(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Ih="164",rr={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},or={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},xg=0,gu=1,bg=2,dp=1,wg=2,Wn=3,Kn=0,zi=1,Ui=2,Zn=0,Or=1,vu=2,_u=3,yu=4,Mg=5,Hs=100,Sg=101,Ag=102,Eg=103,Tg=104,Cg=200,Rg=201,Pg=202,Ig=203,qc=204,$c=205,Lg=206,Fg=207,Bg=208,Dg=209,kg=210,Ng=211,Og=212,Ug=213,zg=214,Vg=0,Hg=1,Gg=2,ol=3,Wg=4,Xg=5,jg=6,Yg=7,Cl=0,qg=1,$g=2,vs=0,Zg=1,Kg=2,Qg=3,Jg=4,e0=5,t0=6,i0=7,xu="attached",n0="detached",fp=300,Yr=301,qr=302,al=303,Zc=304,Rl=306,In=1e3,Tn=1001,ll=1002,li=1003,pp=1004,So=1005,Nt=1006,Qa=1007,Yn=1008,xs=1009,s0=1010,r0=1011,mp=1012,gp=1013,$r=1014,Cn=1015,Jo=1016,vp=1017,_p=1018,ea=1020,o0=35902,a0=1021,l0=1022,vn=1023,c0=1024,h0=1025,Ur=1026,Oo=1027,yp=1028,xp=1029,u0=1030,bp=1031,wp=1033,zl=33776,Vl=33777,Hl=33778,Gl=33779,bu=35840,wu=35841,Mu=35842,Su=35843,Au=36196,Eu=37492,Tu=37496,Cu=37808,Ru=37809,Pu=37810,Iu=37811,Lu=37812,Fu=37813,Bu=37814,Du=37815,ku=37816,Nu=37817,Ou=37818,Uu=37819,zu=37820,Vu=37821,Wl=36492,Hu=36494,Gu=36495,d0=36283,Wu=36284,Xu=36285,ju=36286,f0=2200,p0=2201,m0=2202,Uo=2300,Zr=2301,Xl=2302,Rr=2400,Pr=2401,cl=2402,Lh=2500,g0=2501,v0=0,Mp=1,Kc=2,_0=3200,y0=3201,ta=0,x0=1,ds="",ei="srgb",bi="srgb-linear",Fh="display-p3",Pl="display-p3-linear",hl="linear",Wt="srgb",ul="rec709",dl="p3",ar=7680,Yu=519,b0=512,w0=513,M0=514,Sp=515,S0=516,A0=517,E0=518,T0=519,Qc=35044,qu="300 es",qn=2e3,fl=2001;class As{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let r=0,o=s.length;r<o;r++)s[r].call(this,e);e.target=null}}}const Ti=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let $u=1234567;const zr=Math.PI/180,Kr=180/Math.PI;function _n(){const a=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Ti[a&255]+Ti[a>>8&255]+Ti[a>>16&255]+Ti[a>>24&255]+"-"+Ti[e&255]+Ti[e>>8&255]+"-"+Ti[e>>16&15|64]+Ti[e>>24&255]+"-"+Ti[t&63|128]+Ti[t>>8&255]+"-"+Ti[t>>16&255]+Ti[t>>24&255]+Ti[i&255]+Ti[i>>8&255]+Ti[i>>16&255]+Ti[i>>24&255]).toLowerCase()}function di(a,e,t){return Math.max(e,Math.min(t,a))}function Bh(a,e){return(a%e+e)%e}function C0(a,e,t,i,s){return i+(a-e)*(s-i)/(t-e)}function R0(a,e,t){return a!==e?(t-a)/(e-a):0}function Io(a,e,t){return(1-t)*a+t*e}function P0(a,e,t,i){return Io(a,e,1-Math.exp(-t*i))}function I0(a,e=1){return e-Math.abs(Bh(a,e*2)-e)}function L0(a,e,t){return a<=e?0:a>=t?1:(a=(a-e)/(t-e),a*a*(3-2*a))}function F0(a,e,t){return a<=e?0:a>=t?1:(a=(a-e)/(t-e),a*a*a*(a*(a*6-15)+10))}function B0(a,e){return a+Math.floor(Math.random()*(e-a+1))}function D0(a,e){return a+Math.random()*(e-a)}function k0(a){return a*(.5-Math.random())}function N0(a){a!==void 0&&($u=a);let e=$u+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function O0(a){return a*zr}function U0(a){return a*Kr}function z0(a){return(a&a-1)===0&&a!==0}function V0(a){return Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function H0(a){return Math.pow(2,Math.floor(Math.log(a)/Math.LN2))}function G0(a,e,t,i,s){const r=Math.cos,o=Math.sin,l=r(t/2),h=o(t/2),d=r((e+i)/2),f=o((e+i)/2),c=r((e-i)/2),u=o((e-i)/2),p=r((i-e)/2),m=o((i-e)/2);switch(s){case"XYX":a.set(l*f,h*c,h*u,l*d);break;case"YZY":a.set(h*u,l*f,h*c,l*d);break;case"ZXZ":a.set(h*c,h*u,l*f,l*d);break;case"XZX":a.set(l*f,h*m,h*p,l*d);break;case"YXY":a.set(h*p,l*f,h*m,l*d);break;case"ZYZ":a.set(h*m,h*p,l*f,l*d);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function mn(a,e){switch(e.constructor){case Float32Array:return a;case Uint32Array:return a/4294967295;case Uint16Array:return a/65535;case Uint8Array:return a/255;case Int32Array:return Math.max(a/2147483647,-1);case Int16Array:return Math.max(a/32767,-1);case Int8Array:return Math.max(a/127,-1);default:throw new Error("Invalid component type.")}}function Lt(a,e){switch(e.constructor){case Float32Array:return a;case Uint32Array:return Math.round(a*4294967295);case Uint16Array:return Math.round(a*65535);case Uint8Array:return Math.round(a*255);case Int32Array:return Math.round(a*2147483647);case Int16Array:return Math.round(a*32767);case Int8Array:return Math.round(a*127);default:throw new Error("Invalid component type.")}}const Ai={DEG2RAD:zr,RAD2DEG:Kr,generateUUID:_n,clamp:di,euclideanModulo:Bh,mapLinear:C0,inverseLerp:R0,lerp:Io,damp:P0,pingpong:I0,smoothstep:L0,smootherstep:F0,randInt:B0,randFloat:D0,randFloatSpread:k0,seededRandom:N0,degToRad:O0,radToDeg:U0,isPowerOfTwo:z0,ceilPowerOfTwo:V0,floorPowerOfTwo:H0,setQuaternionFromProperEuler:G0,normalize:Lt,denormalize:mn};class Oe{constructor(e=0,t=0){Oe.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6],this.y=s[1]*t+s[4]*i+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(di(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),s=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*i-o*s+e.x,this.y=r*s+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class pt{constructor(e,t,i,s,r,o,l,h,d){pt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,s,r,o,l,h,d)}set(e,t,i,s,r,o,l,h,d){const f=this.elements;return f[0]=e,f[1]=s,f[2]=l,f[3]=t,f[4]=r,f[5]=h,f[6]=i,f[7]=o,f[8]=d,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,o=i[0],l=i[3],h=i[6],d=i[1],f=i[4],c=i[7],u=i[2],p=i[5],m=i[8],_=s[0],g=s[3],v=s[6],y=s[1],x=s[4],b=s[7],S=s[2],A=s[5],E=s[8];return r[0]=o*_+l*y+h*S,r[3]=o*g+l*x+h*A,r[6]=o*v+l*b+h*E,r[1]=d*_+f*y+c*S,r[4]=d*g+f*x+c*A,r[7]=d*v+f*b+c*E,r[2]=u*_+p*y+m*S,r[5]=u*g+p*x+m*A,r[8]=u*v+p*b+m*E,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],l=e[5],h=e[6],d=e[7],f=e[8];return t*o*f-t*l*d-i*r*f+i*l*h+s*r*d-s*o*h}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],l=e[5],h=e[6],d=e[7],f=e[8],c=f*o-l*d,u=l*h-f*r,p=d*r-o*h,m=t*c+i*u+s*p;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const _=1/m;return e[0]=c*_,e[1]=(s*d-f*i)*_,e[2]=(l*i-s*o)*_,e[3]=u*_,e[4]=(f*t-s*h)*_,e[5]=(s*r-l*t)*_,e[6]=p*_,e[7]=(i*h-d*t)*_,e[8]=(o*t-i*r)*_,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,s,r,o,l){const h=Math.cos(r),d=Math.sin(r);return this.set(i*h,i*d,-i*(h*o+d*l)+o+e,-s*d,s*h,-s*(-d*o+h*l)+l+t,0,0,1),this}scale(e,t){return this.premultiply(jl.makeScale(e,t)),this}rotate(e){return this.premultiply(jl.makeRotation(-e)),this}translate(e,t){return this.premultiply(jl.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<9;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const jl=new pt;function Ap(a){for(let e=a.length-1;e>=0;--e)if(a[e]>=65535)return!0;return!1}function zo(a){return document.createElementNS("http://www.w3.org/1999/xhtml",a)}function W0(){const a=zo("canvas");return a.style.display="block",a}const Zu={};function Ep(a){a in Zu||(Zu[a]=!0,console.warn(a))}const Ku=new pt().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Qu=new pt().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),ca={[bi]:{transfer:hl,primaries:ul,toReference:a=>a,fromReference:a=>a},[ei]:{transfer:Wt,primaries:ul,toReference:a=>a.convertSRGBToLinear(),fromReference:a=>a.convertLinearToSRGB()},[Pl]:{transfer:hl,primaries:dl,toReference:a=>a.applyMatrix3(Qu),fromReference:a=>a.applyMatrix3(Ku)},[Fh]:{transfer:Wt,primaries:dl,toReference:a=>a.convertSRGBToLinear().applyMatrix3(Qu),fromReference:a=>a.applyMatrix3(Ku).convertLinearToSRGB()}},X0=new Set([bi,Pl]),Rt={enabled:!0,_workingColorSpace:bi,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(a){if(!X0.has(a))throw new Error(`Unsupported working color space, "${a}".`);this._workingColorSpace=a},convert:function(a,e,t){if(this.enabled===!1||e===t||!e||!t)return a;const i=ca[e].toReference,s=ca[t].fromReference;return s(i(a))},fromWorkingColorSpace:function(a,e){return this.convert(a,this._workingColorSpace,e)},toWorkingColorSpace:function(a,e){return this.convert(a,e,this._workingColorSpace)},getPrimaries:function(a){return ca[a].primaries},getTransfer:function(a){return a===ds?hl:ca[a].transfer}};function Vr(a){return a<.04045?a*.0773993808:Math.pow(a*.9478672986+.0521327014,2.4)}function Yl(a){return a<.0031308?a*12.92:1.055*Math.pow(a,.41666)-.055}let lr;class j0{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{lr===void 0&&(lr=zo("canvas")),lr.width=e.width,lr.height=e.height;const i=lr.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=lr}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=zo("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),r=s.data;for(let o=0;o<r.length;o++)r[o]=Vr(r[o]/255)*255;return i.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Vr(t[i]/255)*255):t[i]=Vr(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Y0=0;class Tp{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Y0++}),this.uuid=_n(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let o=0,l=s.length;o<l;o++)s[o].isDataTexture?r.push(ql(s[o].image)):r.push(ql(s[o]))}else r=ql(s);i.url=r}return t||(e.images[this.uuid]=i),i}}function ql(a){return typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&a instanceof ImageBitmap?j0.getDataURL(a):a.data?{data:Array.from(a.data),width:a.width,height:a.height,type:a.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let q0=0;class Ht extends As{constructor(e=Ht.DEFAULT_IMAGE,t=Ht.DEFAULT_MAPPING,i=Tn,s=Tn,r=Nt,o=Yn,l=vn,h=xs,d=Ht.DEFAULT_ANISOTROPY,f=ds){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:q0++}),this.uuid=_n(),this.name="",this.source=new Tp(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=r,this.minFilter=o,this.anisotropy=d,this.format=l,this.internalFormat=null,this.type=h,this.offset=new Oe(0,0),this.repeat=new Oe(1,1),this.center=new Oe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new pt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=f,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==fp)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case In:e.x=e.x-Math.floor(e.x);break;case Tn:e.x=e.x<0?0:1;break;case ll:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case In:e.y=e.y-Math.floor(e.y);break;case Tn:e.y=e.y<0?0:1;break;case ll:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Ht.DEFAULT_IMAGE=null;Ht.DEFAULT_MAPPING=fp;Ht.DEFAULT_ANISOTROPY=1;class Ct{constructor(e=0,t=0,i=0,s=1){Ct.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*s+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*s+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*s+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*s+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,s,r;const h=e.elements,d=h[0],f=h[4],c=h[8],u=h[1],p=h[5],m=h[9],_=h[2],g=h[6],v=h[10];if(Math.abs(f-u)<.01&&Math.abs(c-_)<.01&&Math.abs(m-g)<.01){if(Math.abs(f+u)<.1&&Math.abs(c+_)<.1&&Math.abs(m+g)<.1&&Math.abs(d+p+v-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const x=(d+1)/2,b=(p+1)/2,S=(v+1)/2,A=(f+u)/4,E=(c+_)/4,R=(m+g)/4;return x>b&&x>S?x<.01?(i=0,s=.707106781,r=.707106781):(i=Math.sqrt(x),s=A/i,r=E/i):b>S?b<.01?(i=.707106781,s=0,r=.707106781):(s=Math.sqrt(b),i=A/s,r=R/s):S<.01?(i=.707106781,s=.707106781,r=0):(r=Math.sqrt(S),i=E/r,s=R/r),this.set(i,s,r,t),this}let y=Math.sqrt((g-m)*(g-m)+(c-_)*(c-_)+(u-f)*(u-f));return Math.abs(y)<.001&&(y=1),this.x=(g-m)/y,this.y=(c-_)/y,this.z=(u-f)/y,this.w=Math.acos((d+p+v-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class $0 extends As{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Ct(0,0,e,t),this.scissorTest=!1,this.viewport=new Ct(0,0,e,t);const s={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Nt,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const r=new Ht(s,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);r.flipY=!1,r.generateMipmaps=i.generateMipmaps,r.internalFormat=i.internalFormat,this.textures=[];const o=i.count;for(let l=0;l<o;l++)this.textures[l]=r.clone(),this.textures[l].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let s=0,r=this.textures.length;s<r;s++)this.textures[s].image.width=e,this.textures[s].image.height=t,this.textures[s].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,s=e.textures.length;i<s;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Tp(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class bs extends $0{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class Cp extends Ht{constructor(e=null,t=1,i=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=li,this.minFilter=li,this.wrapR=Tn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Z0 extends Ht{constructor(e=null,t=1,i=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=li,this.minFilter=li,this.wrapR=Tn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Tt{constructor(e=0,t=0,i=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=s}static slerpFlat(e,t,i,s,r,o,l){let h=i[s+0],d=i[s+1],f=i[s+2],c=i[s+3];const u=r[o+0],p=r[o+1],m=r[o+2],_=r[o+3];if(l===0){e[t+0]=h,e[t+1]=d,e[t+2]=f,e[t+3]=c;return}if(l===1){e[t+0]=u,e[t+1]=p,e[t+2]=m,e[t+3]=_;return}if(c!==_||h!==u||d!==p||f!==m){let g=1-l;const v=h*u+d*p+f*m+c*_,y=v>=0?1:-1,x=1-v*v;if(x>Number.EPSILON){const S=Math.sqrt(x),A=Math.atan2(S,v*y);g=Math.sin(g*A)/S,l=Math.sin(l*A)/S}const b=l*y;if(h=h*g+u*b,d=d*g+p*b,f=f*g+m*b,c=c*g+_*b,g===1-l){const S=1/Math.sqrt(h*h+d*d+f*f+c*c);h*=S,d*=S,f*=S,c*=S}}e[t]=h,e[t+1]=d,e[t+2]=f,e[t+3]=c}static multiplyQuaternionsFlat(e,t,i,s,r,o){const l=i[s],h=i[s+1],d=i[s+2],f=i[s+3],c=r[o],u=r[o+1],p=r[o+2],m=r[o+3];return e[t]=l*m+f*c+h*p-d*u,e[t+1]=h*m+f*u+d*c-l*p,e[t+2]=d*m+f*p+l*u-h*c,e[t+3]=f*m-l*c-h*u-d*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,s=e._y,r=e._z,o=e._order,l=Math.cos,h=Math.sin,d=l(i/2),f=l(s/2),c=l(r/2),u=h(i/2),p=h(s/2),m=h(r/2);switch(o){case"XYZ":this._x=u*f*c+d*p*m,this._y=d*p*c-u*f*m,this._z=d*f*m+u*p*c,this._w=d*f*c-u*p*m;break;case"YXZ":this._x=u*f*c+d*p*m,this._y=d*p*c-u*f*m,this._z=d*f*m-u*p*c,this._w=d*f*c+u*p*m;break;case"ZXY":this._x=u*f*c-d*p*m,this._y=d*p*c+u*f*m,this._z=d*f*m+u*p*c,this._w=d*f*c-u*p*m;break;case"ZYX":this._x=u*f*c-d*p*m,this._y=d*p*c+u*f*m,this._z=d*f*m-u*p*c,this._w=d*f*c+u*p*m;break;case"YZX":this._x=u*f*c+d*p*m,this._y=d*p*c+u*f*m,this._z=d*f*m-u*p*c,this._w=d*f*c-u*p*m;break;case"XZY":this._x=u*f*c-d*p*m,this._y=d*p*c-u*f*m,this._z=d*f*m+u*p*c,this._w=d*f*c+u*p*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,s=Math.sin(i);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],s=t[4],r=t[8],o=t[1],l=t[5],h=t[9],d=t[2],f=t[6],c=t[10],u=i+l+c;if(u>0){const p=.5/Math.sqrt(u+1);this._w=.25/p,this._x=(f-h)*p,this._y=(r-d)*p,this._z=(o-s)*p}else if(i>l&&i>c){const p=2*Math.sqrt(1+i-l-c);this._w=(f-h)/p,this._x=.25*p,this._y=(s+o)/p,this._z=(r+d)/p}else if(l>c){const p=2*Math.sqrt(1+l-i-c);this._w=(r-d)/p,this._x=(s+o)/p,this._y=.25*p,this._z=(h+f)/p}else{const p=2*Math.sqrt(1+c-i-l);this._w=(o-s)/p,this._x=(r+d)/p,this._y=(h+f)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(di(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const s=Math.min(1,t/i);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,s=e._y,r=e._z,o=e._w,l=t._x,h=t._y,d=t._z,f=t._w;return this._x=i*f+o*l+s*d-r*h,this._y=s*f+o*h+r*l-i*d,this._z=r*f+o*d+i*h-s*l,this._w=o*f-i*l-s*h-r*d,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,s=this._y,r=this._z,o=this._w;let l=o*e._w+i*e._x+s*e._y+r*e._z;if(l<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,l=-l):this.copy(e),l>=1)return this._w=o,this._x=i,this._y=s,this._z=r,this;const h=1-l*l;if(h<=Number.EPSILON){const p=1-t;return this._w=p*o+t*this._w,this._x=p*i+t*this._x,this._y=p*s+t*this._y,this._z=p*r+t*this._z,this.normalize(),this}const d=Math.sqrt(h),f=Math.atan2(d,l),c=Math.sin((1-t)*f)/d,u=Math.sin(t*f)/d;return this._w=o*c+this._w*u,this._x=i*c+this._x*u,this._y=s*c+this._y*u,this._z=r*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),s=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(s*Math.sin(e),s*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class T{constructor(e=0,t=0,i=0){T.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Ju.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Ju.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*s,this.y=r[1]*t+r[4]*i+r[7]*s,this.z=r[2]*t+r[5]*i+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*s+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*s+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*s+r[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,s=this.z,r=e.x,o=e.y,l=e.z,h=e.w,d=2*(o*s-l*i),f=2*(l*t-r*s),c=2*(r*i-o*t);return this.x=t+h*d+o*c-l*f,this.y=i+h*f+l*d-r*c,this.z=s+h*c+r*f-o*d,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*s,this.y=r[1]*t+r[5]*i+r[9]*s,this.z=r[2]*t+r[6]*i+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,s=e.y,r=e.z,o=t.x,l=t.y,h=t.z;return this.x=s*h-r*l,this.y=r*o-i*h,this.z=i*l-s*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return $l.copy(this).projectOnVector(e),this.sub($l)}reflect(e){return this.sub($l.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(di(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const s=Math.sin(t)*e;return this.x=s*Math.sin(i),this.y=Math.cos(t)*e,this.z=s*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const $l=new T,Ju=new Tt;class ft{constructor(e=new T(1/0,1/0,1/0),t=new T(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(cn.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(cn.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=cn.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const r=i.getAttribute("position");if(t===!0&&r!==void 0&&e.isInstancedMesh!==!0)for(let o=0,l=r.count;o<l;o++)e.isMesh===!0?e.getVertexPosition(o,cn):cn.fromBufferAttribute(r,o),cn.applyMatrix4(e.matrixWorld),this.expandByPoint(cn);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),ha.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),ha.copy(i.boundingBox)),ha.applyMatrix4(e.matrixWorld),this.union(ha)}const s=e.children;for(let r=0,o=s.length;r<o;r++)this.expandByObject(s[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,cn),cn.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(lo),ua.subVectors(this.max,lo),cr.subVectors(e.a,lo),hr.subVectors(e.b,lo),ur.subVectors(e.c,lo),ts.subVectors(hr,cr),is.subVectors(ur,hr),Rs.subVectors(cr,ur);let t=[0,-ts.z,ts.y,0,-is.z,is.y,0,-Rs.z,Rs.y,ts.z,0,-ts.x,is.z,0,-is.x,Rs.z,0,-Rs.x,-ts.y,ts.x,0,-is.y,is.x,0,-Rs.y,Rs.x,0];return!Zl(t,cr,hr,ur,ua)||(t=[1,0,0,0,1,0,0,0,1],!Zl(t,cr,hr,ur,ua))?!1:(da.crossVectors(ts,is),t=[da.x,da.y,da.z],Zl(t,cr,hr,ur,ua))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,cn).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(cn).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(On[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),On[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),On[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),On[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),On[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),On[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),On[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),On[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(On),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const On=[new T,new T,new T,new T,new T,new T,new T,new T],cn=new T,ha=new ft,cr=new T,hr=new T,ur=new T,ts=new T,is=new T,Rs=new T,lo=new T,ua=new T,da=new T,Ps=new T;function Zl(a,e,t,i,s){for(let r=0,o=a.length-3;r<=o;r+=3){Ps.fromArray(a,r);const l=s.x*Math.abs(Ps.x)+s.y*Math.abs(Ps.y)+s.z*Math.abs(Ps.z),h=e.dot(Ps),d=t.dot(Ps),f=i.dot(Ps);if(Math.max(-Math.max(h,d,f),Math.min(h,d,f))>l)return!1}return!0}const K0=new ft,co=new T,Kl=new T;class Bn{constructor(e=new T,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):K0.setFromPoints(e).getCenter(i);let s=0;for(let r=0,o=e.length;r<o;r++)s=Math.max(s,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;co.subVectors(e,this.center);const t=co.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),s=(i-this.radius)*.5;this.center.addScaledVector(co,s/i),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Kl.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(co.copy(e.center).add(Kl)),this.expandByPoint(co.copy(e.center).sub(Kl))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Un=new T,Ql=new T,fa=new T,ns=new T,Jl=new T,pa=new T,ec=new T;class so{constructor(e=new T,t=new T(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Un)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Un.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Un.copy(this.origin).addScaledVector(this.direction,t),Un.distanceToSquared(e))}distanceSqToSegment(e,t,i,s){Ql.copy(e).add(t).multiplyScalar(.5),fa.copy(t).sub(e).normalize(),ns.copy(this.origin).sub(Ql);const r=e.distanceTo(t)*.5,o=-this.direction.dot(fa),l=ns.dot(this.direction),h=-ns.dot(fa),d=ns.lengthSq(),f=Math.abs(1-o*o);let c,u,p,m;if(f>0)if(c=o*h-l,u=o*l-h,m=r*f,c>=0)if(u>=-m)if(u<=m){const _=1/f;c*=_,u*=_,p=c*(c+o*u+2*l)+u*(o*c+u+2*h)+d}else u=r,c=Math.max(0,-(o*u+l)),p=-c*c+u*(u+2*h)+d;else u=-r,c=Math.max(0,-(o*u+l)),p=-c*c+u*(u+2*h)+d;else u<=-m?(c=Math.max(0,-(-o*r+l)),u=c>0?-r:Math.min(Math.max(-r,-h),r),p=-c*c+u*(u+2*h)+d):u<=m?(c=0,u=Math.min(Math.max(-r,-h),r),p=u*(u+2*h)+d):(c=Math.max(0,-(o*r+l)),u=c>0?r:Math.min(Math.max(-r,-h),r),p=-c*c+u*(u+2*h)+d);else u=o>0?-r:r,c=Math.max(0,-(o*u+l)),p=-c*c+u*(u+2*h)+d;return i&&i.copy(this.origin).addScaledVector(this.direction,c),s&&s.copy(Ql).addScaledVector(fa,u),p}intersectSphere(e,t){Un.subVectors(e.center,this.origin);const i=Un.dot(this.direction),s=Un.dot(Un)-i*i,r=e.radius*e.radius;if(s>r)return null;const o=Math.sqrt(r-s),l=i-o,h=i+o;return h<0?null:l<0?this.at(h,t):this.at(l,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,s,r,o,l,h;const d=1/this.direction.x,f=1/this.direction.y,c=1/this.direction.z,u=this.origin;return d>=0?(i=(e.min.x-u.x)*d,s=(e.max.x-u.x)*d):(i=(e.max.x-u.x)*d,s=(e.min.x-u.x)*d),f>=0?(r=(e.min.y-u.y)*f,o=(e.max.y-u.y)*f):(r=(e.max.y-u.y)*f,o=(e.min.y-u.y)*f),i>o||r>s||((r>i||isNaN(i))&&(i=r),(o<s||isNaN(s))&&(s=o),c>=0?(l=(e.min.z-u.z)*c,h=(e.max.z-u.z)*c):(l=(e.max.z-u.z)*c,h=(e.min.z-u.z)*c),i>h||l>s)||((l>i||i!==i)&&(i=l),(h<s||s!==s)&&(s=h),s<0)?null:this.at(i>=0?i:s,t)}intersectsBox(e){return this.intersectBox(e,Un)!==null}intersectTriangle(e,t,i,s,r){Jl.subVectors(t,e),pa.subVectors(i,e),ec.crossVectors(Jl,pa);let o=this.direction.dot(ec),l;if(o>0){if(s)return null;l=1}else if(o<0)l=-1,o=-o;else return null;ns.subVectors(this.origin,e);const h=l*this.direction.dot(pa.crossVectors(ns,pa));if(h<0)return null;const d=l*this.direction.dot(Jl.cross(ns));if(d<0||h+d>o)return null;const f=-l*ns.dot(ec);return f<0?null:this.at(f/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Je{constructor(e,t,i,s,r,o,l,h,d,f,c,u,p,m,_,g){Je.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,s,r,o,l,h,d,f,c,u,p,m,_,g)}set(e,t,i,s,r,o,l,h,d,f,c,u,p,m,_,g){const v=this.elements;return v[0]=e,v[4]=t,v[8]=i,v[12]=s,v[1]=r,v[5]=o,v[9]=l,v[13]=h,v[2]=d,v[6]=f,v[10]=c,v[14]=u,v[3]=p,v[7]=m,v[11]=_,v[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Je().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,s=1/dr.setFromMatrixColumn(e,0).length(),r=1/dr.setFromMatrixColumn(e,1).length(),o=1/dr.setFromMatrixColumn(e,2).length();return t[0]=i[0]*s,t[1]=i[1]*s,t[2]=i[2]*s,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,s=e.y,r=e.z,o=Math.cos(i),l=Math.sin(i),h=Math.cos(s),d=Math.sin(s),f=Math.cos(r),c=Math.sin(r);if(e.order==="XYZ"){const u=o*f,p=o*c,m=l*f,_=l*c;t[0]=h*f,t[4]=-h*c,t[8]=d,t[1]=p+m*d,t[5]=u-_*d,t[9]=-l*h,t[2]=_-u*d,t[6]=m+p*d,t[10]=o*h}else if(e.order==="YXZ"){const u=h*f,p=h*c,m=d*f,_=d*c;t[0]=u+_*l,t[4]=m*l-p,t[8]=o*d,t[1]=o*c,t[5]=o*f,t[9]=-l,t[2]=p*l-m,t[6]=_+u*l,t[10]=o*h}else if(e.order==="ZXY"){const u=h*f,p=h*c,m=d*f,_=d*c;t[0]=u-_*l,t[4]=-o*c,t[8]=m+p*l,t[1]=p+m*l,t[5]=o*f,t[9]=_-u*l,t[2]=-o*d,t[6]=l,t[10]=o*h}else if(e.order==="ZYX"){const u=o*f,p=o*c,m=l*f,_=l*c;t[0]=h*f,t[4]=m*d-p,t[8]=u*d+_,t[1]=h*c,t[5]=_*d+u,t[9]=p*d-m,t[2]=-d,t[6]=l*h,t[10]=o*h}else if(e.order==="YZX"){const u=o*h,p=o*d,m=l*h,_=l*d;t[0]=h*f,t[4]=_-u*c,t[8]=m*c+p,t[1]=c,t[5]=o*f,t[9]=-l*f,t[2]=-d*f,t[6]=p*c+m,t[10]=u-_*c}else if(e.order==="XZY"){const u=o*h,p=o*d,m=l*h,_=l*d;t[0]=h*f,t[4]=-c,t[8]=d*f,t[1]=u*c+_,t[5]=o*f,t[9]=p*c-m,t[2]=m*c-p,t[6]=l*f,t[10]=_*c+u}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Q0,e,J0)}lookAt(e,t,i){const s=this.elements;return ji.subVectors(e,t),ji.lengthSq()===0&&(ji.z=1),ji.normalize(),ss.crossVectors(i,ji),ss.lengthSq()===0&&(Math.abs(i.z)===1?ji.x+=1e-4:ji.z+=1e-4,ji.normalize(),ss.crossVectors(i,ji)),ss.normalize(),ma.crossVectors(ji,ss),s[0]=ss.x,s[4]=ma.x,s[8]=ji.x,s[1]=ss.y,s[5]=ma.y,s[9]=ji.y,s[2]=ss.z,s[6]=ma.z,s[10]=ji.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,o=i[0],l=i[4],h=i[8],d=i[12],f=i[1],c=i[5],u=i[9],p=i[13],m=i[2],_=i[6],g=i[10],v=i[14],y=i[3],x=i[7],b=i[11],S=i[15],A=s[0],E=s[4],R=s[8],M=s[12],w=s[1],L=s[5],N=s[9],B=s[13],G=s[2],W=s[6],ee=s[10],z=s[14],k=s[3],q=s[7],$=s[11],H=s[15];return r[0]=o*A+l*w+h*G+d*k,r[4]=o*E+l*L+h*W+d*q,r[8]=o*R+l*N+h*ee+d*$,r[12]=o*M+l*B+h*z+d*H,r[1]=f*A+c*w+u*G+p*k,r[5]=f*E+c*L+u*W+p*q,r[9]=f*R+c*N+u*ee+p*$,r[13]=f*M+c*B+u*z+p*H,r[2]=m*A+_*w+g*G+v*k,r[6]=m*E+_*L+g*W+v*q,r[10]=m*R+_*N+g*ee+v*$,r[14]=m*M+_*B+g*z+v*H,r[3]=y*A+x*w+b*G+S*k,r[7]=y*E+x*L+b*W+S*q,r[11]=y*R+x*N+b*ee+S*$,r[15]=y*M+x*B+b*z+S*H,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],s=e[8],r=e[12],o=e[1],l=e[5],h=e[9],d=e[13],f=e[2],c=e[6],u=e[10],p=e[14],m=e[3],_=e[7],g=e[11],v=e[15];return m*(+r*h*c-s*d*c-r*l*u+i*d*u+s*l*p-i*h*p)+_*(+t*h*p-t*d*u+r*o*u-s*o*p+s*d*f-r*h*f)+g*(+t*d*c-t*l*p-r*o*c+i*o*p+r*l*f-i*d*f)+v*(-s*l*f-t*h*c+t*l*u+s*o*c-i*o*u+i*h*f)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],l=e[5],h=e[6],d=e[7],f=e[8],c=e[9],u=e[10],p=e[11],m=e[12],_=e[13],g=e[14],v=e[15],y=c*g*d-_*u*d+_*h*p-l*g*p-c*h*v+l*u*v,x=m*u*d-f*g*d-m*h*p+o*g*p+f*h*v-o*u*v,b=f*_*d-m*c*d+m*l*p-o*_*p-f*l*v+o*c*v,S=m*c*h-f*_*h-m*l*u+o*_*u+f*l*g-o*c*g,A=t*y+i*x+s*b+r*S;if(A===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const E=1/A;return e[0]=y*E,e[1]=(_*u*r-c*g*r-_*s*p+i*g*p+c*s*v-i*u*v)*E,e[2]=(l*g*r-_*h*r+_*s*d-i*g*d-l*s*v+i*h*v)*E,e[3]=(c*h*r-l*u*r-c*s*d+i*u*d+l*s*p-i*h*p)*E,e[4]=x*E,e[5]=(f*g*r-m*u*r+m*s*p-t*g*p-f*s*v+t*u*v)*E,e[6]=(m*h*r-o*g*r-m*s*d+t*g*d+o*s*v-t*h*v)*E,e[7]=(o*u*r-f*h*r+f*s*d-t*u*d-o*s*p+t*h*p)*E,e[8]=b*E,e[9]=(m*c*r-f*_*r-m*i*p+t*_*p+f*i*v-t*c*v)*E,e[10]=(o*_*r-m*l*r+m*i*d-t*_*d-o*i*v+t*l*v)*E,e[11]=(f*l*r-o*c*r-f*i*d+t*c*d+o*i*p-t*l*p)*E,e[12]=S*E,e[13]=(f*_*s-m*c*s+m*i*u-t*_*u-f*i*g+t*c*g)*E,e[14]=(m*l*s-o*_*s-m*i*h+t*_*h+o*i*g-t*l*g)*E,e[15]=(o*c*s-f*l*s+f*i*h-t*c*h-o*i*u+t*l*u)*E,this}scale(e){const t=this.elements,i=e.x,s=e.y,r=e.z;return t[0]*=i,t[4]*=s,t[8]*=r,t[1]*=i,t[5]*=s,t[9]*=r,t[2]*=i,t[6]*=s,t[10]*=r,t[3]*=i,t[7]*=s,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,s))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),s=Math.sin(t),r=1-i,o=e.x,l=e.y,h=e.z,d=r*o,f=r*l;return this.set(d*o+i,d*l-s*h,d*h+s*l,0,d*l+s*h,f*l+i,f*h-s*o,0,d*h-s*l,f*h+s*o,r*h*h+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,s,r,o){return this.set(1,i,r,0,e,1,o,0,t,s,1,0,0,0,0,1),this}compose(e,t,i){const s=this.elements,r=t._x,o=t._y,l=t._z,h=t._w,d=r+r,f=o+o,c=l+l,u=r*d,p=r*f,m=r*c,_=o*f,g=o*c,v=l*c,y=h*d,x=h*f,b=h*c,S=i.x,A=i.y,E=i.z;return s[0]=(1-(_+v))*S,s[1]=(p+b)*S,s[2]=(m-x)*S,s[3]=0,s[4]=(p-b)*A,s[5]=(1-(u+v))*A,s[6]=(g+y)*A,s[7]=0,s[8]=(m+x)*E,s[9]=(g-y)*E,s[10]=(1-(u+_))*E,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,i){const s=this.elements;let r=dr.set(s[0],s[1],s[2]).length();const o=dr.set(s[4],s[5],s[6]).length(),l=dr.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),e.x=s[12],e.y=s[13],e.z=s[14],hn.copy(this);const d=1/r,f=1/o,c=1/l;return hn.elements[0]*=d,hn.elements[1]*=d,hn.elements[2]*=d,hn.elements[4]*=f,hn.elements[5]*=f,hn.elements[6]*=f,hn.elements[8]*=c,hn.elements[9]*=c,hn.elements[10]*=c,t.setFromRotationMatrix(hn),i.x=r,i.y=o,i.z=l,this}makePerspective(e,t,i,s,r,o,l=qn){const h=this.elements,d=2*r/(t-e),f=2*r/(i-s),c=(t+e)/(t-e),u=(i+s)/(i-s);let p,m;if(l===qn)p=-(o+r)/(o-r),m=-2*o*r/(o-r);else if(l===fl)p=-o/(o-r),m=-o*r/(o-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);return h[0]=d,h[4]=0,h[8]=c,h[12]=0,h[1]=0,h[5]=f,h[9]=u,h[13]=0,h[2]=0,h[6]=0,h[10]=p,h[14]=m,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(e,t,i,s,r,o,l=qn){const h=this.elements,d=1/(t-e),f=1/(i-s),c=1/(o-r),u=(t+e)*d,p=(i+s)*f;let m,_;if(l===qn)m=(o+r)*c,_=-2*c;else if(l===fl)m=r*c,_=-1*c;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);return h[0]=2*d,h[4]=0,h[8]=0,h[12]=-u,h[1]=0,h[5]=2*f,h[9]=0,h[13]=-p,h[2]=0,h[6]=0,h[10]=_,h[14]=-m,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<16;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const dr=new T,hn=new Je,Q0=new T(0,0,0),J0=new T(1,1,1),ss=new T,ma=new T,ji=new T,ed=new Je,td=new Tt;class At{constructor(e=0,t=0,i=0,s=At.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,s=this._order){return this._x=e,this._y=t,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const s=e.elements,r=s[0],o=s[4],l=s[8],h=s[1],d=s[5],f=s[9],c=s[2],u=s[6],p=s[10];switch(t){case"XYZ":this._y=Math.asin(di(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-f,p),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(u,d),this._z=0);break;case"YXZ":this._x=Math.asin(-di(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(l,p),this._z=Math.atan2(h,d)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(di(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,p),this._z=Math.atan2(-o,d)):(this._y=0,this._z=Math.atan2(h,r));break;case"ZYX":this._y=Math.asin(-di(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,p),this._z=Math.atan2(h,r)):(this._x=0,this._z=Math.atan2(-o,d));break;case"YZX":this._z=Math.asin(di(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-f,d),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(l,p));break;case"XZY":this._z=Math.asin(-di(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(u,d),this._y=Math.atan2(l,r)):(this._x=Math.atan2(-f,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return ed.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ed,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return td.setFromEuler(this),this.setFromQuaternion(td,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}At.DEFAULT_ORDER="XYZ";class Dh{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let ev=0;const id=new T,fr=new Tt,zn=new Je,ga=new T,ho=new T,tv=new T,iv=new Tt,nd=new T(1,0,0),sd=new T(0,1,0),rd=new T(0,0,1),od={type:"added"},nv={type:"removed"},pr={type:"childadded",child:null},tc={type:"childremoved",child:null};class je extends As{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ev++}),this.uuid=_n(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=je.DEFAULT_UP.clone();const e=new T,t=new At,i=new Tt,s=new T(1,1,1);function r(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(r),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Je},normalMatrix:{value:new pt}}),this.matrix=new Je,this.matrixWorld=new Je,this.matrixAutoUpdate=je.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=je.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Dh,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return fr.setFromAxisAngle(e,t),this.quaternion.multiply(fr),this}rotateOnWorldAxis(e,t){return fr.setFromAxisAngle(e,t),this.quaternion.premultiply(fr),this}rotateX(e){return this.rotateOnAxis(nd,e)}rotateY(e){return this.rotateOnAxis(sd,e)}rotateZ(e){return this.rotateOnAxis(rd,e)}translateOnAxis(e,t){return id.copy(e).applyQuaternion(this.quaternion),this.position.add(id.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(nd,e)}translateY(e){return this.translateOnAxis(sd,e)}translateZ(e){return this.translateOnAxis(rd,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(zn.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?ga.copy(e):ga.set(e,t,i);const s=this.parent;this.updateWorldMatrix(!0,!1),ho.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?zn.lookAt(ho,ga,this.up):zn.lookAt(ga,ho,this.up),this.quaternion.setFromRotationMatrix(zn),s&&(zn.extractRotation(s.matrixWorld),fr.setFromRotationMatrix(zn),this.quaternion.premultiply(fr.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(od),pr.child=e,this.dispatchEvent(pr),pr.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(nv),tc.child=e,this.dispatchEvent(tc),tc.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),zn.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),zn.multiply(e.parent.matrixWorld)),e.applyMatrix4(zn),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(od),pr.child=e,this.dispatchEvent(pr),pr.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,s=this.children.length;i<s;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const s=this.children;for(let r=0,o=s.length;r<o;r++)s[r].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ho,e,tv),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ho,iv,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,s=t.length;i<s;i++){const r=t[i];(r.matrixWorldAutoUpdate===!0||e===!0)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const s=this.children;for(let r=0,o=s.length;r<o;r++){const l=s[r];l.matrixWorldAutoUpdate===!0&&l.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(l=>({boxInitialized:l.boxInitialized,boxMin:l.box.min.toArray(),boxMax:l.box.max.toArray(),sphereInitialized:l.sphereInitialized,sphereRadius:l.sphere.radius,sphereCenter:l.sphere.center.toArray()})),s.maxGeometryCount=this._maxGeometryCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function r(l,h){return l[h.uuid]===void 0&&(l[h.uuid]=h.toJSON(e)),h.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(e.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const h=l.shapes;if(Array.isArray(h))for(let d=0,f=h.length;d<f;d++){const c=h[d];r(e.shapes,c)}else r(e.shapes,h)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let h=0,d=this.material.length;h<d;h++)l.push(r(e.materials,this.material[h]));s.material=l}else s.material=r(e.materials,this.material);if(this.children.length>0){s.children=[];for(let l=0;l<this.children.length;l++)s.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let l=0;l<this.animations.length;l++){const h=this.animations[l];s.animations.push(r(e.animations,h))}}if(t){const l=o(e.geometries),h=o(e.materials),d=o(e.textures),f=o(e.images),c=o(e.shapes),u=o(e.skeletons),p=o(e.animations),m=o(e.nodes);l.length>0&&(i.geometries=l),h.length>0&&(i.materials=h),d.length>0&&(i.textures=d),f.length>0&&(i.images=f),c.length>0&&(i.shapes=c),u.length>0&&(i.skeletons=u),p.length>0&&(i.animations=p),m.length>0&&(i.nodes=m)}return i.object=s,i;function o(l){const h=[];for(const d in l){const f=l[d];delete f.metadata,h.push(f)}return h}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const s=e.children[i];this.add(s.clone())}return this}}je.DEFAULT_UP=new T(0,1,0);je.DEFAULT_MATRIX_AUTO_UPDATE=!0;je.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const un=new T,Vn=new T,ic=new T,Hn=new T,mr=new T,gr=new T,ad=new T,nc=new T,sc=new T,rc=new T;class gn{constructor(e=new T,t=new T,i=new T){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,s){s.subVectors(i,t),un.subVectors(e,t),s.cross(un);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(e,t,i,s,r){un.subVectors(s,t),Vn.subVectors(i,t),ic.subVectors(e,t);const o=un.dot(un),l=un.dot(Vn),h=un.dot(ic),d=Vn.dot(Vn),f=Vn.dot(ic),c=o*d-l*l;if(c===0)return r.set(0,0,0),null;const u=1/c,p=(d*h-l*f)*u,m=(o*f-l*h)*u;return r.set(1-p-m,m,p)}static containsPoint(e,t,i,s){return this.getBarycoord(e,t,i,s,Hn)===null?!1:Hn.x>=0&&Hn.y>=0&&Hn.x+Hn.y<=1}static getInterpolation(e,t,i,s,r,o,l,h){return this.getBarycoord(e,t,i,s,Hn)===null?(h.x=0,h.y=0,"z"in h&&(h.z=0),"w"in h&&(h.w=0),null):(h.setScalar(0),h.addScaledVector(r,Hn.x),h.addScaledVector(o,Hn.y),h.addScaledVector(l,Hn.z),h)}static isFrontFacing(e,t,i,s){return un.subVectors(i,t),Vn.subVectors(e,t),un.cross(Vn).dot(s)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,s){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,i,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return un.subVectors(this.c,this.b),Vn.subVectors(this.a,this.b),un.cross(Vn).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return gn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return gn.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,s,r){return gn.getInterpolation(e,this.a,this.b,this.c,t,i,s,r)}containsPoint(e){return gn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return gn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,s=this.b,r=this.c;let o,l;mr.subVectors(s,i),gr.subVectors(r,i),nc.subVectors(e,i);const h=mr.dot(nc),d=gr.dot(nc);if(h<=0&&d<=0)return t.copy(i);sc.subVectors(e,s);const f=mr.dot(sc),c=gr.dot(sc);if(f>=0&&c<=f)return t.copy(s);const u=h*c-f*d;if(u<=0&&h>=0&&f<=0)return o=h/(h-f),t.copy(i).addScaledVector(mr,o);rc.subVectors(e,r);const p=mr.dot(rc),m=gr.dot(rc);if(m>=0&&p<=m)return t.copy(r);const _=p*d-h*m;if(_<=0&&d>=0&&m<=0)return l=d/(d-m),t.copy(i).addScaledVector(gr,l);const g=f*m-p*c;if(g<=0&&c-f>=0&&p-m>=0)return ad.subVectors(r,s),l=(c-f)/(c-f+(p-m)),t.copy(s).addScaledVector(ad,l);const v=1/(g+_+u);return o=_*v,l=u*v,t.copy(i).addScaledVector(mr,o).addScaledVector(gr,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Rp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},rs={h:0,s:0,l:0},va={h:0,s:0,l:0};function oc(a,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?a+(e-a)*6*t:t<1/2?e:t<2/3?a+(e-a)*6*(2/3-t):a}let Le=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=ei){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Rt.toWorkingColorSpace(this,t),this}setRGB(e,t,i,s=Rt.workingColorSpace){return this.r=e,this.g=t,this.b=i,Rt.toWorkingColorSpace(this,s),this}setHSL(e,t,i,s=Rt.workingColorSpace){if(e=Bh(e,1),t=di(t,0,1),i=di(i,0,1),t===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,o=2*i-r;this.r=oc(o,r,e+1/3),this.g=oc(o,r,e),this.b=oc(o,r,e-1/3)}return Rt.toWorkingColorSpace(this,s),this}setStyle(e,t=ei){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=s[1],l=s[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=s[1],o=r.length;if(o===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=ei){const i=Rp[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Vr(e.r),this.g=Vr(e.g),this.b=Vr(e.b),this}copyLinearToSRGB(e){return this.r=Yl(e.r),this.g=Yl(e.g),this.b=Yl(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ei){return Rt.fromWorkingColorSpace(Ci.copy(this),e),Math.round(di(Ci.r*255,0,255))*65536+Math.round(di(Ci.g*255,0,255))*256+Math.round(di(Ci.b*255,0,255))}getHexString(e=ei){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Rt.workingColorSpace){Rt.fromWorkingColorSpace(Ci.copy(this),t);const i=Ci.r,s=Ci.g,r=Ci.b,o=Math.max(i,s,r),l=Math.min(i,s,r);let h,d;const f=(l+o)/2;if(l===o)h=0,d=0;else{const c=o-l;switch(d=f<=.5?c/(o+l):c/(2-o-l),o){case i:h=(s-r)/c+(s<r?6:0);break;case s:h=(r-i)/c+2;break;case r:h=(i-s)/c+4;break}h/=6}return e.h=h,e.s=d,e.l=f,e}getRGB(e,t=Rt.workingColorSpace){return Rt.fromWorkingColorSpace(Ci.copy(this),t),e.r=Ci.r,e.g=Ci.g,e.b=Ci.b,e}getStyle(e=ei){Rt.fromWorkingColorSpace(Ci.copy(this),e);const t=Ci.r,i=Ci.g,s=Ci.b;return e!==ei?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(s*255)})`}offsetHSL(e,t,i){return this.getHSL(rs),this.setHSL(rs.h+e,rs.s+t,rs.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(rs),e.getHSL(va);const i=Io(rs.h,va.h,t),s=Io(rs.s,va.s,t),r=Io(rs.l,va.l,t);return this.setHSL(i,s,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,s=this.b,r=e.elements;return this.r=r[0]*t+r[3]*i+r[6]*s,this.g=r[1]*t+r[4]*i+r[7]*s,this.b=r[2]*t+r[5]*i+r[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const Ci=new Le;Le.NAMES=Rp;let sv=0;class Qi extends As{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:sv++}),this.uuid=_n(),this.name="",this.type="Material",this.blending=Or,this.side=Kn,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=qc,this.blendDst=$c,this.blendEquation=Hs,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Le(0,0,0),this.blendAlpha=0,this.depthFunc=ol,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Yu,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ar,this.stencilZFail=ar,this.stencilZPass=ar,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const s=this[t];if(s===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Or&&(i.blending=this.blending),this.side!==Kn&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==qc&&(i.blendSrc=this.blendSrc),this.blendDst!==$c&&(i.blendDst=this.blendDst),this.blendEquation!==Hs&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==ol&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Yu&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==ar&&(i.stencilFail=this.stencilFail),this.stencilZFail!==ar&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==ar&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function s(r){const o=[];for(const l in r){const h=r[l];delete h.metadata,o.push(h)}return o}if(t){const r=s(e.textures),o=s(e.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const s=t.length;i=new Array(s);for(let r=0;r!==s;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Ne extends Qi{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Le(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new At,this.combine=Cl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const ri=new T,_a=new Oe;class ci{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=Qc,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Cn,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return Ep("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[e+s]=t.array[i+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)_a.fromBufferAttribute(this,t),_a.applyMatrix3(e),this.setXY(t,_a.x,_a.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)ri.fromBufferAttribute(this,t),ri.applyMatrix3(e),this.setXYZ(t,ri.x,ri.y,ri.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)ri.fromBufferAttribute(this,t),ri.applyMatrix4(e),this.setXYZ(t,ri.x,ri.y,ri.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ri.fromBufferAttribute(this,t),ri.applyNormalMatrix(e),this.setXYZ(t,ri.x,ri.y,ri.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ri.fromBufferAttribute(this,t),ri.transformDirection(e),this.setXYZ(t,ri.x,ri.y,ri.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=mn(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Lt(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=mn(t,this.array)),t}setX(e,t){return this.normalized&&(t=Lt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=mn(t,this.array)),t}setY(e,t){return this.normalized&&(t=Lt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=mn(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Lt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=mn(t,this.array)),t}setW(e,t){return this.normalized&&(t=Lt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Lt(t,this.array),i=Lt(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,s){return e*=this.itemSize,this.normalized&&(t=Lt(t,this.array),i=Lt(i,this.array),s=Lt(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this}setXYZW(e,t,i,s,r){return e*=this.itemSize,this.normalized&&(t=Lt(t,this.array),i=Lt(i,this.array),s=Lt(s,this.array),r=Lt(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Qc&&(e.usage=this.usage),e}}class kh extends ci{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class Pp extends ci{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class yt extends ci{constructor(e,t,i){super(new Float32Array(e),t,i)}}let rv=0;const tn=new Je,ac=new je,vr=new T,Yi=new ft,uo=new ft,_i=new T;class Bt extends As{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:rv++}),this.uuid=_n(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Ap(e)?Pp:kh)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const r=new pt().getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return tn.makeRotationFromQuaternion(e),this.applyMatrix4(tn),this}rotateX(e){return tn.makeRotationX(e),this.applyMatrix4(tn),this}rotateY(e){return tn.makeRotationY(e),this.applyMatrix4(tn),this}rotateZ(e){return tn.makeRotationZ(e),this.applyMatrix4(tn),this}translate(e,t,i){return tn.makeTranslation(e,t,i),this.applyMatrix4(tn),this}scale(e,t,i){return tn.makeScale(e,t,i),this.applyMatrix4(tn),this}lookAt(e){return ac.lookAt(e),ac.updateMatrix(),this.applyMatrix4(ac.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(vr).negate(),this.translate(vr.x,vr.y,vr.z),this}setFromPoints(e){const t=[];for(let i=0,s=e.length;i<s;i++){const r=e[i];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new yt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ft);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new T(-1/0,-1/0,-1/0),new T(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,s=t.length;i<s;i++){const r=t[i];Yi.setFromBufferAttribute(r),this.morphTargetsRelative?(_i.addVectors(this.boundingBox.min,Yi.min),this.boundingBox.expandByPoint(_i),_i.addVectors(this.boundingBox.max,Yi.max),this.boundingBox.expandByPoint(_i)):(this.boundingBox.expandByPoint(Yi.min),this.boundingBox.expandByPoint(Yi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Bn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new T,1/0);return}if(e){const i=this.boundingSphere.center;if(Yi.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const l=t[r];uo.setFromBufferAttribute(l),this.morphTargetsRelative?(_i.addVectors(Yi.min,uo.min),Yi.expandByPoint(_i),_i.addVectors(Yi.max,uo.max),Yi.expandByPoint(_i)):(Yi.expandByPoint(uo.min),Yi.expandByPoint(uo.max))}Yi.getCenter(i);let s=0;for(let r=0,o=e.count;r<o;r++)_i.fromBufferAttribute(e,r),s=Math.max(s,i.distanceToSquared(_i));if(t)for(let r=0,o=t.length;r<o;r++){const l=t[r],h=this.morphTargetsRelative;for(let d=0,f=l.count;d<f;d++)_i.fromBufferAttribute(l,d),h&&(vr.fromBufferAttribute(e,d),_i.add(vr)),s=Math.max(s,i.distanceToSquared(_i))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,s=t.normal,r=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ci(new Float32Array(4*i.count),4));const o=this.getAttribute("tangent"),l=[],h=[];for(let R=0;R<i.count;R++)l[R]=new T,h[R]=new T;const d=new T,f=new T,c=new T,u=new Oe,p=new Oe,m=new Oe,_=new T,g=new T;function v(R,M,w){d.fromBufferAttribute(i,R),f.fromBufferAttribute(i,M),c.fromBufferAttribute(i,w),u.fromBufferAttribute(r,R),p.fromBufferAttribute(r,M),m.fromBufferAttribute(r,w),f.sub(d),c.sub(d),p.sub(u),m.sub(u);const L=1/(p.x*m.y-m.x*p.y);isFinite(L)&&(_.copy(f).multiplyScalar(m.y).addScaledVector(c,-p.y).multiplyScalar(L),g.copy(c).multiplyScalar(p.x).addScaledVector(f,-m.x).multiplyScalar(L),l[R].add(_),l[M].add(_),l[w].add(_),h[R].add(g),h[M].add(g),h[w].add(g))}let y=this.groups;y.length===0&&(y=[{start:0,count:e.count}]);for(let R=0,M=y.length;R<M;++R){const w=y[R],L=w.start,N=w.count;for(let B=L,G=L+N;B<G;B+=3)v(e.getX(B+0),e.getX(B+1),e.getX(B+2))}const x=new T,b=new T,S=new T,A=new T;function E(R){S.fromBufferAttribute(s,R),A.copy(S);const M=l[R];x.copy(M),x.sub(S.multiplyScalar(S.dot(M))).normalize(),b.crossVectors(A,M);const L=b.dot(h[R])<0?-1:1;o.setXYZW(R,x.x,x.y,x.z,L)}for(let R=0,M=y.length;R<M;++R){const w=y[R],L=w.start,N=w.count;for(let B=L,G=L+N;B<G;B+=3)E(e.getX(B+0)),E(e.getX(B+1)),E(e.getX(B+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new ci(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let u=0,p=i.count;u<p;u++)i.setXYZ(u,0,0,0);const s=new T,r=new T,o=new T,l=new T,h=new T,d=new T,f=new T,c=new T;if(e)for(let u=0,p=e.count;u<p;u+=3){const m=e.getX(u+0),_=e.getX(u+1),g=e.getX(u+2);s.fromBufferAttribute(t,m),r.fromBufferAttribute(t,_),o.fromBufferAttribute(t,g),f.subVectors(o,r),c.subVectors(s,r),f.cross(c),l.fromBufferAttribute(i,m),h.fromBufferAttribute(i,_),d.fromBufferAttribute(i,g),l.add(f),h.add(f),d.add(f),i.setXYZ(m,l.x,l.y,l.z),i.setXYZ(_,h.x,h.y,h.z),i.setXYZ(g,d.x,d.y,d.z)}else for(let u=0,p=t.count;u<p;u+=3)s.fromBufferAttribute(t,u+0),r.fromBufferAttribute(t,u+1),o.fromBufferAttribute(t,u+2),f.subVectors(o,r),c.subVectors(s,r),f.cross(c),i.setXYZ(u+0,f.x,f.y,f.z),i.setXYZ(u+1,f.x,f.y,f.z),i.setXYZ(u+2,f.x,f.y,f.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)_i.fromBufferAttribute(e,t),_i.normalize(),e.setXYZ(t,_i.x,_i.y,_i.z)}toNonIndexed(){function e(l,h){const d=l.array,f=l.itemSize,c=l.normalized,u=new d.constructor(h.length*f);let p=0,m=0;for(let _=0,g=h.length;_<g;_++){l.isInterleavedBufferAttribute?p=h[_]*l.data.stride+l.offset:p=h[_]*f;for(let v=0;v<f;v++)u[m++]=d[p++]}return new ci(u,f,c)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Bt,i=this.index.array,s=this.attributes;for(const l in s){const h=s[l],d=e(h,i);t.setAttribute(l,d)}const r=this.morphAttributes;for(const l in r){const h=[],d=r[l];for(let f=0,c=d.length;f<c;f++){const u=d[f],p=e(u,i);h.push(p)}t.morphAttributes[l]=h}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let l=0,h=o.length;l<h;l++){const d=o[l];t.addGroup(d.start,d.count,d.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const h=this.parameters;for(const d in h)h[d]!==void 0&&(e[d]=h[d]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const h in i){const d=i[h];e.data.attributes[h]=d.toJSON(e.data)}const s={};let r=!1;for(const h in this.morphAttributes){const d=this.morphAttributes[h],f=[];for(let c=0,u=d.length;c<u;c++){const p=d[c];f.push(p.toJSON(e.data))}f.length>0&&(s[h]=f,r=!0)}r&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const l=this.boundingSphere;return l!==null&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const s=e.attributes;for(const d in s){const f=s[d];this.setAttribute(d,f.clone(t))}const r=e.morphAttributes;for(const d in r){const f=[],c=r[d];for(let u=0,p=c.length;u<p;u++)f.push(c[u].clone(t));this.morphAttributes[d]=f}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let d=0,f=o.length;d<f;d++){const c=o[d];this.addGroup(c.start,c.count,c.materialIndex)}const l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());const h=e.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const ld=new Je,Is=new so,ya=new Bn,cd=new T,_r=new T,yr=new T,xr=new T,lc=new T,xa=new T,ba=new Oe,wa=new Oe,Ma=new Oe,hd=new T,ud=new T,dd=new T,Sa=new T,Aa=new T;class Ae extends je{constructor(e=new Bt,t=new Ne){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const l=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=r}}}}getVertexPosition(e,t){const i=this.geometry,s=i.attributes.position,r=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(s,e);const l=this.morphTargetInfluences;if(r&&l){xa.set(0,0,0);for(let h=0,d=r.length;h<d;h++){const f=l[h],c=r[h];f!==0&&(lc.fromBufferAttribute(c,e),o?xa.addScaledVector(lc,f):xa.addScaledVector(lc.sub(t),f))}t.add(xa)}return t}raycast(e,t){const i=this.geometry,s=this.material,r=this.matrixWorld;s!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),ya.copy(i.boundingSphere),ya.applyMatrix4(r),Is.copy(e.ray).recast(e.near),!(ya.containsPoint(Is.origin)===!1&&(Is.intersectSphere(ya,cd)===null||Is.origin.distanceToSquared(cd)>(e.far-e.near)**2))&&(ld.copy(r).invert(),Is.copy(e.ray).applyMatrix4(ld),!(i.boundingBox!==null&&Is.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,Is)))}_computeIntersections(e,t,i){let s;const r=this.geometry,o=this.material,l=r.index,h=r.attributes.position,d=r.attributes.uv,f=r.attributes.uv1,c=r.attributes.normal,u=r.groups,p=r.drawRange;if(l!==null)if(Array.isArray(o))for(let m=0,_=u.length;m<_;m++){const g=u[m],v=o[g.materialIndex],y=Math.max(g.start,p.start),x=Math.min(l.count,Math.min(g.start+g.count,p.start+p.count));for(let b=y,S=x;b<S;b+=3){const A=l.getX(b),E=l.getX(b+1),R=l.getX(b+2);s=Ea(this,v,e,i,d,f,c,A,E,R),s&&(s.faceIndex=Math.floor(b/3),s.face.materialIndex=g.materialIndex,t.push(s))}}else{const m=Math.max(0,p.start),_=Math.min(l.count,p.start+p.count);for(let g=m,v=_;g<v;g+=3){const y=l.getX(g),x=l.getX(g+1),b=l.getX(g+2);s=Ea(this,o,e,i,d,f,c,y,x,b),s&&(s.faceIndex=Math.floor(g/3),t.push(s))}}else if(h!==void 0)if(Array.isArray(o))for(let m=0,_=u.length;m<_;m++){const g=u[m],v=o[g.materialIndex],y=Math.max(g.start,p.start),x=Math.min(h.count,Math.min(g.start+g.count,p.start+p.count));for(let b=y,S=x;b<S;b+=3){const A=b,E=b+1,R=b+2;s=Ea(this,v,e,i,d,f,c,A,E,R),s&&(s.faceIndex=Math.floor(b/3),s.face.materialIndex=g.materialIndex,t.push(s))}}else{const m=Math.max(0,p.start),_=Math.min(h.count,p.start+p.count);for(let g=m,v=_;g<v;g+=3){const y=g,x=g+1,b=g+2;s=Ea(this,o,e,i,d,f,c,y,x,b),s&&(s.faceIndex=Math.floor(g/3),t.push(s))}}}}function ov(a,e,t,i,s,r,o,l){let h;if(e.side===zi?h=i.intersectTriangle(o,r,s,!0,l):h=i.intersectTriangle(s,r,o,e.side===Kn,l),h===null)return null;Aa.copy(l),Aa.applyMatrix4(a.matrixWorld);const d=t.ray.origin.distanceTo(Aa);return d<t.near||d>t.far?null:{distance:d,point:Aa.clone(),object:a}}function Ea(a,e,t,i,s,r,o,l,h,d){a.getVertexPosition(l,_r),a.getVertexPosition(h,yr),a.getVertexPosition(d,xr);const f=ov(a,e,t,i,_r,yr,xr,Sa);if(f){s&&(ba.fromBufferAttribute(s,l),wa.fromBufferAttribute(s,h),Ma.fromBufferAttribute(s,d),f.uv=gn.getInterpolation(Sa,_r,yr,xr,ba,wa,Ma,new Oe)),r&&(ba.fromBufferAttribute(r,l),wa.fromBufferAttribute(r,h),Ma.fromBufferAttribute(r,d),f.uv1=gn.getInterpolation(Sa,_r,yr,xr,ba,wa,Ma,new Oe)),o&&(hd.fromBufferAttribute(o,l),ud.fromBufferAttribute(o,h),dd.fromBufferAttribute(o,d),f.normal=gn.getInterpolation(Sa,_r,yr,xr,hd,ud,dd,new T),f.normal.dot(i.direction)>0&&f.normal.multiplyScalar(-1));const c={a:l,b:h,c:d,normal:new T,materialIndex:0};gn.getNormal(_r,yr,xr,c.normal),f.face=c}return f}class Ut extends Bt{constructor(e=1,t=1,i=1,s=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:s,heightSegments:r,depthSegments:o};const l=this;s=Math.floor(s),r=Math.floor(r),o=Math.floor(o);const h=[],d=[],f=[],c=[];let u=0,p=0;m("z","y","x",-1,-1,i,t,e,o,r,0),m("z","y","x",1,-1,i,t,-e,o,r,1),m("x","z","y",1,1,e,i,t,s,o,2),m("x","z","y",1,-1,e,i,-t,s,o,3),m("x","y","z",1,-1,e,t,i,s,r,4),m("x","y","z",-1,-1,e,t,-i,s,r,5),this.setIndex(h),this.setAttribute("position",new yt(d,3)),this.setAttribute("normal",new yt(f,3)),this.setAttribute("uv",new yt(c,2));function m(_,g,v,y,x,b,S,A,E,R,M){const w=b/E,L=S/R,N=b/2,B=S/2,G=A/2,W=E+1,ee=R+1;let z=0,k=0;const q=new T;for(let $=0;$<ee;$++){const H=$*L-B;for(let Q=0;Q<W;Q++){const X=Q*w-N;q[_]=X*y,q[g]=H*x,q[v]=G,d.push(q.x,q.y,q.z),q[_]=0,q[g]=0,q[v]=A>0?1:-1,f.push(q.x,q.y,q.z),c.push(Q/E),c.push(1-$/R),z+=1}}for(let $=0;$<R;$++)for(let H=0;H<E;H++){const Q=u+H+W*$,X=u+H+W*($+1),F=u+(H+1)+W*($+1),D=u+(H+1)+W*$;h.push(Q,X,D),h.push(X,F,D),k+=6}l.addGroup(p,k,M),p+=k,u+=z}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ut(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Qr(a){const e={};for(const t in a){e[t]={};for(const i in a[t]){const s=a[t][i];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=s.clone():Array.isArray(s)?e[t][i]=s.slice():e[t][i]=s}}return e}function ki(a){const e={};for(let t=0;t<a.length;t++){const i=Qr(a[t]);for(const s in i)e[s]=i[s]}return e}function av(a){const e=[];for(let t=0;t<a.length;t++)e.push(a[t].clone());return e}function Ip(a){const e=a.getRenderTarget();return e===null?a.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Rt.workingColorSpace}const Lp={clone:Qr,merge:ki};var lv=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,cv=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class fi extends Qi{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=lv,this.fragmentShader=cv,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Qr(e.uniforms),this.uniformsGroups=av(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const o=this.uniforms[s].value;o&&o.isTexture?t.uniforms[s]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[s]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[s]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[s]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[s]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[s]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[s]={type:"m4",value:o.toArray()}:t.uniforms[s]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const s in this.extensions)this.extensions[s]===!0&&(i[s]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}let Fp=class extends je{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Je,this.projectionMatrix=new Je,this.projectionMatrixInverse=new Je,this.coordinateSystem=qn}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const os=new T,fd=new Oe,pd=new Oe;class Pi extends Fp{constructor(e=50,t=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Kr*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(zr*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Kr*2*Math.atan(Math.tan(zr*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){os.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(os.x,os.y).multiplyScalar(-e/os.z),os.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(os.x,os.y).multiplyScalar(-e/os.z)}getViewSize(e,t){return this.getViewBounds(e,fd,pd),t.subVectors(pd,fd)}setViewOffset(e,t,i,s,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(zr*.5*this.fov)/this.zoom,i=2*t,s=this.aspect*i,r=-.5*s;const o=this.view;if(this.view!==null&&this.view.enabled){const h=o.fullWidth,d=o.fullHeight;r+=o.offsetX*s/h,t-=o.offsetY*i/d,s*=o.width/h,i*=o.height/d}const l=this.filmOffset;l!==0&&(r+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const br=-90,wr=1;class hv extends je{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new Pi(br,wr,e,t);s.layers=this.layers,this.add(s);const r=new Pi(br,wr,e,t);r.layers=this.layers,this.add(r);const o=new Pi(br,wr,e,t);o.layers=this.layers,this.add(o);const l=new Pi(br,wr,e,t);l.layers=this.layers,this.add(l);const h=new Pi(br,wr,e,t);h.layers=this.layers,this.add(h);const d=new Pi(br,wr,e,t);d.layers=this.layers,this.add(d)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,s,r,o,l,h]=t;for(const d of t)this.remove(d);if(e===qn)i.up.set(0,1,0),i.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),l.up.set(0,1,0),l.lookAt(0,0,1),h.up.set(0,1,0),h.lookAt(0,0,-1);else if(e===fl)i.up.set(0,-1,0),i.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),l.up.set(0,-1,0),l.lookAt(0,0,1),h.up.set(0,-1,0),h.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const d of t)this.add(d),d.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,o,l,h,d,f]=this.children,c=e.getRenderTarget(),u=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),m=e.xr.enabled;e.xr.enabled=!1;const _=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,s),e.render(t,r),e.setRenderTarget(i,1,s),e.render(t,o),e.setRenderTarget(i,2,s),e.render(t,l),e.setRenderTarget(i,3,s),e.render(t,h),e.setRenderTarget(i,4,s),e.render(t,d),i.texture.generateMipmaps=_,e.setRenderTarget(i,5,s),e.render(t,f),e.setRenderTarget(c,u,p),e.xr.enabled=m,i.texture.needsPMREMUpdate=!0}}class Bp extends Ht{constructor(e,t,i,s,r,o,l,h,d,f){e=e!==void 0?e:[],t=t!==void 0?t:Yr,super(e,t,i,s,r,o,l,h,d,f),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class uv extends bs{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},s=[i,i,i,i,i,i];this.texture=new Bp(s,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Nt}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new Ut(5,5,5),r=new fi({name:"CubemapFromEquirect",uniforms:Qr(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:zi,blending:Zn});r.uniforms.tEquirect.value=t;const o=new Ae(s,r),l=t.minFilter;return t.minFilter===Yn&&(t.minFilter=Nt),new hv(1,10,this).update(e,o),t.minFilter=l,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,s){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,s);e.setRenderTarget(r)}}const cc=new T,dv=new T,fv=new pt;class hs{constructor(e=new T(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,s){return this.normal.set(e,t,i),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const s=cc.subVectors(i,t).cross(dv.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(cc),s=this.normal.dot(i);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:t.copy(e.start).addScaledVector(i,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||fv.getNormalMatrix(e),s=this.coplanarPoint(cc).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Ls=new Bn,Ta=new T;class Nh{constructor(e=new hs,t=new hs,i=new hs,s=new hs,r=new hs,o=new hs){this.planes=[e,t,i,s,r,o]}set(e,t,i,s,r,o){const l=this.planes;return l[0].copy(e),l[1].copy(t),l[2].copy(i),l[3].copy(s),l[4].copy(r),l[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=qn){const i=this.planes,s=e.elements,r=s[0],o=s[1],l=s[2],h=s[3],d=s[4],f=s[5],c=s[6],u=s[7],p=s[8],m=s[9],_=s[10],g=s[11],v=s[12],y=s[13],x=s[14],b=s[15];if(i[0].setComponents(h-r,u-d,g-p,b-v).normalize(),i[1].setComponents(h+r,u+d,g+p,b+v).normalize(),i[2].setComponents(h+o,u+f,g+m,b+y).normalize(),i[3].setComponents(h-o,u-f,g-m,b-y).normalize(),i[4].setComponents(h-l,u-c,g-_,b-x).normalize(),t===qn)i[5].setComponents(h+l,u+c,g+_,b+x).normalize();else if(t===fl)i[5].setComponents(l,c,_,x).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Ls.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Ls.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Ls)}intersectsSprite(e){return Ls.center.set(0,0,0),Ls.radius=.7071067811865476,Ls.applyMatrix4(e.matrixWorld),this.intersectsSphere(Ls)}intersectsSphere(e){const t=this.planes,i=e.center,s=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const s=t[i];if(Ta.x=s.normal.x>0?e.max.x:e.min.x,Ta.y=s.normal.y>0?e.max.y:e.min.y,Ta.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(Ta)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Dp(){let a=null,e=!1,t=null,i=null;function s(r,o){t(r,o),i=a.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(i=a.requestAnimationFrame(s),e=!0)},stop:function(){a.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){a=r}}}function pv(a){const e=new WeakMap;function t(l,h){const d=l.array,f=l.usage,c=d.byteLength,u=a.createBuffer();a.bindBuffer(h,u),a.bufferData(h,d,f),l.onUploadCallback();let p;if(d instanceof Float32Array)p=a.FLOAT;else if(d instanceof Uint16Array)l.isFloat16BufferAttribute?p=a.HALF_FLOAT:p=a.UNSIGNED_SHORT;else if(d instanceof Int16Array)p=a.SHORT;else if(d instanceof Uint32Array)p=a.UNSIGNED_INT;else if(d instanceof Int32Array)p=a.INT;else if(d instanceof Int8Array)p=a.BYTE;else if(d instanceof Uint8Array)p=a.UNSIGNED_BYTE;else if(d instanceof Uint8ClampedArray)p=a.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);return{buffer:u,type:p,bytesPerElement:d.BYTES_PER_ELEMENT,version:l.version,size:c}}function i(l,h,d){const f=h.array,c=h._updateRange,u=h.updateRanges;if(a.bindBuffer(d,l),c.count===-1&&u.length===0&&a.bufferSubData(d,0,f),u.length!==0){for(let p=0,m=u.length;p<m;p++){const _=u[p];a.bufferSubData(d,_.start*f.BYTES_PER_ELEMENT,f,_.start,_.count)}h.clearUpdateRanges()}c.count!==-1&&(a.bufferSubData(d,c.offset*f.BYTES_PER_ELEMENT,f,c.offset,c.count),c.count=-1),h.onUploadCallback()}function s(l){return l.isInterleavedBufferAttribute&&(l=l.data),e.get(l)}function r(l){l.isInterleavedBufferAttribute&&(l=l.data);const h=e.get(l);h&&(a.deleteBuffer(h.buffer),e.delete(l))}function o(l,h){if(l.isGLBufferAttribute){const f=e.get(l);(!f||f.version<l.version)&&e.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}l.isInterleavedBufferAttribute&&(l=l.data);const d=e.get(l);if(d===void 0)e.set(l,t(l,h));else if(d.version<l.version){if(d.size!==l.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(d.buffer,l,h),d.version=l.version}}return{get:s,remove:r,update:o}}class pi extends Bt{constructor(e=1,t=1,i=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:s};const r=e/2,o=t/2,l=Math.floor(i),h=Math.floor(s),d=l+1,f=h+1,c=e/l,u=t/h,p=[],m=[],_=[],g=[];for(let v=0;v<f;v++){const y=v*u-o;for(let x=0;x<d;x++){const b=x*c-r;m.push(b,-y,0),_.push(0,0,1),g.push(x/l),g.push(1-v/h)}}for(let v=0;v<h;v++)for(let y=0;y<l;y++){const x=y+d*v,b=y+d*(v+1),S=y+1+d*(v+1),A=y+1+d*v;p.push(x,b,A),p.push(b,S,A)}this.setIndex(p),this.setAttribute("position",new yt(m,3)),this.setAttribute("normal",new yt(_,3)),this.setAttribute("uv",new yt(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new pi(e.width,e.height,e.widthSegments,e.heightSegments)}}var mv=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,gv=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,vv=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,_v=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,yv=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,xv=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,bv=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,wv=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Mv=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Sv=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,Av=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,Ev=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Tv=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,Cv=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Rv=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Pv=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,Iv=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Lv=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Fv=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Bv=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Dv=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,kv=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Nv=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Ov=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Uv=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,zv=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Vv=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Hv=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Gv=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Wv=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Xv="gl_FragColor = linearToOutputTexel( gl_FragColor );",jv=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,Yv=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,qv=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,$v=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Zv=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Kv=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Qv=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Jv=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,e_=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,t_=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,i_=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,n_=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,s_=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,r_=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,o_=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,a_=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,l_=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,c_=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,h_=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,u_=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,d_=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,f_=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,p_=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,m_=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,g_=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,v_=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,__=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,y_=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,x_=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,b_=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,w_=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,M_=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,S_=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,A_=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,E_=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,T_=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[MORPHTARGETS_COUNT];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,C_=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,R_=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,P_=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
	#endif
	#ifdef MORPHTARGETS_TEXTURE
		#ifndef USE_INSTANCING_MORPH
			uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		#endif
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,I_=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,L_=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,F_=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,B_=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,D_=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,k_=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,N_=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,O_=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,U_=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,z_=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,V_=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,H_=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,G_=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,W_=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,X_=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,j_=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Y_=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,q_=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,$_=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Z_=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return shadow;
	}
#endif`,K_=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Q_=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,J_=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,ey=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,ty=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,iy=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,ny=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,sy=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,ry=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,oy=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,ay=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,ly=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,cy=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,hy=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uy=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,dy=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,fy=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const py=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,my=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,gy=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,vy=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,_y=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,yy=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,xy=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,by=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,wy=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,My=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Sy=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Ay=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Ey=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Ty=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Cy=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Ry=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Py=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Iy=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Ly=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Fy=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,By=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Dy=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,ky=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Ny=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Oy=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Uy=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,zy=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Vy=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Hy=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Gy=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Wy=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Xy=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,jy=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Yy=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,mt={alphahash_fragment:mv,alphahash_pars_fragment:gv,alphamap_fragment:vv,alphamap_pars_fragment:_v,alphatest_fragment:yv,alphatest_pars_fragment:xv,aomap_fragment:bv,aomap_pars_fragment:wv,batching_pars_vertex:Mv,batching_vertex:Sv,begin_vertex:Av,beginnormal_vertex:Ev,bsdfs:Tv,iridescence_fragment:Cv,bumpmap_pars_fragment:Rv,clipping_planes_fragment:Pv,clipping_planes_pars_fragment:Iv,clipping_planes_pars_vertex:Lv,clipping_planes_vertex:Fv,color_fragment:Bv,color_pars_fragment:Dv,color_pars_vertex:kv,color_vertex:Nv,common:Ov,cube_uv_reflection_fragment:Uv,defaultnormal_vertex:zv,displacementmap_pars_vertex:Vv,displacementmap_vertex:Hv,emissivemap_fragment:Gv,emissivemap_pars_fragment:Wv,colorspace_fragment:Xv,colorspace_pars_fragment:jv,envmap_fragment:Yv,envmap_common_pars_fragment:qv,envmap_pars_fragment:$v,envmap_pars_vertex:Zv,envmap_physical_pars_fragment:a_,envmap_vertex:Kv,fog_vertex:Qv,fog_pars_vertex:Jv,fog_fragment:e_,fog_pars_fragment:t_,gradientmap_pars_fragment:i_,lightmap_pars_fragment:n_,lights_lambert_fragment:s_,lights_lambert_pars_fragment:r_,lights_pars_begin:o_,lights_toon_fragment:l_,lights_toon_pars_fragment:c_,lights_phong_fragment:h_,lights_phong_pars_fragment:u_,lights_physical_fragment:d_,lights_physical_pars_fragment:f_,lights_fragment_begin:p_,lights_fragment_maps:m_,lights_fragment_end:g_,logdepthbuf_fragment:v_,logdepthbuf_pars_fragment:__,logdepthbuf_pars_vertex:y_,logdepthbuf_vertex:x_,map_fragment:b_,map_pars_fragment:w_,map_particle_fragment:M_,map_particle_pars_fragment:S_,metalnessmap_fragment:A_,metalnessmap_pars_fragment:E_,morphinstance_vertex:T_,morphcolor_vertex:C_,morphnormal_vertex:R_,morphtarget_pars_vertex:P_,morphtarget_vertex:I_,normal_fragment_begin:L_,normal_fragment_maps:F_,normal_pars_fragment:B_,normal_pars_vertex:D_,normal_vertex:k_,normalmap_pars_fragment:N_,clearcoat_normal_fragment_begin:O_,clearcoat_normal_fragment_maps:U_,clearcoat_pars_fragment:z_,iridescence_pars_fragment:V_,opaque_fragment:H_,packing:G_,premultiplied_alpha_fragment:W_,project_vertex:X_,dithering_fragment:j_,dithering_pars_fragment:Y_,roughnessmap_fragment:q_,roughnessmap_pars_fragment:$_,shadowmap_pars_fragment:Z_,shadowmap_pars_vertex:K_,shadowmap_vertex:Q_,shadowmask_pars_fragment:J_,skinbase_vertex:ey,skinning_pars_vertex:ty,skinning_vertex:iy,skinnormal_vertex:ny,specularmap_fragment:sy,specularmap_pars_fragment:ry,tonemapping_fragment:oy,tonemapping_pars_fragment:ay,transmission_fragment:ly,transmission_pars_fragment:cy,uv_pars_fragment:hy,uv_pars_vertex:uy,uv_vertex:dy,worldpos_vertex:fy,background_vert:py,background_frag:my,backgroundCube_vert:gy,backgroundCube_frag:vy,cube_vert:_y,cube_frag:yy,depth_vert:xy,depth_frag:by,distanceRGBA_vert:wy,distanceRGBA_frag:My,equirect_vert:Sy,equirect_frag:Ay,linedashed_vert:Ey,linedashed_frag:Ty,meshbasic_vert:Cy,meshbasic_frag:Ry,meshlambert_vert:Py,meshlambert_frag:Iy,meshmatcap_vert:Ly,meshmatcap_frag:Fy,meshnormal_vert:By,meshnormal_frag:Dy,meshphong_vert:ky,meshphong_frag:Ny,meshphysical_vert:Oy,meshphysical_frag:Uy,meshtoon_vert:zy,meshtoon_frag:Vy,points_vert:Hy,points_frag:Gy,shadow_vert:Wy,shadow_frag:Xy,sprite_vert:jy,sprite_frag:Yy},He={common:{diffuse:{value:new Le(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new pt},alphaMap:{value:null},alphaMapTransform:{value:new pt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new pt}},envmap:{envMap:{value:null},envMapRotation:{value:new pt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new pt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new pt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new pt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new pt},normalScale:{value:new Oe(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new pt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new pt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new pt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new pt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Le(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Le(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new pt},alphaTest:{value:0},uvTransform:{value:new pt}},sprite:{diffuse:{value:new Le(16777215)},opacity:{value:1},center:{value:new Oe(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new pt},alphaMap:{value:null},alphaMapTransform:{value:new pt},alphaTest:{value:0}}},An={basic:{uniforms:ki([He.common,He.specularmap,He.envmap,He.aomap,He.lightmap,He.fog]),vertexShader:mt.meshbasic_vert,fragmentShader:mt.meshbasic_frag},lambert:{uniforms:ki([He.common,He.specularmap,He.envmap,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.fog,He.lights,{emissive:{value:new Le(0)}}]),vertexShader:mt.meshlambert_vert,fragmentShader:mt.meshlambert_frag},phong:{uniforms:ki([He.common,He.specularmap,He.envmap,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.fog,He.lights,{emissive:{value:new Le(0)},specular:{value:new Le(1118481)},shininess:{value:30}}]),vertexShader:mt.meshphong_vert,fragmentShader:mt.meshphong_frag},standard:{uniforms:ki([He.common,He.envmap,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.roughnessmap,He.metalnessmap,He.fog,He.lights,{emissive:{value:new Le(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:mt.meshphysical_vert,fragmentShader:mt.meshphysical_frag},toon:{uniforms:ki([He.common,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.gradientmap,He.fog,He.lights,{emissive:{value:new Le(0)}}]),vertexShader:mt.meshtoon_vert,fragmentShader:mt.meshtoon_frag},matcap:{uniforms:ki([He.common,He.bumpmap,He.normalmap,He.displacementmap,He.fog,{matcap:{value:null}}]),vertexShader:mt.meshmatcap_vert,fragmentShader:mt.meshmatcap_frag},points:{uniforms:ki([He.points,He.fog]),vertexShader:mt.points_vert,fragmentShader:mt.points_frag},dashed:{uniforms:ki([He.common,He.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:mt.linedashed_vert,fragmentShader:mt.linedashed_frag},depth:{uniforms:ki([He.common,He.displacementmap]),vertexShader:mt.depth_vert,fragmentShader:mt.depth_frag},normal:{uniforms:ki([He.common,He.bumpmap,He.normalmap,He.displacementmap,{opacity:{value:1}}]),vertexShader:mt.meshnormal_vert,fragmentShader:mt.meshnormal_frag},sprite:{uniforms:ki([He.sprite,He.fog]),vertexShader:mt.sprite_vert,fragmentShader:mt.sprite_frag},background:{uniforms:{uvTransform:{value:new pt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:mt.background_vert,fragmentShader:mt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new pt}},vertexShader:mt.backgroundCube_vert,fragmentShader:mt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:mt.cube_vert,fragmentShader:mt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:mt.equirect_vert,fragmentShader:mt.equirect_frag},distanceRGBA:{uniforms:ki([He.common,He.displacementmap,{referencePosition:{value:new T},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:mt.distanceRGBA_vert,fragmentShader:mt.distanceRGBA_frag},shadow:{uniforms:ki([He.lights,He.fog,{color:{value:new Le(0)},opacity:{value:1}}]),vertexShader:mt.shadow_vert,fragmentShader:mt.shadow_frag}};An.physical={uniforms:ki([An.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new pt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new pt},clearcoatNormalScale:{value:new Oe(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new pt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new pt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new pt},sheen:{value:0},sheenColor:{value:new Le(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new pt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new pt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new pt},transmissionSamplerSize:{value:new Oe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new pt},attenuationDistance:{value:0},attenuationColor:{value:new Le(0)},specularColor:{value:new Le(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new pt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new pt},anisotropyVector:{value:new Oe},anisotropyMap:{value:null},anisotropyMapTransform:{value:new pt}}]),vertexShader:mt.meshphysical_vert,fragmentShader:mt.meshphysical_frag};const Ca={r:0,b:0,g:0},Fs=new At,qy=new Je;function $y(a,e,t,i,s,r,o){const l=new Le(0);let h=r===!0?0:1,d,f,c=null,u=0,p=null;function m(y){let x=y.isScene===!0?y.background:null;return x&&x.isTexture&&(x=(y.backgroundBlurriness>0?t:e).get(x)),x}function _(y){let x=!1;const b=m(y);b===null?v(l,h):b&&b.isColor&&(v(b,1),x=!0);const S=a.xr.getEnvironmentBlendMode();S==="additive"?i.buffers.color.setClear(0,0,0,1,o):S==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,o),(a.autoClear||x)&&a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil)}function g(y,x){const b=m(x);b&&(b.isCubeTexture||b.mapping===Rl)?(f===void 0&&(f=new Ae(new Ut(1,1,1),new fi({name:"BackgroundCubeMaterial",uniforms:Qr(An.backgroundCube.uniforms),vertexShader:An.backgroundCube.vertexShader,fragmentShader:An.backgroundCube.fragmentShader,side:zi,depthTest:!1,depthWrite:!1,fog:!1})),f.geometry.deleteAttribute("normal"),f.geometry.deleteAttribute("uv"),f.onBeforeRender=function(S,A,E){this.matrixWorld.copyPosition(E.matrixWorld)},Object.defineProperty(f.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(f)),Fs.copy(x.backgroundRotation),Fs.x*=-1,Fs.y*=-1,Fs.z*=-1,b.isCubeTexture&&b.isRenderTargetTexture===!1&&(Fs.y*=-1,Fs.z*=-1),f.material.uniforms.envMap.value=b,f.material.uniforms.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,f.material.uniforms.backgroundBlurriness.value=x.backgroundBlurriness,f.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,f.material.uniforms.backgroundRotation.value.setFromMatrix4(qy.makeRotationFromEuler(Fs)),f.material.toneMapped=Rt.getTransfer(b.colorSpace)!==Wt,(c!==b||u!==b.version||p!==a.toneMapping)&&(f.material.needsUpdate=!0,c=b,u=b.version,p=a.toneMapping),f.layers.enableAll(),y.unshift(f,f.geometry,f.material,0,0,null)):b&&b.isTexture&&(d===void 0&&(d=new Ae(new pi(2,2),new fi({name:"BackgroundMaterial",uniforms:Qr(An.background.uniforms),vertexShader:An.background.vertexShader,fragmentShader:An.background.fragmentShader,side:Kn,depthTest:!1,depthWrite:!1,fog:!1})),d.geometry.deleteAttribute("normal"),Object.defineProperty(d.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(d)),d.material.uniforms.t2D.value=b,d.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,d.material.toneMapped=Rt.getTransfer(b.colorSpace)!==Wt,b.matrixAutoUpdate===!0&&b.updateMatrix(),d.material.uniforms.uvTransform.value.copy(b.matrix),(c!==b||u!==b.version||p!==a.toneMapping)&&(d.material.needsUpdate=!0,c=b,u=b.version,p=a.toneMapping),d.layers.enableAll(),y.unshift(d,d.geometry,d.material,0,0,null))}function v(y,x){y.getRGB(Ca,Ip(a)),i.buffers.color.setClear(Ca.r,Ca.g,Ca.b,x,o)}return{getClearColor:function(){return l},setClearColor:function(y,x=1){l.set(y),h=x,v(l,h)},getClearAlpha:function(){return h},setClearAlpha:function(y){h=y,v(l,h)},render:_,addToRenderList:g}}function Zy(a,e){const t=a.getParameter(a.MAX_VERTEX_ATTRIBS),i={},s=u(null);let r=s,o=!1;function l(w,L,N,B,G){let W=!1;const ee=c(B,N,L);r!==ee&&(r=ee,d(r.object)),W=p(w,B,N,G),W&&m(w,B,N,G),G!==null&&e.update(G,a.ELEMENT_ARRAY_BUFFER),(W||o)&&(o=!1,b(w,L,N,B),G!==null&&a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e.get(G).buffer))}function h(){return a.createVertexArray()}function d(w){return a.bindVertexArray(w)}function f(w){return a.deleteVertexArray(w)}function c(w,L,N){const B=N.wireframe===!0;let G=i[w.id];G===void 0&&(G={},i[w.id]=G);let W=G[L.id];W===void 0&&(W={},G[L.id]=W);let ee=W[B];return ee===void 0&&(ee=u(h()),W[B]=ee),ee}function u(w){const L=[],N=[],B=[];for(let G=0;G<t;G++)L[G]=0,N[G]=0,B[G]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:L,enabledAttributes:N,attributeDivisors:B,object:w,attributes:{},index:null}}function p(w,L,N,B){const G=r.attributes,W=L.attributes;let ee=0;const z=N.getAttributes();for(const k in z)if(z[k].location>=0){const $=G[k];let H=W[k];if(H===void 0&&(k==="instanceMatrix"&&w.instanceMatrix&&(H=w.instanceMatrix),k==="instanceColor"&&w.instanceColor&&(H=w.instanceColor)),$===void 0||$.attribute!==H||H&&$.data!==H.data)return!0;ee++}return r.attributesNum!==ee||r.index!==B}function m(w,L,N,B){const G={},W=L.attributes;let ee=0;const z=N.getAttributes();for(const k in z)if(z[k].location>=0){let $=W[k];$===void 0&&(k==="instanceMatrix"&&w.instanceMatrix&&($=w.instanceMatrix),k==="instanceColor"&&w.instanceColor&&($=w.instanceColor));const H={};H.attribute=$,$&&$.data&&(H.data=$.data),G[k]=H,ee++}r.attributes=G,r.attributesNum=ee,r.index=B}function _(){const w=r.newAttributes;for(let L=0,N=w.length;L<N;L++)w[L]=0}function g(w){v(w,0)}function v(w,L){const N=r.newAttributes,B=r.enabledAttributes,G=r.attributeDivisors;N[w]=1,B[w]===0&&(a.enableVertexAttribArray(w),B[w]=1),G[w]!==L&&(a.vertexAttribDivisor(w,L),G[w]=L)}function y(){const w=r.newAttributes,L=r.enabledAttributes;for(let N=0,B=L.length;N<B;N++)L[N]!==w[N]&&(a.disableVertexAttribArray(N),L[N]=0)}function x(w,L,N,B,G,W,ee){ee===!0?a.vertexAttribIPointer(w,L,N,G,W):a.vertexAttribPointer(w,L,N,B,G,W)}function b(w,L,N,B){_();const G=B.attributes,W=N.getAttributes(),ee=L.defaultAttributeValues;for(const z in W){const k=W[z];if(k.location>=0){let q=G[z];if(q===void 0&&(z==="instanceMatrix"&&w.instanceMatrix&&(q=w.instanceMatrix),z==="instanceColor"&&w.instanceColor&&(q=w.instanceColor)),q!==void 0){const $=q.normalized,H=q.itemSize,Q=e.get(q);if(Q===void 0)continue;const X=Q.buffer,F=Q.type,D=Q.bytesPerElement,j=F===a.INT||F===a.UNSIGNED_INT||q.gpuType===gp;if(q.isInterleavedBufferAttribute){const te=q.data,ae=te.stride,K=q.offset;if(te.isInstancedInterleavedBuffer){for(let O=0;O<k.locationSize;O++)v(k.location+O,te.meshPerAttribute);w.isInstancedMesh!==!0&&B._maxInstanceCount===void 0&&(B._maxInstanceCount=te.meshPerAttribute*te.count)}else for(let O=0;O<k.locationSize;O++)g(k.location+O);a.bindBuffer(a.ARRAY_BUFFER,X);for(let O=0;O<k.locationSize;O++)x(k.location+O,H/k.locationSize,F,$,ae*D,(K+H/k.locationSize*O)*D,j)}else{if(q.isInstancedBufferAttribute){for(let te=0;te<k.locationSize;te++)v(k.location+te,q.meshPerAttribute);w.isInstancedMesh!==!0&&B._maxInstanceCount===void 0&&(B._maxInstanceCount=q.meshPerAttribute*q.count)}else for(let te=0;te<k.locationSize;te++)g(k.location+te);a.bindBuffer(a.ARRAY_BUFFER,X);for(let te=0;te<k.locationSize;te++)x(k.location+te,H/k.locationSize,F,$,H*D,H/k.locationSize*te*D,j)}}else if(ee!==void 0){const $=ee[z];if($!==void 0)switch($.length){case 2:a.vertexAttrib2fv(k.location,$);break;case 3:a.vertexAttrib3fv(k.location,$);break;case 4:a.vertexAttrib4fv(k.location,$);break;default:a.vertexAttrib1fv(k.location,$)}}}}y()}function S(){R();for(const w in i){const L=i[w];for(const N in L){const B=L[N];for(const G in B)f(B[G].object),delete B[G];delete L[N]}delete i[w]}}function A(w){if(i[w.id]===void 0)return;const L=i[w.id];for(const N in L){const B=L[N];for(const G in B)f(B[G].object),delete B[G];delete L[N]}delete i[w.id]}function E(w){for(const L in i){const N=i[L];if(N[w.id]===void 0)continue;const B=N[w.id];for(const G in B)f(B[G].object),delete B[G];delete N[w.id]}}function R(){M(),o=!0,r!==s&&(r=s,d(r.object))}function M(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:l,reset:R,resetDefaultState:M,dispose:S,releaseStatesOfGeometry:A,releaseStatesOfProgram:E,initAttributes:_,enableAttribute:g,disableUnusedAttributes:y}}function Ky(a,e,t){let i;function s(d){i=d}function r(d,f){a.drawArrays(i,d,f),t.update(f,i,1)}function o(d,f,c){c!==0&&(a.drawArraysInstanced(i,d,f,c),t.update(f,i,c))}function l(d,f,c){if(c===0)return;const u=e.get("WEBGL_multi_draw");if(u===null)for(let p=0;p<c;p++)this.render(d[p],f[p]);else{u.multiDrawArraysWEBGL(i,d,0,f,0,c);let p=0;for(let m=0;m<c;m++)p+=f[m];t.update(p,i,1)}}function h(d,f,c,u){if(c===0)return;const p=e.get("WEBGL_multi_draw");if(p===null)for(let m=0;m<d.length;m++)o(d[m],f[m],u[m]);else{p.multiDrawArraysInstancedWEBGL(i,d,0,f,0,u,0,c);let m=0;for(let _=0;_<c;_++)m+=f[_];for(let _=0;_<u.length;_++)t.update(m,i,u[_])}}this.setMode=s,this.render=r,this.renderInstances=o,this.renderMultiDraw=l,this.renderMultiDrawInstances=h}function Qy(a,e,t,i){let s;function r(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){const A=e.get("EXT_texture_filter_anisotropic");s=a.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function o(A){return!(A!==vn&&i.convert(A)!==a.getParameter(a.IMPLEMENTATION_COLOR_READ_FORMAT))}function l(A){const E=A===Jo&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(A!==xs&&i.convert(A)!==a.getParameter(a.IMPLEMENTATION_COLOR_READ_TYPE)&&A!==Cn&&!E)}function h(A){if(A==="highp"){if(a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision>0&&a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision>0)return"highp";A="mediump"}return A==="mediump"&&a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision>0&&a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let d=t.precision!==void 0?t.precision:"highp";const f=h(d);f!==d&&(console.warn("THREE.WebGLRenderer:",d,"not supported, using",f,"instead."),d=f);const c=t.logarithmicDepthBuffer===!0,u=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),p=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS),m=a.getParameter(a.MAX_TEXTURE_SIZE),_=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE),g=a.getParameter(a.MAX_VERTEX_ATTRIBS),v=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),y=a.getParameter(a.MAX_VARYING_VECTORS),x=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS),b=p>0,S=a.getParameter(a.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:r,getMaxPrecision:h,textureFormatReadable:o,textureTypeReadable:l,precision:d,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:p,maxTextureSize:m,maxCubemapSize:_,maxAttributes:g,maxVertexUniforms:v,maxVaryings:y,maxFragmentUniforms:x,vertexTextures:b,maxSamples:S}}function Jy(a){const e=this;let t=null,i=0,s=!1,r=!1;const o=new hs,l=new pt,h={value:null,needsUpdate:!1};this.uniform=h,this.numPlanes=0,this.numIntersection=0,this.init=function(c,u){const p=c.length!==0||u||i!==0||s;return s=u,i=c.length,p},this.beginShadows=function(){r=!0,f(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(c,u){t=f(c,u,0)},this.setState=function(c,u,p){const m=c.clippingPlanes,_=c.clipIntersection,g=c.clipShadows,v=a.get(c);if(!s||m===null||m.length===0||r&&!g)r?f(null):d();else{const y=r?0:i,x=y*4;let b=v.clippingState||null;h.value=b,b=f(m,u,x,p);for(let S=0;S!==x;++S)b[S]=t[S];v.clippingState=b,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=y}};function d(){h.value!==t&&(h.value=t,h.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function f(c,u,p,m){const _=c!==null?c.length:0;let g=null;if(_!==0){if(g=h.value,m!==!0||g===null){const v=p+_*4,y=u.matrixWorldInverse;l.getNormalMatrix(y),(g===null||g.length<v)&&(g=new Float32Array(v));for(let x=0,b=p;x!==_;++x,b+=4)o.copy(c[x]).applyMatrix4(y,l),o.normal.toArray(g,b),g[b+3]=o.constant}h.value=g,h.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,g}}function ex(a){let e=new WeakMap;function t(o,l){return l===al?o.mapping=Yr:l===Zc&&(o.mapping=qr),o}function i(o){if(o&&o.isTexture){const l=o.mapping;if(l===al||l===Zc)if(e.has(o)){const h=e.get(o).texture;return t(h,o.mapping)}else{const h=o.image;if(h&&h.height>0){const d=new uv(h.height);return d.fromEquirectangularTexture(a,o),e.set(o,d),o.addEventListener("dispose",s),t(d.texture,o.mapping)}else return null}}return o}function s(o){const l=o.target;l.removeEventListener("dispose",s);const h=e.get(l);h!==void 0&&(e.delete(l),h.dispose())}function r(){e=new WeakMap}return{get:i,dispose:r}}class ia extends Fp{constructor(e=-1,t=1,i=1,s=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=s,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,s,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-e,o=i+e,l=s+t,h=s-t;if(this.view!==null&&this.view.enabled){const d=(this.right-this.left)/this.view.fullWidth/this.zoom,f=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=d*this.view.offsetX,o=r+d*this.view.width,l-=f*this.view.offsetY,h=l-f*this.view.height}this.projectionMatrix.makeOrthographic(r,o,l,h,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Ir=4,md=[.125,.215,.35,.446,.526,.582],Gs=20,hc=new ia,gd=new Le;let uc=null,dc=0,fc=0,pc=!1;const Us=(1+Math.sqrt(5))/2,Mr=1/Us,vd=[new T(-Us,Mr,0),new T(Us,Mr,0),new T(-Mr,0,Us),new T(Mr,0,Us),new T(0,Us,-Mr),new T(0,Us,Mr),new T(-1,1,-1),new T(1,1,-1),new T(-1,1,1),new T(1,1,1)];class _d{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,s=100){uc=this._renderer.getRenderTarget(),dc=this._renderer.getActiveCubeFace(),fc=this._renderer.getActiveMipmapLevel(),pc=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,s,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=bd(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=xd(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(uc,dc,fc),this._renderer.xr.enabled=pc,e.scissorTest=!1,Ra(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Yr||e.mapping===qr?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),uc=this._renderer.getRenderTarget(),dc=this._renderer.getActiveCubeFace(),fc=this._renderer.getActiveMipmapLevel(),pc=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Nt,minFilter:Nt,generateMipmaps:!1,type:Jo,format:vn,colorSpace:bi,depthBuffer:!1},s=yd(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=yd(e,t,i);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=tx(r)),this._blurMaterial=ix(r,e,t)}return s}_compileMaterial(e){const t=new Ae(this._lodPlanes[0],e);this._renderer.compile(t,hc)}_sceneToCubeUV(e,t,i,s){const l=new Pi(90,1,t,i),h=[1,-1,1,1,1,1],d=[1,1,1,-1,-1,-1],f=this._renderer,c=f.autoClear,u=f.toneMapping;f.getClearColor(gd),f.toneMapping=vs,f.autoClear=!1;const p=new Ne({name:"PMREM.Background",side:zi,depthWrite:!1,depthTest:!1}),m=new Ae(new Ut,p);let _=!1;const g=e.background;g?g.isColor&&(p.color.copy(g),e.background=null,_=!0):(p.color.copy(gd),_=!0);for(let v=0;v<6;v++){const y=v%3;y===0?(l.up.set(0,h[v],0),l.lookAt(d[v],0,0)):y===1?(l.up.set(0,0,h[v]),l.lookAt(0,d[v],0)):(l.up.set(0,h[v],0),l.lookAt(0,0,d[v]));const x=this._cubeSize;Ra(s,y*x,v>2?x:0,x,x),f.setRenderTarget(s),_&&f.render(m,l),f.render(e,l)}m.geometry.dispose(),m.material.dispose(),f.toneMapping=u,f.autoClear=c,e.background=g}_textureToCubeUV(e,t){const i=this._renderer,s=e.mapping===Yr||e.mapping===qr;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=bd()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=xd());const r=s?this._cubemapMaterial:this._equirectMaterial,o=new Ae(this._lodPlanes[0],r),l=r.uniforms;l.envMap.value=e;const h=this._cubeSize;Ra(t,0,0,3*h,2*h),i.setRenderTarget(t),i.render(o,hc)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const s=this._lodPlanes.length;for(let r=1;r<s;r++){const o=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),l=vd[(s-r-1)%vd.length];this._blur(e,r-1,r,o,l)}t.autoClear=i}_blur(e,t,i,s,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,s,"latitudinal",r),this._halfBlur(o,e,i,i,s,"longitudinal",r)}_halfBlur(e,t,i,s,r,o,l){const h=this._renderer,d=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const f=3,c=new Ae(this._lodPlanes[s],d),u=d.uniforms,p=this._sizeLods[i]-1,m=isFinite(r)?Math.PI/(2*p):2*Math.PI/(2*Gs-1),_=r/m,g=isFinite(r)?1+Math.floor(f*_):Gs;g>Gs&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${Gs}`);const v=[];let y=0;for(let E=0;E<Gs;++E){const R=E/_,M=Math.exp(-R*R/2);v.push(M),E===0?y+=M:E<g&&(y+=2*M)}for(let E=0;E<v.length;E++)v[E]=v[E]/y;u.envMap.value=e.texture,u.samples.value=g,u.weights.value=v,u.latitudinal.value=o==="latitudinal",l&&(u.poleAxis.value=l);const{_lodMax:x}=this;u.dTheta.value=m,u.mipInt.value=x-i;const b=this._sizeLods[s],S=3*b*(s>x-Ir?s-x+Ir:0),A=4*(this._cubeSize-b);Ra(t,S,A,3*b,2*b),h.setRenderTarget(t),h.render(c,hc)}}function tx(a){const e=[],t=[],i=[];let s=a;const r=a-Ir+1+md.length;for(let o=0;o<r;o++){const l=Math.pow(2,s);t.push(l);let h=1/l;o>a-Ir?h=md[o-a+Ir-1]:o===0&&(h=0),i.push(h);const d=1/(l-2),f=-d,c=1+d,u=[f,f,c,f,c,c,f,f,c,c,f,c],p=6,m=6,_=3,g=2,v=1,y=new Float32Array(_*m*p),x=new Float32Array(g*m*p),b=new Float32Array(v*m*p);for(let A=0;A<p;A++){const E=A%3*2/3-1,R=A>2?0:-1,M=[E,R,0,E+2/3,R,0,E+2/3,R+1,0,E,R,0,E+2/3,R+1,0,E,R+1,0];y.set(M,_*m*A),x.set(u,g*m*A);const w=[A,A,A,A,A,A];b.set(w,v*m*A)}const S=new Bt;S.setAttribute("position",new ci(y,_)),S.setAttribute("uv",new ci(x,g)),S.setAttribute("faceIndex",new ci(b,v)),e.push(S),s>Ir&&s--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function yd(a,e,t){const i=new bs(a,e,t);return i.texture.mapping=Rl,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Ra(a,e,t,i,s){a.viewport.set(e,t,i,s),a.scissor.set(e,t,i,s)}function ix(a,e,t){const i=new Float32Array(Gs),s=new T(0,1,0);return new fi({name:"SphericalGaussianBlur",defines:{n:Gs,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${a}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:Oh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Zn,depthTest:!1,depthWrite:!1})}function xd(){return new fi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Oh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Zn,depthTest:!1,depthWrite:!1})}function bd(){return new fi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Oh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Zn,depthTest:!1,depthWrite:!1})}function Oh(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function nx(a){let e=new WeakMap,t=null;function i(l){if(l&&l.isTexture){const h=l.mapping,d=h===al||h===Zc,f=h===Yr||h===qr;if(d||f){let c=e.get(l);const u=c!==void 0?c.texture.pmremVersion:0;if(l.isRenderTargetTexture&&l.pmremVersion!==u)return t===null&&(t=new _d(a)),c=d?t.fromEquirectangular(l,c):t.fromCubemap(l,c),c.texture.pmremVersion=l.pmremVersion,e.set(l,c),c.texture;if(c!==void 0)return c.texture;{const p=l.image;return d&&p&&p.height>0||f&&p&&s(p)?(t===null&&(t=new _d(a)),c=d?t.fromEquirectangular(l):t.fromCubemap(l),c.texture.pmremVersion=l.pmremVersion,e.set(l,c),l.addEventListener("dispose",r),c.texture):null}}}return l}function s(l){let h=0;const d=6;for(let f=0;f<d;f++)l[f]!==void 0&&h++;return h===d}function r(l){const h=l.target;h.removeEventListener("dispose",r);const d=e.get(h);d!==void 0&&(e.delete(h),d.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:o}}function sx(a){const e={};function t(i){if(e[i]!==void 0)return e[i];let s;switch(i){case"WEBGL_depth_texture":s=a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=a.getExtension(i)}return e[i]=s,s}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const s=t(i);return s===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),s}}}function rx(a,e,t,i){const s={},r=new WeakMap;function o(c){const u=c.target;u.index!==null&&e.remove(u.index);for(const m in u.attributes)e.remove(u.attributes[m]);for(const m in u.morphAttributes){const _=u.morphAttributes[m];for(let g=0,v=_.length;g<v;g++)e.remove(_[g])}u.removeEventListener("dispose",o),delete s[u.id];const p=r.get(u);p&&(e.remove(p),r.delete(u)),i.releaseStatesOfGeometry(u),u.isInstancedBufferGeometry===!0&&delete u._maxInstanceCount,t.memory.geometries--}function l(c,u){return s[u.id]===!0||(u.addEventListener("dispose",o),s[u.id]=!0,t.memory.geometries++),u}function h(c){const u=c.attributes;for(const m in u)e.update(u[m],a.ARRAY_BUFFER);const p=c.morphAttributes;for(const m in p){const _=p[m];for(let g=0,v=_.length;g<v;g++)e.update(_[g],a.ARRAY_BUFFER)}}function d(c){const u=[],p=c.index,m=c.attributes.position;let _=0;if(p!==null){const y=p.array;_=p.version;for(let x=0,b=y.length;x<b;x+=3){const S=y[x+0],A=y[x+1],E=y[x+2];u.push(S,A,A,E,E,S)}}else if(m!==void 0){const y=m.array;_=m.version;for(let x=0,b=y.length/3-1;x<b;x+=3){const S=x+0,A=x+1,E=x+2;u.push(S,A,A,E,E,S)}}else return;const g=new(Ap(u)?Pp:kh)(u,1);g.version=_;const v=r.get(c);v&&e.remove(v),r.set(c,g)}function f(c){const u=r.get(c);if(u){const p=c.index;p!==null&&u.version<p.version&&d(c)}else d(c);return r.get(c)}return{get:l,update:h,getWireframeAttribute:f}}function ox(a,e,t){let i;function s(u){i=u}let r,o;function l(u){r=u.type,o=u.bytesPerElement}function h(u,p){a.drawElements(i,p,r,u*o),t.update(p,i,1)}function d(u,p,m){m!==0&&(a.drawElementsInstanced(i,p,r,u*o,m),t.update(p,i,m))}function f(u,p,m){if(m===0)return;const _=e.get("WEBGL_multi_draw");if(_===null)for(let g=0;g<m;g++)this.render(u[g]/o,p[g]);else{_.multiDrawElementsWEBGL(i,p,0,r,u,0,m);let g=0;for(let v=0;v<m;v++)g+=p[v];t.update(g,i,1)}}function c(u,p,m,_){if(m===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let v=0;v<u.length;v++)d(u[v]/o,p[v],_[v]);else{g.multiDrawElementsInstancedWEBGL(i,p,0,r,u,0,_,0,m);let v=0;for(let y=0;y<m;y++)v+=p[y];for(let y=0;y<_.length;y++)t.update(v,i,_[y])}}this.setMode=s,this.setIndex=l,this.render=h,this.renderInstances=d,this.renderMultiDraw=f,this.renderMultiDrawInstances=c}function ax(a){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(r,o,l){switch(t.calls++,o){case a.TRIANGLES:t.triangles+=l*(r/3);break;case a.LINES:t.lines+=l*(r/2);break;case a.LINE_STRIP:t.lines+=l*(r-1);break;case a.LINE_LOOP:t.lines+=l*r;break;case a.POINTS:t.points+=l*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function s(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:i}}function lx(a,e,t){const i=new WeakMap,s=new Ct;function r(o,l,h){const d=o.morphTargetInfluences,f=l.morphAttributes.position||l.morphAttributes.normal||l.morphAttributes.color,c=f!==void 0?f.length:0;let u=i.get(l);if(u===void 0||u.count!==c){let w=function(){R.dispose(),i.delete(l),l.removeEventListener("dispose",w)};var p=w;u!==void 0&&u.texture.dispose();const m=l.morphAttributes.position!==void 0,_=l.morphAttributes.normal!==void 0,g=l.morphAttributes.color!==void 0,v=l.morphAttributes.position||[],y=l.morphAttributes.normal||[],x=l.morphAttributes.color||[];let b=0;m===!0&&(b=1),_===!0&&(b=2),g===!0&&(b=3);let S=l.attributes.position.count*b,A=1;S>e.maxTextureSize&&(A=Math.ceil(S/e.maxTextureSize),S=e.maxTextureSize);const E=new Float32Array(S*A*4*c),R=new Cp(E,S,A,c);R.type=Cn,R.needsUpdate=!0;const M=b*4;for(let L=0;L<c;L++){const N=v[L],B=y[L],G=x[L],W=S*A*4*L;for(let ee=0;ee<N.count;ee++){const z=ee*M;m===!0&&(s.fromBufferAttribute(N,ee),E[W+z+0]=s.x,E[W+z+1]=s.y,E[W+z+2]=s.z,E[W+z+3]=0),_===!0&&(s.fromBufferAttribute(B,ee),E[W+z+4]=s.x,E[W+z+5]=s.y,E[W+z+6]=s.z,E[W+z+7]=0),g===!0&&(s.fromBufferAttribute(G,ee),E[W+z+8]=s.x,E[W+z+9]=s.y,E[W+z+10]=s.z,E[W+z+11]=G.itemSize===4?s.w:1)}}u={count:c,texture:R,size:new Oe(S,A)},i.set(l,u),l.addEventListener("dispose",w)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)h.getUniforms().setValue(a,"morphTexture",o.morphTexture,t);else{let m=0;for(let g=0;g<d.length;g++)m+=d[g];const _=l.morphTargetsRelative?1:1-m;h.getUniforms().setValue(a,"morphTargetBaseInfluence",_),h.getUniforms().setValue(a,"morphTargetInfluences",d)}h.getUniforms().setValue(a,"morphTargetsTexture",u.texture,t),h.getUniforms().setValue(a,"morphTargetsTextureSize",u.size)}return{update:r}}function cx(a,e,t,i){let s=new WeakMap;function r(h){const d=i.render.frame,f=h.geometry,c=e.get(h,f);if(s.get(c)!==d&&(e.update(c),s.set(c,d)),h.isInstancedMesh&&(h.hasEventListener("dispose",l)===!1&&h.addEventListener("dispose",l),s.get(h)!==d&&(t.update(h.instanceMatrix,a.ARRAY_BUFFER),h.instanceColor!==null&&t.update(h.instanceColor,a.ARRAY_BUFFER),s.set(h,d))),h.isSkinnedMesh){const u=h.skeleton;s.get(u)!==d&&(u.update(),s.set(u,d))}return c}function o(){s=new WeakMap}function l(h){const d=h.target;d.removeEventListener("dispose",l),t.remove(d.instanceMatrix),d.instanceColor!==null&&t.remove(d.instanceColor)}return{update:r,dispose:o}}class kp extends Ht{constructor(e,t,i,s,r,o,l,h,d,f){if(f=f!==void 0?f:Ur,f!==Ur&&f!==Oo)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&f===Ur&&(i=$r),i===void 0&&f===Oo&&(i=ea),super(null,s,r,o,l,h,f,i,d),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=l!==void 0?l:li,this.minFilter=h!==void 0?h:li,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const Np=new Ht,Op=new kp(1,1);Op.compareFunction=Sp;const Up=new Cp,zp=new Z0,Vp=new Bp,wd=[],Md=[],Sd=new Float32Array(16),Ad=new Float32Array(9),Ed=new Float32Array(4);function ro(a,e,t){const i=a[0];if(i<=0||i>0)return a;const s=e*t;let r=wd[s];if(r===void 0&&(r=new Float32Array(s),wd[s]=r),e!==0){i.toArray(r,0);for(let o=1,l=0;o!==e;++o)l+=t,a[o].toArray(r,l)}return r}function mi(a,e){if(a.length!==e.length)return!1;for(let t=0,i=a.length;t<i;t++)if(a[t]!==e[t])return!1;return!0}function gi(a,e){for(let t=0,i=e.length;t<i;t++)a[t]=e[t]}function Il(a,e){let t=Md[e];t===void 0&&(t=new Int32Array(e),Md[e]=t);for(let i=0;i!==e;++i)t[i]=a.allocateTextureUnit();return t}function hx(a,e){const t=this.cache;t[0]!==e&&(a.uniform1f(this.addr,e),t[0]=e)}function ux(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(a.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(mi(t,e))return;a.uniform2fv(this.addr,e),gi(t,e)}}function dx(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(a.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(a.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(mi(t,e))return;a.uniform3fv(this.addr,e),gi(t,e)}}function fx(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(a.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(mi(t,e))return;a.uniform4fv(this.addr,e),gi(t,e)}}function px(a,e){const t=this.cache,i=e.elements;if(i===void 0){if(mi(t,e))return;a.uniformMatrix2fv(this.addr,!1,e),gi(t,e)}else{if(mi(t,i))return;Ed.set(i),a.uniformMatrix2fv(this.addr,!1,Ed),gi(t,i)}}function mx(a,e){const t=this.cache,i=e.elements;if(i===void 0){if(mi(t,e))return;a.uniformMatrix3fv(this.addr,!1,e),gi(t,e)}else{if(mi(t,i))return;Ad.set(i),a.uniformMatrix3fv(this.addr,!1,Ad),gi(t,i)}}function gx(a,e){const t=this.cache,i=e.elements;if(i===void 0){if(mi(t,e))return;a.uniformMatrix4fv(this.addr,!1,e),gi(t,e)}else{if(mi(t,i))return;Sd.set(i),a.uniformMatrix4fv(this.addr,!1,Sd),gi(t,i)}}function vx(a,e){const t=this.cache;t[0]!==e&&(a.uniform1i(this.addr,e),t[0]=e)}function _x(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(a.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(mi(t,e))return;a.uniform2iv(this.addr,e),gi(t,e)}}function yx(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(a.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(mi(t,e))return;a.uniform3iv(this.addr,e),gi(t,e)}}function xx(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(a.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(mi(t,e))return;a.uniform4iv(this.addr,e),gi(t,e)}}function bx(a,e){const t=this.cache;t[0]!==e&&(a.uniform1ui(this.addr,e),t[0]=e)}function wx(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(a.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(mi(t,e))return;a.uniform2uiv(this.addr,e),gi(t,e)}}function Mx(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(a.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(mi(t,e))return;a.uniform3uiv(this.addr,e),gi(t,e)}}function Sx(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(a.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(mi(t,e))return;a.uniform4uiv(this.addr,e),gi(t,e)}}function Ax(a,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(a.uniform1i(this.addr,s),i[0]=s);const r=this.type===a.SAMPLER_2D_SHADOW?Op:Np;t.setTexture2D(e||r,s)}function Ex(a,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(a.uniform1i(this.addr,s),i[0]=s),t.setTexture3D(e||zp,s)}function Tx(a,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(a.uniform1i(this.addr,s),i[0]=s),t.setTextureCube(e||Vp,s)}function Cx(a,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(a.uniform1i(this.addr,s),i[0]=s),t.setTexture2DArray(e||Up,s)}function Rx(a){switch(a){case 5126:return hx;case 35664:return ux;case 35665:return dx;case 35666:return fx;case 35674:return px;case 35675:return mx;case 35676:return gx;case 5124:case 35670:return vx;case 35667:case 35671:return _x;case 35668:case 35672:return yx;case 35669:case 35673:return xx;case 5125:return bx;case 36294:return wx;case 36295:return Mx;case 36296:return Sx;case 35678:case 36198:case 36298:case 36306:case 35682:return Ax;case 35679:case 36299:case 36307:return Ex;case 35680:case 36300:case 36308:case 36293:return Tx;case 36289:case 36303:case 36311:case 36292:return Cx}}function Px(a,e){a.uniform1fv(this.addr,e)}function Ix(a,e){const t=ro(e,this.size,2);a.uniform2fv(this.addr,t)}function Lx(a,e){const t=ro(e,this.size,3);a.uniform3fv(this.addr,t)}function Fx(a,e){const t=ro(e,this.size,4);a.uniform4fv(this.addr,t)}function Bx(a,e){const t=ro(e,this.size,4);a.uniformMatrix2fv(this.addr,!1,t)}function Dx(a,e){const t=ro(e,this.size,9);a.uniformMatrix3fv(this.addr,!1,t)}function kx(a,e){const t=ro(e,this.size,16);a.uniformMatrix4fv(this.addr,!1,t)}function Nx(a,e){a.uniform1iv(this.addr,e)}function Ox(a,e){a.uniform2iv(this.addr,e)}function Ux(a,e){a.uniform3iv(this.addr,e)}function zx(a,e){a.uniform4iv(this.addr,e)}function Vx(a,e){a.uniform1uiv(this.addr,e)}function Hx(a,e){a.uniform2uiv(this.addr,e)}function Gx(a,e){a.uniform3uiv(this.addr,e)}function Wx(a,e){a.uniform4uiv(this.addr,e)}function Xx(a,e,t){const i=this.cache,s=e.length,r=Il(t,s);mi(i,r)||(a.uniform1iv(this.addr,r),gi(i,r));for(let o=0;o!==s;++o)t.setTexture2D(e[o]||Np,r[o])}function jx(a,e,t){const i=this.cache,s=e.length,r=Il(t,s);mi(i,r)||(a.uniform1iv(this.addr,r),gi(i,r));for(let o=0;o!==s;++o)t.setTexture3D(e[o]||zp,r[o])}function Yx(a,e,t){const i=this.cache,s=e.length,r=Il(t,s);mi(i,r)||(a.uniform1iv(this.addr,r),gi(i,r));for(let o=0;o!==s;++o)t.setTextureCube(e[o]||Vp,r[o])}function qx(a,e,t){const i=this.cache,s=e.length,r=Il(t,s);mi(i,r)||(a.uniform1iv(this.addr,r),gi(i,r));for(let o=0;o!==s;++o)t.setTexture2DArray(e[o]||Up,r[o])}function $x(a){switch(a){case 5126:return Px;case 35664:return Ix;case 35665:return Lx;case 35666:return Fx;case 35674:return Bx;case 35675:return Dx;case 35676:return kx;case 5124:case 35670:return Nx;case 35667:case 35671:return Ox;case 35668:case 35672:return Ux;case 35669:case 35673:return zx;case 5125:return Vx;case 36294:return Hx;case 36295:return Gx;case 36296:return Wx;case 35678:case 36198:case 36298:case 36306:case 35682:return Xx;case 35679:case 36299:case 36307:return jx;case 35680:case 36300:case 36308:case 36293:return Yx;case 36289:case 36303:case 36311:case 36292:return qx}}class Zx{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=Rx(t.type)}}class Kx{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=$x(t.type)}}class Qx{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const s=this.seq;for(let r=0,o=s.length;r!==o;++r){const l=s[r];l.setValue(e,t[l.id],i)}}}const mc=/(\w+)(\])?(\[|\.)?/g;function Td(a,e){a.seq.push(e),a.map[e.id]=e}function Jx(a,e,t){const i=a.name,s=i.length;for(mc.lastIndex=0;;){const r=mc.exec(i),o=mc.lastIndex;let l=r[1];const h=r[2]==="]",d=r[3];if(h&&(l=l|0),d===void 0||d==="["&&o+2===s){Td(t,d===void 0?new Zx(l,a,e):new Kx(l,a,e));break}else{let c=t.map[l];c===void 0&&(c=new Qx(l),Td(t,c)),t=c}}}class Ja{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<i;++s){const r=e.getActiveUniform(t,s),o=e.getUniformLocation(t,r.name);Jx(r,o,this)}}setValue(e,t,i,s){const r=this.map[t];r!==void 0&&r.setValue(e,i,s)}setOptional(e,t,i){const s=t[i];s!==void 0&&this.setValue(e,i,s)}static upload(e,t,i,s){for(let r=0,o=t.length;r!==o;++r){const l=t[r],h=i[l.id];h.needsUpdate!==!1&&l.setValue(e,h.value,s)}}static seqWithValue(e,t){const i=[];for(let s=0,r=e.length;s!==r;++s){const o=e[s];o.id in t&&i.push(o)}return i}}function Cd(a,e,t){const i=a.createShader(e);return a.shaderSource(i,t),a.compileShader(i),i}const eb=37297;let tb=0;function ib(a,e){const t=a.split(`
`),i=[],s=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let o=s;o<r;o++){const l=o+1;i.push(`${l===e?">":" "} ${l}: ${t[o]}`)}return i.join(`
`)}function nb(a){const e=Rt.getPrimaries(Rt.workingColorSpace),t=Rt.getPrimaries(a);let i;switch(e===t?i="":e===dl&&t===ul?i="LinearDisplayP3ToLinearSRGB":e===ul&&t===dl&&(i="LinearSRGBToLinearDisplayP3"),a){case bi:case Pl:return[i,"LinearTransferOETF"];case ei:case Fh:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",a),[i,"LinearTransferOETF"]}}function Rd(a,e,t){const i=a.getShaderParameter(e,a.COMPILE_STATUS),s=a.getShaderInfoLog(e).trim();if(i&&s==="")return"";const r=/ERROR: 0:(\d+)/.exec(s);if(r){const o=parseInt(r[1]);return t.toUpperCase()+`

`+s+`

`+ib(a.getShaderSource(e),o)}else return s}function sb(a,e){const t=nb(e);return`vec4 ${a}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function rb(a,e){let t;switch(e){case Zg:t="Linear";break;case Kg:t="Reinhard";break;case Qg:t="OptimizedCineon";break;case Jg:t="ACESFilmic";break;case t0:t="AgX";break;case i0:t="Neutral";break;case e0:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+a+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function ob(a){return[a.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",a.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Ao).join(`
`)}function ab(a){const e=[];for(const t in a){const i=a[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function lb(a,e){const t={},i=a.getProgramParameter(e,a.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){const r=a.getActiveAttrib(e,s),o=r.name;let l=1;r.type===a.FLOAT_MAT2&&(l=2),r.type===a.FLOAT_MAT3&&(l=3),r.type===a.FLOAT_MAT4&&(l=4),t[o]={type:r.type,location:a.getAttribLocation(e,o),locationSize:l}}return t}function Ao(a){return a!==""}function Pd(a,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return a.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Id(a,e){return a.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const cb=/^[ \t]*#include +<([\w\d./]+)>/gm;function Jc(a){return a.replace(cb,ub)}const hb=new Map;function ub(a,e){let t=mt[e];if(t===void 0){const i=hb.get(e);if(i!==void 0)t=mt[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return Jc(t)}const db=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ld(a){return a.replace(db,fb)}function fb(a,e,t,i){let s="";for(let r=parseInt(e);r<parseInt(t);r++)s+=i.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}function Fd(a){let e=`precision ${a.precision} float;
	precision ${a.precision} int;
	precision ${a.precision} sampler2D;
	precision ${a.precision} samplerCube;
	precision ${a.precision} sampler3D;
	precision ${a.precision} sampler2DArray;
	precision ${a.precision} sampler2DShadow;
	precision ${a.precision} samplerCubeShadow;
	precision ${a.precision} sampler2DArrayShadow;
	precision ${a.precision} isampler2D;
	precision ${a.precision} isampler3D;
	precision ${a.precision} isamplerCube;
	precision ${a.precision} isampler2DArray;
	precision ${a.precision} usampler2D;
	precision ${a.precision} usampler3D;
	precision ${a.precision} usamplerCube;
	precision ${a.precision} usampler2DArray;
	`;return a.precision==="highp"?e+=`
#define HIGH_PRECISION`:a.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:a.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function pb(a){let e="SHADOWMAP_TYPE_BASIC";return a.shadowMapType===dp?e="SHADOWMAP_TYPE_PCF":a.shadowMapType===wg?e="SHADOWMAP_TYPE_PCF_SOFT":a.shadowMapType===Wn&&(e="SHADOWMAP_TYPE_VSM"),e}function mb(a){let e="ENVMAP_TYPE_CUBE";if(a.envMap)switch(a.envMapMode){case Yr:case qr:e="ENVMAP_TYPE_CUBE";break;case Rl:e="ENVMAP_TYPE_CUBE_UV";break}return e}function gb(a){let e="ENVMAP_MODE_REFLECTION";if(a.envMap)switch(a.envMapMode){case qr:e="ENVMAP_MODE_REFRACTION";break}return e}function vb(a){let e="ENVMAP_BLENDING_NONE";if(a.envMap)switch(a.combine){case Cl:e="ENVMAP_BLENDING_MULTIPLY";break;case qg:e="ENVMAP_BLENDING_MIX";break;case $g:e="ENVMAP_BLENDING_ADD";break}return e}function _b(a){const e=a.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function yb(a,e,t,i){const s=a.getContext(),r=t.defines;let o=t.vertexShader,l=t.fragmentShader;const h=pb(t),d=mb(t),f=gb(t),c=vb(t),u=_b(t),p=ob(t),m=ab(r),_=s.createProgram();let g,v,y=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(g=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m].filter(Ao).join(`
`),g.length>0&&(g+=`
`),v=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m].filter(Ao).join(`
`),v.length>0&&(v+=`
`)):(g=[Fd(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+f:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+h:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Ao).join(`
`),v=[Fd(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+d:"",t.envMap?"#define "+f:"",t.envMap?"#define "+c:"",u?"#define CUBEUV_TEXEL_WIDTH "+u.texelWidth:"",u?"#define CUBEUV_TEXEL_HEIGHT "+u.texelHeight:"",u?"#define CUBEUV_MAX_MIP "+u.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+h:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==vs?"#define TONE_MAPPING":"",t.toneMapping!==vs?mt.tonemapping_pars_fragment:"",t.toneMapping!==vs?rb("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",mt.colorspace_pars_fragment,sb("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Ao).join(`
`)),o=Jc(o),o=Pd(o,t),o=Id(o,t),l=Jc(l),l=Pd(l,t),l=Id(l,t),o=Ld(o),l=Ld(l),t.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,v=["#define varying in",t.glslVersion===qu?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===qu?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);const x=y+g+o,b=y+v+l,S=Cd(s,s.VERTEX_SHADER,x),A=Cd(s,s.FRAGMENT_SHADER,b);s.attachShader(_,S),s.attachShader(_,A),t.index0AttributeName!==void 0?s.bindAttribLocation(_,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(_,0,"position"),s.linkProgram(_);function E(L){if(a.debug.checkShaderErrors){const N=s.getProgramInfoLog(_).trim(),B=s.getShaderInfoLog(S).trim(),G=s.getShaderInfoLog(A).trim();let W=!0,ee=!0;if(s.getProgramParameter(_,s.LINK_STATUS)===!1)if(W=!1,typeof a.debug.onShaderError=="function")a.debug.onShaderError(s,_,S,A);else{const z=Rd(s,S,"vertex"),k=Rd(s,A,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(_,s.VALIDATE_STATUS)+`

Material Name: `+L.name+`
Material Type: `+L.type+`

Program Info Log: `+N+`
`+z+`
`+k)}else N!==""?console.warn("THREE.WebGLProgram: Program Info Log:",N):(B===""||G==="")&&(ee=!1);ee&&(L.diagnostics={runnable:W,programLog:N,vertexShader:{log:B,prefix:g},fragmentShader:{log:G,prefix:v}})}s.deleteShader(S),s.deleteShader(A),R=new Ja(s,_),M=lb(s,_)}let R;this.getUniforms=function(){return R===void 0&&E(this),R};let M;this.getAttributes=function(){return M===void 0&&E(this),M};let w=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return w===!1&&(w=s.getProgramParameter(_,eb)),w},this.destroy=function(){i.releaseStatesOfProgram(this),s.deleteProgram(_),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=tb++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=S,this.fragmentShader=A,this}let xb=0;class bb{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,s=this._getShaderStage(t),r=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return o.has(s)===!1&&(o.add(s),s.usedTimes++),o.has(r)===!1&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new wb(e),t.set(e,i)),i}}class wb{constructor(e){this.id=xb++,this.code=e,this.usedTimes=0}}function Mb(a,e,t,i,s,r,o){const l=new Dh,h=new bb,d=new Set,f=[],c=s.logarithmicDepthBuffer,u=s.vertexTextures;let p=s.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(M){return d.add(M),M===0?"uv":`uv${M}`}function g(M,w,L,N,B){const G=N.fog,W=B.geometry,ee=M.isMeshStandardMaterial?N.environment:null,z=(M.isMeshStandardMaterial?t:e).get(M.envMap||ee),k=z&&z.mapping===Rl?z.image.height:null,q=m[M.type];M.precision!==null&&(p=s.getMaxPrecision(M.precision),p!==M.precision&&console.warn("THREE.WebGLProgram.getParameters:",M.precision,"not supported, using",p,"instead."));const $=W.morphAttributes.position||W.morphAttributes.normal||W.morphAttributes.color,H=$!==void 0?$.length:0;let Q=0;W.morphAttributes.position!==void 0&&(Q=1),W.morphAttributes.normal!==void 0&&(Q=2),W.morphAttributes.color!==void 0&&(Q=3);let X,F,D,j;if(q){const gt=An[q];X=gt.vertexShader,F=gt.fragmentShader}else X=M.vertexShader,F=M.fragmentShader,h.update(M),D=h.getVertexShaderID(M),j=h.getFragmentShaderID(M);const te=a.getRenderTarget(),ae=B.isInstancedMesh===!0,K=B.isBatchedMesh===!0,O=!!M.map,pe=!!M.matcap,xe=!!z,Ee=!!M.aoMap,ve=!!M.lightMap,he=!!M.bumpMap,fe=!!M.normalMap,qe=!!M.displacementMap,Ye=!!M.emissiveMap,U=!!M.metalnessMap,P=!!M.roughnessMap,re=M.anisotropy>0,de=M.clearcoat>0,me=M.dispersion>0,_e=M.iridescence>0,De=M.sheen>0,Ce=M.transmission>0,Me=re&&!!M.anisotropyMap,tt=de&&!!M.clearcoatMap,Pe=de&&!!M.clearcoatNormalMap,et=de&&!!M.clearcoatRoughnessMap,ut=_e&&!!M.iridescenceMap,it=_e&&!!M.iridescenceThicknessMap,We=De&&!!M.sheenColorMap,st=De&&!!M.sheenRoughnessMap,ct=!!M.specularMap,xt=!!M.specularColorMap,rt=!!M.specularIntensityMap,C=Ce&&!!M.transmissionMap,ne=Ce&&!!M.thicknessMap,oe=!!M.gradientMap,be=!!M.alphaMap,Re=M.alphaTest>0,ot=!!M.alphaHash,ht=!!M.extensions;let Et=vs;M.toneMapped&&(te===null||te.isXRRenderTarget===!0)&&(Et=a.toneMapping);const Gt={shaderID:q,shaderType:M.type,shaderName:M.name,vertexShader:X,fragmentShader:F,defines:M.defines,customVertexShaderID:D,customFragmentShaderID:j,isRawShaderMaterial:M.isRawShaderMaterial===!0,glslVersion:M.glslVersion,precision:p,batching:K,instancing:ae,instancingColor:ae&&B.instanceColor!==null,instancingMorph:ae&&B.morphTexture!==null,supportsVertexTextures:u,outputColorSpace:te===null?a.outputColorSpace:te.isXRRenderTarget===!0?te.texture.colorSpace:bi,alphaToCoverage:!!M.alphaToCoverage,map:O,matcap:pe,envMap:xe,envMapMode:xe&&z.mapping,envMapCubeUVHeight:k,aoMap:Ee,lightMap:ve,bumpMap:he,normalMap:fe,displacementMap:u&&qe,emissiveMap:Ye,normalMapObjectSpace:fe&&M.normalMapType===x0,normalMapTangentSpace:fe&&M.normalMapType===ta,metalnessMap:U,roughnessMap:P,anisotropy:re,anisotropyMap:Me,clearcoat:de,clearcoatMap:tt,clearcoatNormalMap:Pe,clearcoatRoughnessMap:et,dispersion:me,iridescence:_e,iridescenceMap:ut,iridescenceThicknessMap:it,sheen:De,sheenColorMap:We,sheenRoughnessMap:st,specularMap:ct,specularColorMap:xt,specularIntensityMap:rt,transmission:Ce,transmissionMap:C,thicknessMap:ne,gradientMap:oe,opaque:M.transparent===!1&&M.blending===Or&&M.alphaToCoverage===!1,alphaMap:be,alphaTest:Re,alphaHash:ot,combine:M.combine,mapUv:O&&_(M.map.channel),aoMapUv:Ee&&_(M.aoMap.channel),lightMapUv:ve&&_(M.lightMap.channel),bumpMapUv:he&&_(M.bumpMap.channel),normalMapUv:fe&&_(M.normalMap.channel),displacementMapUv:qe&&_(M.displacementMap.channel),emissiveMapUv:Ye&&_(M.emissiveMap.channel),metalnessMapUv:U&&_(M.metalnessMap.channel),roughnessMapUv:P&&_(M.roughnessMap.channel),anisotropyMapUv:Me&&_(M.anisotropyMap.channel),clearcoatMapUv:tt&&_(M.clearcoatMap.channel),clearcoatNormalMapUv:Pe&&_(M.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:et&&_(M.clearcoatRoughnessMap.channel),iridescenceMapUv:ut&&_(M.iridescenceMap.channel),iridescenceThicknessMapUv:it&&_(M.iridescenceThicknessMap.channel),sheenColorMapUv:We&&_(M.sheenColorMap.channel),sheenRoughnessMapUv:st&&_(M.sheenRoughnessMap.channel),specularMapUv:ct&&_(M.specularMap.channel),specularColorMapUv:xt&&_(M.specularColorMap.channel),specularIntensityMapUv:rt&&_(M.specularIntensityMap.channel),transmissionMapUv:C&&_(M.transmissionMap.channel),thicknessMapUv:ne&&_(M.thicknessMap.channel),alphaMapUv:be&&_(M.alphaMap.channel),vertexTangents:!!W.attributes.tangent&&(fe||re),vertexColors:M.vertexColors,vertexAlphas:M.vertexColors===!0&&!!W.attributes.color&&W.attributes.color.itemSize===4,pointsUvs:B.isPoints===!0&&!!W.attributes.uv&&(O||be),fog:!!G,useFog:M.fog===!0,fogExp2:!!G&&G.isFogExp2,flatShading:M.flatShading===!0,sizeAttenuation:M.sizeAttenuation===!0,logarithmicDepthBuffer:c,skinning:B.isSkinnedMesh===!0,morphTargets:W.morphAttributes.position!==void 0,morphNormals:W.morphAttributes.normal!==void 0,morphColors:W.morphAttributes.color!==void 0,morphTargetsCount:H,morphTextureStride:Q,numDirLights:w.directional.length,numPointLights:w.point.length,numSpotLights:w.spot.length,numSpotLightMaps:w.spotLightMap.length,numRectAreaLights:w.rectArea.length,numHemiLights:w.hemi.length,numDirLightShadows:w.directionalShadowMap.length,numPointLightShadows:w.pointShadowMap.length,numSpotLightShadows:w.spotShadowMap.length,numSpotLightShadowsWithMaps:w.numSpotLightShadowsWithMaps,numLightProbes:w.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:M.dithering,shadowMapEnabled:a.shadowMap.enabled&&L.length>0,shadowMapType:a.shadowMap.type,toneMapping:Et,useLegacyLights:a._useLegacyLights,decodeVideoTexture:O&&M.map.isVideoTexture===!0&&Rt.getTransfer(M.map.colorSpace)===Wt,premultipliedAlpha:M.premultipliedAlpha,doubleSided:M.side===Ui,flipSided:M.side===zi,useDepthPacking:M.depthPacking>=0,depthPacking:M.depthPacking||0,index0AttributeName:M.index0AttributeName,extensionClipCullDistance:ht&&M.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:ht&&M.extensions.multiDraw===!0&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:M.customProgramCacheKey()};return Gt.vertexUv1s=d.has(1),Gt.vertexUv2s=d.has(2),Gt.vertexUv3s=d.has(3),d.clear(),Gt}function v(M){const w=[];if(M.shaderID?w.push(M.shaderID):(w.push(M.customVertexShaderID),w.push(M.customFragmentShaderID)),M.defines!==void 0)for(const L in M.defines)w.push(L),w.push(M.defines[L]);return M.isRawShaderMaterial===!1&&(y(w,M),x(w,M),w.push(a.outputColorSpace)),w.push(M.customProgramCacheKey),w.join()}function y(M,w){M.push(w.precision),M.push(w.outputColorSpace),M.push(w.envMapMode),M.push(w.envMapCubeUVHeight),M.push(w.mapUv),M.push(w.alphaMapUv),M.push(w.lightMapUv),M.push(w.aoMapUv),M.push(w.bumpMapUv),M.push(w.normalMapUv),M.push(w.displacementMapUv),M.push(w.emissiveMapUv),M.push(w.metalnessMapUv),M.push(w.roughnessMapUv),M.push(w.anisotropyMapUv),M.push(w.clearcoatMapUv),M.push(w.clearcoatNormalMapUv),M.push(w.clearcoatRoughnessMapUv),M.push(w.iridescenceMapUv),M.push(w.iridescenceThicknessMapUv),M.push(w.sheenColorMapUv),M.push(w.sheenRoughnessMapUv),M.push(w.specularMapUv),M.push(w.specularColorMapUv),M.push(w.specularIntensityMapUv),M.push(w.transmissionMapUv),M.push(w.thicknessMapUv),M.push(w.combine),M.push(w.fogExp2),M.push(w.sizeAttenuation),M.push(w.morphTargetsCount),M.push(w.morphAttributeCount),M.push(w.numDirLights),M.push(w.numPointLights),M.push(w.numSpotLights),M.push(w.numSpotLightMaps),M.push(w.numHemiLights),M.push(w.numRectAreaLights),M.push(w.numDirLightShadows),M.push(w.numPointLightShadows),M.push(w.numSpotLightShadows),M.push(w.numSpotLightShadowsWithMaps),M.push(w.numLightProbes),M.push(w.shadowMapType),M.push(w.toneMapping),M.push(w.numClippingPlanes),M.push(w.numClipIntersection),M.push(w.depthPacking)}function x(M,w){l.disableAll(),w.supportsVertexTextures&&l.enable(0),w.instancing&&l.enable(1),w.instancingColor&&l.enable(2),w.instancingMorph&&l.enable(3),w.matcap&&l.enable(4),w.envMap&&l.enable(5),w.normalMapObjectSpace&&l.enable(6),w.normalMapTangentSpace&&l.enable(7),w.clearcoat&&l.enable(8),w.iridescence&&l.enable(9),w.alphaTest&&l.enable(10),w.vertexColors&&l.enable(11),w.vertexAlphas&&l.enable(12),w.vertexUv1s&&l.enable(13),w.vertexUv2s&&l.enable(14),w.vertexUv3s&&l.enable(15),w.vertexTangents&&l.enable(16),w.anisotropy&&l.enable(17),w.alphaHash&&l.enable(18),w.batching&&l.enable(19),w.dispersion&&l.enable(20),M.push(l.mask),l.disableAll(),w.fog&&l.enable(0),w.useFog&&l.enable(1),w.flatShading&&l.enable(2),w.logarithmicDepthBuffer&&l.enable(3),w.skinning&&l.enable(4),w.morphTargets&&l.enable(5),w.morphNormals&&l.enable(6),w.morphColors&&l.enable(7),w.premultipliedAlpha&&l.enable(8),w.shadowMapEnabled&&l.enable(9),w.useLegacyLights&&l.enable(10),w.doubleSided&&l.enable(11),w.flipSided&&l.enable(12),w.useDepthPacking&&l.enable(13),w.dithering&&l.enable(14),w.transmission&&l.enable(15),w.sheen&&l.enable(16),w.opaque&&l.enable(17),w.pointsUvs&&l.enable(18),w.decodeVideoTexture&&l.enable(19),w.alphaToCoverage&&l.enable(20),M.push(l.mask)}function b(M){const w=m[M.type];let L;if(w){const N=An[w];L=Lp.clone(N.uniforms)}else L=M.uniforms;return L}function S(M,w){let L;for(let N=0,B=f.length;N<B;N++){const G=f[N];if(G.cacheKey===w){L=G,++L.usedTimes;break}}return L===void 0&&(L=new yb(a,w,M,r),f.push(L)),L}function A(M){if(--M.usedTimes===0){const w=f.indexOf(M);f[w]=f[f.length-1],f.pop(),M.destroy()}}function E(M){h.remove(M)}function R(){h.dispose()}return{getParameters:g,getProgramCacheKey:v,getUniforms:b,acquireProgram:S,releaseProgram:A,releaseShaderCache:E,programs:f,dispose:R}}function Sb(){let a=new WeakMap;function e(r){let o=a.get(r);return o===void 0&&(o={},a.set(r,o)),o}function t(r){a.delete(r)}function i(r,o,l){a.get(r)[o]=l}function s(){a=new WeakMap}return{get:e,remove:t,update:i,dispose:s}}function Ab(a,e){return a.groupOrder!==e.groupOrder?a.groupOrder-e.groupOrder:a.renderOrder!==e.renderOrder?a.renderOrder-e.renderOrder:a.material.id!==e.material.id?a.material.id-e.material.id:a.z!==e.z?a.z-e.z:a.id-e.id}function Bd(a,e){return a.groupOrder!==e.groupOrder?a.groupOrder-e.groupOrder:a.renderOrder!==e.renderOrder?a.renderOrder-e.renderOrder:a.z!==e.z?e.z-a.z:a.id-e.id}function Dd(){const a=[];let e=0;const t=[],i=[],s=[];function r(){e=0,t.length=0,i.length=0,s.length=0}function o(c,u,p,m,_,g){let v=a[e];return v===void 0?(v={id:c.id,object:c,geometry:u,material:p,groupOrder:m,renderOrder:c.renderOrder,z:_,group:g},a[e]=v):(v.id=c.id,v.object=c,v.geometry=u,v.material=p,v.groupOrder=m,v.renderOrder=c.renderOrder,v.z=_,v.group=g),e++,v}function l(c,u,p,m,_,g){const v=o(c,u,p,m,_,g);p.transmission>0?i.push(v):p.transparent===!0?s.push(v):t.push(v)}function h(c,u,p,m,_,g){const v=o(c,u,p,m,_,g);p.transmission>0?i.unshift(v):p.transparent===!0?s.unshift(v):t.unshift(v)}function d(c,u){t.length>1&&t.sort(c||Ab),i.length>1&&i.sort(u||Bd),s.length>1&&s.sort(u||Bd)}function f(){for(let c=e,u=a.length;c<u;c++){const p=a[c];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:t,transmissive:i,transparent:s,init:r,push:l,unshift:h,finish:f,sort:d}}function Eb(){let a=new WeakMap;function e(i,s){const r=a.get(i);let o;return r===void 0?(o=new Dd,a.set(i,[o])):s>=r.length?(o=new Dd,r.push(o)):o=r[s],o}function t(){a=new WeakMap}return{get:e,dispose:t}}function Tb(){const a={};return{get:function(e){if(a[e.id]!==void 0)return a[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new T,color:new Le};break;case"SpotLight":t={position:new T,direction:new T,color:new Le,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new T,color:new Le,distance:0,decay:0};break;case"HemisphereLight":t={direction:new T,skyColor:new Le,groundColor:new Le};break;case"RectAreaLight":t={color:new Le,position:new T,halfWidth:new T,halfHeight:new T};break}return a[e.id]=t,t}}}function Cb(){const a={};return{get:function(e){if(a[e.id]!==void 0)return a[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Oe};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Oe};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Oe,shadowCameraNear:1,shadowCameraFar:1e3};break}return a[e.id]=t,t}}}let Rb=0;function Pb(a,e){return(e.castShadow?2:0)-(a.castShadow?2:0)+(e.map?1:0)-(a.map?1:0)}function Ib(a){const e=new Tb,t=Cb(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let d=0;d<9;d++)i.probe.push(new T);const s=new T,r=new Je,o=new Je;function l(d,f){let c=0,u=0,p=0;for(let L=0;L<9;L++)i.probe[L].set(0,0,0);let m=0,_=0,g=0,v=0,y=0,x=0,b=0,S=0,A=0,E=0,R=0;d.sort(Pb);const M=f===!0?Math.PI:1;for(let L=0,N=d.length;L<N;L++){const B=d[L],G=B.color,W=B.intensity,ee=B.distance,z=B.shadow&&B.shadow.map?B.shadow.map.texture:null;if(B.isAmbientLight)c+=G.r*W*M,u+=G.g*W*M,p+=G.b*W*M;else if(B.isLightProbe){for(let k=0;k<9;k++)i.probe[k].addScaledVector(B.sh.coefficients[k],W);R++}else if(B.isDirectionalLight){const k=e.get(B);if(k.color.copy(B.color).multiplyScalar(B.intensity*M),B.castShadow){const q=B.shadow,$=t.get(B);$.shadowBias=q.bias,$.shadowNormalBias=q.normalBias,$.shadowRadius=q.radius,$.shadowMapSize=q.mapSize,i.directionalShadow[m]=$,i.directionalShadowMap[m]=z,i.directionalShadowMatrix[m]=B.shadow.matrix,x++}i.directional[m]=k,m++}else if(B.isSpotLight){const k=e.get(B);k.position.setFromMatrixPosition(B.matrixWorld),k.color.copy(G).multiplyScalar(W*M),k.distance=ee,k.coneCos=Math.cos(B.angle),k.penumbraCos=Math.cos(B.angle*(1-B.penumbra)),k.decay=B.decay,i.spot[g]=k;const q=B.shadow;if(B.map&&(i.spotLightMap[A]=B.map,A++,q.updateMatrices(B),B.castShadow&&E++),i.spotLightMatrix[g]=q.matrix,B.castShadow){const $=t.get(B);$.shadowBias=q.bias,$.shadowNormalBias=q.normalBias,$.shadowRadius=q.radius,$.shadowMapSize=q.mapSize,i.spotShadow[g]=$,i.spotShadowMap[g]=z,S++}g++}else if(B.isRectAreaLight){const k=e.get(B);k.color.copy(G).multiplyScalar(W),k.halfWidth.set(B.width*.5,0,0),k.halfHeight.set(0,B.height*.5,0),i.rectArea[v]=k,v++}else if(B.isPointLight){const k=e.get(B);if(k.color.copy(B.color).multiplyScalar(B.intensity*M),k.distance=B.distance,k.decay=B.decay,B.castShadow){const q=B.shadow,$=t.get(B);$.shadowBias=q.bias,$.shadowNormalBias=q.normalBias,$.shadowRadius=q.radius,$.shadowMapSize=q.mapSize,$.shadowCameraNear=q.camera.near,$.shadowCameraFar=q.camera.far,i.pointShadow[_]=$,i.pointShadowMap[_]=z,i.pointShadowMatrix[_]=B.shadow.matrix,b++}i.point[_]=k,_++}else if(B.isHemisphereLight){const k=e.get(B);k.skyColor.copy(B.color).multiplyScalar(W*M),k.groundColor.copy(B.groundColor).multiplyScalar(W*M),i.hemi[y]=k,y++}}v>0&&(a.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=He.LTC_FLOAT_1,i.rectAreaLTC2=He.LTC_FLOAT_2):(i.rectAreaLTC1=He.LTC_HALF_1,i.rectAreaLTC2=He.LTC_HALF_2)),i.ambient[0]=c,i.ambient[1]=u,i.ambient[2]=p;const w=i.hash;(w.directionalLength!==m||w.pointLength!==_||w.spotLength!==g||w.rectAreaLength!==v||w.hemiLength!==y||w.numDirectionalShadows!==x||w.numPointShadows!==b||w.numSpotShadows!==S||w.numSpotMaps!==A||w.numLightProbes!==R)&&(i.directional.length=m,i.spot.length=g,i.rectArea.length=v,i.point.length=_,i.hemi.length=y,i.directionalShadow.length=x,i.directionalShadowMap.length=x,i.pointShadow.length=b,i.pointShadowMap.length=b,i.spotShadow.length=S,i.spotShadowMap.length=S,i.directionalShadowMatrix.length=x,i.pointShadowMatrix.length=b,i.spotLightMatrix.length=S+A-E,i.spotLightMap.length=A,i.numSpotLightShadowsWithMaps=E,i.numLightProbes=R,w.directionalLength=m,w.pointLength=_,w.spotLength=g,w.rectAreaLength=v,w.hemiLength=y,w.numDirectionalShadows=x,w.numPointShadows=b,w.numSpotShadows=S,w.numSpotMaps=A,w.numLightProbes=R,i.version=Rb++)}function h(d,f){let c=0,u=0,p=0,m=0,_=0;const g=f.matrixWorldInverse;for(let v=0,y=d.length;v<y;v++){const x=d[v];if(x.isDirectionalLight){const b=i.directional[c];b.direction.setFromMatrixPosition(x.matrixWorld),s.setFromMatrixPosition(x.target.matrixWorld),b.direction.sub(s),b.direction.transformDirection(g),c++}else if(x.isSpotLight){const b=i.spot[p];b.position.setFromMatrixPosition(x.matrixWorld),b.position.applyMatrix4(g),b.direction.setFromMatrixPosition(x.matrixWorld),s.setFromMatrixPosition(x.target.matrixWorld),b.direction.sub(s),b.direction.transformDirection(g),p++}else if(x.isRectAreaLight){const b=i.rectArea[m];b.position.setFromMatrixPosition(x.matrixWorld),b.position.applyMatrix4(g),o.identity(),r.copy(x.matrixWorld),r.premultiply(g),o.extractRotation(r),b.halfWidth.set(x.width*.5,0,0),b.halfHeight.set(0,x.height*.5,0),b.halfWidth.applyMatrix4(o),b.halfHeight.applyMatrix4(o),m++}else if(x.isPointLight){const b=i.point[u];b.position.setFromMatrixPosition(x.matrixWorld),b.position.applyMatrix4(g),u++}else if(x.isHemisphereLight){const b=i.hemi[_];b.direction.setFromMatrixPosition(x.matrixWorld),b.direction.transformDirection(g),_++}}}return{setup:l,setupView:h,state:i}}function kd(a){const e=new Ib(a),t=[],i=[];function s(f){d.camera=f,t.length=0,i.length=0}function r(f){t.push(f)}function o(f){i.push(f)}function l(f){e.setup(t,f)}function h(f){e.setupView(t,f)}const d={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:s,state:d,setupLights:l,setupLightsView:h,pushLight:r,pushShadow:o}}function Lb(a){let e=new WeakMap;function t(s,r=0){const o=e.get(s);let l;return o===void 0?(l=new kd(a),e.set(s,[l])):r>=o.length?(l=new kd(a),o.push(l)):l=o[r],l}function i(){e=new WeakMap}return{get:t,dispose:i}}class Fb extends Qi{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=_0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Bb extends Qi{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const Db=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,kb=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Nb(a,e,t){let i=new Nh;const s=new Oe,r=new Oe,o=new Ct,l=new Fb({depthPacking:y0}),h=new Bb,d={},f=t.maxTextureSize,c={[Kn]:zi,[zi]:Kn,[Ui]:Ui},u=new fi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Oe},radius:{value:4}},vertexShader:Db,fragmentShader:kb}),p=u.clone();p.defines.HORIZONTAL_PASS=1;const m=new Bt;m.setAttribute("position",new ci(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new Ae(m,u),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=dp;let v=this.type;this.render=function(A,E,R){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||A.length===0)return;const M=a.getRenderTarget(),w=a.getActiveCubeFace(),L=a.getActiveMipmapLevel(),N=a.state;N.setBlending(Zn),N.buffers.color.setClear(1,1,1,1),N.buffers.depth.setTest(!0),N.setScissorTest(!1);const B=v!==Wn&&this.type===Wn,G=v===Wn&&this.type!==Wn;for(let W=0,ee=A.length;W<ee;W++){const z=A[W],k=z.shadow;if(k===void 0){console.warn("THREE.WebGLShadowMap:",z,"has no shadow.");continue}if(k.autoUpdate===!1&&k.needsUpdate===!1)continue;s.copy(k.mapSize);const q=k.getFrameExtents();if(s.multiply(q),r.copy(k.mapSize),(s.x>f||s.y>f)&&(s.x>f&&(r.x=Math.floor(f/q.x),s.x=r.x*q.x,k.mapSize.x=r.x),s.y>f&&(r.y=Math.floor(f/q.y),s.y=r.y*q.y,k.mapSize.y=r.y)),k.map===null||B===!0||G===!0){const H=this.type!==Wn?{minFilter:li,magFilter:li}:{};k.map!==null&&k.map.dispose(),k.map=new bs(s.x,s.y,H),k.map.texture.name=z.name+".shadowMap",k.camera.updateProjectionMatrix()}a.setRenderTarget(k.map),a.clear();const $=k.getViewportCount();for(let H=0;H<$;H++){const Q=k.getViewport(H);o.set(r.x*Q.x,r.y*Q.y,r.x*Q.z,r.y*Q.w),N.viewport(o),k.updateMatrices(z,H),i=k.getFrustum(),b(E,R,k.camera,z,this.type)}k.isPointLightShadow!==!0&&this.type===Wn&&y(k,R),k.needsUpdate=!1}v=this.type,g.needsUpdate=!1,a.setRenderTarget(M,w,L)};function y(A,E){const R=e.update(_);u.defines.VSM_SAMPLES!==A.blurSamples&&(u.defines.VSM_SAMPLES=A.blurSamples,p.defines.VSM_SAMPLES=A.blurSamples,u.needsUpdate=!0,p.needsUpdate=!0),A.mapPass===null&&(A.mapPass=new bs(s.x,s.y)),u.uniforms.shadow_pass.value=A.map.texture,u.uniforms.resolution.value=A.mapSize,u.uniforms.radius.value=A.radius,a.setRenderTarget(A.mapPass),a.clear(),a.renderBufferDirect(E,null,R,u,_,null),p.uniforms.shadow_pass.value=A.mapPass.texture,p.uniforms.resolution.value=A.mapSize,p.uniforms.radius.value=A.radius,a.setRenderTarget(A.map),a.clear(),a.renderBufferDirect(E,null,R,p,_,null)}function x(A,E,R,M){let w=null;const L=R.isPointLight===!0?A.customDistanceMaterial:A.customDepthMaterial;if(L!==void 0)w=L;else if(w=R.isPointLight===!0?h:l,a.localClippingEnabled&&E.clipShadows===!0&&Array.isArray(E.clippingPlanes)&&E.clippingPlanes.length!==0||E.displacementMap&&E.displacementScale!==0||E.alphaMap&&E.alphaTest>0||E.map&&E.alphaTest>0){const N=w.uuid,B=E.uuid;let G=d[N];G===void 0&&(G={},d[N]=G);let W=G[B];W===void 0&&(W=w.clone(),G[B]=W,E.addEventListener("dispose",S)),w=W}if(w.visible=E.visible,w.wireframe=E.wireframe,M===Wn?w.side=E.shadowSide!==null?E.shadowSide:E.side:w.side=E.shadowSide!==null?E.shadowSide:c[E.side],w.alphaMap=E.alphaMap,w.alphaTest=E.alphaTest,w.map=E.map,w.clipShadows=E.clipShadows,w.clippingPlanes=E.clippingPlanes,w.clipIntersection=E.clipIntersection,w.displacementMap=E.displacementMap,w.displacementScale=E.displacementScale,w.displacementBias=E.displacementBias,w.wireframeLinewidth=E.wireframeLinewidth,w.linewidth=E.linewidth,R.isPointLight===!0&&w.isMeshDistanceMaterial===!0){const N=a.properties.get(w);N.light=R}return w}function b(A,E,R,M,w){if(A.visible===!1)return;if(A.layers.test(E.layers)&&(A.isMesh||A.isLine||A.isPoints)&&(A.castShadow||A.receiveShadow&&w===Wn)&&(!A.frustumCulled||i.intersectsObject(A))){A.modelViewMatrix.multiplyMatrices(R.matrixWorldInverse,A.matrixWorld);const B=e.update(A),G=A.material;if(Array.isArray(G)){const W=B.groups;for(let ee=0,z=W.length;ee<z;ee++){const k=W[ee],q=G[k.materialIndex];if(q&&q.visible){const $=x(A,q,M,w);A.onBeforeShadow(a,A,E,R,B,$,k),a.renderBufferDirect(R,null,B,$,A,k),A.onAfterShadow(a,A,E,R,B,$,k)}}}else if(G.visible){const W=x(A,G,M,w);A.onBeforeShadow(a,A,E,R,B,W,null),a.renderBufferDirect(R,null,B,W,A,null),A.onAfterShadow(a,A,E,R,B,W,null)}}const N=A.children;for(let B=0,G=N.length;B<G;B++)b(N[B],E,R,M,w)}function S(A){A.target.removeEventListener("dispose",S);for(const R in d){const M=d[R],w=A.target.uuid;w in M&&(M[w].dispose(),delete M[w])}}}function Ob(a){function e(){let C=!1;const ne=new Ct;let oe=null;const be=new Ct(0,0,0,0);return{setMask:function(Re){oe!==Re&&!C&&(a.colorMask(Re,Re,Re,Re),oe=Re)},setLocked:function(Re){C=Re},setClear:function(Re,ot,ht,Et,Gt){Gt===!0&&(Re*=Et,ot*=Et,ht*=Et),ne.set(Re,ot,ht,Et),be.equals(ne)===!1&&(a.clearColor(Re,ot,ht,Et),be.copy(ne))},reset:function(){C=!1,oe=null,be.set(-1,0,0,0)}}}function t(){let C=!1,ne=null,oe=null,be=null;return{setTest:function(Re){Re?j(a.DEPTH_TEST):te(a.DEPTH_TEST)},setMask:function(Re){ne!==Re&&!C&&(a.depthMask(Re),ne=Re)},setFunc:function(Re){if(oe!==Re){switch(Re){case Vg:a.depthFunc(a.NEVER);break;case Hg:a.depthFunc(a.ALWAYS);break;case Gg:a.depthFunc(a.LESS);break;case ol:a.depthFunc(a.LEQUAL);break;case Wg:a.depthFunc(a.EQUAL);break;case Xg:a.depthFunc(a.GEQUAL);break;case jg:a.depthFunc(a.GREATER);break;case Yg:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}oe=Re}},setLocked:function(Re){C=Re},setClear:function(Re){be!==Re&&(a.clearDepth(Re),be=Re)},reset:function(){C=!1,ne=null,oe=null,be=null}}}function i(){let C=!1,ne=null,oe=null,be=null,Re=null,ot=null,ht=null,Et=null,Gt=null;return{setTest:function(gt){C||(gt?j(a.STENCIL_TEST):te(a.STENCIL_TEST))},setMask:function(gt){ne!==gt&&!C&&(a.stencilMask(gt),ne=gt)},setFunc:function(gt,vt,le){(oe!==gt||be!==vt||Re!==le)&&(a.stencilFunc(gt,vt,le),oe=gt,be=vt,Re=le)},setOp:function(gt,vt,le){(ot!==gt||ht!==vt||Et!==le)&&(a.stencilOp(gt,vt,le),ot=gt,ht=vt,Et=le)},setLocked:function(gt){C=gt},setClear:function(gt){Gt!==gt&&(a.clearStencil(gt),Gt=gt)},reset:function(){C=!1,ne=null,oe=null,be=null,Re=null,ot=null,ht=null,Et=null,Gt=null}}}const s=new e,r=new t,o=new i,l=new WeakMap,h=new WeakMap;let d={},f={},c=new WeakMap,u=[],p=null,m=!1,_=null,g=null,v=null,y=null,x=null,b=null,S=null,A=new Le(0,0,0),E=0,R=!1,M=null,w=null,L=null,N=null,B=null;const G=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let W=!1,ee=0;const z=a.getParameter(a.VERSION);z.indexOf("WebGL")!==-1?(ee=parseFloat(/^WebGL (\d)/.exec(z)[1]),W=ee>=1):z.indexOf("OpenGL ES")!==-1&&(ee=parseFloat(/^OpenGL ES (\d)/.exec(z)[1]),W=ee>=2);let k=null,q={};const $=a.getParameter(a.SCISSOR_BOX),H=a.getParameter(a.VIEWPORT),Q=new Ct().fromArray($),X=new Ct().fromArray(H);function F(C,ne,oe,be){const Re=new Uint8Array(4),ot=a.createTexture();a.bindTexture(C,ot),a.texParameteri(C,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(C,a.TEXTURE_MAG_FILTER,a.NEAREST);for(let ht=0;ht<oe;ht++)C===a.TEXTURE_3D||C===a.TEXTURE_2D_ARRAY?a.texImage3D(ne,0,a.RGBA,1,1,be,0,a.RGBA,a.UNSIGNED_BYTE,Re):a.texImage2D(ne+ht,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,Re);return ot}const D={};D[a.TEXTURE_2D]=F(a.TEXTURE_2D,a.TEXTURE_2D,1),D[a.TEXTURE_CUBE_MAP]=F(a.TEXTURE_CUBE_MAP,a.TEXTURE_CUBE_MAP_POSITIVE_X,6),D[a.TEXTURE_2D_ARRAY]=F(a.TEXTURE_2D_ARRAY,a.TEXTURE_2D_ARRAY,1,1),D[a.TEXTURE_3D]=F(a.TEXTURE_3D,a.TEXTURE_3D,1,1),s.setClear(0,0,0,1),r.setClear(1),o.setClear(0),j(a.DEPTH_TEST),r.setFunc(ol),he(!1),fe(gu),j(a.CULL_FACE),Ee(Zn);function j(C){d[C]!==!0&&(a.enable(C),d[C]=!0)}function te(C){d[C]!==!1&&(a.disable(C),d[C]=!1)}function ae(C,ne){return f[C]!==ne?(a.bindFramebuffer(C,ne),f[C]=ne,C===a.DRAW_FRAMEBUFFER&&(f[a.FRAMEBUFFER]=ne),C===a.FRAMEBUFFER&&(f[a.DRAW_FRAMEBUFFER]=ne),!0):!1}function K(C,ne){let oe=u,be=!1;if(C){oe=c.get(ne),oe===void 0&&(oe=[],c.set(ne,oe));const Re=C.textures;if(oe.length!==Re.length||oe[0]!==a.COLOR_ATTACHMENT0){for(let ot=0,ht=Re.length;ot<ht;ot++)oe[ot]=a.COLOR_ATTACHMENT0+ot;oe.length=Re.length,be=!0}}else oe[0]!==a.BACK&&(oe[0]=a.BACK,be=!0);be&&a.drawBuffers(oe)}function O(C){return p!==C?(a.useProgram(C),p=C,!0):!1}const pe={[Hs]:a.FUNC_ADD,[Sg]:a.FUNC_SUBTRACT,[Ag]:a.FUNC_REVERSE_SUBTRACT};pe[Eg]=a.MIN,pe[Tg]=a.MAX;const xe={[Cg]:a.ZERO,[Rg]:a.ONE,[Pg]:a.SRC_COLOR,[qc]:a.SRC_ALPHA,[kg]:a.SRC_ALPHA_SATURATE,[Bg]:a.DST_COLOR,[Lg]:a.DST_ALPHA,[Ig]:a.ONE_MINUS_SRC_COLOR,[$c]:a.ONE_MINUS_SRC_ALPHA,[Dg]:a.ONE_MINUS_DST_COLOR,[Fg]:a.ONE_MINUS_DST_ALPHA,[Ng]:a.CONSTANT_COLOR,[Og]:a.ONE_MINUS_CONSTANT_COLOR,[Ug]:a.CONSTANT_ALPHA,[zg]:a.ONE_MINUS_CONSTANT_ALPHA};function Ee(C,ne,oe,be,Re,ot,ht,Et,Gt,gt){if(C===Zn){m===!0&&(te(a.BLEND),m=!1);return}if(m===!1&&(j(a.BLEND),m=!0),C!==Mg){if(C!==_||gt!==R){if((g!==Hs||x!==Hs)&&(a.blendEquation(a.FUNC_ADD),g=Hs,x=Hs),gt)switch(C){case Or:a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);break;case vu:a.blendFunc(a.ONE,a.ONE);break;case _u:a.blendFuncSeparate(a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ZERO,a.ONE);break;case yu:a.blendFuncSeparate(a.ZERO,a.SRC_COLOR,a.ZERO,a.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",C);break}else switch(C){case Or:a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);break;case vu:a.blendFunc(a.SRC_ALPHA,a.ONE);break;case _u:a.blendFuncSeparate(a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ZERO,a.ONE);break;case yu:a.blendFunc(a.ZERO,a.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",C);break}v=null,y=null,b=null,S=null,A.set(0,0,0),E=0,_=C,R=gt}return}Re=Re||ne,ot=ot||oe,ht=ht||be,(ne!==g||Re!==x)&&(a.blendEquationSeparate(pe[ne],pe[Re]),g=ne,x=Re),(oe!==v||be!==y||ot!==b||ht!==S)&&(a.blendFuncSeparate(xe[oe],xe[be],xe[ot],xe[ht]),v=oe,y=be,b=ot,S=ht),(Et.equals(A)===!1||Gt!==E)&&(a.blendColor(Et.r,Et.g,Et.b,Gt),A.copy(Et),E=Gt),_=C,R=!1}function ve(C,ne){C.side===Ui?te(a.CULL_FACE):j(a.CULL_FACE);let oe=C.side===zi;ne&&(oe=!oe),he(oe),C.blending===Or&&C.transparent===!1?Ee(Zn):Ee(C.blending,C.blendEquation,C.blendSrc,C.blendDst,C.blendEquationAlpha,C.blendSrcAlpha,C.blendDstAlpha,C.blendColor,C.blendAlpha,C.premultipliedAlpha),r.setFunc(C.depthFunc),r.setTest(C.depthTest),r.setMask(C.depthWrite),s.setMask(C.colorWrite);const be=C.stencilWrite;o.setTest(be),be&&(o.setMask(C.stencilWriteMask),o.setFunc(C.stencilFunc,C.stencilRef,C.stencilFuncMask),o.setOp(C.stencilFail,C.stencilZFail,C.stencilZPass)),Ye(C.polygonOffset,C.polygonOffsetFactor,C.polygonOffsetUnits),C.alphaToCoverage===!0?j(a.SAMPLE_ALPHA_TO_COVERAGE):te(a.SAMPLE_ALPHA_TO_COVERAGE)}function he(C){M!==C&&(C?a.frontFace(a.CW):a.frontFace(a.CCW),M=C)}function fe(C){C!==xg?(j(a.CULL_FACE),C!==w&&(C===gu?a.cullFace(a.BACK):C===bg?a.cullFace(a.FRONT):a.cullFace(a.FRONT_AND_BACK))):te(a.CULL_FACE),w=C}function qe(C){C!==L&&(W&&a.lineWidth(C),L=C)}function Ye(C,ne,oe){C?(j(a.POLYGON_OFFSET_FILL),(N!==ne||B!==oe)&&(a.polygonOffset(ne,oe),N=ne,B=oe)):te(a.POLYGON_OFFSET_FILL)}function U(C){C?j(a.SCISSOR_TEST):te(a.SCISSOR_TEST)}function P(C){C===void 0&&(C=a.TEXTURE0+G-1),k!==C&&(a.activeTexture(C),k=C)}function re(C,ne,oe){oe===void 0&&(k===null?oe=a.TEXTURE0+G-1:oe=k);let be=q[oe];be===void 0&&(be={type:void 0,texture:void 0},q[oe]=be),(be.type!==C||be.texture!==ne)&&(k!==oe&&(a.activeTexture(oe),k=oe),a.bindTexture(C,ne||D[C]),be.type=C,be.texture=ne)}function de(){const C=q[k];C!==void 0&&C.type!==void 0&&(a.bindTexture(C.type,null),C.type=void 0,C.texture=void 0)}function me(){try{a.compressedTexImage2D.apply(a,arguments)}catch(C){console.error("THREE.WebGLState:",C)}}function _e(){try{a.compressedTexImage3D.apply(a,arguments)}catch(C){console.error("THREE.WebGLState:",C)}}function De(){try{a.texSubImage2D.apply(a,arguments)}catch(C){console.error("THREE.WebGLState:",C)}}function Ce(){try{a.texSubImage3D.apply(a,arguments)}catch(C){console.error("THREE.WebGLState:",C)}}function Me(){try{a.compressedTexSubImage2D.apply(a,arguments)}catch(C){console.error("THREE.WebGLState:",C)}}function tt(){try{a.compressedTexSubImage3D.apply(a,arguments)}catch(C){console.error("THREE.WebGLState:",C)}}function Pe(){try{a.texStorage2D.apply(a,arguments)}catch(C){console.error("THREE.WebGLState:",C)}}function et(){try{a.texStorage3D.apply(a,arguments)}catch(C){console.error("THREE.WebGLState:",C)}}function ut(){try{a.texImage2D.apply(a,arguments)}catch(C){console.error("THREE.WebGLState:",C)}}function it(){try{a.texImage3D.apply(a,arguments)}catch(C){console.error("THREE.WebGLState:",C)}}function We(C){Q.equals(C)===!1&&(a.scissor(C.x,C.y,C.z,C.w),Q.copy(C))}function st(C){X.equals(C)===!1&&(a.viewport(C.x,C.y,C.z,C.w),X.copy(C))}function ct(C,ne){let oe=h.get(ne);oe===void 0&&(oe=new WeakMap,h.set(ne,oe));let be=oe.get(C);be===void 0&&(be=a.getUniformBlockIndex(ne,C.name),oe.set(C,be))}function xt(C,ne){const be=h.get(ne).get(C);l.get(ne)!==be&&(a.uniformBlockBinding(ne,be,C.__bindingPointIndex),l.set(ne,be))}function rt(){a.disable(a.BLEND),a.disable(a.CULL_FACE),a.disable(a.DEPTH_TEST),a.disable(a.POLYGON_OFFSET_FILL),a.disable(a.SCISSOR_TEST),a.disable(a.STENCIL_TEST),a.disable(a.SAMPLE_ALPHA_TO_COVERAGE),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ONE,a.ZERO),a.blendFuncSeparate(a.ONE,a.ZERO,a.ONE,a.ZERO),a.blendColor(0,0,0,0),a.colorMask(!0,!0,!0,!0),a.clearColor(0,0,0,0),a.depthMask(!0),a.depthFunc(a.LESS),a.clearDepth(1),a.stencilMask(4294967295),a.stencilFunc(a.ALWAYS,0,4294967295),a.stencilOp(a.KEEP,a.KEEP,a.KEEP),a.clearStencil(0),a.cullFace(a.BACK),a.frontFace(a.CCW),a.polygonOffset(0,0),a.activeTexture(a.TEXTURE0),a.bindFramebuffer(a.FRAMEBUFFER,null),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,null),a.bindFramebuffer(a.READ_FRAMEBUFFER,null),a.useProgram(null),a.lineWidth(1),a.scissor(0,0,a.canvas.width,a.canvas.height),a.viewport(0,0,a.canvas.width,a.canvas.height),d={},k=null,q={},f={},c=new WeakMap,u=[],p=null,m=!1,_=null,g=null,v=null,y=null,x=null,b=null,S=null,A=new Le(0,0,0),E=0,R=!1,M=null,w=null,L=null,N=null,B=null,Q.set(0,0,a.canvas.width,a.canvas.height),X.set(0,0,a.canvas.width,a.canvas.height),s.reset(),r.reset(),o.reset()}return{buffers:{color:s,depth:r,stencil:o},enable:j,disable:te,bindFramebuffer:ae,drawBuffers:K,useProgram:O,setBlending:Ee,setMaterial:ve,setFlipSided:he,setCullFace:fe,setLineWidth:qe,setPolygonOffset:Ye,setScissorTest:U,activeTexture:P,bindTexture:re,unbindTexture:de,compressedTexImage2D:me,compressedTexImage3D:_e,texImage2D:ut,texImage3D:it,updateUBOMapping:ct,uniformBlockBinding:xt,texStorage2D:Pe,texStorage3D:et,texSubImage2D:De,texSubImage3D:Ce,compressedTexSubImage2D:Me,compressedTexSubImage3D:tt,scissor:We,viewport:st,reset:rt}}function Ub(a,e,t,i,s,r,o){const l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,h=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),d=new Oe,f=new WeakMap;let c;const u=new WeakMap;let p=!1;try{p=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function m(U,P){return p?new OffscreenCanvas(U,P):zo("canvas")}function _(U,P,re){let de=1;const me=Ye(U);if((me.width>re||me.height>re)&&(de=re/Math.max(me.width,me.height)),de<1)if(typeof HTMLImageElement<"u"&&U instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&U instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&U instanceof ImageBitmap||typeof VideoFrame<"u"&&U instanceof VideoFrame){const _e=Math.floor(de*me.width),De=Math.floor(de*me.height);c===void 0&&(c=m(_e,De));const Ce=P?m(_e,De):c;return Ce.width=_e,Ce.height=De,Ce.getContext("2d").drawImage(U,0,0,_e,De),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+me.width+"x"+me.height+") to ("+_e+"x"+De+")."),Ce}else return"data"in U&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+me.width+"x"+me.height+")."),U;return U}function g(U){return U.generateMipmaps&&U.minFilter!==li&&U.minFilter!==Nt}function v(U){a.generateMipmap(U)}function y(U,P,re,de,me=!1){if(U!==null){if(a[U]!==void 0)return a[U];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+U+"'")}let _e=P;if(P===a.RED&&(re===a.FLOAT&&(_e=a.R32F),re===a.HALF_FLOAT&&(_e=a.R16F),re===a.UNSIGNED_BYTE&&(_e=a.R8)),P===a.RED_INTEGER&&(re===a.UNSIGNED_BYTE&&(_e=a.R8UI),re===a.UNSIGNED_SHORT&&(_e=a.R16UI),re===a.UNSIGNED_INT&&(_e=a.R32UI),re===a.BYTE&&(_e=a.R8I),re===a.SHORT&&(_e=a.R16I),re===a.INT&&(_e=a.R32I)),P===a.RG&&(re===a.FLOAT&&(_e=a.RG32F),re===a.HALF_FLOAT&&(_e=a.RG16F),re===a.UNSIGNED_BYTE&&(_e=a.RG8)),P===a.RG_INTEGER&&(re===a.UNSIGNED_BYTE&&(_e=a.RG8UI),re===a.UNSIGNED_SHORT&&(_e=a.RG16UI),re===a.UNSIGNED_INT&&(_e=a.RG32UI),re===a.BYTE&&(_e=a.RG8I),re===a.SHORT&&(_e=a.RG16I),re===a.INT&&(_e=a.RG32I)),P===a.RGB&&re===a.UNSIGNED_INT_5_9_9_9_REV&&(_e=a.RGB9_E5),P===a.RGBA){const De=me?hl:Rt.getTransfer(de);re===a.FLOAT&&(_e=a.RGBA32F),re===a.HALF_FLOAT&&(_e=a.RGBA16F),re===a.UNSIGNED_BYTE&&(_e=De===Wt?a.SRGB8_ALPHA8:a.RGBA8),re===a.UNSIGNED_SHORT_4_4_4_4&&(_e=a.RGBA4),re===a.UNSIGNED_SHORT_5_5_5_1&&(_e=a.RGB5_A1)}return(_e===a.R16F||_e===a.R32F||_e===a.RG16F||_e===a.RG32F||_e===a.RGBA16F||_e===a.RGBA32F)&&e.get("EXT_color_buffer_float"),_e}function x(U,P){return g(U)===!0||U.isFramebufferTexture&&U.minFilter!==li&&U.minFilter!==Nt?Math.log2(Math.max(P.width,P.height))+1:U.mipmaps!==void 0&&U.mipmaps.length>0?U.mipmaps.length:U.isCompressedTexture&&Array.isArray(U.image)?P.mipmaps.length:1}function b(U){const P=U.target;P.removeEventListener("dispose",b),A(P),P.isVideoTexture&&f.delete(P)}function S(U){const P=U.target;P.removeEventListener("dispose",S),R(P)}function A(U){const P=i.get(U);if(P.__webglInit===void 0)return;const re=U.source,de=u.get(re);if(de){const me=de[P.__cacheKey];me.usedTimes--,me.usedTimes===0&&E(U),Object.keys(de).length===0&&u.delete(re)}i.remove(U)}function E(U){const P=i.get(U);a.deleteTexture(P.__webglTexture);const re=U.source,de=u.get(re);delete de[P.__cacheKey],o.memory.textures--}function R(U){const P=i.get(U);if(U.depthTexture&&U.depthTexture.dispose(),U.isWebGLCubeRenderTarget)for(let de=0;de<6;de++){if(Array.isArray(P.__webglFramebuffer[de]))for(let me=0;me<P.__webglFramebuffer[de].length;me++)a.deleteFramebuffer(P.__webglFramebuffer[de][me]);else a.deleteFramebuffer(P.__webglFramebuffer[de]);P.__webglDepthbuffer&&a.deleteRenderbuffer(P.__webglDepthbuffer[de])}else{if(Array.isArray(P.__webglFramebuffer))for(let de=0;de<P.__webglFramebuffer.length;de++)a.deleteFramebuffer(P.__webglFramebuffer[de]);else a.deleteFramebuffer(P.__webglFramebuffer);if(P.__webglDepthbuffer&&a.deleteRenderbuffer(P.__webglDepthbuffer),P.__webglMultisampledFramebuffer&&a.deleteFramebuffer(P.__webglMultisampledFramebuffer),P.__webglColorRenderbuffer)for(let de=0;de<P.__webglColorRenderbuffer.length;de++)P.__webglColorRenderbuffer[de]&&a.deleteRenderbuffer(P.__webglColorRenderbuffer[de]);P.__webglDepthRenderbuffer&&a.deleteRenderbuffer(P.__webglDepthRenderbuffer)}const re=U.textures;for(let de=0,me=re.length;de<me;de++){const _e=i.get(re[de]);_e.__webglTexture&&(a.deleteTexture(_e.__webglTexture),o.memory.textures--),i.remove(re[de])}i.remove(U)}let M=0;function w(){M=0}function L(){const U=M;return U>=s.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+U+" texture units while this GPU supports only "+s.maxTextures),M+=1,U}function N(U){const P=[];return P.push(U.wrapS),P.push(U.wrapT),P.push(U.wrapR||0),P.push(U.magFilter),P.push(U.minFilter),P.push(U.anisotropy),P.push(U.internalFormat),P.push(U.format),P.push(U.type),P.push(U.generateMipmaps),P.push(U.premultiplyAlpha),P.push(U.flipY),P.push(U.unpackAlignment),P.push(U.colorSpace),P.join()}function B(U,P){const re=i.get(U);if(U.isVideoTexture&&fe(U),U.isRenderTargetTexture===!1&&U.version>0&&re.__version!==U.version){const de=U.image;if(de===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(de.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Q(re,U,P);return}}t.bindTexture(a.TEXTURE_2D,re.__webglTexture,a.TEXTURE0+P)}function G(U,P){const re=i.get(U);if(U.version>0&&re.__version!==U.version){Q(re,U,P);return}t.bindTexture(a.TEXTURE_2D_ARRAY,re.__webglTexture,a.TEXTURE0+P)}function W(U,P){const re=i.get(U);if(U.version>0&&re.__version!==U.version){Q(re,U,P);return}t.bindTexture(a.TEXTURE_3D,re.__webglTexture,a.TEXTURE0+P)}function ee(U,P){const re=i.get(U);if(U.version>0&&re.__version!==U.version){X(re,U,P);return}t.bindTexture(a.TEXTURE_CUBE_MAP,re.__webglTexture,a.TEXTURE0+P)}const z={[In]:a.REPEAT,[Tn]:a.CLAMP_TO_EDGE,[ll]:a.MIRRORED_REPEAT},k={[li]:a.NEAREST,[pp]:a.NEAREST_MIPMAP_NEAREST,[So]:a.NEAREST_MIPMAP_LINEAR,[Nt]:a.LINEAR,[Qa]:a.LINEAR_MIPMAP_NEAREST,[Yn]:a.LINEAR_MIPMAP_LINEAR},q={[b0]:a.NEVER,[T0]:a.ALWAYS,[w0]:a.LESS,[Sp]:a.LEQUAL,[M0]:a.EQUAL,[E0]:a.GEQUAL,[S0]:a.GREATER,[A0]:a.NOTEQUAL};function $(U,P){if(P.type===Cn&&e.has("OES_texture_float_linear")===!1&&(P.magFilter===Nt||P.magFilter===Qa||P.magFilter===So||P.magFilter===Yn||P.minFilter===Nt||P.minFilter===Qa||P.minFilter===So||P.minFilter===Yn)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),a.texParameteri(U,a.TEXTURE_WRAP_S,z[P.wrapS]),a.texParameteri(U,a.TEXTURE_WRAP_T,z[P.wrapT]),(U===a.TEXTURE_3D||U===a.TEXTURE_2D_ARRAY)&&a.texParameteri(U,a.TEXTURE_WRAP_R,z[P.wrapR]),a.texParameteri(U,a.TEXTURE_MAG_FILTER,k[P.magFilter]),a.texParameteri(U,a.TEXTURE_MIN_FILTER,k[P.minFilter]),P.compareFunction&&(a.texParameteri(U,a.TEXTURE_COMPARE_MODE,a.COMPARE_REF_TO_TEXTURE),a.texParameteri(U,a.TEXTURE_COMPARE_FUNC,q[P.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(P.magFilter===li||P.minFilter!==So&&P.minFilter!==Yn||P.type===Cn&&e.has("OES_texture_float_linear")===!1)return;if(P.anisotropy>1||i.get(P).__currentAnisotropy){const re=e.get("EXT_texture_filter_anisotropic");a.texParameterf(U,re.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(P.anisotropy,s.getMaxAnisotropy())),i.get(P).__currentAnisotropy=P.anisotropy}}}function H(U,P){let re=!1;U.__webglInit===void 0&&(U.__webglInit=!0,P.addEventListener("dispose",b));const de=P.source;let me=u.get(de);me===void 0&&(me={},u.set(de,me));const _e=N(P);if(_e!==U.__cacheKey){me[_e]===void 0&&(me[_e]={texture:a.createTexture(),usedTimes:0},o.memory.textures++,re=!0),me[_e].usedTimes++;const De=me[U.__cacheKey];De!==void 0&&(me[U.__cacheKey].usedTimes--,De.usedTimes===0&&E(P)),U.__cacheKey=_e,U.__webglTexture=me[_e].texture}return re}function Q(U,P,re){let de=a.TEXTURE_2D;(P.isDataArrayTexture||P.isCompressedArrayTexture)&&(de=a.TEXTURE_2D_ARRAY),P.isData3DTexture&&(de=a.TEXTURE_3D);const me=H(U,P),_e=P.source;t.bindTexture(de,U.__webglTexture,a.TEXTURE0+re);const De=i.get(_e);if(_e.version!==De.__version||me===!0){t.activeTexture(a.TEXTURE0+re);const Ce=Rt.getPrimaries(Rt.workingColorSpace),Me=P.colorSpace===ds?null:Rt.getPrimaries(P.colorSpace),tt=P.colorSpace===ds||Ce===Me?a.NONE:a.BROWSER_DEFAULT_WEBGL;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,P.flipY),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,P.premultiplyAlpha),a.pixelStorei(a.UNPACK_ALIGNMENT,P.unpackAlignment),a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,tt);let Pe=_(P.image,!1,s.maxTextureSize);Pe=qe(P,Pe);const et=r.convert(P.format,P.colorSpace),ut=r.convert(P.type);let it=y(P.internalFormat,et,ut,P.colorSpace,P.isVideoTexture);$(de,P);let We;const st=P.mipmaps,ct=P.isVideoTexture!==!0,xt=De.__version===void 0||me===!0,rt=_e.dataReady,C=x(P,Pe);if(P.isDepthTexture)it=a.DEPTH_COMPONENT16,P.type===Cn?it=a.DEPTH_COMPONENT32F:P.type===$r?it=a.DEPTH_COMPONENT24:P.type===ea&&(it=a.DEPTH24_STENCIL8),xt&&(ct?t.texStorage2D(a.TEXTURE_2D,1,it,Pe.width,Pe.height):t.texImage2D(a.TEXTURE_2D,0,it,Pe.width,Pe.height,0,et,ut,null));else if(P.isDataTexture)if(st.length>0){ct&&xt&&t.texStorage2D(a.TEXTURE_2D,C,it,st[0].width,st[0].height);for(let ne=0,oe=st.length;ne<oe;ne++)We=st[ne],ct?rt&&t.texSubImage2D(a.TEXTURE_2D,ne,0,0,We.width,We.height,et,ut,We.data):t.texImage2D(a.TEXTURE_2D,ne,it,We.width,We.height,0,et,ut,We.data);P.generateMipmaps=!1}else ct?(xt&&t.texStorage2D(a.TEXTURE_2D,C,it,Pe.width,Pe.height),rt&&t.texSubImage2D(a.TEXTURE_2D,0,0,0,Pe.width,Pe.height,et,ut,Pe.data)):t.texImage2D(a.TEXTURE_2D,0,it,Pe.width,Pe.height,0,et,ut,Pe.data);else if(P.isCompressedTexture)if(P.isCompressedArrayTexture){ct&&xt&&t.texStorage3D(a.TEXTURE_2D_ARRAY,C,it,st[0].width,st[0].height,Pe.depth);for(let ne=0,oe=st.length;ne<oe;ne++)We=st[ne],P.format!==vn?et!==null?ct?rt&&t.compressedTexSubImage3D(a.TEXTURE_2D_ARRAY,ne,0,0,0,We.width,We.height,Pe.depth,et,We.data,0,0):t.compressedTexImage3D(a.TEXTURE_2D_ARRAY,ne,it,We.width,We.height,Pe.depth,0,We.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ct?rt&&t.texSubImage3D(a.TEXTURE_2D_ARRAY,ne,0,0,0,We.width,We.height,Pe.depth,et,ut,We.data):t.texImage3D(a.TEXTURE_2D_ARRAY,ne,it,We.width,We.height,Pe.depth,0,et,ut,We.data)}else{ct&&xt&&t.texStorage2D(a.TEXTURE_2D,C,it,st[0].width,st[0].height);for(let ne=0,oe=st.length;ne<oe;ne++)We=st[ne],P.format!==vn?et!==null?ct?rt&&t.compressedTexSubImage2D(a.TEXTURE_2D,ne,0,0,We.width,We.height,et,We.data):t.compressedTexImage2D(a.TEXTURE_2D,ne,it,We.width,We.height,0,We.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ct?rt&&t.texSubImage2D(a.TEXTURE_2D,ne,0,0,We.width,We.height,et,ut,We.data):t.texImage2D(a.TEXTURE_2D,ne,it,We.width,We.height,0,et,ut,We.data)}else if(P.isDataArrayTexture)ct?(xt&&t.texStorage3D(a.TEXTURE_2D_ARRAY,C,it,Pe.width,Pe.height,Pe.depth),rt&&t.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,0,Pe.width,Pe.height,Pe.depth,et,ut,Pe.data)):t.texImage3D(a.TEXTURE_2D_ARRAY,0,it,Pe.width,Pe.height,Pe.depth,0,et,ut,Pe.data);else if(P.isData3DTexture)ct?(xt&&t.texStorage3D(a.TEXTURE_3D,C,it,Pe.width,Pe.height,Pe.depth),rt&&t.texSubImage3D(a.TEXTURE_3D,0,0,0,0,Pe.width,Pe.height,Pe.depth,et,ut,Pe.data)):t.texImage3D(a.TEXTURE_3D,0,it,Pe.width,Pe.height,Pe.depth,0,et,ut,Pe.data);else if(P.isFramebufferTexture){if(xt)if(ct)t.texStorage2D(a.TEXTURE_2D,C,it,Pe.width,Pe.height);else{let ne=Pe.width,oe=Pe.height;for(let be=0;be<C;be++)t.texImage2D(a.TEXTURE_2D,be,it,ne,oe,0,et,ut,null),ne>>=1,oe>>=1}}else if(st.length>0){if(ct&&xt){const ne=Ye(st[0]);t.texStorage2D(a.TEXTURE_2D,C,it,ne.width,ne.height)}for(let ne=0,oe=st.length;ne<oe;ne++)We=st[ne],ct?rt&&t.texSubImage2D(a.TEXTURE_2D,ne,0,0,et,ut,We):t.texImage2D(a.TEXTURE_2D,ne,it,et,ut,We);P.generateMipmaps=!1}else if(ct){if(xt){const ne=Ye(Pe);t.texStorage2D(a.TEXTURE_2D,C,it,ne.width,ne.height)}rt&&t.texSubImage2D(a.TEXTURE_2D,0,0,0,et,ut,Pe)}else t.texImage2D(a.TEXTURE_2D,0,it,et,ut,Pe);g(P)&&v(de),De.__version=_e.version,P.onUpdate&&P.onUpdate(P)}U.__version=P.version}function X(U,P,re){if(P.image.length!==6)return;const de=H(U,P),me=P.source;t.bindTexture(a.TEXTURE_CUBE_MAP,U.__webglTexture,a.TEXTURE0+re);const _e=i.get(me);if(me.version!==_e.__version||de===!0){t.activeTexture(a.TEXTURE0+re);const De=Rt.getPrimaries(Rt.workingColorSpace),Ce=P.colorSpace===ds?null:Rt.getPrimaries(P.colorSpace),Me=P.colorSpace===ds||De===Ce?a.NONE:a.BROWSER_DEFAULT_WEBGL;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,P.flipY),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,P.premultiplyAlpha),a.pixelStorei(a.UNPACK_ALIGNMENT,P.unpackAlignment),a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,Me);const tt=P.isCompressedTexture||P.image[0].isCompressedTexture,Pe=P.image[0]&&P.image[0].isDataTexture,et=[];for(let oe=0;oe<6;oe++)!tt&&!Pe?et[oe]=_(P.image[oe],!0,s.maxCubemapSize):et[oe]=Pe?P.image[oe].image:P.image[oe],et[oe]=qe(P,et[oe]);const ut=et[0],it=r.convert(P.format,P.colorSpace),We=r.convert(P.type),st=y(P.internalFormat,it,We,P.colorSpace),ct=P.isVideoTexture!==!0,xt=_e.__version===void 0||de===!0,rt=me.dataReady;let C=x(P,ut);$(a.TEXTURE_CUBE_MAP,P);let ne;if(tt){ct&&xt&&t.texStorage2D(a.TEXTURE_CUBE_MAP,C,st,ut.width,ut.height);for(let oe=0;oe<6;oe++){ne=et[oe].mipmaps;for(let be=0;be<ne.length;be++){const Re=ne[be];P.format!==vn?it!==null?ct?rt&&t.compressedTexSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+oe,be,0,0,Re.width,Re.height,it,Re.data):t.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+oe,be,st,Re.width,Re.height,0,Re.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ct?rt&&t.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+oe,be,0,0,Re.width,Re.height,it,We,Re.data):t.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+oe,be,st,Re.width,Re.height,0,it,We,Re.data)}}}else{if(ne=P.mipmaps,ct&&xt){ne.length>0&&C++;const oe=Ye(et[0]);t.texStorage2D(a.TEXTURE_CUBE_MAP,C,st,oe.width,oe.height)}for(let oe=0;oe<6;oe++)if(Pe){ct?rt&&t.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,0,0,et[oe].width,et[oe].height,it,We,et[oe].data):t.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,st,et[oe].width,et[oe].height,0,it,We,et[oe].data);for(let be=0;be<ne.length;be++){const ot=ne[be].image[oe].image;ct?rt&&t.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+oe,be+1,0,0,ot.width,ot.height,it,We,ot.data):t.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+oe,be+1,st,ot.width,ot.height,0,it,We,ot.data)}}else{ct?rt&&t.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,0,0,it,We,et[oe]):t.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,st,it,We,et[oe]);for(let be=0;be<ne.length;be++){const Re=ne[be];ct?rt&&t.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+oe,be+1,0,0,it,We,Re.image[oe]):t.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+oe,be+1,st,it,We,Re.image[oe])}}}g(P)&&v(a.TEXTURE_CUBE_MAP),_e.__version=me.version,P.onUpdate&&P.onUpdate(P)}U.__version=P.version}function F(U,P,re,de,me,_e){const De=r.convert(re.format,re.colorSpace),Ce=r.convert(re.type),Me=y(re.internalFormat,De,Ce,re.colorSpace);if(!i.get(P).__hasExternalTextures){const Pe=Math.max(1,P.width>>_e),et=Math.max(1,P.height>>_e);me===a.TEXTURE_3D||me===a.TEXTURE_2D_ARRAY?t.texImage3D(me,_e,Me,Pe,et,P.depth,0,De,Ce,null):t.texImage2D(me,_e,Me,Pe,et,0,De,Ce,null)}t.bindFramebuffer(a.FRAMEBUFFER,U),he(P)?l.framebufferTexture2DMultisampleEXT(a.FRAMEBUFFER,de,me,i.get(re).__webglTexture,0,ve(P)):(me===a.TEXTURE_2D||me>=a.TEXTURE_CUBE_MAP_POSITIVE_X&&me<=a.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&a.framebufferTexture2D(a.FRAMEBUFFER,de,me,i.get(re).__webglTexture,_e),t.bindFramebuffer(a.FRAMEBUFFER,null)}function D(U,P,re){if(a.bindRenderbuffer(a.RENDERBUFFER,U),P.depthBuffer&&!P.stencilBuffer){let de=a.DEPTH_COMPONENT24;if(re||he(P)){const me=P.depthTexture;me&&me.isDepthTexture&&(me.type===Cn?de=a.DEPTH_COMPONENT32F:me.type===$r&&(de=a.DEPTH_COMPONENT24));const _e=ve(P);he(P)?l.renderbufferStorageMultisampleEXT(a.RENDERBUFFER,_e,de,P.width,P.height):a.renderbufferStorageMultisample(a.RENDERBUFFER,_e,de,P.width,P.height)}else a.renderbufferStorage(a.RENDERBUFFER,de,P.width,P.height);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,U)}else if(P.depthBuffer&&P.stencilBuffer){const de=ve(P);re&&he(P)===!1?a.renderbufferStorageMultisample(a.RENDERBUFFER,de,a.DEPTH24_STENCIL8,P.width,P.height):he(P)?l.renderbufferStorageMultisampleEXT(a.RENDERBUFFER,de,a.DEPTH24_STENCIL8,P.width,P.height):a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,P.width,P.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,U)}else{const de=P.textures;for(let me=0;me<de.length;me++){const _e=de[me],De=r.convert(_e.format,_e.colorSpace),Ce=r.convert(_e.type),Me=y(_e.internalFormat,De,Ce,_e.colorSpace),tt=ve(P);re&&he(P)===!1?a.renderbufferStorageMultisample(a.RENDERBUFFER,tt,Me,P.width,P.height):he(P)?l.renderbufferStorageMultisampleEXT(a.RENDERBUFFER,tt,Me,P.width,P.height):a.renderbufferStorage(a.RENDERBUFFER,Me,P.width,P.height)}}a.bindRenderbuffer(a.RENDERBUFFER,null)}function j(U,P){if(P&&P.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(a.FRAMEBUFFER,U),!(P.depthTexture&&P.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(P.depthTexture).__webglTexture||P.depthTexture.image.width!==P.width||P.depthTexture.image.height!==P.height)&&(P.depthTexture.image.width=P.width,P.depthTexture.image.height=P.height,P.depthTexture.needsUpdate=!0),B(P.depthTexture,0);const de=i.get(P.depthTexture).__webglTexture,me=ve(P);if(P.depthTexture.format===Ur)he(P)?l.framebufferTexture2DMultisampleEXT(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,de,0,me):a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,de,0);else if(P.depthTexture.format===Oo)he(P)?l.framebufferTexture2DMultisampleEXT(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,de,0,me):a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,de,0);else throw new Error("Unknown depthTexture format")}function te(U){const P=i.get(U),re=U.isWebGLCubeRenderTarget===!0;if(U.depthTexture&&!P.__autoAllocateDepthBuffer){if(re)throw new Error("target.depthTexture not supported in Cube render targets");j(P.__webglFramebuffer,U)}else if(re){P.__webglDepthbuffer=[];for(let de=0;de<6;de++)t.bindFramebuffer(a.FRAMEBUFFER,P.__webglFramebuffer[de]),P.__webglDepthbuffer[de]=a.createRenderbuffer(),D(P.__webglDepthbuffer[de],U,!1)}else t.bindFramebuffer(a.FRAMEBUFFER,P.__webglFramebuffer),P.__webglDepthbuffer=a.createRenderbuffer(),D(P.__webglDepthbuffer,U,!1);t.bindFramebuffer(a.FRAMEBUFFER,null)}function ae(U,P,re){const de=i.get(U);P!==void 0&&F(de.__webglFramebuffer,U,U.texture,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,0),re!==void 0&&te(U)}function K(U){const P=U.texture,re=i.get(U),de=i.get(P);U.addEventListener("dispose",S);const me=U.textures,_e=U.isWebGLCubeRenderTarget===!0,De=me.length>1;if(De||(de.__webglTexture===void 0&&(de.__webglTexture=a.createTexture()),de.__version=P.version,o.memory.textures++),_e){re.__webglFramebuffer=[];for(let Ce=0;Ce<6;Ce++)if(P.mipmaps&&P.mipmaps.length>0){re.__webglFramebuffer[Ce]=[];for(let Me=0;Me<P.mipmaps.length;Me++)re.__webglFramebuffer[Ce][Me]=a.createFramebuffer()}else re.__webglFramebuffer[Ce]=a.createFramebuffer()}else{if(P.mipmaps&&P.mipmaps.length>0){re.__webglFramebuffer=[];for(let Ce=0;Ce<P.mipmaps.length;Ce++)re.__webglFramebuffer[Ce]=a.createFramebuffer()}else re.__webglFramebuffer=a.createFramebuffer();if(De)for(let Ce=0,Me=me.length;Ce<Me;Ce++){const tt=i.get(me[Ce]);tt.__webglTexture===void 0&&(tt.__webglTexture=a.createTexture(),o.memory.textures++)}if(U.samples>0&&he(U)===!1){re.__webglMultisampledFramebuffer=a.createFramebuffer(),re.__webglColorRenderbuffer=[],t.bindFramebuffer(a.FRAMEBUFFER,re.__webglMultisampledFramebuffer);for(let Ce=0;Ce<me.length;Ce++){const Me=me[Ce];re.__webglColorRenderbuffer[Ce]=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,re.__webglColorRenderbuffer[Ce]);const tt=r.convert(Me.format,Me.colorSpace),Pe=r.convert(Me.type),et=y(Me.internalFormat,tt,Pe,Me.colorSpace,U.isXRRenderTarget===!0),ut=ve(U);a.renderbufferStorageMultisample(a.RENDERBUFFER,ut,et,U.width,U.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0+Ce,a.RENDERBUFFER,re.__webglColorRenderbuffer[Ce])}a.bindRenderbuffer(a.RENDERBUFFER,null),U.depthBuffer&&(re.__webglDepthRenderbuffer=a.createRenderbuffer(),D(re.__webglDepthRenderbuffer,U,!0)),t.bindFramebuffer(a.FRAMEBUFFER,null)}}if(_e){t.bindTexture(a.TEXTURE_CUBE_MAP,de.__webglTexture),$(a.TEXTURE_CUBE_MAP,P);for(let Ce=0;Ce<6;Ce++)if(P.mipmaps&&P.mipmaps.length>0)for(let Me=0;Me<P.mipmaps.length;Me++)F(re.__webglFramebuffer[Ce][Me],U,P,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,Me);else F(re.__webglFramebuffer[Ce],U,P,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,0);g(P)&&v(a.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(De){for(let Ce=0,Me=me.length;Ce<Me;Ce++){const tt=me[Ce],Pe=i.get(tt);t.bindTexture(a.TEXTURE_2D,Pe.__webglTexture),$(a.TEXTURE_2D,tt),F(re.__webglFramebuffer,U,tt,a.COLOR_ATTACHMENT0+Ce,a.TEXTURE_2D,0),g(tt)&&v(a.TEXTURE_2D)}t.unbindTexture()}else{let Ce=a.TEXTURE_2D;if((U.isWebGL3DRenderTarget||U.isWebGLArrayRenderTarget)&&(Ce=U.isWebGL3DRenderTarget?a.TEXTURE_3D:a.TEXTURE_2D_ARRAY),t.bindTexture(Ce,de.__webglTexture),$(Ce,P),P.mipmaps&&P.mipmaps.length>0)for(let Me=0;Me<P.mipmaps.length;Me++)F(re.__webglFramebuffer[Me],U,P,a.COLOR_ATTACHMENT0,Ce,Me);else F(re.__webglFramebuffer,U,P,a.COLOR_ATTACHMENT0,Ce,0);g(P)&&v(Ce),t.unbindTexture()}U.depthBuffer&&te(U)}function O(U){const P=U.textures;for(let re=0,de=P.length;re<de;re++){const me=P[re];if(g(me)){const _e=U.isWebGLCubeRenderTarget?a.TEXTURE_CUBE_MAP:a.TEXTURE_2D,De=i.get(me).__webglTexture;t.bindTexture(_e,De),v(_e),t.unbindTexture()}}}const pe=[],xe=[];function Ee(U){if(U.samples>0){if(he(U)===!1){const P=U.textures,re=U.width,de=U.height;let me=a.COLOR_BUFFER_BIT;const _e=U.stencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT,De=i.get(U),Ce=P.length>1;if(Ce)for(let Me=0;Me<P.length;Me++)t.bindFramebuffer(a.FRAMEBUFFER,De.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0+Me,a.RENDERBUFFER,null),t.bindFramebuffer(a.FRAMEBUFFER,De.__webglFramebuffer),a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0+Me,a.TEXTURE_2D,null,0);t.bindFramebuffer(a.READ_FRAMEBUFFER,De.__webglMultisampledFramebuffer),t.bindFramebuffer(a.DRAW_FRAMEBUFFER,De.__webglFramebuffer);for(let Me=0;Me<P.length;Me++){if(U.resolveDepthBuffer&&(U.depthBuffer&&(me|=a.DEPTH_BUFFER_BIT),U.stencilBuffer&&U.resolveStencilBuffer&&(me|=a.STENCIL_BUFFER_BIT)),Ce){a.framebufferRenderbuffer(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,De.__webglColorRenderbuffer[Me]);const tt=i.get(P[Me]).__webglTexture;a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,tt,0)}a.blitFramebuffer(0,0,re,de,0,0,re,de,me,a.NEAREST),h===!0&&(pe.length=0,xe.length=0,pe.push(a.COLOR_ATTACHMENT0+Me),U.depthBuffer&&U.resolveDepthBuffer===!1&&(pe.push(_e),xe.push(_e),a.invalidateFramebuffer(a.DRAW_FRAMEBUFFER,xe)),a.invalidateFramebuffer(a.READ_FRAMEBUFFER,pe))}if(t.bindFramebuffer(a.READ_FRAMEBUFFER,null),t.bindFramebuffer(a.DRAW_FRAMEBUFFER,null),Ce)for(let Me=0;Me<P.length;Me++){t.bindFramebuffer(a.FRAMEBUFFER,De.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0+Me,a.RENDERBUFFER,De.__webglColorRenderbuffer[Me]);const tt=i.get(P[Me]).__webglTexture;t.bindFramebuffer(a.FRAMEBUFFER,De.__webglFramebuffer),a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0+Me,a.TEXTURE_2D,tt,0)}t.bindFramebuffer(a.DRAW_FRAMEBUFFER,De.__webglMultisampledFramebuffer)}else if(U.depthBuffer&&U.resolveDepthBuffer===!1&&h){const P=U.stencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT;a.invalidateFramebuffer(a.DRAW_FRAMEBUFFER,[P])}}}function ve(U){return Math.min(s.maxSamples,U.samples)}function he(U){const P=i.get(U);return U.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&P.__useRenderToTexture!==!1}function fe(U){const P=o.render.frame;f.get(U)!==P&&(f.set(U,P),U.update())}function qe(U,P){const re=U.colorSpace,de=U.format,me=U.type;return U.isCompressedTexture===!0||U.isVideoTexture===!0||re!==bi&&re!==ds&&(Rt.getTransfer(re)===Wt?(de!==vn||me!==xs)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",re)),P}function Ye(U){return typeof HTMLImageElement<"u"&&U instanceof HTMLImageElement?(d.width=U.naturalWidth||U.width,d.height=U.naturalHeight||U.height):typeof VideoFrame<"u"&&U instanceof VideoFrame?(d.width=U.displayWidth,d.height=U.displayHeight):(d.width=U.width,d.height=U.height),d}this.allocateTextureUnit=L,this.resetTextureUnits=w,this.setTexture2D=B,this.setTexture2DArray=G,this.setTexture3D=W,this.setTextureCube=ee,this.rebindTextures=ae,this.setupRenderTarget=K,this.updateRenderTargetMipmap=O,this.updateMultisampleRenderTarget=Ee,this.setupDepthRenderbuffer=te,this.setupFrameBufferTexture=F,this.useMultisampledRTT=he}function zb(a,e){function t(i,s=ds){let r;const o=Rt.getTransfer(s);if(i===xs)return a.UNSIGNED_BYTE;if(i===vp)return a.UNSIGNED_SHORT_4_4_4_4;if(i===_p)return a.UNSIGNED_SHORT_5_5_5_1;if(i===o0)return a.UNSIGNED_INT_5_9_9_9_REV;if(i===s0)return a.BYTE;if(i===r0)return a.SHORT;if(i===mp)return a.UNSIGNED_SHORT;if(i===gp)return a.INT;if(i===$r)return a.UNSIGNED_INT;if(i===Cn)return a.FLOAT;if(i===Jo)return a.HALF_FLOAT;if(i===a0)return a.ALPHA;if(i===l0)return a.RGB;if(i===vn)return a.RGBA;if(i===c0)return a.LUMINANCE;if(i===h0)return a.LUMINANCE_ALPHA;if(i===Ur)return a.DEPTH_COMPONENT;if(i===Oo)return a.DEPTH_STENCIL;if(i===yp)return a.RED;if(i===xp)return a.RED_INTEGER;if(i===u0)return a.RG;if(i===bp)return a.RG_INTEGER;if(i===wp)return a.RGBA_INTEGER;if(i===zl||i===Vl||i===Hl||i===Gl)if(o===Wt)if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),r!==null){if(i===zl)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===Vl)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===Hl)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===Gl)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(r=e.get("WEBGL_compressed_texture_s3tc"),r!==null){if(i===zl)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Vl)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===Hl)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===Gl)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===bu||i===wu||i===Mu||i===Su)if(r=e.get("WEBGL_compressed_texture_pvrtc"),r!==null){if(i===bu)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===wu)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===Mu)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===Su)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===Au||i===Eu||i===Tu)if(r=e.get("WEBGL_compressed_texture_etc"),r!==null){if(i===Au||i===Eu)return o===Wt?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(i===Tu)return o===Wt?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===Cu||i===Ru||i===Pu||i===Iu||i===Lu||i===Fu||i===Bu||i===Du||i===ku||i===Nu||i===Ou||i===Uu||i===zu||i===Vu)if(r=e.get("WEBGL_compressed_texture_astc"),r!==null){if(i===Cu)return o===Wt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===Ru)return o===Wt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===Pu)return o===Wt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===Iu)return o===Wt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===Lu)return o===Wt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===Fu)return o===Wt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===Bu)return o===Wt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===Du)return o===Wt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===ku)return o===Wt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===Nu)return o===Wt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===Ou)return o===Wt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===Uu)return o===Wt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===zu)return o===Wt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===Vu)return o===Wt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===Wl||i===Hu||i===Gu)if(r=e.get("EXT_texture_compression_bptc"),r!==null){if(i===Wl)return o===Wt?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===Hu)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===Gu)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===d0||i===Wu||i===Xu||i===ju)if(r=e.get("EXT_texture_compression_rgtc"),r!==null){if(i===Wl)return r.COMPRESSED_RED_RGTC1_EXT;if(i===Wu)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===Xu)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===ju)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===ea?a.UNSIGNED_INT_24_8:a[i]!==void 0?a[i]:null}return{convert:t}}class Vb extends Pi{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class $n extends je{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Hb={type:"move"};class gc{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new $n,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new $n,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new T,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new T),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new $n,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new T,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new T),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let s=null,r=null,o=null;const l=this._targetRay,h=this._grip,d=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(d&&e.hand){o=!0;for(const _ of e.hand.values()){const g=t.getJointPose(_,i),v=this._getHandJoint(d,_);g!==null&&(v.matrix.fromArray(g.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.matrixWorldNeedsUpdate=!0,v.jointRadius=g.radius),v.visible=g!==null}const f=d.joints["index-finger-tip"],c=d.joints["thumb-tip"],u=f.position.distanceTo(c.position),p=.02,m=.005;d.inputState.pinching&&u>p+m?(d.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!d.inputState.pinching&&u<=p-m&&(d.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else h!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),r!==null&&(h.matrix.fromArray(r.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),h.matrixWorldNeedsUpdate=!0,r.linearVelocity?(h.hasLinearVelocity=!0,h.linearVelocity.copy(r.linearVelocity)):h.hasLinearVelocity=!1,r.angularVelocity?(h.hasAngularVelocity=!0,h.angularVelocity.copy(r.angularVelocity)):h.hasAngularVelocity=!1));l!==null&&(s=t.getPose(e.targetRaySpace,i),s===null&&r!==null&&(s=r),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1,this.dispatchEvent(Hb)))}return l!==null&&(l.visible=s!==null),h!==null&&(h.visible=r!==null),d!==null&&(d.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new $n;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}const Gb=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,Wb=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Xb{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(this.texture===null){const s=new Ht,r=e.properties.get(s);r.__webglTexture=t.texture,(t.depthNear!=i.depthNear||t.depthFar!=i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=s}}render(e,t){if(this.texture!==null){if(this.mesh===null){const i=t.cameras[0].viewport,s=new fi({vertexShader:Gb,fragmentShader:Wb,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new Ae(new pi(20,20),s)}e.render(this.mesh,t)}}reset(){this.texture=null,this.mesh=null}}class jb extends As{constructor(e,t){super();const i=this;let s=null,r=1,o=null,l="local-floor",h=1,d=null,f=null,c=null,u=null,p=null,m=null;const _=new Xb,g=t.getContextAttributes();let v=null,y=null;const x=[],b=[],S=new Oe;let A=null;const E=new Pi;E.layers.enable(1),E.viewport=new Ct;const R=new Pi;R.layers.enable(2),R.viewport=new Ct;const M=[E,R],w=new Vb;w.layers.enable(1),w.layers.enable(2);let L=null,N=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(F){let D=x[F];return D===void 0&&(D=new gc,x[F]=D),D.getTargetRaySpace()},this.getControllerGrip=function(F){let D=x[F];return D===void 0&&(D=new gc,x[F]=D),D.getGripSpace()},this.getHand=function(F){let D=x[F];return D===void 0&&(D=new gc,x[F]=D),D.getHandSpace()};function B(F){const D=b.indexOf(F.inputSource);if(D===-1)return;const j=x[D];j!==void 0&&(j.update(F.inputSource,F.frame,d||o),j.dispatchEvent({type:F.type,data:F.inputSource}))}function G(){s.removeEventListener("select",B),s.removeEventListener("selectstart",B),s.removeEventListener("selectend",B),s.removeEventListener("squeeze",B),s.removeEventListener("squeezestart",B),s.removeEventListener("squeezeend",B),s.removeEventListener("end",G),s.removeEventListener("inputsourceschange",W);for(let F=0;F<x.length;F++){const D=b[F];D!==null&&(b[F]=null,x[F].disconnect(D))}L=null,N=null,_.reset(),e.setRenderTarget(v),p=null,u=null,c=null,s=null,y=null,X.stop(),i.isPresenting=!1,e.setPixelRatio(A),e.setSize(S.width,S.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(F){r=F,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(F){l=F,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return d||o},this.setReferenceSpace=function(F){d=F},this.getBaseLayer=function(){return u!==null?u:p},this.getBinding=function(){return c},this.getFrame=function(){return m},this.getSession=function(){return s},this.setSession=async function(F){if(s=F,s!==null){if(v=e.getRenderTarget(),s.addEventListener("select",B),s.addEventListener("selectstart",B),s.addEventListener("selectend",B),s.addEventListener("squeeze",B),s.addEventListener("squeezestart",B),s.addEventListener("squeezeend",B),s.addEventListener("end",G),s.addEventListener("inputsourceschange",W),g.xrCompatible!==!0&&await t.makeXRCompatible(),A=e.getPixelRatio(),e.getSize(S),s.renderState.layers===void 0){const D={antialias:g.antialias,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:r};p=new XRWebGLLayer(s,t,D),s.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),y=new bs(p.framebufferWidth,p.framebufferHeight,{format:vn,type:xs,colorSpace:e.outputColorSpace,stencilBuffer:g.stencil})}else{let D=null,j=null,te=null;g.depth&&(te=g.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,D=g.stencil?Oo:Ur,j=g.stencil?ea:$r);const ae={colorFormat:t.RGBA8,depthFormat:te,scaleFactor:r};c=new XRWebGLBinding(s,t),u=c.createProjectionLayer(ae),s.updateRenderState({layers:[u]}),e.setPixelRatio(1),e.setSize(u.textureWidth,u.textureHeight,!1),y=new bs(u.textureWidth,u.textureHeight,{format:vn,type:xs,depthTexture:new kp(u.textureWidth,u.textureHeight,j,void 0,void 0,void 0,void 0,void 0,void 0,D),stencilBuffer:g.stencil,colorSpace:e.outputColorSpace,samples:g.antialias?4:0,resolveDepthBuffer:u.ignoreDepthValues===!1})}y.isXRRenderTarget=!0,this.setFoveation(h),d=null,o=await s.requestReferenceSpace(l),X.setContext(s),X.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode};function W(F){for(let D=0;D<F.removed.length;D++){const j=F.removed[D],te=b.indexOf(j);te>=0&&(b[te]=null,x[te].disconnect(j))}for(let D=0;D<F.added.length;D++){const j=F.added[D];let te=b.indexOf(j);if(te===-1){for(let K=0;K<x.length;K++)if(K>=b.length){b.push(j),te=K;break}else if(b[K]===null){b[K]=j,te=K;break}if(te===-1)break}const ae=x[te];ae&&ae.connect(j)}}const ee=new T,z=new T;function k(F,D,j){ee.setFromMatrixPosition(D.matrixWorld),z.setFromMatrixPosition(j.matrixWorld);const te=ee.distanceTo(z),ae=D.projectionMatrix.elements,K=j.projectionMatrix.elements,O=ae[14]/(ae[10]-1),pe=ae[14]/(ae[10]+1),xe=(ae[9]+1)/ae[5],Ee=(ae[9]-1)/ae[5],ve=(ae[8]-1)/ae[0],he=(K[8]+1)/K[0],fe=O*ve,qe=O*he,Ye=te/(-ve+he),U=Ye*-ve;D.matrixWorld.decompose(F.position,F.quaternion,F.scale),F.translateX(U),F.translateZ(Ye),F.matrixWorld.compose(F.position,F.quaternion,F.scale),F.matrixWorldInverse.copy(F.matrixWorld).invert();const P=O+Ye,re=pe+Ye,de=fe-U,me=qe+(te-U),_e=xe*pe/re*P,De=Ee*pe/re*P;F.projectionMatrix.makePerspective(de,me,_e,De,P,re),F.projectionMatrixInverse.copy(F.projectionMatrix).invert()}function q(F,D){D===null?F.matrixWorld.copy(F.matrix):F.matrixWorld.multiplyMatrices(D.matrixWorld,F.matrix),F.matrixWorldInverse.copy(F.matrixWorld).invert()}this.updateCamera=function(F){if(s===null)return;_.texture!==null&&(F.near=_.depthNear,F.far=_.depthFar),w.near=R.near=E.near=F.near,w.far=R.far=E.far=F.far,(L!==w.near||N!==w.far)&&(s.updateRenderState({depthNear:w.near,depthFar:w.far}),L=w.near,N=w.far,E.near=L,E.far=N,R.near=L,R.far=N,E.updateProjectionMatrix(),R.updateProjectionMatrix(),F.updateProjectionMatrix());const D=F.parent,j=w.cameras;q(w,D);for(let te=0;te<j.length;te++)q(j[te],D);j.length===2?k(w,E,R):w.projectionMatrix.copy(E.projectionMatrix),$(F,w,D)};function $(F,D,j){j===null?F.matrix.copy(D.matrixWorld):(F.matrix.copy(j.matrixWorld),F.matrix.invert(),F.matrix.multiply(D.matrixWorld)),F.matrix.decompose(F.position,F.quaternion,F.scale),F.updateMatrixWorld(!0),F.projectionMatrix.copy(D.projectionMatrix),F.projectionMatrixInverse.copy(D.projectionMatrixInverse),F.isPerspectiveCamera&&(F.fov=Kr*2*Math.atan(1/F.projectionMatrix.elements[5]),F.zoom=1)}this.getCamera=function(){return w},this.getFoveation=function(){if(!(u===null&&p===null))return h},this.setFoveation=function(F){h=F,u!==null&&(u.fixedFoveation=F),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=F)},this.hasDepthSensing=function(){return _.texture!==null};let H=null;function Q(F,D){if(f=D.getViewerPose(d||o),m=D,f!==null){const j=f.views;p!==null&&(e.setRenderTargetFramebuffer(y,p.framebuffer),e.setRenderTarget(y));let te=!1;j.length!==w.cameras.length&&(w.cameras.length=0,te=!0);for(let K=0;K<j.length;K++){const O=j[K];let pe=null;if(p!==null)pe=p.getViewport(O);else{const Ee=c.getViewSubImage(u,O);pe=Ee.viewport,K===0&&(e.setRenderTargetTextures(y,Ee.colorTexture,u.ignoreDepthValues?void 0:Ee.depthStencilTexture),e.setRenderTarget(y))}let xe=M[K];xe===void 0&&(xe=new Pi,xe.layers.enable(K),xe.viewport=new Ct,M[K]=xe),xe.matrix.fromArray(O.transform.matrix),xe.matrix.decompose(xe.position,xe.quaternion,xe.scale),xe.projectionMatrix.fromArray(O.projectionMatrix),xe.projectionMatrixInverse.copy(xe.projectionMatrix).invert(),xe.viewport.set(pe.x,pe.y,pe.width,pe.height),K===0&&(w.matrix.copy(xe.matrix),w.matrix.decompose(w.position,w.quaternion,w.scale)),te===!0&&w.cameras.push(xe)}const ae=s.enabledFeatures;if(ae&&ae.includes("depth-sensing")){const K=c.getDepthInformation(j[0]);K&&K.isValid&&K.texture&&_.init(e,K,s.renderState)}}for(let j=0;j<x.length;j++){const te=b[j],ae=x[j];te!==null&&ae!==void 0&&ae.update(te,D,d||o)}_.render(e,w),H&&H(F,D),D.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:D}),m=null}const X=new Dp;X.setAnimationLoop(Q),this.setAnimationLoop=function(F){H=F},this.dispose=function(){}}}const Bs=new At,Yb=new Je;function qb(a,e){function t(g,v){g.matrixAutoUpdate===!0&&g.updateMatrix(),v.value.copy(g.matrix)}function i(g,v){v.color.getRGB(g.fogColor.value,Ip(a)),v.isFog?(g.fogNear.value=v.near,g.fogFar.value=v.far):v.isFogExp2&&(g.fogDensity.value=v.density)}function s(g,v,y,x,b){v.isMeshBasicMaterial||v.isMeshLambertMaterial?r(g,v):v.isMeshToonMaterial?(r(g,v),c(g,v)):v.isMeshPhongMaterial?(r(g,v),f(g,v)):v.isMeshStandardMaterial?(r(g,v),u(g,v),v.isMeshPhysicalMaterial&&p(g,v,b)):v.isMeshMatcapMaterial?(r(g,v),m(g,v)):v.isMeshDepthMaterial?r(g,v):v.isMeshDistanceMaterial?(r(g,v),_(g,v)):v.isMeshNormalMaterial?r(g,v):v.isLineBasicMaterial?(o(g,v),v.isLineDashedMaterial&&l(g,v)):v.isPointsMaterial?h(g,v,y,x):v.isSpriteMaterial?d(g,v):v.isShadowMaterial?(g.color.value.copy(v.color),g.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}function r(g,v){g.opacity.value=v.opacity,v.color&&g.diffuse.value.copy(v.color),v.emissive&&g.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(g.map.value=v.map,t(v.map,g.mapTransform)),v.alphaMap&&(g.alphaMap.value=v.alphaMap,t(v.alphaMap,g.alphaMapTransform)),v.bumpMap&&(g.bumpMap.value=v.bumpMap,t(v.bumpMap,g.bumpMapTransform),g.bumpScale.value=v.bumpScale,v.side===zi&&(g.bumpScale.value*=-1)),v.normalMap&&(g.normalMap.value=v.normalMap,t(v.normalMap,g.normalMapTransform),g.normalScale.value.copy(v.normalScale),v.side===zi&&g.normalScale.value.negate()),v.displacementMap&&(g.displacementMap.value=v.displacementMap,t(v.displacementMap,g.displacementMapTransform),g.displacementScale.value=v.displacementScale,g.displacementBias.value=v.displacementBias),v.emissiveMap&&(g.emissiveMap.value=v.emissiveMap,t(v.emissiveMap,g.emissiveMapTransform)),v.specularMap&&(g.specularMap.value=v.specularMap,t(v.specularMap,g.specularMapTransform)),v.alphaTest>0&&(g.alphaTest.value=v.alphaTest);const y=e.get(v),x=y.envMap,b=y.envMapRotation;if(x&&(g.envMap.value=x,Bs.copy(b),Bs.x*=-1,Bs.y*=-1,Bs.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(Bs.y*=-1,Bs.z*=-1),g.envMapRotation.value.setFromMatrix4(Yb.makeRotationFromEuler(Bs)),g.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=v.reflectivity,g.ior.value=v.ior,g.refractionRatio.value=v.refractionRatio),v.lightMap){g.lightMap.value=v.lightMap;const S=a._useLegacyLights===!0?Math.PI:1;g.lightMapIntensity.value=v.lightMapIntensity*S,t(v.lightMap,g.lightMapTransform)}v.aoMap&&(g.aoMap.value=v.aoMap,g.aoMapIntensity.value=v.aoMapIntensity,t(v.aoMap,g.aoMapTransform))}function o(g,v){g.diffuse.value.copy(v.color),g.opacity.value=v.opacity,v.map&&(g.map.value=v.map,t(v.map,g.mapTransform))}function l(g,v){g.dashSize.value=v.dashSize,g.totalSize.value=v.dashSize+v.gapSize,g.scale.value=v.scale}function h(g,v,y,x){g.diffuse.value.copy(v.color),g.opacity.value=v.opacity,g.size.value=v.size*y,g.scale.value=x*.5,v.map&&(g.map.value=v.map,t(v.map,g.uvTransform)),v.alphaMap&&(g.alphaMap.value=v.alphaMap,t(v.alphaMap,g.alphaMapTransform)),v.alphaTest>0&&(g.alphaTest.value=v.alphaTest)}function d(g,v){g.diffuse.value.copy(v.color),g.opacity.value=v.opacity,g.rotation.value=v.rotation,v.map&&(g.map.value=v.map,t(v.map,g.mapTransform)),v.alphaMap&&(g.alphaMap.value=v.alphaMap,t(v.alphaMap,g.alphaMapTransform)),v.alphaTest>0&&(g.alphaTest.value=v.alphaTest)}function f(g,v){g.specular.value.copy(v.specular),g.shininess.value=Math.max(v.shininess,1e-4)}function c(g,v){v.gradientMap&&(g.gradientMap.value=v.gradientMap)}function u(g,v){g.metalness.value=v.metalness,v.metalnessMap&&(g.metalnessMap.value=v.metalnessMap,t(v.metalnessMap,g.metalnessMapTransform)),g.roughness.value=v.roughness,v.roughnessMap&&(g.roughnessMap.value=v.roughnessMap,t(v.roughnessMap,g.roughnessMapTransform)),v.envMap&&(g.envMapIntensity.value=v.envMapIntensity)}function p(g,v,y){g.ior.value=v.ior,v.sheen>0&&(g.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),g.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(g.sheenColorMap.value=v.sheenColorMap,t(v.sheenColorMap,g.sheenColorMapTransform)),v.sheenRoughnessMap&&(g.sheenRoughnessMap.value=v.sheenRoughnessMap,t(v.sheenRoughnessMap,g.sheenRoughnessMapTransform))),v.clearcoat>0&&(g.clearcoat.value=v.clearcoat,g.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(g.clearcoatMap.value=v.clearcoatMap,t(v.clearcoatMap,g.clearcoatMapTransform)),v.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap,t(v.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),v.clearcoatNormalMap&&(g.clearcoatNormalMap.value=v.clearcoatNormalMap,t(v.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),v.side===zi&&g.clearcoatNormalScale.value.negate())),v.dispersion>0&&(g.dispersion.value=v.dispersion),v.iridescence>0&&(g.iridescence.value=v.iridescence,g.iridescenceIOR.value=v.iridescenceIOR,g.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(g.iridescenceMap.value=v.iridescenceMap,t(v.iridescenceMap,g.iridescenceMapTransform)),v.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=v.iridescenceThicknessMap,t(v.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),v.transmission>0&&(g.transmission.value=v.transmission,g.transmissionSamplerMap.value=y.texture,g.transmissionSamplerSize.value.set(y.width,y.height),v.transmissionMap&&(g.transmissionMap.value=v.transmissionMap,t(v.transmissionMap,g.transmissionMapTransform)),g.thickness.value=v.thickness,v.thicknessMap&&(g.thicknessMap.value=v.thicknessMap,t(v.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=v.attenuationDistance,g.attenuationColor.value.copy(v.attenuationColor)),v.anisotropy>0&&(g.anisotropyVector.value.set(v.anisotropy*Math.cos(v.anisotropyRotation),v.anisotropy*Math.sin(v.anisotropyRotation)),v.anisotropyMap&&(g.anisotropyMap.value=v.anisotropyMap,t(v.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=v.specularIntensity,g.specularColor.value.copy(v.specularColor),v.specularColorMap&&(g.specularColorMap.value=v.specularColorMap,t(v.specularColorMap,g.specularColorMapTransform)),v.specularIntensityMap&&(g.specularIntensityMap.value=v.specularIntensityMap,t(v.specularIntensityMap,g.specularIntensityMapTransform))}function m(g,v){v.matcap&&(g.matcap.value=v.matcap)}function _(g,v){const y=e.get(v).light;g.referencePosition.value.setFromMatrixPosition(y.matrixWorld),g.nearDistance.value=y.shadow.camera.near,g.farDistance.value=y.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:s}}function $b(a,e,t,i){let s={},r={},o=[];const l=a.getParameter(a.MAX_UNIFORM_BUFFER_BINDINGS);function h(y,x){const b=x.program;i.uniformBlockBinding(y,b)}function d(y,x){let b=s[y.id];b===void 0&&(m(y),b=f(y),s[y.id]=b,y.addEventListener("dispose",g));const S=x.program;i.updateUBOMapping(y,S);const A=e.render.frame;r[y.id]!==A&&(u(y),r[y.id]=A)}function f(y){const x=c();y.__bindingPointIndex=x;const b=a.createBuffer(),S=y.__size,A=y.usage;return a.bindBuffer(a.UNIFORM_BUFFER,b),a.bufferData(a.UNIFORM_BUFFER,S,A),a.bindBuffer(a.UNIFORM_BUFFER,null),a.bindBufferBase(a.UNIFORM_BUFFER,x,b),b}function c(){for(let y=0;y<l;y++)if(o.indexOf(y)===-1)return o.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function u(y){const x=s[y.id],b=y.uniforms,S=y.__cache;a.bindBuffer(a.UNIFORM_BUFFER,x);for(let A=0,E=b.length;A<E;A++){const R=Array.isArray(b[A])?b[A]:[b[A]];for(let M=0,w=R.length;M<w;M++){const L=R[M];if(p(L,A,M,S)===!0){const N=L.__offset,B=Array.isArray(L.value)?L.value:[L.value];let G=0;for(let W=0;W<B.length;W++){const ee=B[W],z=_(ee);typeof ee=="number"||typeof ee=="boolean"?(L.__data[0]=ee,a.bufferSubData(a.UNIFORM_BUFFER,N+G,L.__data)):ee.isMatrix3?(L.__data[0]=ee.elements[0],L.__data[1]=ee.elements[1],L.__data[2]=ee.elements[2],L.__data[3]=0,L.__data[4]=ee.elements[3],L.__data[5]=ee.elements[4],L.__data[6]=ee.elements[5],L.__data[7]=0,L.__data[8]=ee.elements[6],L.__data[9]=ee.elements[7],L.__data[10]=ee.elements[8],L.__data[11]=0):(ee.toArray(L.__data,G),G+=z.storage/Float32Array.BYTES_PER_ELEMENT)}a.bufferSubData(a.UNIFORM_BUFFER,N,L.__data)}}}a.bindBuffer(a.UNIFORM_BUFFER,null)}function p(y,x,b,S){const A=y.value,E=x+"_"+b;if(S[E]===void 0)return typeof A=="number"||typeof A=="boolean"?S[E]=A:S[E]=A.clone(),!0;{const R=S[E];if(typeof A=="number"||typeof A=="boolean"){if(R!==A)return S[E]=A,!0}else if(R.equals(A)===!1)return R.copy(A),!0}return!1}function m(y){const x=y.uniforms;let b=0;const S=16;for(let E=0,R=x.length;E<R;E++){const M=Array.isArray(x[E])?x[E]:[x[E]];for(let w=0,L=M.length;w<L;w++){const N=M[w],B=Array.isArray(N.value)?N.value:[N.value];for(let G=0,W=B.length;G<W;G++){const ee=B[G],z=_(ee),k=b%S;k!==0&&S-k<z.boundary&&(b+=S-k),N.__data=new Float32Array(z.storage/Float32Array.BYTES_PER_ELEMENT),N.__offset=b,b+=z.storage}}}const A=b%S;return A>0&&(b+=S-A),y.__size=b,y.__cache={},this}function _(y){const x={boundary:0,storage:0};return typeof y=="number"||typeof y=="boolean"?(x.boundary=4,x.storage=4):y.isVector2?(x.boundary=8,x.storage=8):y.isVector3||y.isColor?(x.boundary=16,x.storage=12):y.isVector4?(x.boundary=16,x.storage=16):y.isMatrix3?(x.boundary=48,x.storage=48):y.isMatrix4?(x.boundary=64,x.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),x}function g(y){const x=y.target;x.removeEventListener("dispose",g);const b=o.indexOf(x.__bindingPointIndex);o.splice(b,1),a.deleteBuffer(s[x.id]),delete s[x.id],delete r[x.id]}function v(){for(const y in s)a.deleteBuffer(s[y]);o=[],s={},r={}}return{bind:h,update:d,dispose:v}}class Zb{constructor(e={}){const{canvas:t=W0(),context:i=null,depth:s=!0,stencil:r=!1,alpha:o=!1,antialias:l=!1,premultipliedAlpha:h=!0,preserveDrawingBuffer:d=!1,powerPreference:f="default",failIfMajorPerformanceCaveat:c=!1}=e;this.isWebGLRenderer=!0;let u;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");u=i.getContextAttributes().alpha}else u=o;const p=new Uint32Array(4),m=new Int32Array(4);let _=null,g=null;const v=[],y=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=ei,this._useLegacyLights=!1,this.toneMapping=vs,this.toneMappingExposure=1;const x=this;let b=!1,S=0,A=0,E=null,R=-1,M=null;const w=new Ct,L=new Ct;let N=null;const B=new Le(0);let G=0,W=t.width,ee=t.height,z=1,k=null,q=null;const $=new Ct(0,0,W,ee),H=new Ct(0,0,W,ee);let Q=!1;const X=new Nh;let F=!1,D=!1;const j=new Je,te=new T,ae={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function K(){return E===null?z:1}let O=i;function pe(I,V){return t.getContext(I,V)}try{const I={alpha:!0,depth:s,stencil:r,antialias:l,premultipliedAlpha:h,preserveDrawingBuffer:d,powerPreference:f,failIfMajorPerformanceCaveat:c};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Ih}`),t.addEventListener("webglcontextlost",C,!1),t.addEventListener("webglcontextrestored",ne,!1),t.addEventListener("webglcontextcreationerror",oe,!1),O===null){const V="webgl2";if(O=pe(V,I),O===null)throw pe(V)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(I){throw console.error("THREE.WebGLRenderer: "+I.message),I}let xe,Ee,ve,he,fe,qe,Ye,U,P,re,de,me,_e,De,Ce,Me,tt,Pe,et,ut,it,We,st,ct;function xt(){xe=new sx(O),xe.init(),We=new zb(O,xe),Ee=new Qy(O,xe,e,We),ve=new Ob(O),he=new ax(O),fe=new Sb,qe=new Ub(O,xe,ve,fe,Ee,We,he),Ye=new ex(x),U=new nx(x),P=new pv(O),st=new Zy(O,P),re=new rx(O,P,he,st),de=new cx(O,re,P,he),et=new lx(O,Ee,qe),Me=new Jy(fe),me=new Mb(x,Ye,U,xe,Ee,st,Me),_e=new qb(x,fe),De=new Eb,Ce=new Lb(xe),Pe=new $y(x,Ye,U,ve,de,u,h),tt=new Nb(x,de,Ee),ct=new $b(O,he,Ee,ve),ut=new Ky(O,xe,he),it=new ox(O,xe,he),he.programs=me.programs,x.capabilities=Ee,x.extensions=xe,x.properties=fe,x.renderLists=De,x.shadowMap=tt,x.state=ve,x.info=he}xt();const rt=new jb(x,O);this.xr=rt,this.getContext=function(){return O},this.getContextAttributes=function(){return O.getContextAttributes()},this.forceContextLoss=function(){const I=xe.get("WEBGL_lose_context");I&&I.loseContext()},this.forceContextRestore=function(){const I=xe.get("WEBGL_lose_context");I&&I.restoreContext()},this.getPixelRatio=function(){return z},this.setPixelRatio=function(I){I!==void 0&&(z=I,this.setSize(W,ee,!1))},this.getSize=function(I){return I.set(W,ee)},this.setSize=function(I,V,Y=!0){if(rt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}W=I,ee=V,t.width=Math.floor(I*z),t.height=Math.floor(V*z),Y===!0&&(t.style.width=I+"px",t.style.height=V+"px"),this.setViewport(0,0,I,V)},this.getDrawingBufferSize=function(I){return I.set(W*z,ee*z).floor()},this.setDrawingBufferSize=function(I,V,Y){W=I,ee=V,z=Y,t.width=Math.floor(I*Y),t.height=Math.floor(V*Y),this.setViewport(0,0,I,V)},this.getCurrentViewport=function(I){return I.copy(w)},this.getViewport=function(I){return I.copy($)},this.setViewport=function(I,V,Y,Z){I.isVector4?$.set(I.x,I.y,I.z,I.w):$.set(I,V,Y,Z),ve.viewport(w.copy($).multiplyScalar(z).round())},this.getScissor=function(I){return I.copy(H)},this.setScissor=function(I,V,Y,Z){I.isVector4?H.set(I.x,I.y,I.z,I.w):H.set(I,V,Y,Z),ve.scissor(L.copy(H).multiplyScalar(z).round())},this.getScissorTest=function(){return Q},this.setScissorTest=function(I){ve.setScissorTest(Q=I)},this.setOpaqueSort=function(I){k=I},this.setTransparentSort=function(I){q=I},this.getClearColor=function(I){return I.copy(Pe.getClearColor())},this.setClearColor=function(){Pe.setClearColor.apply(Pe,arguments)},this.getClearAlpha=function(){return Pe.getClearAlpha()},this.setClearAlpha=function(){Pe.setClearAlpha.apply(Pe,arguments)},this.clear=function(I=!0,V=!0,Y=!0){let Z=0;if(I){let J=!1;if(E!==null){const se=E.texture.format;J=se===wp||se===bp||se===xp}if(J){const se=E.texture.type,Te=se===xs||se===$r||se===mp||se===ea||se===vp||se===_p,Ie=Pe.getClearColor(),$e=Pe.getClearAlpha(),ze=Ie.r,Xe=Ie.g,Be=Ie.b;Te?(p[0]=ze,p[1]=Xe,p[2]=Be,p[3]=$e,O.clearBufferuiv(O.COLOR,0,p)):(m[0]=ze,m[1]=Xe,m[2]=Be,m[3]=$e,O.clearBufferiv(O.COLOR,0,m))}else Z|=O.COLOR_BUFFER_BIT}V&&(Z|=O.DEPTH_BUFFER_BIT),Y&&(Z|=O.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),O.clear(Z)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",C,!1),t.removeEventListener("webglcontextrestored",ne,!1),t.removeEventListener("webglcontextcreationerror",oe,!1),De.dispose(),Ce.dispose(),fe.dispose(),Ye.dispose(),U.dispose(),de.dispose(),st.dispose(),ct.dispose(),me.dispose(),rt.dispose(),rt.removeEventListener("sessionstart",gt),rt.removeEventListener("sessionend",vt),le.stop()};function C(I){I.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function ne(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const I=he.autoReset,V=tt.enabled,Y=tt.autoUpdate,Z=tt.needsUpdate,J=tt.type;xt(),he.autoReset=I,tt.enabled=V,tt.autoUpdate=Y,tt.needsUpdate=Z,tt.type=J}function oe(I){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",I.statusMessage)}function be(I){const V=I.target;V.removeEventListener("dispose",be),Re(V)}function Re(I){ot(I),fe.remove(I)}function ot(I){const V=fe.get(I).programs;V!==void 0&&(V.forEach(function(Y){me.releaseProgram(Y)}),I.isShaderMaterial&&me.releaseShaderCache(I))}this.renderBufferDirect=function(I,V,Y,Z,J,se){V===null&&(V=ae);const Te=J.isMesh&&J.matrixWorld.determinant()<0,Ie=ke(I,V,Y,Z,J);ve.setMaterial(Z,Te);let $e=Y.index,ze=1;if(Z.wireframe===!0){if($e=re.getWireframeAttribute(Y),$e===void 0)return;ze=2}const Xe=Y.drawRange,Be=Y.attributes.position;let St=Xe.start*ze,Pt=(Xe.start+Xe.count)*ze;se!==null&&(St=Math.max(St,se.start*ze),Pt=Math.min(Pt,(se.start+se.count)*ze)),$e!==null?(St=Math.max(St,0),Pt=Math.min(Pt,$e.count)):Be!=null&&(St=Math.max(St,0),Pt=Math.min(Pt,Be.count));const Ft=Pt-St;if(Ft<0||Ft===1/0)return;st.setup(J,Z,Ie,Y,$e);let hi,dt=ut;if($e!==null&&(hi=P.get($e),dt=it,dt.setIndex(hi)),J.isMesh)Z.wireframe===!0?(ve.setLineWidth(Z.wireframeLinewidth*K()),dt.setMode(O.LINES)):dt.setMode(O.TRIANGLES);else if(J.isLine){let Ze=Z.linewidth;Ze===void 0&&(Ze=1),ve.setLineWidth(Ze*K()),J.isLineSegments?dt.setMode(O.LINES):J.isLineLoop?dt.setMode(O.LINE_LOOP):dt.setMode(O.LINE_STRIP)}else J.isPoints?dt.setMode(O.POINTS):J.isSprite&&dt.setMode(O.TRIANGLES);if(J.isBatchedMesh)J._multiDrawInstances!==null?dt.renderMultiDrawInstances(J._multiDrawStarts,J._multiDrawCounts,J._multiDrawCount,J._multiDrawInstances):dt.renderMultiDraw(J._multiDrawStarts,J._multiDrawCounts,J._multiDrawCount);else if(J.isInstancedMesh)dt.renderInstances(St,Ft,J.count);else if(Y.isInstancedBufferGeometry){const Ze=Y._maxInstanceCount!==void 0?Y._maxInstanceCount:1/0,Bi=Math.min(Y.instanceCount,Ze);dt.renderInstances(St,Ft,Bi)}else dt.render(St,Ft)};function ht(I,V,Y){I.transparent===!0&&I.side===Ui&&I.forceSinglePass===!1?(I.side=zi,I.needsUpdate=!0,Fe(I,V,Y),I.side=Kn,I.needsUpdate=!0,Fe(I,V,Y),I.side=Ui):Fe(I,V,Y)}this.compile=function(I,V,Y=null){Y===null&&(Y=I),g=Ce.get(Y),g.init(V),y.push(g),Y.traverseVisible(function(J){J.isLight&&J.layers.test(V.layers)&&(g.pushLight(J),J.castShadow&&g.pushShadow(J))}),I!==Y&&I.traverseVisible(function(J){J.isLight&&J.layers.test(V.layers)&&(g.pushLight(J),J.castShadow&&g.pushShadow(J))}),g.setupLights(x._useLegacyLights);const Z=new Set;return I.traverse(function(J){const se=J.material;if(se)if(Array.isArray(se))for(let Te=0;Te<se.length;Te++){const Ie=se[Te];ht(Ie,Y,J),Z.add(Ie)}else ht(se,Y,J),Z.add(se)}),y.pop(),g=null,Z},this.compileAsync=function(I,V,Y=null){const Z=this.compile(I,V,Y);return new Promise(J=>{function se(){if(Z.forEach(function(Te){fe.get(Te).currentProgram.isReady()&&Z.delete(Te)}),Z.size===0){J(I);return}setTimeout(se,10)}xe.get("KHR_parallel_shader_compile")!==null?se():setTimeout(se,10)})};let Et=null;function Gt(I){Et&&Et(I)}function gt(){le.stop()}function vt(){le.start()}const le=new Dp;le.setAnimationLoop(Gt),typeof self<"u"&&le.setContext(self),this.setAnimationLoop=function(I){Et=I,rt.setAnimationLoop(I),I===null?le.stop():le.start()},rt.addEventListener("sessionstart",gt),rt.addEventListener("sessionend",vt),this.render=function(I,V){if(V!==void 0&&V.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(b===!0)return;I.matrixWorldAutoUpdate===!0&&I.updateMatrixWorld(),V.parent===null&&V.matrixWorldAutoUpdate===!0&&V.updateMatrixWorld(),rt.enabled===!0&&rt.isPresenting===!0&&(rt.cameraAutoUpdate===!0&&rt.updateCamera(V),V=rt.getCamera()),I.isScene===!0&&I.onBeforeRender(x,I,V,E),g=Ce.get(I,y.length),g.init(V),y.push(g),j.multiplyMatrices(V.projectionMatrix,V.matrixWorldInverse),X.setFromProjectionMatrix(j),D=this.localClippingEnabled,F=Me.init(this.clippingPlanes,D),_=De.get(I,v.length),_.init(),v.push(_),ge(I,V,0,x.sortObjects),_.finish(),x.sortObjects===!0&&_.sort(k,q);const Y=rt.enabled===!1||rt.isPresenting===!1||rt.hasDepthSensing()===!1;Y&&Pe.addToRenderList(_,I),this.info.render.frame++,F===!0&&Me.beginShadows();const Z=g.state.shadowsArray;tt.render(Z,I,V),F===!0&&Me.endShadows(),this.info.autoReset===!0&&this.info.reset();const J=_.opaque,se=_.transmissive;if(g.setupLights(x._useLegacyLights),V.isArrayCamera){const Te=V.cameras;if(se.length>0)for(let Ie=0,$e=Te.length;Ie<$e;Ie++){const ze=Te[Ie];we(J,se,I,ze)}Y&&Pe.render(I);for(let Ie=0,$e=Te.length;Ie<$e;Ie++){const ze=Te[Ie];ye(_,I,ze,ze.viewport)}}else se.length>0&&we(J,se,I,V),Y&&Pe.render(I),ye(_,I,V);E!==null&&(qe.updateMultisampleRenderTarget(E),qe.updateRenderTargetMipmap(E)),I.isScene===!0&&I.onAfterRender(x,I,V),st.resetDefaultState(),R=-1,M=null,y.pop(),y.length>0?(g=y[y.length-1],F===!0&&Me.setGlobalState(x.clippingPlanes,g.state.camera)):g=null,v.pop(),v.length>0?_=v[v.length-1]:_=null};function ge(I,V,Y,Z){if(I.visible===!1)return;if(I.layers.test(V.layers)){if(I.isGroup)Y=I.renderOrder;else if(I.isLOD)I.autoUpdate===!0&&I.update(V);else if(I.isLight)g.pushLight(I),I.castShadow&&g.pushShadow(I);else if(I.isSprite){if(!I.frustumCulled||X.intersectsSprite(I)){Z&&te.setFromMatrixPosition(I.matrixWorld).applyMatrix4(j);const Te=de.update(I),Ie=I.material;Ie.visible&&_.push(I,Te,Ie,Y,te.z,null)}}else if((I.isMesh||I.isLine||I.isPoints)&&(!I.frustumCulled||X.intersectsObject(I))){const Te=de.update(I),Ie=I.material;if(Z&&(I.boundingSphere!==void 0?(I.boundingSphere===null&&I.computeBoundingSphere(),te.copy(I.boundingSphere.center)):(Te.boundingSphere===null&&Te.computeBoundingSphere(),te.copy(Te.boundingSphere.center)),te.applyMatrix4(I.matrixWorld).applyMatrix4(j)),Array.isArray(Ie)){const $e=Te.groups;for(let ze=0,Xe=$e.length;ze<Xe;ze++){const Be=$e[ze],St=Ie[Be.materialIndex];St&&St.visible&&_.push(I,Te,St,Y,te.z,Be)}}else Ie.visible&&_.push(I,Te,Ie,Y,te.z,null)}}const se=I.children;for(let Te=0,Ie=se.length;Te<Ie;Te++)ge(se[Te],V,Y,Z)}function ye(I,V,Y,Z){const J=I.opaque,se=I.transmissive,Te=I.transparent;g.setupLightsView(Y),F===!0&&Me.setGlobalState(x.clippingPlanes,Y),Z&&ve.viewport(w.copy(Z)),J.length>0&&nt(J,V,Y),se.length>0&&nt(se,V,Y),Te.length>0&&nt(Te,V,Y),ve.buffers.depth.setTest(!0),ve.buffers.depth.setMask(!0),ve.buffers.color.setMask(!0),ve.setPolygonOffset(!1)}function we(I,V,Y,Z){if((Y.isScene===!0?Y.overrideMaterial:null)!==null)return;g.state.transmissionRenderTarget[Z.id]===void 0&&(g.state.transmissionRenderTarget[Z.id]=new bs(1,1,{generateMipmaps:!0,type:xe.has("EXT_color_buffer_half_float")||xe.has("EXT_color_buffer_float")?Jo:xs,minFilter:Yn,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1}));const se=g.state.transmissionRenderTarget[Z.id],Te=Z.viewport||w;se.setSize(Te.z,Te.w);const Ie=x.getRenderTarget();x.setRenderTarget(se),x.getClearColor(B),G=x.getClearAlpha(),G<1&&x.setClearColor(16777215,.5),x.clear();const $e=x.toneMapping;x.toneMapping=vs;const ze=Z.viewport;if(Z.viewport!==void 0&&(Z.viewport=void 0),g.setupLightsView(Z),F===!0&&Me.setGlobalState(x.clippingPlanes,Z),nt(I,Y,Z),qe.updateMultisampleRenderTarget(se),qe.updateRenderTargetMipmap(se),xe.has("WEBGL_multisampled_render_to_texture")===!1){let Xe=!1;for(let Be=0,St=V.length;Be<St;Be++){const Pt=V[Be],Ft=Pt.object,hi=Pt.geometry,dt=Pt.material,Ze=Pt.group;if(dt.side===Ui&&Ft.layers.test(Z.layers)){const Bi=dt.side;dt.side=zi,dt.needsUpdate=!0,Ue(Ft,Y,Z,hi,dt,Ze),dt.side=Bi,dt.needsUpdate=!0,Xe=!0}}Xe===!0&&(qe.updateMultisampleRenderTarget(se),qe.updateRenderTargetMipmap(se))}x.setRenderTarget(Ie),x.setClearColor(B,G),ze!==void 0&&(Z.viewport=ze),x.toneMapping=$e}function nt(I,V,Y){const Z=V.isScene===!0?V.overrideMaterial:null;for(let J=0,se=I.length;J<se;J++){const Te=I[J],Ie=Te.object,$e=Te.geometry,ze=Z===null?Te.material:Z,Xe=Te.group;Ie.layers.test(Y.layers)&&Ue(Ie,V,Y,$e,ze,Xe)}}function Ue(I,V,Y,Z,J,se){I.onBeforeRender(x,V,Y,Z,J,se),I.modelViewMatrix.multiplyMatrices(Y.matrixWorldInverse,I.matrixWorld),I.normalMatrix.getNormalMatrix(I.modelViewMatrix),J.onBeforeRender(x,V,Y,Z,I,se),J.transparent===!0&&J.side===Ui&&J.forceSinglePass===!1?(J.side=zi,J.needsUpdate=!0,x.renderBufferDirect(Y,V,Z,J,I,se),J.side=Kn,J.needsUpdate=!0,x.renderBufferDirect(Y,V,Z,J,I,se),J.side=Ui):x.renderBufferDirect(Y,V,Z,J,I,se),I.onAfterRender(x,V,Y,Z,J,se)}function Fe(I,V,Y){V.isScene!==!0&&(V=ae);const Z=fe.get(I),J=g.state.lights,se=g.state.shadowsArray,Te=J.state.version,Ie=me.getParameters(I,J.state,se,V,Y),$e=me.getProgramCacheKey(Ie);let ze=Z.programs;Z.environment=I.isMeshStandardMaterial?V.environment:null,Z.fog=V.fog,Z.envMap=(I.isMeshStandardMaterial?U:Ye).get(I.envMap||Z.environment),Z.envMapRotation=Z.environment!==null&&I.envMap===null?V.environmentRotation:I.envMapRotation,ze===void 0&&(I.addEventListener("dispose",be),ze=new Map,Z.programs=ze);let Xe=ze.get($e);if(Xe!==void 0){if(Z.currentProgram===Xe&&Z.lightsStateVersion===Te)return ce(I,Ie),Xe}else Ie.uniforms=me.getUniforms(I),I.onBuild(Y,Ie,x),I.onBeforeCompile(Ie,x),Xe=me.acquireProgram(Ie,$e),ze.set($e,Xe),Z.uniforms=Ie.uniforms;const Be=Z.uniforms;return(!I.isShaderMaterial&&!I.isRawShaderMaterial||I.clipping===!0)&&(Be.clippingPlanes=Me.uniform),ce(I,Ie),Z.needsLights=Ke(I),Z.lightsStateVersion=Te,Z.needsLights&&(Be.ambientLightColor.value=J.state.ambient,Be.lightProbe.value=J.state.probe,Be.directionalLights.value=J.state.directional,Be.directionalLightShadows.value=J.state.directionalShadow,Be.spotLights.value=J.state.spot,Be.spotLightShadows.value=J.state.spotShadow,Be.rectAreaLights.value=J.state.rectArea,Be.ltc_1.value=J.state.rectAreaLTC1,Be.ltc_2.value=J.state.rectAreaLTC2,Be.pointLights.value=J.state.point,Be.pointLightShadows.value=J.state.pointShadow,Be.hemisphereLights.value=J.state.hemi,Be.directionalShadowMap.value=J.state.directionalShadowMap,Be.directionalShadowMatrix.value=J.state.directionalShadowMatrix,Be.spotShadowMap.value=J.state.spotShadowMap,Be.spotLightMatrix.value=J.state.spotLightMatrix,Be.spotLightMap.value=J.state.spotLightMap,Be.pointShadowMap.value=J.state.pointShadowMap,Be.pointShadowMatrix.value=J.state.pointShadowMatrix),Z.currentProgram=Xe,Z.uniformsList=null,Xe}function Ve(I){if(I.uniformsList===null){const V=I.currentProgram.getUniforms();I.uniformsList=Ja.seqWithValue(V.seq,I.uniforms)}return I.uniformsList}function ce(I,V){const Y=fe.get(I);Y.outputColorSpace=V.outputColorSpace,Y.batching=V.batching,Y.instancing=V.instancing,Y.instancingColor=V.instancingColor,Y.instancingMorph=V.instancingMorph,Y.skinning=V.skinning,Y.morphTargets=V.morphTargets,Y.morphNormals=V.morphNormals,Y.morphColors=V.morphColors,Y.morphTargetsCount=V.morphTargetsCount,Y.numClippingPlanes=V.numClippingPlanes,Y.numIntersection=V.numClipIntersection,Y.vertexAlphas=V.vertexAlphas,Y.vertexTangents=V.vertexTangents,Y.toneMapping=V.toneMapping}function ke(I,V,Y,Z,J){V.isScene!==!0&&(V=ae),qe.resetTextureUnits();const se=V.fog,Te=Z.isMeshStandardMaterial?V.environment:null,Ie=E===null?x.outputColorSpace:E.isXRRenderTarget===!0?E.texture.colorSpace:bi,$e=(Z.isMeshStandardMaterial?U:Ye).get(Z.envMap||Te),ze=Z.vertexColors===!0&&!!Y.attributes.color&&Y.attributes.color.itemSize===4,Xe=!!Y.attributes.tangent&&(!!Z.normalMap||Z.anisotropy>0),Be=!!Y.morphAttributes.position,St=!!Y.morphAttributes.normal,Pt=!!Y.morphAttributes.color;let Ft=vs;Z.toneMapped&&(E===null||E.isXRRenderTarget===!0)&&(Ft=x.toneMapping);const hi=Y.morphAttributes.position||Y.morphAttributes.normal||Y.morphAttributes.color,dt=hi!==void 0?hi.length:0,Ze=fe.get(Z),Bi=g.state.lights;if(F===!0&&(D===!0||I!==M)){const Ot=I===M&&Z.id===R;Me.setState(Z,I,Ot)}let at=!1;Z.version===Ze.__version?(Ze.needsLights&&Ze.lightsStateVersion!==Bi.state.version||Ze.outputColorSpace!==Ie||J.isBatchedMesh&&Ze.batching===!1||!J.isBatchedMesh&&Ze.batching===!0||J.isInstancedMesh&&Ze.instancing===!1||!J.isInstancedMesh&&Ze.instancing===!0||J.isSkinnedMesh&&Ze.skinning===!1||!J.isSkinnedMesh&&Ze.skinning===!0||J.isInstancedMesh&&Ze.instancingColor===!0&&J.instanceColor===null||J.isInstancedMesh&&Ze.instancingColor===!1&&J.instanceColor!==null||J.isInstancedMesh&&Ze.instancingMorph===!0&&J.morphTexture===null||J.isInstancedMesh&&Ze.instancingMorph===!1&&J.morphTexture!==null||Ze.envMap!==$e||Z.fog===!0&&Ze.fog!==se||Ze.numClippingPlanes!==void 0&&(Ze.numClippingPlanes!==Me.numPlanes||Ze.numIntersection!==Me.numIntersection)||Ze.vertexAlphas!==ze||Ze.vertexTangents!==Xe||Ze.morphTargets!==Be||Ze.morphNormals!==St||Ze.morphColors!==Pt||Ze.toneMapping!==Ft||Ze.morphTargetsCount!==dt)&&(at=!0):(at=!0,Ze.__version=Z.version);let Mi=Ze.currentProgram;at===!0&&(Mi=Fe(Z,V,J));let Si=!1,Qt=!1,ii=!1;const It=Mi.getUniforms(),vi=Ze.uniforms;if(ve.useProgram(Mi.program)&&(Si=!0,Qt=!0,ii=!0),Z.id!==R&&(R=Z.id,Qt=!0),Si||M!==I){It.setValue(O,"projectionMatrix",I.projectionMatrix),It.setValue(O,"viewMatrix",I.matrixWorldInverse);const Ot=It.map.cameraPosition;Ot!==void 0&&Ot.setValue(O,te.setFromMatrixPosition(I.matrixWorld)),Ee.logarithmicDepthBuffer&&It.setValue(O,"logDepthBufFC",2/(Math.log(I.far+1)/Math.LN2)),(Z.isMeshPhongMaterial||Z.isMeshToonMaterial||Z.isMeshLambertMaterial||Z.isMeshBasicMaterial||Z.isMeshStandardMaterial||Z.isShaderMaterial)&&It.setValue(O,"isOrthographic",I.isOrthographicCamera===!0),M!==I&&(M=I,Qt=!0,ii=!0)}if(J.isSkinnedMesh){It.setOptional(O,J,"bindMatrix"),It.setOptional(O,J,"bindMatrixInverse");const Ot=J.skeleton;Ot&&(Ot.boneTexture===null&&Ot.computeBoneTexture(),It.setValue(O,"boneTexture",Ot.boneTexture,qe))}J.isBatchedMesh&&(It.setOptional(O,J,"batchingTexture"),It.setValue(O,"batchingTexture",J._matricesTexture,qe));const lt=Y.morphAttributes;if((lt.position!==void 0||lt.normal!==void 0||lt.color!==void 0)&&et.update(J,Y,Mi),(Qt||Ze.receiveShadow!==J.receiveShadow)&&(Ze.receiveShadow=J.receiveShadow,It.setValue(O,"receiveShadow",J.receiveShadow)),Z.isMeshGouraudMaterial&&Z.envMap!==null&&(vi.envMap.value=$e,vi.flipEnvMap.value=$e.isCubeTexture&&$e.isRenderTargetTexture===!1?-1:1),Z.isMeshStandardMaterial&&Z.envMap===null&&V.environment!==null&&(vi.envMapIntensity.value=V.environmentIntensity),Qt&&(It.setValue(O,"toneMappingExposure",x.toneMappingExposure),Ze.needsLights&&Ge(vi,ii),se&&Z.fog===!0&&_e.refreshFogUniforms(vi,se),_e.refreshMaterialUniforms(vi,Z,z,ee,g.state.transmissionRenderTarget[I.id]),Ja.upload(O,Ve(Ze),vi,qe)),Z.isShaderMaterial&&Z.uniformsNeedUpdate===!0&&(Ja.upload(O,Ve(Ze),vi,qe),Z.uniformsNeedUpdate=!1),Z.isSpriteMaterial&&It.setValue(O,"center",J.center),It.setValue(O,"modelViewMatrix",J.modelViewMatrix),It.setValue(O,"normalMatrix",J.normalMatrix),It.setValue(O,"modelMatrix",J.matrixWorld),Z.isShaderMaterial||Z.isRawShaderMaterial){const Ot=Z.uniformsGroups;for(let Jt=0,Nn=Ot.length;Jt<Nn;Jt++){const bn=Ot[Jt];ct.update(bn,Mi),ct.bind(bn,Mi)}}return Mi}function Ge(I,V){I.ambientLightColor.needsUpdate=V,I.lightProbe.needsUpdate=V,I.directionalLights.needsUpdate=V,I.directionalLightShadows.needsUpdate=V,I.pointLights.needsUpdate=V,I.pointLightShadows.needsUpdate=V,I.spotLights.needsUpdate=V,I.spotLightShadows.needsUpdate=V,I.rectAreaLights.needsUpdate=V,I.hemisphereLights.needsUpdate=V}function Ke(I){return I.isMeshLambertMaterial||I.isMeshToonMaterial||I.isMeshPhongMaterial||I.isMeshStandardMaterial||I.isShadowMaterial||I.isShaderMaterial&&I.lights===!0}this.getActiveCubeFace=function(){return S},this.getActiveMipmapLevel=function(){return A},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(I,V,Y){fe.get(I.texture).__webglTexture=V,fe.get(I.depthTexture).__webglTexture=Y;const Z=fe.get(I);Z.__hasExternalTextures=!0,Z.__autoAllocateDepthBuffer=Y===void 0,Z.__autoAllocateDepthBuffer||xe.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Z.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(I,V){const Y=fe.get(I);Y.__webglFramebuffer=V,Y.__useDefaultFramebuffer=V===void 0},this.setRenderTarget=function(I,V=0,Y=0){E=I,S=V,A=Y;let Z=!0,J=null,se=!1,Te=!1;if(I){const $e=fe.get(I);$e.__useDefaultFramebuffer!==void 0?(ve.bindFramebuffer(O.FRAMEBUFFER,null),Z=!1):$e.__webglFramebuffer===void 0?qe.setupRenderTarget(I):$e.__hasExternalTextures&&qe.rebindTextures(I,fe.get(I.texture).__webglTexture,fe.get(I.depthTexture).__webglTexture);const ze=I.texture;(ze.isData3DTexture||ze.isDataArrayTexture||ze.isCompressedArrayTexture)&&(Te=!0);const Xe=fe.get(I).__webglFramebuffer;I.isWebGLCubeRenderTarget?(Array.isArray(Xe[V])?J=Xe[V][Y]:J=Xe[V],se=!0):I.samples>0&&qe.useMultisampledRTT(I)===!1?J=fe.get(I).__webglMultisampledFramebuffer:Array.isArray(Xe)?J=Xe[Y]:J=Xe,w.copy(I.viewport),L.copy(I.scissor),N=I.scissorTest}else w.copy($).multiplyScalar(z).floor(),L.copy(H).multiplyScalar(z).floor(),N=Q;if(ve.bindFramebuffer(O.FRAMEBUFFER,J)&&Z&&ve.drawBuffers(I,J),ve.viewport(w),ve.scissor(L),ve.setScissorTest(N),se){const $e=fe.get(I.texture);O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_CUBE_MAP_POSITIVE_X+V,$e.__webglTexture,Y)}else if(Te){const $e=fe.get(I.texture),ze=V||0;O.framebufferTextureLayer(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,$e.__webglTexture,Y||0,ze)}R=-1},this.readRenderTargetPixels=function(I,V,Y,Z,J,se,Te){if(!(I&&I.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ie=fe.get(I).__webglFramebuffer;if(I.isWebGLCubeRenderTarget&&Te!==void 0&&(Ie=Ie[Te]),Ie){ve.bindFramebuffer(O.FRAMEBUFFER,Ie);try{const $e=I.texture,ze=$e.format,Xe=$e.type;if(!Ee.textureFormatReadable(ze)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ee.textureTypeReadable(Xe)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}V>=0&&V<=I.width-Z&&Y>=0&&Y<=I.height-J&&O.readPixels(V,Y,Z,J,We.convert(ze),We.convert(Xe),se)}finally{const $e=E!==null?fe.get(E).__webglFramebuffer:null;ve.bindFramebuffer(O.FRAMEBUFFER,$e)}}},this.copyFramebufferToTexture=function(I,V,Y=0){const Z=Math.pow(2,-Y),J=Math.floor(V.image.width*Z),se=Math.floor(V.image.height*Z);qe.setTexture2D(V,0),O.copyTexSubImage2D(O.TEXTURE_2D,Y,0,0,I.x,I.y,J,se),ve.unbindTexture()},this.copyTextureToTexture=function(I,V,Y,Z=0){const J=V.image.width,se=V.image.height,Te=We.convert(Y.format),Ie=We.convert(Y.type);qe.setTexture2D(Y,0),O.pixelStorei(O.UNPACK_FLIP_Y_WEBGL,Y.flipY),O.pixelStorei(O.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Y.premultiplyAlpha),O.pixelStorei(O.UNPACK_ALIGNMENT,Y.unpackAlignment),V.isDataTexture?O.texSubImage2D(O.TEXTURE_2D,Z,I.x,I.y,J,se,Te,Ie,V.image.data):V.isCompressedTexture?O.compressedTexSubImage2D(O.TEXTURE_2D,Z,I.x,I.y,V.mipmaps[0].width,V.mipmaps[0].height,Te,V.mipmaps[0].data):O.texSubImage2D(O.TEXTURE_2D,Z,I.x,I.y,Te,Ie,V.image),Z===0&&Y.generateMipmaps&&O.generateMipmap(O.TEXTURE_2D),ve.unbindTexture()},this.copyTextureToTexture3D=function(I,V,Y,Z,J=0){const se=I.max.x-I.min.x,Te=I.max.y-I.min.y,Ie=I.max.z-I.min.z,$e=We.convert(Z.format),ze=We.convert(Z.type);let Xe;if(Z.isData3DTexture)qe.setTexture3D(Z,0),Xe=O.TEXTURE_3D;else if(Z.isDataArrayTexture||Z.isCompressedArrayTexture)qe.setTexture2DArray(Z,0),Xe=O.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}O.pixelStorei(O.UNPACK_FLIP_Y_WEBGL,Z.flipY),O.pixelStorei(O.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Z.premultiplyAlpha),O.pixelStorei(O.UNPACK_ALIGNMENT,Z.unpackAlignment);const Be=O.getParameter(O.UNPACK_ROW_LENGTH),St=O.getParameter(O.UNPACK_IMAGE_HEIGHT),Pt=O.getParameter(O.UNPACK_SKIP_PIXELS),Ft=O.getParameter(O.UNPACK_SKIP_ROWS),hi=O.getParameter(O.UNPACK_SKIP_IMAGES),dt=Y.isCompressedTexture?Y.mipmaps[J]:Y.image;O.pixelStorei(O.UNPACK_ROW_LENGTH,dt.width),O.pixelStorei(O.UNPACK_IMAGE_HEIGHT,dt.height),O.pixelStorei(O.UNPACK_SKIP_PIXELS,I.min.x),O.pixelStorei(O.UNPACK_SKIP_ROWS,I.min.y),O.pixelStorei(O.UNPACK_SKIP_IMAGES,I.min.z),Y.isDataTexture||Y.isData3DTexture?O.texSubImage3D(Xe,J,V.x,V.y,V.z,se,Te,Ie,$e,ze,dt.data):Z.isCompressedArrayTexture?O.compressedTexSubImage3D(Xe,J,V.x,V.y,V.z,se,Te,Ie,$e,dt.data):O.texSubImage3D(Xe,J,V.x,V.y,V.z,se,Te,Ie,$e,ze,dt),O.pixelStorei(O.UNPACK_ROW_LENGTH,Be),O.pixelStorei(O.UNPACK_IMAGE_HEIGHT,St),O.pixelStorei(O.UNPACK_SKIP_PIXELS,Pt),O.pixelStorei(O.UNPACK_SKIP_ROWS,Ft),O.pixelStorei(O.UNPACK_SKIP_IMAGES,hi),J===0&&Z.generateMipmaps&&O.generateMipmap(Xe),ve.unbindTexture()},this.initTexture=function(I){I.isCubeTexture?qe.setTextureCube(I,0):I.isData3DTexture?qe.setTexture3D(I,0):I.isDataArrayTexture||I.isCompressedArrayTexture?qe.setTexture2DArray(I,0):qe.setTexture2D(I,0),ve.unbindTexture()},this.resetState=function(){S=0,A=0,E=null,ve.reset(),st.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return qn}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===Fh?"display-p3":"srgb",t.unpackColorSpace=Rt.workingColorSpace===Pl?"display-p3":"srgb"}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class Kb extends je{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new At,this.environmentIntensity=1,this.environmentRotation=new At,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class Qb{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Qc,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=_n()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return Ep("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let s=0,r=this.stride;s<r;s++)this.array[e+s]=t.array[i+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=_n()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=_n()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Di=new T;class Uh{constructor(e,t,i,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Di.fromBufferAttribute(this,t),Di.applyMatrix4(e),this.setXYZ(t,Di.x,Di.y,Di.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Di.fromBufferAttribute(this,t),Di.applyNormalMatrix(e),this.setXYZ(t,Di.x,Di.y,Di.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Di.fromBufferAttribute(this,t),Di.transformDirection(e),this.setXYZ(t,Di.x,Di.y,Di.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=mn(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Lt(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=Lt(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Lt(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Lt(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Lt(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=mn(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=mn(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=mn(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=mn(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Lt(t,this.array),i=Lt(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Lt(t,this.array),i=Lt(i,this.array),s=Lt(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this}setXYZW(e,t,i,s,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Lt(t,this.array),i=Lt(i,this.array),s=Lt(s,this.array),r=Lt(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return new ci(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Uh(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const Nd=new T,Od=new Ct,Ud=new Ct,Jb=new T,zd=new Je,Pa=new T,vc=new Bn,Vd=new Je,_c=new so;class Hp extends Ae{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=xu,this.bindMatrix=new Je,this.bindMatrixInverse=new Je,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new ft),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,Pa),this.boundingBox.expandByPoint(Pa)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Bn),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,Pa),this.boundingSphere.expandByPoint(Pa)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,s=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),vc.copy(this.boundingSphere),vc.applyMatrix4(s),e.ray.intersectsSphere(vc)!==!1&&(Vd.copy(s).invert(),_c.copy(e.ray).applyMatrix4(Vd),!(this.boundingBox!==null&&_c.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,_c)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Ct,t=this.geometry.attributes.skinWeight;for(let i=0,s=t.count;i<s;i++){e.fromBufferAttribute(t,i);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===xu?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===n0?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,s=this.geometry;Od.fromBufferAttribute(s.attributes.skinIndex,e),Ud.fromBufferAttribute(s.attributes.skinWeight,e),Nd.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const o=Ud.getComponent(r);if(o!==0){const l=Od.getComponent(r);zd.multiplyMatrices(i.bones[l].matrixWorld,i.boneInverses[l]),t.addScaledVector(Jb.copy(Nd).applyMatrix4(zd),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}class pl extends je{constructor(){super(),this.isBone=!0,this.type="Bone"}}class zh extends Ht{constructor(e=null,t=1,i=1,s,r,o,l,h,d=li,f=li,c,u){super(null,o,l,h,d,f,s,r,c,u),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Hd=new Je,ew=new Je;class Ll{constructor(e=[],t=[]){this.uuid=_n(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,s=this.bones.length;i<s;i++)this.boneInverses.push(new Je)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new Je;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,s=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const l=e[r]?e[r].matrixWorld:ew;Hd.multiplyMatrices(l,t[r]),Hd.toArray(i,r*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new Ll(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new zh(t,e,e,vn,Cn);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,s=e.bones.length;i<s;i++){const r=e.bones[i];let o=t[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new pl),this.bones.push(o),this.boneInverses.push(new Je().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let s=0,r=t.length;s<r;s++){const o=t[s];e.bones.push(o.uuid);const l=i[s];e.boneInverses.push(l.toArray())}return e}}class eh extends ci{constructor(e,t,i,s=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Sr=new Je,Gd=new Je,Ia=[],Wd=new ft,tw=new Je,fo=new Ae,po=new Bn;class iw extends Ae{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new eh(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<i;s++)this.setMatrixAt(s,tw)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new ft),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Sr),Wd.copy(e.boundingBox).applyMatrix4(Sr),this.boundingBox.union(Wd)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Bn),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Sr),po.copy(e.boundingSphere).applyMatrix4(Sr),this.boundingSphere.union(po)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const i=t.morphTargetInfluences,s=this.morphTexture.source.data.data,r=i.length+1,o=e*r+1;for(let l=0;l<i.length;l++)i[l]=s[o+l]}raycast(e,t){const i=this.matrixWorld,s=this.count;if(fo.geometry=this.geometry,fo.material=this.material,fo.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),po.copy(this.boundingSphere),po.applyMatrix4(i),e.ray.intersectsSphere(po)!==!1))for(let r=0;r<s;r++){this.getMatrixAt(r,Sr),Gd.multiplyMatrices(i,Sr),fo.matrixWorld=Gd,fo.raycast(e,Ia);for(let o=0,l=Ia.length;o<l;o++){const h=Ia[o];h.instanceId=r,h.object=this,t.push(h)}Ia.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new eh(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const i=t.morphTargetInfluences,s=i.length+1;this.morphTexture===null&&(this.morphTexture=new zh(new Float32Array(s*this.count),s,this.count,yp,Cn));const r=this.morphTexture.source.data.data;let o=0;for(let d=0;d<i.length;d++)o+=i[d];const l=this.geometry.morphTargetsRelative?1:1-o,h=s*e;r[h]=l,r.set(i,h+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class tr extends Qi{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Le(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const ml=new T,gl=new T,Xd=new Je,mo=new so,La=new Bn,yc=new T,jd=new T;class qi extends je{constructor(e=new Bt,t=new tr){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let s=1,r=t.count;s<r;s++)ml.fromBufferAttribute(t,s-1),gl.fromBufferAttribute(t,s),i[s]=i[s-1],i[s]+=ml.distanceTo(gl);e.setAttribute("lineDistance",new yt(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,r=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),La.copy(i.boundingSphere),La.applyMatrix4(s),La.radius+=r,e.ray.intersectsSphere(La)===!1)return;Xd.copy(s).invert(),mo.copy(e.ray).applyMatrix4(Xd);const l=r/((this.scale.x+this.scale.y+this.scale.z)/3),h=l*l,d=this.isLineSegments?2:1,f=i.index,u=i.attributes.position;if(f!==null){const p=Math.max(0,o.start),m=Math.min(f.count,o.start+o.count);for(let _=p,g=m-1;_<g;_+=d){const v=f.getX(_),y=f.getX(_+1),x=Fa(this,e,mo,h,v,y);x&&t.push(x)}if(this.isLineLoop){const _=f.getX(m-1),g=f.getX(p),v=Fa(this,e,mo,h,_,g);v&&t.push(v)}}else{const p=Math.max(0,o.start),m=Math.min(u.count,o.start+o.count);for(let _=p,g=m-1;_<g;_+=d){const v=Fa(this,e,mo,h,_,_+1);v&&t.push(v)}if(this.isLineLoop){const _=Fa(this,e,mo,h,m-1,p);_&&t.push(_)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const l=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=r}}}}}function Fa(a,e,t,i,s,r){const o=a.geometry.attributes.position;if(ml.fromBufferAttribute(o,s),gl.fromBufferAttribute(o,r),t.distanceSqToSegment(ml,gl,yc,jd)>i)return;yc.applyMatrix4(a.matrixWorld);const h=e.ray.origin.distanceTo(yc);if(!(h<e.near||h>e.far))return{distance:h,point:jd.clone().applyMatrix4(a.matrixWorld),index:s,face:null,faceIndex:null,object:a}}const Yd=new T,qd=new T;class Vh extends qi{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let s=0,r=t.count;s<r;s+=2)Yd.fromBufferAttribute(t,s),qd.fromBufferAttribute(t,s+1),i[s]=s===0?0:i[s-1],i[s+1]=i[s]+Yd.distanceTo(qd);e.setAttribute("lineDistance",new yt(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class nw extends qi{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class Gp extends Qi{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Le(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const $d=new Je,th=new so,Ba=new Bn,Da=new T;class sw extends je{constructor(e=new Bt,t=new Gp){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,r=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Ba.copy(i.boundingSphere),Ba.applyMatrix4(s),Ba.radius+=r,e.ray.intersectsSphere(Ba)===!1)return;$d.copy(s).invert(),th.copy(e.ray).applyMatrix4($d);const l=r/((this.scale.x+this.scale.y+this.scale.z)/3),h=l*l,d=i.index,c=i.attributes.position;if(d!==null){const u=Math.max(0,o.start),p=Math.min(d.count,o.start+o.count);for(let m=u,_=p;m<_;m++){const g=d.getX(m);Da.fromBufferAttribute(c,g),Zd(Da,g,h,s,e,t,this)}}else{const u=Math.max(0,o.start),p=Math.min(c.count,o.start+o.count);for(let m=u,_=p;m<_;m++)Da.fromBufferAttribute(c,m),Zd(Da,m,h,s,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const l=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=r}}}}}function Zd(a,e,t,i,s,r,o){const l=th.distanceSqToPoint(a);if(l<t){const h=new T;th.closestPointToPoint(a,h),h.applyMatrix4(i);const d=s.ray.origin.distanceTo(h);if(d<s.near||d>s.far)return;r.push({distance:d,distanceToRay:Math.sqrt(l),point:h,index:e,face:null,object:o})}}class Kd extends Ht{constructor(e,t,i,s,r,o,l,h,d){super(e,t,i,s,r,o,l,h,d),this.isCanvasTexture=!0,this.needsUpdate=!0}}class rw{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,s=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),r+=i.distanceTo(s),t.push(r),s=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let s=0;const r=i.length;let o;t?o=t:o=e*i[r-1];let l=0,h=r-1,d;for(;l<=h;)if(s=Math.floor(l+(h-l)/2),d=i[s]-o,d<0)l=s+1;else if(d>0)h=s-1;else{h=s;break}if(s=h,i[s]===o)return s/(r-1);const f=i[s],u=i[s+1]-f,p=(o-f)/u;return(s+p)/(r-1)}getTangent(e,t){let s=e-1e-4,r=e+1e-4;s<0&&(s=0),r>1&&(r=1);const o=this.getPoint(s),l=this.getPoint(r),h=t||(o.isVector2?new Oe:new T);return h.copy(l).sub(o).normalize(),h}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new T,s=[],r=[],o=[],l=new T,h=new Je;for(let p=0;p<=e;p++){const m=p/e;s[p]=this.getTangentAt(m,new T)}r[0]=new T,o[0]=new T;let d=Number.MAX_VALUE;const f=Math.abs(s[0].x),c=Math.abs(s[0].y),u=Math.abs(s[0].z);f<=d&&(d=f,i.set(1,0,0)),c<=d&&(d=c,i.set(0,1,0)),u<=d&&i.set(0,0,1),l.crossVectors(s[0],i).normalize(),r[0].crossVectors(s[0],l),o[0].crossVectors(s[0],r[0]);for(let p=1;p<=e;p++){if(r[p]=r[p-1].clone(),o[p]=o[p-1].clone(),l.crossVectors(s[p-1],s[p]),l.length()>Number.EPSILON){l.normalize();const m=Math.acos(di(s[p-1].dot(s[p]),-1,1));r[p].applyMatrix4(h.makeRotationAxis(l,m))}o[p].crossVectors(s[p],r[p])}if(t===!0){let p=Math.acos(di(r[0].dot(r[e]),-1,1));p/=e,s[0].dot(l.crossVectors(r[0],r[e]))>0&&(p=-p);for(let m=1;m<=e;m++)r[m].applyMatrix4(h.makeRotationAxis(s[m],p*m)),o[m].crossVectors(s[m],r[m])}return{tangents:s,normals:r,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class oi extends Bt{constructor(e=1,t=1,i=1,s=32,r=1,o=!1,l=0,h=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:s,heightSegments:r,openEnded:o,thetaStart:l,thetaLength:h};const d=this;s=Math.floor(s),r=Math.floor(r);const f=[],c=[],u=[],p=[];let m=0;const _=[],g=i/2;let v=0;y(),o===!1&&(e>0&&x(!0),t>0&&x(!1)),this.setIndex(f),this.setAttribute("position",new yt(c,3)),this.setAttribute("normal",new yt(u,3)),this.setAttribute("uv",new yt(p,2));function y(){const b=new T,S=new T;let A=0;const E=(t-e)/i;for(let R=0;R<=r;R++){const M=[],w=R/r,L=w*(t-e)+e;for(let N=0;N<=s;N++){const B=N/s,G=B*h+l,W=Math.sin(G),ee=Math.cos(G);S.x=L*W,S.y=-w*i+g,S.z=L*ee,c.push(S.x,S.y,S.z),b.set(W,E,ee).normalize(),u.push(b.x,b.y,b.z),p.push(B,1-w),M.push(m++)}_.push(M)}for(let R=0;R<s;R++)for(let M=0;M<r;M++){const w=_[M][R],L=_[M+1][R],N=_[M+1][R+1],B=_[M][R+1];f.push(w,L,B),f.push(L,N,B),A+=6}d.addGroup(v,A,0),v+=A}function x(b){const S=m,A=new Oe,E=new T;let R=0;const M=b===!0?e:t,w=b===!0?1:-1;for(let N=1;N<=s;N++)c.push(0,g*w,0),u.push(0,w,0),p.push(.5,.5),m++;const L=m;for(let N=0;N<=s;N++){const G=N/s*h+l,W=Math.cos(G),ee=Math.sin(G);E.x=M*ee,E.y=g*w,E.z=M*W,c.push(E.x,E.y,E.z),u.push(0,w,0),A.x=W*.5+.5,A.y=ee*.5*w+.5,p.push(A.x,A.y),m++}for(let N=0;N<s;N++){const B=S+N,G=L+N;b===!0?f.push(G,G+1,B):f.push(G+1,G,B),R+=3}d.addGroup(v,R,b===!0?1:2),v+=R}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new oi(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class vl extends oi{constructor(e=1,t=1,i=32,s=1,r=!1,o=0,l=Math.PI*2){super(0,e,t,i,s,r,o,l),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:s,openEnded:r,thetaStart:o,thetaLength:l}}static fromJSON(e){return new vl(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Hh extends Bt{constructor(e=[],t=[],i=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:s};const r=[],o=[];l(s),d(i),f(),this.setAttribute("position",new yt(r,3)),this.setAttribute("normal",new yt(r.slice(),3)),this.setAttribute("uv",new yt(o,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function l(y){const x=new T,b=new T,S=new T;for(let A=0;A<t.length;A+=3)p(t[A+0],x),p(t[A+1],b),p(t[A+2],S),h(x,b,S,y)}function h(y,x,b,S){const A=S+1,E=[];for(let R=0;R<=A;R++){E[R]=[];const M=y.clone().lerp(b,R/A),w=x.clone().lerp(b,R/A),L=A-R;for(let N=0;N<=L;N++)N===0&&R===A?E[R][N]=M:E[R][N]=M.clone().lerp(w,N/L)}for(let R=0;R<A;R++)for(let M=0;M<2*(A-R)-1;M++){const w=Math.floor(M/2);M%2===0?(u(E[R][w+1]),u(E[R+1][w]),u(E[R][w])):(u(E[R][w+1]),u(E[R+1][w+1]),u(E[R+1][w]))}}function d(y){const x=new T;for(let b=0;b<r.length;b+=3)x.x=r[b+0],x.y=r[b+1],x.z=r[b+2],x.normalize().multiplyScalar(y),r[b+0]=x.x,r[b+1]=x.y,r[b+2]=x.z}function f(){const y=new T;for(let x=0;x<r.length;x+=3){y.x=r[x+0],y.y=r[x+1],y.z=r[x+2];const b=g(y)/2/Math.PI+.5,S=v(y)/Math.PI+.5;o.push(b,1-S)}m(),c()}function c(){for(let y=0;y<o.length;y+=6){const x=o[y+0],b=o[y+2],S=o[y+4],A=Math.max(x,b,S),E=Math.min(x,b,S);A>.9&&E<.1&&(x<.2&&(o[y+0]+=1),b<.2&&(o[y+2]+=1),S<.2&&(o[y+4]+=1))}}function u(y){r.push(y.x,y.y,y.z)}function p(y,x){const b=y*3;x.x=e[b+0],x.y=e[b+1],x.z=e[b+2]}function m(){const y=new T,x=new T,b=new T,S=new T,A=new Oe,E=new Oe,R=new Oe;for(let M=0,w=0;M<r.length;M+=9,w+=6){y.set(r[M+0],r[M+1],r[M+2]),x.set(r[M+3],r[M+4],r[M+5]),b.set(r[M+6],r[M+7],r[M+8]),A.set(o[w+0],o[w+1]),E.set(o[w+2],o[w+3]),R.set(o[w+4],o[w+5]),S.copy(y).add(x).add(b).divideScalar(3);const L=g(S);_(A,w+0,y,L),_(E,w+2,x,L),_(R,w+4,b,L)}}function _(y,x,b,S){S<0&&y.x===1&&(o[x]=y.x-1),b.x===0&&b.z===0&&(o[x]=S/2/Math.PI+.5)}function g(y){return Math.atan2(y.z,-y.x)}function v(y){return Math.atan2(-y.y,Math.sqrt(y.x*y.x+y.z*y.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Hh(e.vertices,e.indices,e.radius,e.details)}}const ka=new T,Na=new T,xc=new T,Oa=new gn;class ow extends Bt{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const s=Math.pow(10,4),r=Math.cos(zr*t),o=e.getIndex(),l=e.getAttribute("position"),h=o?o.count:l.count,d=[0,0,0],f=["a","b","c"],c=new Array(3),u={},p=[];for(let m=0;m<h;m+=3){o?(d[0]=o.getX(m),d[1]=o.getX(m+1),d[2]=o.getX(m+2)):(d[0]=m,d[1]=m+1,d[2]=m+2);const{a:_,b:g,c:v}=Oa;if(_.fromBufferAttribute(l,d[0]),g.fromBufferAttribute(l,d[1]),v.fromBufferAttribute(l,d[2]),Oa.getNormal(xc),c[0]=`${Math.round(_.x*s)},${Math.round(_.y*s)},${Math.round(_.z*s)}`,c[1]=`${Math.round(g.x*s)},${Math.round(g.y*s)},${Math.round(g.z*s)}`,c[2]=`${Math.round(v.x*s)},${Math.round(v.y*s)},${Math.round(v.z*s)}`,!(c[0]===c[1]||c[1]===c[2]||c[2]===c[0]))for(let y=0;y<3;y++){const x=(y+1)%3,b=c[y],S=c[x],A=Oa[f[y]],E=Oa[f[x]],R=`${b}_${S}`,M=`${S}_${b}`;M in u&&u[M]?(xc.dot(u[M].normal)<=r&&(p.push(A.x,A.y,A.z),p.push(E.x,E.y,E.z)),u[M]=null):R in u||(u[R]={index0:d[y],index1:d[x],normal:xc.clone()})}}for(const m in u)if(u[m]){const{index0:_,index1:g}=u[m];ka.fromBufferAttribute(l,_),Na.fromBufferAttribute(l,g),p.push(ka.x,ka.y,ka.z),p.push(Na.x,Na.y,Na.z)}this.setAttribute("position",new yt(p,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}const aw={triangulate:function(a,e,t=2){const i=e&&e.length,s=i?e[0]*t:a.length;let r=Wp(a,0,s,t,!0);const o=[];if(!r||r.next===r.prev)return o;let l,h,d,f,c,u,p;if(i&&(r=dw(a,e,r,t)),a.length>80*t){l=d=a[0],h=f=a[1];for(let m=t;m<s;m+=t)c=a[m],u=a[m+1],c<l&&(l=c),u<h&&(h=u),c>d&&(d=c),u>f&&(f=u);p=Math.max(d-l,f-h),p=p!==0?32767/p:0}return Vo(r,o,t,l,h,p,0),o}};function Wp(a,e,t,i,s){let r,o;if(s===Mw(a,e,t,i)>0)for(r=e;r<t;r+=i)o=Qd(r,a[r],a[r+1],o);else for(r=t-i;r>=e;r-=i)o=Qd(r,a[r],a[r+1],o);return o&&Fl(o,o.next)&&(Go(o),o=o.next),o}function Zs(a,e){if(!a)return a;e||(e=a);let t=a,i;do if(i=!1,!t.steiner&&(Fl(t,t.next)||Zt(t.prev,t,t.next)===0)){if(Go(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Vo(a,e,t,i,s,r,o){if(!a)return;!o&&r&&vw(a,i,s,r);let l=a,h,d;for(;a.prev!==a.next;){if(h=a.prev,d=a.next,r?cw(a,i,s,r):lw(a)){e.push(h.i/t|0),e.push(a.i/t|0),e.push(d.i/t|0),Go(a),a=d.next,l=d.next;continue}if(a=d,a===l){o?o===1?(a=hw(Zs(a),e,t),Vo(a,e,t,i,s,r,2)):o===2&&uw(a,e,t,i,s,r):Vo(Zs(a),e,t,i,s,r,1);break}}}function lw(a){const e=a.prev,t=a,i=a.next;if(Zt(e,t,i)>=0)return!1;const s=e.x,r=t.x,o=i.x,l=e.y,h=t.y,d=i.y,f=s<r?s<o?s:o:r<o?r:o,c=l<h?l<d?l:d:h<d?h:d,u=s>r?s>o?s:o:r>o?r:o,p=l>h?l>d?l:d:h>d?h:d;let m=i.next;for(;m!==e;){if(m.x>=f&&m.x<=u&&m.y>=c&&m.y<=p&&Lr(s,l,r,h,o,d,m.x,m.y)&&Zt(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function cw(a,e,t,i){const s=a.prev,r=a,o=a.next;if(Zt(s,r,o)>=0)return!1;const l=s.x,h=r.x,d=o.x,f=s.y,c=r.y,u=o.y,p=l<h?l<d?l:d:h<d?h:d,m=f<c?f<u?f:u:c<u?c:u,_=l>h?l>d?l:d:h>d?h:d,g=f>c?f>u?f:u:c>u?c:u,v=ih(p,m,e,t,i),y=ih(_,g,e,t,i);let x=a.prevZ,b=a.nextZ;for(;x&&x.z>=v&&b&&b.z<=y;){if(x.x>=p&&x.x<=_&&x.y>=m&&x.y<=g&&x!==s&&x!==o&&Lr(l,f,h,c,d,u,x.x,x.y)&&Zt(x.prev,x,x.next)>=0||(x=x.prevZ,b.x>=p&&b.x<=_&&b.y>=m&&b.y<=g&&b!==s&&b!==o&&Lr(l,f,h,c,d,u,b.x,b.y)&&Zt(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;x&&x.z>=v;){if(x.x>=p&&x.x<=_&&x.y>=m&&x.y<=g&&x!==s&&x!==o&&Lr(l,f,h,c,d,u,x.x,x.y)&&Zt(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=y;){if(b.x>=p&&b.x<=_&&b.y>=m&&b.y<=g&&b!==s&&b!==o&&Lr(l,f,h,c,d,u,b.x,b.y)&&Zt(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function hw(a,e,t){let i=a;do{const s=i.prev,r=i.next.next;!Fl(s,r)&&Xp(s,i,i.next,r)&&Ho(s,r)&&Ho(r,s)&&(e.push(s.i/t|0),e.push(i.i/t|0),e.push(r.i/t|0),Go(i),Go(i.next),i=a=r),i=i.next}while(i!==a);return Zs(i)}function uw(a,e,t,i,s,r){let o=a;do{let l=o.next.next;for(;l!==o.prev;){if(o.i!==l.i&&xw(o,l)){let h=jp(o,l);o=Zs(o,o.next),h=Zs(h,h.next),Vo(o,e,t,i,s,r,0),Vo(h,e,t,i,s,r,0);return}l=l.next}o=o.next}while(o!==a)}function dw(a,e,t,i){const s=[];let r,o,l,h,d;for(r=0,o=e.length;r<o;r++)l=e[r]*i,h=r<o-1?e[r+1]*i:a.length,d=Wp(a,l,h,i,!1),d===d.next&&(d.steiner=!0),s.push(yw(d));for(s.sort(fw),r=0;r<s.length;r++)t=pw(s[r],t);return t}function fw(a,e){return a.x-e.x}function pw(a,e){const t=mw(a,e);if(!t)return e;const i=jp(t,a);return Zs(i,i.next),Zs(t,t.next)}function mw(a,e){let t=e,i=-1/0,s;const r=a.x,o=a.y;do{if(o<=t.y&&o>=t.next.y&&t.next.y!==t.y){const u=t.x+(o-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(u<=r&&u>i&&(i=u,s=t.x<t.next.x?t:t.next,u===r))return s}t=t.next}while(t!==e);if(!s)return null;const l=s,h=s.x,d=s.y;let f=1/0,c;t=s;do r>=t.x&&t.x>=h&&r!==t.x&&Lr(o<d?r:i,o,h,d,o<d?i:r,o,t.x,t.y)&&(c=Math.abs(o-t.y)/(r-t.x),Ho(t,a)&&(c<f||c===f&&(t.x>s.x||t.x===s.x&&gw(s,t)))&&(s=t,f=c)),t=t.next;while(t!==l);return s}function gw(a,e){return Zt(a.prev,a,e.prev)<0&&Zt(e.next,a,a.next)<0}function vw(a,e,t,i){let s=a;do s.z===0&&(s.z=ih(s.x,s.y,e,t,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==a);s.prevZ.nextZ=null,s.prevZ=null,_w(s)}function _w(a){let e,t,i,s,r,o,l,h,d=1;do{for(t=a,a=null,r=null,o=0;t;){for(o++,i=t,l=0,e=0;e<d&&(l++,i=i.nextZ,!!i);e++);for(h=d;l>0||h>0&&i;)l!==0&&(h===0||!i||t.z<=i.z)?(s=t,t=t.nextZ,l--):(s=i,i=i.nextZ,h--),r?r.nextZ=s:a=s,s.prevZ=r,r=s;t=i}r.nextZ=null,d*=2}while(o>1);return a}function ih(a,e,t,i,s){return a=(a-t)*s|0,e=(e-i)*s|0,a=(a|a<<8)&16711935,a=(a|a<<4)&252645135,a=(a|a<<2)&858993459,a=(a|a<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,a|e<<1}function yw(a){let e=a,t=a;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==a);return t}function Lr(a,e,t,i,s,r,o,l){return(s-o)*(e-l)>=(a-o)*(r-l)&&(a-o)*(i-l)>=(t-o)*(e-l)&&(t-o)*(r-l)>=(s-o)*(i-l)}function xw(a,e){return a.next.i!==e.i&&a.prev.i!==e.i&&!bw(a,e)&&(Ho(a,e)&&Ho(e,a)&&ww(a,e)&&(Zt(a.prev,a,e.prev)||Zt(a,e.prev,e))||Fl(a,e)&&Zt(a.prev,a,a.next)>0&&Zt(e.prev,e,e.next)>0)}function Zt(a,e,t){return(e.y-a.y)*(t.x-e.x)-(e.x-a.x)*(t.y-e.y)}function Fl(a,e){return a.x===e.x&&a.y===e.y}function Xp(a,e,t,i){const s=za(Zt(a,e,t)),r=za(Zt(a,e,i)),o=za(Zt(t,i,a)),l=za(Zt(t,i,e));return!!(s!==r&&o!==l||s===0&&Ua(a,t,e)||r===0&&Ua(a,i,e)||o===0&&Ua(t,a,i)||l===0&&Ua(t,e,i))}function Ua(a,e,t){return e.x<=Math.max(a.x,t.x)&&e.x>=Math.min(a.x,t.x)&&e.y<=Math.max(a.y,t.y)&&e.y>=Math.min(a.y,t.y)}function za(a){return a>0?1:a<0?-1:0}function bw(a,e){let t=a;do{if(t.i!==a.i&&t.next.i!==a.i&&t.i!==e.i&&t.next.i!==e.i&&Xp(t,t.next,a,e))return!0;t=t.next}while(t!==a);return!1}function Ho(a,e){return Zt(a.prev,a,a.next)<0?Zt(a,e,a.next)>=0&&Zt(a,a.prev,e)>=0:Zt(a,e,a.prev)<0||Zt(a,a.next,e)<0}function ww(a,e){let t=a,i=!1;const s=(a.x+e.x)/2,r=(a.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&s<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==a);return i}function jp(a,e){const t=new nh(a.i,a.x,a.y),i=new nh(e.i,e.x,e.y),s=a.next,r=e.prev;return a.next=e,e.prev=a,t.next=s,s.prev=t,i.next=t,t.prev=i,r.next=i,i.prev=r,i}function Qd(a,e,t,i){const s=new nh(a,e,t);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function Go(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function nh(a,e,t){this.i=a,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Mw(a,e,t,i){let s=0;for(let r=e,o=t-i;r<t;r+=i)s+=(a[o]-a[r])*(a[r+1]+a[o+1]),o=r;return s}class Gh{static area(e){const t=e.length;let i=0;for(let s=t-1,r=0;r<t;s=r++)i+=e[s].x*e[r].y-e[r].x*e[s].y;return i*.5}static isClockWise(e){return Gh.area(e)<0}static triangulateShape(e,t){const i=[],s=[],r=[];Jd(e),ef(i,e);let o=e.length;t.forEach(Jd);for(let h=0;h<t.length;h++)s.push(o),o+=t[h].length,ef(i,t[h]);const l=aw.triangulate(i,s);for(let h=0;h<l.length;h+=3)r.push(l.slice(h,h+3));return r}}function Jd(a){const e=a.length;e>2&&a[e-1].equals(a[0])&&a.pop()}function ef(a,e){for(let t=0;t<e.length;t++)a.push(e[t].x),a.push(e[t].y)}class Fr extends Hh{constructor(e=1,t=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],s=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,s,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Fr(e.radius,e.detail)}}class na extends Bt{constructor(e=1,t=32,i=16,s=0,r=Math.PI*2,o=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:s,phiLength:r,thetaStart:o,thetaLength:l},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const h=Math.min(o+l,Math.PI);let d=0;const f=[],c=new T,u=new T,p=[],m=[],_=[],g=[];for(let v=0;v<=i;v++){const y=[],x=v/i;let b=0;v===0&&o===0?b=.5/t:v===i&&h===Math.PI&&(b=-.5/t);for(let S=0;S<=t;S++){const A=S/t;c.x=-e*Math.cos(s+A*r)*Math.sin(o+x*l),c.y=e*Math.cos(o+x*l),c.z=e*Math.sin(s+A*r)*Math.sin(o+x*l),m.push(c.x,c.y,c.z),u.copy(c).normalize(),_.push(u.x,u.y,u.z),g.push(A+b,1-x),y.push(d++)}f.push(y)}for(let v=0;v<i;v++)for(let y=0;y<t;y++){const x=f[v][y+1],b=f[v][y],S=f[v+1][y],A=f[v+1][y+1];(v!==0||o>0)&&p.push(x,b,A),(v!==i-1||h<Math.PI)&&p.push(b,S,A)}this.setIndex(p),this.setAttribute("position",new yt(m,3)),this.setAttribute("normal",new yt(_,3)),this.setAttribute("uv",new yt(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new na(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Ws extends Bt{constructor(e=1,t=.4,i=12,s=48,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:s,arc:r},i=Math.floor(i),s=Math.floor(s);const o=[],l=[],h=[],d=[],f=new T,c=new T,u=new T;for(let p=0;p<=i;p++)for(let m=0;m<=s;m++){const _=m/s*r,g=p/i*Math.PI*2;c.x=(e+t*Math.cos(g))*Math.cos(_),c.y=(e+t*Math.cos(g))*Math.sin(_),c.z=t*Math.sin(g),l.push(c.x,c.y,c.z),f.x=e*Math.cos(_),f.y=e*Math.sin(_),u.subVectors(c,f).normalize(),h.push(u.x,u.y,u.z),d.push(m/s),d.push(p/i)}for(let p=1;p<=i;p++)for(let m=1;m<=s;m++){const _=(s+1)*p+m-1,g=(s+1)*(p-1)+m-1,v=(s+1)*(p-1)+m,y=(s+1)*p+m;o.push(_,g,y),o.push(g,v,y)}this.setIndex(o),this.setAttribute("position",new yt(l,3)),this.setAttribute("normal",new yt(h,3)),this.setAttribute("uv",new yt(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ws(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Ei extends Qi{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Le(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Le(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ta,this.normalScale=new Oe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new At,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Dn extends Ei{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Oe(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return di(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Le(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Le(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Le(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class bc extends Qi{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Le(16777215),this.specular=new Le(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Le(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ta,this.normalScale=new Oe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new At,this.combine=Cl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class el extends Qi{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ta,this.normalScale=new Oe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class Sw extends Qi{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Le(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Le(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ta,this.normalScale=new Oe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new At,this.combine=Cl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}function Va(a,e,t){return!a||!t&&a.constructor===e?a:typeof e.BYTES_PER_ELEMENT=="number"?new e(a):Array.prototype.slice.call(a)}function Aw(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)}function Ew(a){function e(s,r){return a[s]-a[r]}const t=a.length,i=new Array(t);for(let s=0;s!==t;++s)i[s]=s;return i.sort(e),i}function tf(a,e,t){const i=a.length,s=new a.constructor(i);for(let r=0,o=0;o!==i;++r){const l=t[r]*e;for(let h=0;h!==e;++h)s[o++]=a[l+h]}return s}function Yp(a,e,t,i){let s=1,r=a[0];for(;r!==void 0&&r[i]===void 0;)r=a[s++];if(r===void 0)return;let o=r[i];if(o!==void 0)if(Array.isArray(o))do o=r[i],o!==void 0&&(e.push(r.time),t.push.apply(t,o)),r=a[s++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[i],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=a[s++];while(r!==void 0);else do o=r[i],o!==void 0&&(e.push(r.time),t.push(o)),r=a[s++];while(r!==void 0)}class sa{constructor(e,t,i,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,s=t[i],r=t[i-1];e:{t:{let o;i:{n:if(!(e<s)){for(let l=i+2;;){if(s===void 0){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===l)break;if(r=s,s=t[++i],e<s)break t}o=t.length;break i}if(!(e>=r)){const l=t[1];e<l&&(i=2,r=l);for(let h=i-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===h)break;if(s=r,r=t[--i-1],e>=r)break t}o=i,i=0;break i}break e}for(;i<o;){const l=i+o>>>1;e<t[l]?o=l:i=l+1}if(s=t[i],r=t[i-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,s)}return this.interpolate_(i,r,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=e*s;for(let o=0;o!==s;++o)t[o]=i[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Tw extends sa{constructor(e,t,i,s){super(e,t,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Rr,endingEnd:Rr}}intervalChanged_(e,t,i){const s=this.parameterPositions;let r=e-2,o=e+1,l=s[r],h=s[o];if(l===void 0)switch(this.getSettings_().endingStart){case Pr:r=e,l=2*t-i;break;case cl:r=s.length-2,l=t+s[r]-s[r+1];break;default:r=e,l=i}if(h===void 0)switch(this.getSettings_().endingEnd){case Pr:o=e,h=2*i-t;break;case cl:o=1,h=i+s[1]-s[0];break;default:o=e-1,h=t}const d=(i-t)*.5,f=this.valueSize;this._weightPrev=d/(t-l),this._weightNext=d/(h-i),this._offsetPrev=r*f,this._offsetNext=o*f}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,l=this.valueSize,h=e*l,d=h-l,f=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,p=this._weightNext,m=(i-t)/(s-t),_=m*m,g=_*m,v=-u*g+2*u*_-u*m,y=(1+u)*g+(-1.5-2*u)*_+(-.5+u)*m+1,x=(-1-p)*g+(1.5+p)*_+.5*m,b=p*g-p*_;for(let S=0;S!==l;++S)r[S]=v*o[f+S]+y*o[d+S]+x*o[h+S]+b*o[c+S];return r}}class qp extends sa{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,l=this.valueSize,h=e*l,d=h-l,f=(i-t)/(s-t),c=1-f;for(let u=0;u!==l;++u)r[u]=o[d+u]*c+o[h+u]*f;return r}}class Cw extends sa{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class kn{constructor(e,t,i,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Va(t,this.TimeBufferType),this.values=Va(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Va(e.times,Array),values:Va(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(i.interpolation=s)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new Cw(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new qp(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Tw(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Uo:t=this.InterpolantFactoryMethodDiscrete;break;case Zr:t=this.InterpolantFactoryMethodLinear;break;case Xl:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Uo;case this.InterpolantFactoryMethodLinear:return Zr;case this.InterpolantFactoryMethodSmooth:return Xl}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]*=e}return this}trim(e,t){const i=this.times,s=i.length;let r=0,o=s-1;for(;r!==s&&i[r]<e;)++r;for(;o!==-1&&i[o]>t;)--o;if(++o,r!==0||o!==s){r>=o&&(o=Math.max(o,1),r=o-1);const l=this.getValueSize();this.times=i.slice(r,o),this.values=this.values.slice(r*l,o*l)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,s=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let l=0;l!==r;l++){const h=i[l];if(typeof h=="number"&&isNaN(h)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,l,h),e=!1;break}if(o!==null&&o>h){console.error("THREE.KeyframeTrack: Out of order keys.",this,l,h,o),e=!1;break}o=h}if(s!==void 0&&Aw(s))for(let l=0,h=s.length;l!==h;++l){const d=s[l];if(isNaN(d)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,l,d),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),s=this.getInterpolation()===Xl,r=e.length-1;let o=1;for(let l=1;l<r;++l){let h=!1;const d=e[l],f=e[l+1];if(d!==f&&(l!==1||d!==e[0]))if(s)h=!0;else{const c=l*i,u=c-i,p=c+i;for(let m=0;m!==i;++m){const _=t[c+m];if(_!==t[u+m]||_!==t[p+m]){h=!0;break}}}if(h){if(l!==o){e[o]=e[l];const c=l*i,u=o*i;for(let p=0;p!==i;++p)t[u+p]=t[c+p]}++o}}if(r>0){e[o]=e[r];for(let l=r*i,h=o*i,d=0;d!==i;++d)t[h+d]=t[l+d];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=this.constructor,s=new i(this.name,e,t);return s.createInterpolant=this.createInterpolant,s}}kn.prototype.TimeBufferType=Float32Array;kn.prototype.ValueBufferType=Float32Array;kn.prototype.DefaultInterpolation=Zr;class oo extends kn{}oo.prototype.ValueTypeName="bool";oo.prototype.ValueBufferType=Array;oo.prototype.DefaultInterpolation=Uo;oo.prototype.InterpolantFactoryMethodLinear=void 0;oo.prototype.InterpolantFactoryMethodSmooth=void 0;class $p extends kn{}$p.prototype.ValueTypeName="color";class Ks extends kn{}Ks.prototype.ValueTypeName="number";class Rw extends sa{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,l=this.valueSize,h=(i-t)/(s-t);let d=e*l;for(let f=d+l;d!==f;d+=4)Tt.slerpFlat(r,0,o,d-l,o,d,h);return r}}class Qn extends kn{InterpolantFactoryMethodLinear(e){return new Rw(this.times,this.values,this.getValueSize(),e)}}Qn.prototype.ValueTypeName="quaternion";Qn.prototype.DefaultInterpolation=Zr;Qn.prototype.InterpolantFactoryMethodSmooth=void 0;class ao extends kn{}ao.prototype.ValueTypeName="string";ao.prototype.ValueBufferType=Array;ao.prototype.DefaultInterpolation=Uo;ao.prototype.InterpolantFactoryMethodLinear=void 0;ao.prototype.InterpolantFactoryMethodSmooth=void 0;class Qs extends kn{}Qs.prototype.ValueTypeName="vector";class _l{constructor(e="",t=-1,i=[],s=Lh){this.name=e,this.tracks=i,this.duration=t,this.blendMode=s,this.uuid=_n(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,s=1/(e.fps||1);for(let o=0,l=i.length;o!==l;++o)t.push(Iw(i[o]).scale(s));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],i=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=i.length;r!==o;++r)t.push(kn.toJSON(i[r]));return s}static CreateFromMorphTargetSequence(e,t,i,s){const r=t.length,o=[];for(let l=0;l<r;l++){let h=[],d=[];h.push((l+r-1)%r,l,(l+1)%r),d.push(0,1,0);const f=Ew(h);h=tf(h,1,f),d=tf(d,1,f),!s&&h[0]===0&&(h.push(r),d.push(d[0])),o.push(new Ks(".morphTargetInfluences["+t[l].name+"]",h,d).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const s=e;i=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<i.length;s++)if(i[s].name===t)return i[s];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const s={},r=/^([\w-]*?)([\d]+)$/;for(let l=0,h=e.length;l<h;l++){const d=e[l],f=d.name.match(r);if(f&&f.length>1){const c=f[1];let u=s[c];u||(s[c]=u=[]),u.push(d)}}const o=[];for(const l in s)o.push(this.CreateFromMorphTargetSequence(l,s[l],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(c,u,p,m,_){if(p.length!==0){const g=[],v=[];Yp(p,g,v,m),g.length!==0&&_.push(new c(u,g,v))}},s=[],r=e.name||"default",o=e.fps||30,l=e.blendMode;let h=e.length||-1;const d=e.hierarchy||[];for(let c=0;c<d.length;c++){const u=d[c].keys;if(!(!u||u.length===0))if(u[0].morphTargets){const p={};let m;for(m=0;m<u.length;m++)if(u[m].morphTargets)for(let _=0;_<u[m].morphTargets.length;_++)p[u[m].morphTargets[_]]=-1;for(const _ in p){const g=[],v=[];for(let y=0;y!==u[m].morphTargets.length;++y){const x=u[m];g.push(x.time),v.push(x.morphTarget===_?1:0)}s.push(new Ks(".morphTargetInfluence["+_+"]",g,v))}h=p.length*o}else{const p=".bones["+t[c].name+"]";i(Qs,p+".position",u,"pos",s),i(Qn,p+".quaternion",u,"rot",s),i(Qs,p+".scale",u,"scl",s)}}return s.length===0?null:new this(r,h,s,l)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,s=e.length;i!==s;++i){const r=this.tracks[i];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Pw(a){switch(a.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ks;case"vector":case"vector2":case"vector3":case"vector4":return Qs;case"color":return $p;case"quaternion":return Qn;case"bool":case"boolean":return oo;case"string":return ao}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+a)}function Iw(a){if(a.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=Pw(a.type);if(a.times===void 0){const t=[],i=[];Yp(a.keys,t,i,"value"),a.times=t,a.values=i}return e.parse!==void 0?e.parse(a):new e(a.name,a.times,a.values,a.interpolation)}const fs={enabled:!1,files:{},add:function(a,e){this.enabled!==!1&&(this.files[a]=e)},get:function(a){if(this.enabled!==!1)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}};class Lw{constructor(e,t,i){const s=this;let r=!1,o=0,l=0,h;const d=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(f){l++,r===!1&&s.onStart!==void 0&&s.onStart(f,o,l),r=!0},this.itemEnd=function(f){o++,s.onProgress!==void 0&&s.onProgress(f,o,l),o===l&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(f){s.onError!==void 0&&s.onError(f)},this.resolveURL=function(f){return h?h(f):f},this.setURLModifier=function(f){return h=f,this},this.addHandler=function(f,c){return d.push(f,c),this},this.removeHandler=function(f){const c=d.indexOf(f);return c!==-1&&d.splice(c,2),this},this.getHandler=function(f){for(let c=0,u=d.length;c<u;c+=2){const p=d[c],m=d[c+1];if(p.global&&(p.lastIndex=0),p.test(f))return m}return null}}}const Fw=new Lw;class Ln{constructor(e){this.manager=e!==void 0?e:Fw,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(s,r){i.load(e,s,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Ln.DEFAULT_MATERIAL_NAME="__DEFAULT";const Gn={};class Bw extends Error{constructor(e,t){super(e),this.response=t}}class Wo extends Ln{constructor(e){super(e)}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=fs.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(Gn[e]!==void 0){Gn[e].push({onLoad:t,onProgress:i,onError:s});return}Gn[e]=[],Gn[e].push({onLoad:t,onProgress:i,onError:s});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),l=this.mimeType,h=this.responseType;fetch(o).then(d=>{if(d.status===200||d.status===0){if(d.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||d.body===void 0||d.body.getReader===void 0)return d;const f=Gn[e],c=d.body.getReader(),u=d.headers.get("X-File-Size")||d.headers.get("Content-Length"),p=u?parseInt(u):0,m=p!==0;let _=0;const g=new ReadableStream({start(v){y();function y(){c.read().then(({done:x,value:b})=>{if(x)v.close();else{_+=b.byteLength;const S=new ProgressEvent("progress",{lengthComputable:m,loaded:_,total:p});for(let A=0,E=f.length;A<E;A++){const R=f[A];R.onProgress&&R.onProgress(S)}v.enqueue(b),y()}})}}});return new Response(g)}else throw new Bw(`fetch for "${d.url}" responded with ${d.status}: ${d.statusText}`,d)}).then(d=>{switch(h){case"arraybuffer":return d.arrayBuffer();case"blob":return d.blob();case"document":return d.text().then(f=>new DOMParser().parseFromString(f,l));case"json":return d.json();default:if(l===void 0)return d.text();{const c=/charset="?([^;"\s]*)"?/i.exec(l),u=c&&c[1]?c[1].toLowerCase():void 0,p=new TextDecoder(u);return d.arrayBuffer().then(m=>p.decode(m))}}}).then(d=>{fs.add(e,d);const f=Gn[e];delete Gn[e];for(let c=0,u=f.length;c<u;c++){const p=f[c];p.onLoad&&p.onLoad(d)}}).catch(d=>{const f=Gn[e];if(f===void 0)throw this.manager.itemError(e),d;delete Gn[e];for(let c=0,u=f.length;c<u;c++){const p=f[c];p.onError&&p.onError(d)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Dw extends Ln{constructor(e){super(e)}load(e,t,i,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=fs.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const l=zo("img");function h(){f(),fs.add(e,this),t&&t(this),r.manager.itemEnd(e)}function d(c){f(),s&&s(c),r.manager.itemError(e),r.manager.itemEnd(e)}function f(){l.removeEventListener("load",h,!1),l.removeEventListener("error",d,!1)}return l.addEventListener("load",h,!1),l.addEventListener("error",d,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),r.manager.itemStart(e),l.src=e,l}}class Wh extends Ln{constructor(e){super(e)}load(e,t,i,s){const r=new Ht,o=new Dw(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(l){r.image=l,r.needsUpdate=!0,t!==void 0&&t(r)},i,s),r}}class Bl extends je{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Le(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}const wc=new Je,nf=new T,sf=new T;class Xh{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Oe(512,512),this.map=null,this.mapPass=null,this.matrix=new Je,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Nh,this._frameExtents=new Oe(1,1),this._viewportCount=1,this._viewports=[new Ct(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;nf.setFromMatrixPosition(e.matrixWorld),t.position.copy(nf),sf.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(sf),t.updateMatrixWorld(),wc.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(wc),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(wc)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class kw extends Xh{constructor(){super(new Pi(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=Kr*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(i!==t.fov||s!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=s,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Zp extends Bl{constructor(e,t,i=0,s=Math.PI/3,r=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(je.DEFAULT_UP),this.updateMatrix(),this.target=new je,this.distance=i,this.angle=s,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new kw}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const rf=new Je,go=new T,Mc=new T;class Nw extends Xh{constructor(){super(new Pi(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Oe(4,2),this._viewportCount=6,this._viewports=[new Ct(2,1,1,1),new Ct(0,1,1,1),new Ct(3,1,1,1),new Ct(1,1,1,1),new Ct(3,0,1,1),new Ct(1,0,1,1)],this._cubeDirections=[new T(1,0,0),new T(-1,0,0),new T(0,0,1),new T(0,0,-1),new T(0,1,0),new T(0,-1,0)],this._cubeUps=[new T(0,1,0),new T(0,1,0),new T(0,1,0),new T(0,1,0),new T(0,0,1),new T(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,s=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),go.setFromMatrixPosition(e.matrixWorld),i.position.copy(go),Mc.copy(i.position),Mc.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(Mc),i.updateMatrixWorld(),s.makeTranslation(-go.x,-go.y,-go.z),rf.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(rf)}}class sh extends Bl{constructor(e,t,i=0,s=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=s,this.shadow=new Nw}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Ow extends Xh{constructor(){super(new ia(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class ra extends Bl{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(je.DEFAULT_UP),this.updateMatrix(),this.target=new je,this.shadow=new Ow}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Dl extends Bl{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class Hr{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,s=e.length;i<s;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class Uw extends Ln{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=fs.get(e);if(o!==void 0){if(r.manager.itemStart(e),o.then){o.then(d=>{t&&t(d),r.manager.itemEnd(e)}).catch(d=>{s&&s(d)});return}return setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o}const l={};l.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",l.headers=this.requestHeader;const h=fetch(e,l).then(function(d){return d.blob()}).then(function(d){return createImageBitmap(d,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(d){return fs.add(e,d),t&&t(d),r.manager.itemEnd(e),d}).catch(function(d){s&&s(d),fs.remove(e),r.manager.itemError(e),r.manager.itemEnd(e)});fs.add(e,h),r.manager.itemStart(e)}}class zw{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=of(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=of();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function of(){return(typeof performance>"u"?Date:performance).now()}class Vw{constructor(e,t,i){this.binding=e,this.valueSize=i;let s,r,o;switch(t){case"quaternion":s=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":s=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:s=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,s=this.valueSize,r=e*s+s;let o=this.cumulativeWeight;if(o===0){for(let l=0;l!==s;++l)i[r+l]=i[l];o=t}else{o+=t;const l=t/o;this._mixBufferRegion(i,r,0,l,s)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,s=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,s,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,s=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,l=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const h=t*this._origIndex;this._mixBufferRegion(i,s,h,1-r,t)}o>0&&this._mixBufferRegionAdditive(i,s,this._addIndex*t,1,t);for(let h=t,d=t+t;h!==d;++h)if(i[h]!==i[h+t]){l.setValue(i,s);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,s=i*this._origIndex;e.getValue(t,s);for(let r=i,o=s;r!==o;++r)t[r]=t[s+r%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,s,r){if(s>=.5)for(let o=0;o!==r;++o)e[t+o]=e[i+o]}_slerp(e,t,i,s){Tt.slerpFlat(e,t,e,t,e,i,s)}_slerpAdditive(e,t,i,s,r){const o=this._workIndex*r;Tt.multiplyQuaternionsFlat(e,o,e,t,e,i),Tt.slerpFlat(e,t,e,t,e,o,s)}_lerp(e,t,i,s,r){const o=1-s;for(let l=0;l!==r;++l){const h=t+l;e[h]=e[h]*o+e[i+l]*s}}_lerpAdditive(e,t,i,s,r){for(let o=0;o!==r;++o){const l=t+o;e[l]=e[l]+e[i+o]*s}}}const jh="\\[\\]\\.:\\/",Hw=new RegExp("["+jh+"]","g"),Yh="[^"+jh+"]",Gw="[^"+jh.replace("\\.","")+"]",Ww=/((?:WC+[\/:])*)/.source.replace("WC",Yh),Xw=/(WCOD+)?/.source.replace("WCOD",Gw),jw=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Yh),Yw=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Yh),qw=new RegExp("^"+Ww+Xw+jw+Yw+"$"),$w=["material","materials","bones","map"];class Zw{constructor(e,t,i){const s=i||Mt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,s=this._bindings[i];s!==void 0&&s.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=i.length;s!==r;++s)i[s].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class Mt{constructor(e,t,i){this.path=t,this.parsedPath=i||Mt.parseTrackName(t),this.node=Mt.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Mt.Composite(e,t,i):new Mt(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Hw,"")}static parseTrackName(e){const t=qw.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const r=i.nodeName.substring(s+1);$w.indexOf(r)!==-1&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=r)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(r){for(let o=0;o<r.length;o++){const l=r[o];if(l.name===t||l.uuid===t)return l;const h=i(l.children);if(h)return h}return null},s=i(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)e[t++]=i[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,s=t.propertyName;let r=t.propertyIndex;if(e||(e=Mt.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let d=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let f=0;f<e.length;f++)if(e[f].name===d){d=f;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(d!==void 0){if(e[d]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[d]}}const o=e[s];if(o===void 0){const d=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+d+"."+s+" but it wasn't found.",e);return}let l=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?l=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(l=this.Versioning.MatrixWorldNeedsUpdate);let h=this.BindingType.Direct;if(r!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}h=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(h=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(h=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=s;this.getValue=this.GetterByBindingType[h],this.setValue=this.SetterByBindingTypeAndVersioning[h][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Mt.Composite=Zw;Mt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Mt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Mt.prototype.GetterByBindingType=[Mt.prototype._getValue_direct,Mt.prototype._getValue_array,Mt.prototype._getValue_arrayElement,Mt.prototype._getValue_toArray];Mt.prototype.SetterByBindingTypeAndVersioning=[[Mt.prototype._setValue_direct,Mt.prototype._setValue_direct_setNeedsUpdate,Mt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Mt.prototype._setValue_array,Mt.prototype._setValue_array_setNeedsUpdate,Mt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Mt.prototype._setValue_arrayElement,Mt.prototype._setValue_arrayElement_setNeedsUpdate,Mt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Mt.prototype._setValue_fromArray,Mt.prototype._setValue_fromArray_setNeedsUpdate,Mt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Kw{constructor(e,t,i=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=s;const r=t.tracks,o=r.length,l=new Array(o),h={endingStart:Rr,endingEnd:Rr};for(let d=0;d!==o;++d){const f=r[d].createInterpolant(null);l[d]=f,f.settings=h}this._interpolantSettings=h,this._interpolants=l,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=p0,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const s=this._clip.duration,r=e._clip.duration,o=r/s,l=s/r;e.warp(1,o,t),this.warp(l,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const s=this._mixer,r=s.time,o=this.timeScale;let l=this._timeScaleInterpolant;l===null&&(l=s._lendControlInterpolant(),this._timeScaleInterpolant=l);const h=l.parameterPositions,d=l.sampleValues;return h[0]=r,h[1]=r+i,d[0]=e/o,d[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,s){if(!this.enabled){this._updateWeight(e);return}const r=this._startTime;if(r!==null){const h=(e-r)*i;h<0||i===0?t=0:(this._startTime=null,t=i*h)}t*=this._updateTimeScale(e);const o=this._updateTime(t),l=this._updateWeight(e);if(l>0){const h=this._interpolants,d=this._propertyBindings;switch(this.blendMode){case g0:for(let f=0,c=h.length;f!==c;++f)h[f].evaluate(o),d[f].accumulateAdditive(l);break;case Lh:default:for(let f=0,c=h.length;f!==c;++f)h[f].evaluate(o),d[f].accumulate(s,l)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const s=i.evaluate(e)[0];t*=s,e>i.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const s=i.evaluate(e)[0];t*=s,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let s=this.time+e,r=this._loopCount;const o=i===m0;if(e===0)return r===-1?s:o&&(r&1)===1?t-s:s;if(i===f0){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else if(s<0)s=0;else{this.time=s;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),s>=t||s<0){const l=Math.floor(s/t);s-=t*l,r+=Math.abs(l);const h=this.repetitions-r;if(h<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?t:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(h===1){const d=e<0;this._setEndings(d,!d,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:l})}}else this.time=s;if(o&&(r&1)===1)return t-s}return s}_setEndings(e,t,i){const s=this._interpolantSettings;i?(s.endingStart=Pr,s.endingEnd=Pr):(e?s.endingStart=this.zeroSlopeAtStart?Pr:Rr:s.endingStart=cl,t?s.endingEnd=this.zeroSlopeAtEnd?Pr:Rr:s.endingEnd=cl)}_scheduleFading(e,t,i){const s=this._mixer,r=s.time;let o=this._weightInterpolant;o===null&&(o=s._lendControlInterpolant(),this._weightInterpolant=o);const l=o.parameterPositions,h=o.sampleValues;return l[0]=r,h[0]=t,l[1]=r+e,h[1]=i,this}}const Qw=new Float32Array(1);class qh extends As{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,s=e._clip.tracks,r=s.length,o=e._propertyBindings,l=e._interpolants,h=i.uuid,d=this._bindingsByRootAndName;let f=d[h];f===void 0&&(f={},d[h]=f);for(let c=0;c!==r;++c){const u=s[c],p=u.name;let m=f[p];if(m!==void 0)++m.referenceCount,o[c]=m;else{if(m=o[c],m!==void 0){m._cacheIndex===null&&(++m.referenceCount,this._addInactiveBinding(m,h,p));continue}const _=t&&t._propertyBindings[c].binding.parsedPath;m=new Vw(Mt.create(i,p,_),u.ValueTypeName,u.getValueSize()),++m.referenceCount,this._addInactiveBinding(m,h,p),o[c]=m}l[c].resultBuffer=m.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,s=e._clip.uuid,r=this._actionsByClip[s];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,s,i)}const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const r=t[i];r.useCount++===0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const r=t[i];--r.useCount===0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const s=this._actions,r=this._actionsByClip;let o=r[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{const l=o.knownActions;e._byClipCacheIndex=l.length,l.push(e)}e._cacheIndex=s.length,s.push(e),o.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],s=e._cacheIndex;i._cacheIndex=s,t[s]=i,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,o=this._actionsByClip,l=o[r],h=l.knownActions,d=h[h.length-1],f=e._byClipCacheIndex;d._byClipCacheIndex=f,h[f]=d,h.pop(),e._byClipCacheIndex=null;const c=l.actionByRoot,u=(e._localRoot||this._root).uuid;delete c[u],h.length===0&&delete o[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const r=t[i];--r.referenceCount===0&&this._removeInactiveBinding(r)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,s=this._nActiveActions++,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=i,t[i]=r}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,s=--this._nActiveActions,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=i,t[i]=r}_addInactiveBinding(e,t,i){const s=this._bindingsByRootAndName,r=this._bindings;let o=s[t];o===void 0&&(o={},s[t]=o),o[i]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,s=i.rootNode.uuid,r=i.path,o=this._bindingsByRootAndName,l=o[s],h=t[t.length-1],d=e._cacheIndex;h._cacheIndex=d,t[d]=h,t.pop(),delete l[r],Object.keys(l).length===0&&delete o[s]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,s=this._nActiveBindings++,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=i,t[i]=r}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,s=--this._nActiveBindings,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=i,t[i]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new qp(new Float32Array(2),new Float32Array(2),1,Qw),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,s=--this._nActiveControlInterpolants,r=t[s];e.__cacheIndex=s,t[s]=e,r.__cacheIndex=i,t[i]=r}clipAction(e,t,i){const s=t||this._root,r=s.uuid;let o=typeof e=="string"?_l.findByName(s,e):e;const l=o!==null?o.uuid:e,h=this._actionsByClip[l];let d=null;if(i===void 0&&(o!==null?i=o.blendMode:i=Lh),h!==void 0){const c=h.actionByRoot[r];if(c!==void 0&&c.blendMode===i)return c;d=h.knownActions[0],o===null&&(o=d._clip)}if(o===null)return null;const f=new Kw(this,o,t,i);return this._bindAction(f,d),this._addInactiveAction(f,l,r),f}existingAction(e,t){const i=t||this._root,s=i.uuid,r=typeof e=="string"?_l.findByName(i,e):e,o=r?r.uuid:e,l=this._actionsByClip[o];return l!==void 0&&l.actionByRoot[s]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,s=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1;for(let d=0;d!==i;++d)t[d]._update(s,e,r,o);const l=this._bindings,h=this._nActiveBindings;for(let d=0;d!==h;++d)l[d].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,s=this._actionsByClip,r=s[i];if(r!==void 0){const o=r.knownActions;for(let l=0,h=o.length;l!==h;++l){const d=o[l];this._deactivateAction(d);const f=d._cacheIndex,c=t[t.length-1];d._cacheIndex=null,d._byClipCacheIndex=null,c._cacheIndex=f,t[f]=c,t.pop(),this._removeInactiveBindingsForAction(d)}delete s[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const o in i){const l=i[o].actionByRoot,h=l[t];h!==void 0&&(this._deactivateAction(h),this._removeInactiveAction(h))}const s=this._bindingsByRootAndName,r=s[t];if(r!==void 0)for(const o in r){const l=r[o];l.restoreOriginalState(),this._removeInactiveBinding(l)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}const af=new Je;class $h{constructor(e,t,i=0,s=1/0){this.ray=new so(e,t),this.near=i,this.far=s,this.camera=null,this.layers=new Dh,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return af.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(af),this}intersectObject(e,t=!0,i=[]){return rh(e,this,i,t),i.sort(lf),i}intersectObjects(e,t=!0,i=[]){for(let s=0,r=e.length;s<r;s++)rh(e[s],this,i,t);return i.sort(lf),i}}function lf(a,e){return a.distance-e.distance}function rh(a,e,t,i){if(a.layers.test(e.layers)&&a.raycast(e,t),i===!0){const s=a.children;for(let r=0,o=s.length;r<o;r++)rh(s[r],e,t,!0)}}class cf{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(di(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}const hf=new T;let Ha,Sc;class Jw extends je{constructor(e=new T(0,0,1),t=new T(0,0,0),i=1,s=16776960,r=i*.2,o=r*.2){super(),this.type="ArrowHelper",Ha===void 0&&(Ha=new Bt,Ha.setAttribute("position",new yt([0,0,0,0,1,0],3)),Sc=new oi(0,.5,1,5,1),Sc.translate(0,-.5,0)),this.position.copy(t),this.line=new qi(Ha,new tr({color:s,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ae(Sc,new Ne({color:s,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,r,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{hf.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(hf,t)}}setLength(e,t=e*.2,i=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class eM extends Vh{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],s=new Bt;s.setAttribute("position",new yt(t,3)),s.setAttribute("color",new yt(i,3));const r=new tr({vertexColors:!0,toneMapped:!1});super(s,r),this.type="AxesHelper"}setColors(e,t,i){const s=new Le,r=this.geometry.attributes.color.array;return s.set(e),s.toArray(r,0),s.toArray(r,3),s.set(t),s.toArray(r,6),s.toArray(r,9),s.set(i),s.toArray(r,12),s.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Ih}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Ih);function tM(a){if(!(typeof window>"u")){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=a,document.head.appendChild(e),a}}function Br(a,e){var t=a.__state.conversionName.toString(),i=Math.round(a.r),s=Math.round(a.g),r=Math.round(a.b),o=a.a,l=Math.round(a.h),h=a.s.toFixed(1),d=a.v.toFixed(1);if(e||t==="THREE_CHAR_HEX"||t==="SIX_CHAR_HEX"){for(var f=a.hex.toString(16);f.length<6;)f="0"+f;return"#"+f}else{if(t==="CSS_RGB")return"rgb("+i+","+s+","+r+")";if(t==="CSS_RGBA")return"rgba("+i+","+s+","+r+","+o+")";if(t==="HEX")return"0x"+a.hex.toString(16);if(t==="RGB_ARRAY")return"["+i+","+s+","+r+"]";if(t==="RGBA_ARRAY")return"["+i+","+s+","+r+","+o+"]";if(t==="RGB_OBJ")return"{r:"+i+",g:"+s+",b:"+r+"}";if(t==="RGBA_OBJ")return"{r:"+i+",g:"+s+",b:"+r+",a:"+o+"}";if(t==="HSV_OBJ")return"{h:"+l+",s:"+h+",v:"+d+"}";if(t==="HSVA_OBJ")return"{h:"+l+",s:"+h+",v:"+d+",a:"+o+"}"}return"unknown format"}var uf=Array.prototype.forEach,vo=Array.prototype.slice,Se={BREAK:{},extend:function(e){return this.each(vo.call(arguments,1),function(t){var i=this.isObject(t)?Object.keys(t):[];i.forEach((function(s){this.isUndefined(t[s])||(e[s]=t[s])}).bind(this))},this),e},defaults:function(e){return this.each(vo.call(arguments,1),function(t){var i=this.isObject(t)?Object.keys(t):[];i.forEach((function(s){this.isUndefined(e[s])&&(e[s]=t[s])}).bind(this))},this),e},compose:function(){var e=vo.call(arguments);return function(){for(var t=vo.call(arguments),i=e.length-1;i>=0;i--)t=[e[i].apply(this,t)];return t[0]}},each:function(e,t,i){if(e){if(uf&&e.forEach&&e.forEach===uf)e.forEach(t,i);else if(e.length===e.length+0){var s=void 0,r=void 0;for(s=0,r=e.length;s<r;s++)if(s in e&&t.call(i,e[s],s)===this.BREAK)return}else for(var o in e)if(t.call(i,e[o],o)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},debounce:function(e,t,i){var s=void 0;return function(){var r=this,o=arguments;function l(){s=null,i||e.apply(r,o)}var h=i||!s;clearTimeout(s),s=setTimeout(l,t),h&&e.apply(r,o)}},toArray:function(e){return e.toArray?e.toArray():vo.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return e===null},isNaN:function(a){function e(t){return a.apply(this,arguments)}return e.toString=function(){return a.toString()},e}(function(a){return isNaN(a)}),isArray:Array.isArray||function(a){return a.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return e instanceof Function}},iM=[{litmus:Se.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:Br},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:Br},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:Br},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:Br}}},{litmus:Se.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:Se.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!==3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!==4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:Se.isObject,conversions:{RGBA_OBJ:{read:function(e){return Se.isNumber(e.r)&&Se.isNumber(e.g)&&Se.isNumber(e.b)&&Se.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return Se.isNumber(e.r)&&Se.isNumber(e.g)&&Se.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return Se.isNumber(e.h)&&Se.isNumber(e.s)&&Se.isNumber(e.v)&&Se.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return Se.isNumber(e.h)&&Se.isNumber(e.s)&&Se.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],_o=void 0,Ga=void 0,oh=function(){Ga=!1;var e=arguments.length>1?Se.toArray(arguments):arguments[0];return Se.each(iM,function(t){if(t.litmus(e))return Se.each(t.conversions,function(i,s){if(_o=i.read(e),Ga===!1&&_o!==!1)return Ga=_o,_o.conversionName=s,_o.conversion=i,Se.BREAK}),Se.BREAK}),Ga},df=void 0,yl={hsv_to_rgb:function(e,t,i){var s=Math.floor(e/60)%6,r=e/60-Math.floor(e/60),o=i*(1-t),l=i*(1-r*t),h=i*(1-(1-r)*t),d=[[i,h,o],[l,i,o],[o,i,h],[o,l,i],[h,o,i],[i,o,l]][s];return{r:d[0]*255,g:d[1]*255,b:d[2]*255}},rgb_to_hsv:function(e,t,i){var s=Math.min(e,t,i),r=Math.max(e,t,i),o=r-s,l=void 0,h=void 0;if(r!==0)h=o/r;else return{h:NaN,s:0,v:0};return e===r?l=(t-i)/o:t===r?l=2+(i-e)/o:l=4+(e-t)/o,l/=6,l<0&&(l+=1),{h:l*360,s:h,v:r/255}},rgb_to_hex:function(e,t,i){var s=this.hex_with_component(0,2,e);return s=this.hex_with_component(s,1,t),s=this.hex_with_component(s,0,i),s},component_from_hex:function(e,t){return e>>t*8&255},hex_with_component:function(e,t,i){return i<<(df=t*8)|e&~(255<<df)}},nM=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},yn=function(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")},xn=function(){function a(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e}}(),ws=function a(e,t,i){e===null&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,t);if(s===void 0){var r=Object.getPrototypeOf(e);return r===null?void 0:a(r,t,i)}else{if("value"in s)return s.value;var o=s.get;return o===void 0?void 0:o.call(i)}},Es=function(a,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);a.prototype=Object.create(e&&e.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(a,e):a.__proto__=e)},Ts=function(a,e){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:a},xi=function(){function a(){if(yn(this,a),this.__state=oh.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return xn(a,[{key:"toString",value:function(){return Br(this)}},{key:"toHexString",value:function(){return Br(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),a}();function Zh(a,e,t){Object.defineProperty(a,e,{get:function(){return this.__state.space==="RGB"?this.__state[e]:(xi.recalculateRGB(this,e,t),this.__state[e])},set:function(s){this.__state.space!=="RGB"&&(xi.recalculateRGB(this,e,t),this.__state.space="RGB"),this.__state[e]=s}})}function Kh(a,e){Object.defineProperty(a,e,{get:function(){return this.__state.space==="HSV"?this.__state[e]:(xi.recalculateHSV(this),this.__state[e])},set:function(i){this.__state.space!=="HSV"&&(xi.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=i}})}xi.recalculateRGB=function(a,e,t){if(a.__state.space==="HEX")a.__state[e]=yl.component_from_hex(a.__state.hex,t);else if(a.__state.space==="HSV")Se.extend(a.__state,yl.hsv_to_rgb(a.__state.h,a.__state.s,a.__state.v));else throw new Error("Corrupted color state")};xi.recalculateHSV=function(a){var e=yl.rgb_to_hsv(a.r,a.g,a.b);Se.extend(a.__state,{s:e.s,v:e.v}),Se.isNaN(e.h)?Se.isUndefined(a.__state.h)&&(a.__state.h=0):a.__state.h=e.h};xi.COMPONENTS=["r","g","b","h","s","v","hex","a"];Zh(xi.prototype,"r",2);Zh(xi.prototype,"g",1);Zh(xi.prototype,"b",0);Kh(xi.prototype,"h");Kh(xi.prototype,"s");Kh(xi.prototype,"v");Object.defineProperty(xi.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}});Object.defineProperty(xi.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=yl.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var ir=function(){function a(e,t){yn(this,a),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}return xn(a,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),a}(),sM={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},Kp={};Se.each(sM,function(a,e){Se.each(a,function(t){Kp[t]=e})});var rM=/(\d+(\.\d+)?)px/;function wn(a){if(a==="0"||Se.isUndefined(a))return 0;var e=a.match(rM);return Se.isNull(e)?0:parseFloat(e[1])}var ue={makeSelectable:function(e,t){e===void 0||e.style===void 0||(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,i){var s=i,r=t;Se.isUndefined(r)&&(r=!0),Se.isUndefined(s)&&(s=!0),e.style.position="absolute",r&&(e.style.left=0,e.style.right=0),s&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,i,s){var r=i||{},o=Kp[t];if(!o)throw new Error("Event type "+t+" not supported.");var l=document.createEvent(o);switch(o){case"MouseEvents":{var h=r.x||r.clientX||0,d=r.y||r.clientY||0;l.initMouseEvent(t,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,h,d,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var f=l.initKeyboardEvent||l.initKeyEvent;Se.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),f(t,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break}default:{l.initEvent(t,r.bubbles||!1,r.cancelable||!0);break}}Se.defaults(l,s),e.dispatchEvent(l)},bind:function(e,t,i,s){var r=s||!1;return e.addEventListener?e.addEventListener(t,i,r):e.attachEvent&&e.attachEvent("on"+t,i),ue},unbind:function(e,t,i,s){var r=s||!1;return e.removeEventListener?e.removeEventListener(t,i,r):e.detachEvent&&e.detachEvent("on"+t,i),ue},addClass:function(e,t){if(e.className===void 0)e.className=t;else if(e.className!==t){var i=e.className.split(/ +/);i.indexOf(t)===-1&&(i.push(t),e.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return ue},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var i=e.className.split(/ +/),s=i.indexOf(t);s!==-1&&(i.splice(s,1),e.className=i.join(" "))}else e.className=void 0;return ue},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return wn(t["border-left-width"])+wn(t["border-right-width"])+wn(t["padding-left"])+wn(t["padding-right"])+wn(t.width)},getHeight:function(e){var t=getComputedStyle(e);return wn(t["border-top-width"])+wn(t["border-bottom-width"])+wn(t["padding-top"])+wn(t["padding-bottom"])+wn(t.height)},getOffset:function(e){var t=e,i={left:0,top:0};if(t.offsetParent)do i.left+=t.offsetLeft,i.top+=t.offsetTop,t=t.offsetParent;while(t);return i},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},Qp=function(a){Es(e,a);function e(t,i){yn(this,e);var s=Ts(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),r=s;s.__prev=s.getValue(),s.__checkbox=document.createElement("input"),s.__checkbox.setAttribute("type","checkbox");function o(){r.setValue(!r.__prev)}return ue.bind(s.__checkbox,"change",o,!1),s.domElement.appendChild(s.__checkbox),s.updateDisplay(),s}return xn(e,[{key:"setValue",value:function(i){var s=ws(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,i);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),s}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),ws(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(ir),oM=function(a){Es(e,a);function e(t,i,s){yn(this,e);var r=Ts(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),o=s,l=r;if(r.__select=document.createElement("select"),Se.isArray(o)){var h={};Se.each(o,function(d){h[d]=d}),o=h}return Se.each(o,function(d,f){var c=document.createElement("option");c.innerHTML=f,c.setAttribute("value",d),l.__select.appendChild(c)}),r.updateDisplay(),ue.bind(r.__select,"change",function(){var d=this.options[this.selectedIndex].value;l.setValue(d)}),r.domElement.appendChild(r.__select),r}return xn(e,[{key:"setValue",value:function(i){var s=ws(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,i);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),s}},{key:"updateDisplay",value:function(){return ue.isActive(this.__select)?this:(this.__select.value=this.getValue(),ws(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(ir),aM=function(a){Es(e,a);function e(t,i){yn(this,e);var s=Ts(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),r=s;function o(){r.setValue(r.__input.value)}function l(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),ue.bind(s.__input,"keyup",o),ue.bind(s.__input,"change",o),ue.bind(s.__input,"blur",l),ue.bind(s.__input,"keydown",function(h){h.keyCode===13&&this.blur()}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return xn(e,[{key:"updateDisplay",value:function(){return ue.isActive(this.__input)||(this.__input.value=this.getValue()),ws(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(ir);function ff(a){var e=a.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var Jp=function(a){Es(e,a);function e(t,i,s){yn(this,e);var r=Ts(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),o=s||{};return r.__min=o.min,r.__max=o.max,r.__step=o.step,Se.isUndefined(r.__step)?r.initialValue===0?r.__impliedStep=1:r.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(r.initialValue))/Math.LN10))/10:r.__impliedStep=r.__step,r.__precision=ff(r.__impliedStep),r}return xn(e,[{key:"setValue",value:function(i){var s=i;return this.__min!==void 0&&s<this.__min?s=this.__min:this.__max!==void 0&&s>this.__max&&(s=this.__max),this.__step!==void 0&&s%this.__step!==0&&(s=Math.round(s/this.__step)*this.__step),ws(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,s)}},{key:"min",value:function(i){return this.__min=i,this}},{key:"max",value:function(i){return this.__max=i,this}},{key:"step",value:function(i){return this.__step=i,this.__impliedStep=i,this.__precision=ff(i),this}}]),e}(ir);function lM(a,e){var t=Math.pow(10,e);return Math.round(a*t)/t}var xl=function(a){Es(e,a);function e(t,i,s){yn(this,e);var r=Ts(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,s));r.__truncationSuspended=!1;var o=r,l=void 0;function h(){var m=parseFloat(o.__input.value);Se.isNaN(m)||o.setValue(m)}function d(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function f(){d()}function c(m){var _=l-m.clientY;o.setValue(o.getValue()+_*o.__impliedStep),l=m.clientY}function u(){ue.unbind(window,"mousemove",c),ue.unbind(window,"mouseup",u),d()}function p(m){ue.bind(window,"mousemove",c),ue.bind(window,"mouseup",u),l=m.clientY}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),ue.bind(r.__input,"change",h),ue.bind(r.__input,"blur",f),ue.bind(r.__input,"mousedown",p),ue.bind(r.__input,"keydown",function(m){m.keyCode===13&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,d())}),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return xn(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():lM(this.getValue(),this.__precision),ws(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Jp);function pf(a,e,t,i,s){return i+(s-i)*((a-e)/(t-e))}var ah=function(a){Es(e,a);function e(t,i,s,r,o){yn(this,e);var l=Ts(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,{min:s,max:r,step:o})),h=l;l.__background=document.createElement("div"),l.__foreground=document.createElement("div"),ue.bind(l.__background,"mousedown",d),ue.bind(l.__background,"touchstart",u),ue.addClass(l.__background,"slider"),ue.addClass(l.__foreground,"slider-fg");function d(_){document.activeElement.blur(),ue.bind(window,"mousemove",f),ue.bind(window,"mouseup",c),f(_)}function f(_){_.preventDefault();var g=h.__background.getBoundingClientRect();return h.setValue(pf(_.clientX,g.left,g.right,h.__min,h.__max)),!1}function c(){ue.unbind(window,"mousemove",f),ue.unbind(window,"mouseup",c),h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())}function u(_){_.touches.length===1&&(ue.bind(window,"touchmove",p),ue.bind(window,"touchend",m),p(_))}function p(_){var g=_.touches[0].clientX,v=h.__background.getBoundingClientRect();h.setValue(pf(g,v.left,v.right,h.__min,h.__max))}function m(){ue.unbind(window,"touchmove",p),ue.unbind(window,"touchend",m),h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())}return l.updateDisplay(),l.__background.appendChild(l.__foreground),l.domElement.appendChild(l.__background),l}return xn(e,[{key:"updateDisplay",value:function(){var i=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=i*100+"%",ws(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Jp),em=function(a){Es(e,a);function e(t,i,s){yn(this,e);var r=Ts(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),o=r;return r.__button=document.createElement("div"),r.__button.innerHTML=s===void 0?"Fire":s,ue.bind(r.__button,"click",function(l){return l.preventDefault(),o.fire(),!1}),ue.addClass(r.__button,"button"),r.domElement.appendChild(r.__button),r}return xn(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(ir),lh=function(a){Es(e,a);function e(t,i){yn(this,e);var s=Ts(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));s.__color=new xi(s.getValue()),s.__temp=new xi(0);var r=s;s.domElement=document.createElement("div"),ue.makeSelectable(s.domElement,!1),s.__selector=document.createElement("div"),s.__selector.className="selector",s.__saturation_field=document.createElement("div"),s.__saturation_field.className="saturation-field",s.__field_knob=document.createElement("div"),s.__field_knob.className="field-knob",s.__field_knob_border="2px solid ",s.__hue_knob=document.createElement("div"),s.__hue_knob.className="hue-knob",s.__hue_field=document.createElement("div"),s.__hue_field.className="hue-field",s.__input=document.createElement("input"),s.__input.type="text",s.__input_textShadow="0 1px 1px ",ue.bind(s.__input,"keydown",function(_){_.keyCode===13&&c.call(this)}),ue.bind(s.__input,"blur",c),ue.bind(s.__selector,"mousedown",function(){ue.addClass(this,"drag").bind(window,"mouseup",function(){ue.removeClass(r.__selector,"drag")})}),ue.bind(s.__selector,"touchstart",function(){ue.addClass(this,"drag").bind(window,"touchend",function(){ue.removeClass(r.__selector,"drag")})});var o=document.createElement("div");Se.extend(s.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),Se.extend(s.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:s.__field_knob_border+(s.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),Se.extend(s.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),Se.extend(s.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),Se.extend(o.style,{width:"100%",height:"100%",background:"none"}),mf(o,"top","rgba(0,0,0,0)","#000"),Se.extend(s.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),hM(s.__hue_field),Se.extend(s.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:s.__input_textShadow+"rgba(0,0,0,0.7)"}),ue.bind(s.__saturation_field,"mousedown",l),ue.bind(s.__saturation_field,"touchstart",l),ue.bind(s.__field_knob,"mousedown",l),ue.bind(s.__field_knob,"touchstart",l),ue.bind(s.__hue_field,"mousedown",h),ue.bind(s.__hue_field,"touchstart",h);function l(_){p(_),ue.bind(window,"mousemove",p),ue.bind(window,"touchmove",p),ue.bind(window,"mouseup",d),ue.bind(window,"touchend",d)}function h(_){m(_),ue.bind(window,"mousemove",m),ue.bind(window,"touchmove",m),ue.bind(window,"mouseup",f),ue.bind(window,"touchend",f)}function d(){ue.unbind(window,"mousemove",p),ue.unbind(window,"touchmove",p),ue.unbind(window,"mouseup",d),ue.unbind(window,"touchend",d),u()}function f(){ue.unbind(window,"mousemove",m),ue.unbind(window,"touchmove",m),ue.unbind(window,"mouseup",f),ue.unbind(window,"touchend",f),u()}function c(){var _=oh(this.value);_!==!1?(r.__color.__state=_,r.setValue(r.__color.toOriginal())):this.value=r.__color.toString()}function u(){r.__onFinishChange&&r.__onFinishChange.call(r,r.__color.toOriginal())}s.__saturation_field.appendChild(o),s.__selector.appendChild(s.__field_knob),s.__selector.appendChild(s.__saturation_field),s.__selector.appendChild(s.__hue_field),s.__hue_field.appendChild(s.__hue_knob),s.domElement.appendChild(s.__input),s.domElement.appendChild(s.__selector),s.updateDisplay();function p(_){_.type.indexOf("touch")===-1&&_.preventDefault();var g=r.__saturation_field.getBoundingClientRect(),v=_.touches&&_.touches[0]||_,y=v.clientX,x=v.clientY,b=(y-g.left)/(g.right-g.left),S=1-(x-g.top)/(g.bottom-g.top);return S>1?S=1:S<0&&(S=0),b>1?b=1:b<0&&(b=0),r.__color.v=S,r.__color.s=b,r.setValue(r.__color.toOriginal()),!1}function m(_){_.type.indexOf("touch")===-1&&_.preventDefault();var g=r.__hue_field.getBoundingClientRect(),v=_.touches&&_.touches[0]||_,y=v.clientY,x=1-(y-g.top)/(g.bottom-g.top);return x>1?x=1:x<0&&(x=0),r.__color.h=x*360,r.setValue(r.__color.toOriginal()),!1}return s}return xn(e,[{key:"updateDisplay",value:function(){var i=oh(this.getValue());if(i!==!1){var s=!1;Se.each(xi.COMPONENTS,function(l){if(!Se.isUndefined(i[l])&&!Se.isUndefined(this.__color.__state[l])&&i[l]!==this.__color.__state[l])return s=!0,{}},this),s&&Se.extend(this.__color.__state,i)}Se.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var r=this.__color.v<.5||this.__color.s>.5?255:0,o=255-r;Se.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+r+","+r+","+r+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,mf(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),Se.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+r+","+r+","+r+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}}]),e}(ir),cM=["-moz-","-o-","-webkit-","-ms-",""];function mf(a,e,t,i){a.style.background="",Se.each(cM,function(s){a.style.cssText+="background: "+s+"linear-gradient("+e+", "+t+" 0%, "+i+" 100%); "})}function hM(a){a.style.background="",a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var uM={load:function(e,t){var i=t||document,s=i.createElement("link");s.type="text/css",s.rel="stylesheet",s.href=e,i.getElementsByTagName("head")[0].appendChild(s)},inject:function(e,t){var i=t||document,s=document.createElement("style");s.type="text/css",s.innerHTML=e;var r=i.getElementsByTagName("head")[0];try{r.appendChild(s)}catch{}}},dM=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,fM=function(e,t){var i=e[t];return Se.isArray(arguments[2])||Se.isObject(arguments[2])?new oM(e,t,arguments[2]):Se.isNumber(i)?Se.isNumber(arguments[2])&&Se.isNumber(arguments[3])?Se.isNumber(arguments[4])?new ah(e,t,arguments[2],arguments[3],arguments[4]):new ah(e,t,arguments[2],arguments[3]):Se.isNumber(arguments[4])?new xl(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new xl(e,t,{min:arguments[2],max:arguments[3]}):Se.isString(i)?new aM(e,t):Se.isFunction(i)?new em(e,t,""):Se.isBoolean(i)?new Qp(e,t):null};function pM(a){setTimeout(a,1e3/60)}var mM=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||pM,gM=function(){function a(){yn(this,a),this.backgroundElement=document.createElement("div"),Se.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),ue.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),Se.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;ue.bind(this.backgroundElement,"click",function(){e.hide()})}return xn(a,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),Se.defer(function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var t=this,i=function s(){t.domElement.style.display="none",t.backgroundElement.style.display="none",ue.unbind(t.domElement,"webkitTransitionEnd",s),ue.unbind(t.domElement,"transitionend",s),ue.unbind(t.domElement,"oTransitionEnd",s)};ue.bind(this.domElement,"webkitTransitionEnd",i),ue.bind(this.domElement,"transitionend",i),ue.bind(this.domElement,"oTransitionEnd",i),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-ue.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-ue.getHeight(this.domElement)/2+"px"}}]),a}(),vM=tM(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);uM.inject(vM);var gf="dg",vf=72,_f=20,Xo="Default",Eo=function(){try{return!!window.localStorage}catch{return!1}}(),Lo=void 0,yf=!0,Tr=void 0,Ac=!1,tm=[],Vt=function a(e){var t=this,i=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),ue.addClass(this.domElement,gf),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=Se.defaults(i,{closeOnTop:!1,autoPlace:!0,width:a.DEFAULT_WIDTH}),i=Se.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),Se.isUndefined(i.load)?i.load={preset:Xo}:i.preset&&(i.load.preset=i.preset),Se.isUndefined(i.parent)&&i.hideable&&tm.push(this),i.resizable=Se.isUndefined(i.parent)&&i.resizable,i.autoPlace&&Se.isUndefined(i.scrollable)&&(i.scrollable=!0);var s=Eo&&localStorage.getItem(Cr(this,"isLocal"))==="true",r=void 0,o=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return t.parent?t.getRoot().preset:i.load.preset},set:function(u){t.parent?t.getRoot().preset=u:i.load.preset=u,bM(this),t.revert()}},width:{get:function(){return i.width},set:function(u){i.width=u,uh(t,u)}},name:{get:function(){return i.name},set:function(u){i.name=u,o&&(o.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(u){i.closed=u,i.closed?ue.addClass(t.__ul,a.CLASS_CLOSED):ue.removeClass(t.__ul,a.CLASS_CLOSED),this.onResize(),t.__closeButton&&(t.__closeButton.innerHTML=u?a.TEXT_OPEN:a.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return s},set:function(u){Eo&&(s=u,u?ue.bind(window,"unload",r):ue.unbind(window,"unload",r),localStorage.setItem(Cr(t,"isLocal"),u))}}}),Se.isUndefined(i.parent)){if(this.closed=i.closed||!1,ue.addClass(this.domElement,a.CLASS_MAIN),ue.makeSelectable(this.domElement,!1),Eo&&s){t.useLocalStorage=!0;var l=localStorage.getItem(Cr(this,"gui"));l&&(i.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=a.TEXT_CLOSED,ue.addClass(this.__closeButton,a.CLASS_CLOSE_BUTTON),i.closeOnTop?(ue.addClass(this.__closeButton,a.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(ue.addClass(this.__closeButton,a.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),ue.bind(this.__closeButton,"click",function(){t.closed=!t.closed})}else{i.closed===void 0&&(i.closed=!0);var h=document.createTextNode(i.name);ue.addClass(h,"controller-name"),o=Qh(t,h);var d=function(u){return u.preventDefault(),t.closed=!t.closed,!1};ue.addClass(this.__ul,a.CLASS_CLOSED),ue.addClass(o,"title"),ue.bind(o,"click",d),i.closed||(this.closed=!1)}i.autoPlace&&(Se.isUndefined(i.parent)&&(yf&&(Tr=document.createElement("div"),ue.addClass(Tr,gf),ue.addClass(Tr,a.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Tr),yf=!1),Tr.appendChild(this.domElement),ue.addClass(this.domElement,a.CLASS_AUTO_PLACE)),this.parent||uh(t,i.width)),this.__resizeHandler=function(){t.onResizeDebounced()},ue.bind(window,"resize",this.__resizeHandler),ue.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),ue.bind(this.__ul,"transitionend",this.__resizeHandler),ue.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&xM(this),r=function(){Eo&&localStorage.getItem(Cr(t,"isLocal"))==="true"&&localStorage.setItem(Cr(t,"gui"),JSON.stringify(t.getSaveObject()))},this.saveToLocalStorageIfPossible=r;function f(){var c=t.getRoot();c.width+=1,Se.defer(function(){c.width-=1})}i.parent||f()};Vt.toggleHide=function(){Ac=!Ac,Se.each(tm,function(a){a.domElement.style.display=Ac?"none":""})};Vt.CLASS_AUTO_PLACE="a";Vt.CLASS_AUTO_PLACE_CONTAINER="ac";Vt.CLASS_MAIN="main";Vt.CLASS_CONTROLLER_ROW="cr";Vt.CLASS_TOO_TALL="taller-than-window";Vt.CLASS_CLOSED="closed";Vt.CLASS_CLOSE_BUTTON="close-button";Vt.CLASS_CLOSE_TOP="close-top";Vt.CLASS_CLOSE_BOTTOM="close-bottom";Vt.CLASS_DRAG="drag";Vt.DEFAULT_WIDTH=245;Vt.TEXT_CLOSED="Close Controls";Vt.TEXT_OPEN="Open Controls";Vt._keydownHandler=function(a){document.activeElement.type!=="text"&&(a.which===vf||a.keyCode===vf)&&Vt.toggleHide()};ue.bind(window,"keydown",Vt._keydownHandler,!1);Se.extend(Vt.prototype,{add:function(e,t){return Fo(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return Fo(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;Se.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Tr.removeChild(this.domElement);var e=this;Se.each(this.__folders,function(t){e.removeFolder(t)}),ue.unbind(window,"keydown",Vt._keydownHandler,!1),xf(this)},addFolder:function(e){if(this.__folders[e]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var i=new Vt(t);this.__folders[e]=i;var s=Qh(this,i.domElement);return ue.addClass(s,"folder"),i},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],xf(e);var t=this;Se.each(e.__folders,function(i){e.removeFolder(i)}),Se.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=ue.getOffset(e.__ul).top,i=0;Se.each(e.__ul.childNodes,function(s){e.autoPlace&&s===e.__save_row||(i+=ue.getHeight(s))}),window.innerHeight-t-_f<i?(ue.addClass(e.domElement,Vt.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-_f+"px"):(ue.removeClass(e.domElement,Vt.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&Se.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:Se.debounce(function(){this.onResize()},50),remember:function(){if(Se.isUndefined(Lo)&&(Lo=new gM,Lo.domElement.innerHTML=dM),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;Se.each(Array.prototype.slice.call(arguments),function(t){e.__rememberedObjects.length===0&&yM(e),e.__rememberedObjects.indexOf(t)===-1&&e.__rememberedObjects.push(t)}),this.autoPlace&&uh(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=Wa(this)),e.folders={},Se.each(this.__folders,function(t,i){e.folders[i]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Wa(this),ch(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[Xo]=Wa(this,!0)),this.load.remembered[e]=Wa(this),this.preset=e,hh(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){Se.each(this.__controllers,function(t){this.getRoot().load.remembered?im(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),Se.each(this.__folders,function(t){t.revert(t)}),e||ch(this.getRoot(),!1)},listen:function(e){var t=this.__listening.length===0;this.__listening.push(e),t&&nm(this.__listening)},updateDisplay:function(){Se.each(this.__controllers,function(e){e.updateDisplay()}),Se.each(this.__folders,function(e){e.updateDisplay()})}});function Qh(a,e,t){var i=document.createElement("li");return e&&i.appendChild(e),t?a.__ul.insertBefore(i,t):a.__ul.appendChild(i),a.onResize(),i}function xf(a){ue.unbind(window,"resize",a.__resizeHandler),a.saveToLocalStorageIfPossible&&ue.unbind(window,"unload",a.saveToLocalStorageIfPossible)}function ch(a,e){var t=a.__preset_select[a.__preset_select.selectedIndex];e?t.innerHTML=t.value+"*":t.innerHTML=t.value}function _M(a,e,t){if(t.__li=e,t.__gui=a,Se.extend(t,{options:function(o){if(arguments.length>1){var l=t.__li.nextElementSibling;return t.remove(),Fo(a,t.object,t.property,{before:l,factoryArgs:[Se.toArray(arguments)]})}if(Se.isArray(o)||Se.isObject(o)){var h=t.__li.nextElementSibling;return t.remove(),Fo(a,t.object,t.property,{before:h,factoryArgs:[o]})}},name:function(o){return t.__li.firstElementChild.firstElementChild.innerHTML=o,t},listen:function(){return t.__gui.listen(t),t},remove:function(){return t.__gui.remove(t),t}}),t instanceof ah){var i=new xl(t.object,t.property,{min:t.__min,max:t.__max,step:t.__step});Se.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(r){var o=t[r],l=i[r];t[r]=i[r]=function(){var h=Array.prototype.slice.call(arguments);return l.apply(i,h),o.apply(t,h)}}),ue.addClass(e,"has-slider"),t.domElement.insertBefore(i.domElement,t.domElement.firstElementChild)}else if(t instanceof xl){var s=function(o){if(Se.isNumber(t.__min)&&Se.isNumber(t.__max)){var l=t.__li.firstElementChild.firstElementChild.innerHTML,h=t.__gui.__listening.indexOf(t)>-1;t.remove();var d=Fo(a,t.object,t.property,{before:t.__li.nextElementSibling,factoryArgs:[t.__min,t.__max,t.__step]});return d.name(l),h&&d.listen(),d}return o};t.min=Se.compose(s,t.min),t.max=Se.compose(s,t.max)}else t instanceof Qp?(ue.bind(e,"click",function(){ue.fakeEvent(t.__checkbox,"click")}),ue.bind(t.__checkbox,"click",function(r){r.stopPropagation()})):t instanceof em?(ue.bind(e,"click",function(){ue.fakeEvent(t.__button,"click")}),ue.bind(e,"mouseover",function(){ue.addClass(t.__button,"hover")}),ue.bind(e,"mouseout",function(){ue.removeClass(t.__button,"hover")})):t instanceof lh&&(ue.addClass(e,"color"),t.updateDisplay=Se.compose(function(r){return e.style.borderLeftColor=t.__color.toString(),r},t.updateDisplay),t.updateDisplay());t.setValue=Se.compose(function(r){return a.getRoot().__preset_select&&t.isModified()&&ch(a.getRoot(),!0),r},t.setValue)}function im(a,e){var t=a.getRoot(),i=t.__rememberedObjects.indexOf(e.object);if(i!==-1){var s=t.__rememberedObjectIndecesToControllers[i];if(s===void 0&&(s={},t.__rememberedObjectIndecesToControllers[i]=s),s[e.property]=e,t.load&&t.load.remembered){var r=t.load.remembered,o=void 0;if(r[a.preset])o=r[a.preset];else if(r[Xo])o=r[Xo];else return;if(o[i]&&o[i][e.property]!==void 0){var l=o[i][e.property];e.initialValue=l,e.setValue(l)}}}}function Fo(a,e,t,i){if(e[t]===void 0)throw new Error('Object "'+e+'" has no property "'+t+'"');var s=void 0;if(i.color)s=new lh(e,t);else{var r=[e,t].concat(i.factoryArgs);s=fM.apply(a,r)}i.before instanceof ir&&(i.before=i.before.__li),im(a,s),ue.addClass(s.domElement,"c");var o=document.createElement("span");ue.addClass(o,"property-name"),o.innerHTML=s.property;var l=document.createElement("div");l.appendChild(o),l.appendChild(s.domElement);var h=Qh(a,l,i.before);return ue.addClass(h,Vt.CLASS_CONTROLLER_ROW),s instanceof lh?ue.addClass(h,"color"):ue.addClass(h,nM(s.getValue())),_M(a,h,s),a.__controllers.push(s),s}function Cr(a,e){return document.location.href+"."+e}function hh(a,e,t){var i=document.createElement("option");i.innerHTML=e,i.value=e,a.__preset_select.appendChild(i),t&&(a.__preset_select.selectedIndex=a.__preset_select.length-1)}function bf(a,e){e.style.display=a.useLocalStorage?"block":"none"}function yM(a){var e=a.__save_row=document.createElement("li");ue.addClass(a.domElement,"has-save"),a.__ul.insertBefore(e,a.__ul.firstChild),ue.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",ue.addClass(t,"button gears");var i=document.createElement("span");i.innerHTML="Save",ue.addClass(i,"button"),ue.addClass(i,"save");var s=document.createElement("span");s.innerHTML="New",ue.addClass(s,"button"),ue.addClass(s,"save-as");var r=document.createElement("span");r.innerHTML="Revert",ue.addClass(r,"button"),ue.addClass(r,"revert");var o=a.__preset_select=document.createElement("select");if(a.load&&a.load.remembered?Se.each(a.load.remembered,function(c,u){hh(a,u,u===a.preset)}):hh(a,Xo,!1),ue.bind(o,"change",function(){for(var c=0;c<a.__preset_select.length;c++)a.__preset_select[c].innerHTML=a.__preset_select[c].value;a.preset=this.value}),e.appendChild(o),e.appendChild(t),e.appendChild(i),e.appendChild(s),e.appendChild(r),Eo){var l=document.getElementById("dg-local-explain"),h=document.getElementById("dg-local-storage"),d=document.getElementById("dg-save-locally");d.style.display="block",localStorage.getItem(Cr(a,"isLocal"))==="true"&&h.setAttribute("checked","checked"),bf(a,l),ue.bind(h,"change",function(){a.useLocalStorage=!a.useLocalStorage,bf(a,l)})}var f=document.getElementById("dg-new-constructor");ue.bind(f,"keydown",function(c){c.metaKey&&(c.which===67||c.keyCode===67)&&Lo.hide()}),ue.bind(t,"click",function(){f.innerHTML=JSON.stringify(a.getSaveObject(),void 0,2),Lo.show(),f.focus(),f.select()}),ue.bind(i,"click",function(){a.save()}),ue.bind(s,"click",function(){var c=prompt("Enter a new preset name.");c&&a.saveAs(c)}),ue.bind(r,"click",function(){a.revert()})}function xM(a){var e=void 0;a.__resize_handle=document.createElement("div"),Se.extend(a.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function t(r){return r.preventDefault(),a.width+=e-r.clientX,a.onResize(),e=r.clientX,!1}function i(){ue.removeClass(a.__closeButton,Vt.CLASS_DRAG),ue.unbind(window,"mousemove",t),ue.unbind(window,"mouseup",i)}function s(r){return r.preventDefault(),e=r.clientX,ue.addClass(a.__closeButton,Vt.CLASS_DRAG),ue.bind(window,"mousemove",t),ue.bind(window,"mouseup",i),!1}ue.bind(a.__resize_handle,"mousedown",s),ue.bind(a.__closeButton,"mousedown",s),a.domElement.insertBefore(a.__resize_handle,a.domElement.firstElementChild)}function uh(a,e){a.domElement.style.width=e+"px",a.__save_row&&a.autoPlace&&(a.__save_row.style.width=e+"px"),a.__closeButton&&(a.__closeButton.style.width=e+"px")}function Wa(a,e){var t={};return Se.each(a.__rememberedObjects,function(i,s){var r={},o=a.__rememberedObjectIndecesToControllers[s];Se.each(o,function(l,h){r[h]=e?l.initialValue:l.getValue()}),t[s]=r}),t}function bM(a){for(var e=0;e<a.__preset_select.length;e++)a.__preset_select[e].value===a.preset&&(a.__preset_select.selectedIndex=e)}function nm(a){a.length!==0&&mM.call(window,function(){nm(a)}),Se.each(a,function(e){e.updateDisplay()})}var wM=Vt;class nr{constructor(){this.callbacks={},this.callbacks.base={}}on(e,t){const i=this;return typeof e>"u"||e===""?(console.warn("wrong names"),!1):typeof t>"u"?(console.warn("wrong callback"),!1):(this.resolveNames(e).forEach(function(r){const o=i.resolveName(r);i.callbacks[o.namespace]instanceof Object||(i.callbacks[o.namespace]={}),i.callbacks[o.namespace][o.value]instanceof Array||(i.callbacks[o.namespace][o.value]=[]),i.callbacks[o.namespace][o.value].push(t)}),this)}off(e){const t=this;return typeof e>"u"||e===""?(console.warn("wrong name"),!1):(this.resolveNames(e).forEach(function(s){const r=t.resolveName(s);if(r.namespace!=="base"&&r.value==="")delete t.callbacks[r.namespace];else if(r.namespace==="base")for(const o in t.callbacks)t.callbacks[o]instanceof Object&&t.callbacks[o][r.value]instanceof Array&&(delete t.callbacks[o][r.value],Object.keys(t.callbacks[o]).length===0&&delete t.callbacks[o]);else t.callbacks[r.namespace]instanceof Object&&t.callbacks[r.namespace][r.value]instanceof Array&&(delete t.callbacks[r.namespace][r.value],Object.keys(t.callbacks[r.namespace]).length===0&&delete t.callbacks[r.namespace])}),this)}trigger(e,t){if(typeof e>"u"||e==="")return console.warn("wrong name"),!1;const i=this;let s=null;const r=t instanceof Array?t:[];let o=this.resolveNames(e);if(o=this.resolveName(o[0]),o.namespace==="base")for(const l in i.callbacks)i.callbacks[l]instanceof Object&&i.callbacks[l][o.value]instanceof Array&&i.callbacks[l][o.value].forEach(function(h){h.apply(i,r)});else if(this.callbacks[o.namespace]instanceof Object){if(o.value==="")return console.warn("wrong name"),this;i.callbacks[o.namespace][o.value].forEach(function(l){l.apply(i,r)})}return s}resolveNames(e){let t=e;return t=t.replace(/[^a-zA-Z0-9 ,/.]/g,""),t=t.replace(/[,/]+/g," "),t=t.split(" "),t}resolveName(e){const t={},i=e.split(".");return t.original=e,t.value=i[0],t.namespace="base",i.length>1&&i[1]!==""&&(t.namespace=i[1]),t}}class MM extends nr{constructor(){super(),this.viewport={},this.$sizeViewport=document.createElement("div"),this.$sizeViewport.style.width="100vw",this.$sizeViewport.style.height="100vh",this.$sizeViewport.style.position="absolute",this.$sizeViewport.style.top=0,this.$sizeViewport.style.left=0,this.$sizeViewport.style.pointerEvents="none",this.resize=this.resize.bind(this),window.addEventListener("resize",this.resize),this.resize()}resize(){document.body.appendChild(this.$sizeViewport),this.viewport.width=this.$sizeViewport.offsetWidth,this.viewport.height=this.$sizeViewport.offsetHeight,document.body.removeChild(this.$sizeViewport),this.width=window.innerWidth,this.height=window.innerHeight,this.trigger("resize")}}class SM extends nr{constructor(){super(),this.start=Date.now(),this.current=this.start,this.elapsed=0,this.delta=16,this.tick=this.tick.bind(this),this.tick()}tick(){this.ticker=window.requestAnimationFrame(this.tick);const e=Date.now();this.delta=e-this.current,this.elapsed=e-this.start,this.current=e,this.delta>60&&(this.delta=60),this.trigger("tick")}stop(){window.cancelAnimationFrame(this.ticker)}}var AM=`uniform sampler2D tShadow;
uniform vec3 uShadowColor;
uniform float uAlpha;

varying vec2 vUv;

void main()
{
    float shadowAlpha = 1.0 - texture2D(tShadow, vUv).r;
    shadowAlpha *= uAlpha;

    gl_FragColor = vec4(uShadowColor, shadowAlpha);
}`,EM=`varying vec2 vUv;

void main()
{
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`;function TM(){const a={tShadow:{value:null},uShadowColor:{value:null},uAlpha:{value:null}};return new fi({wireframe:!1,transparent:!0,uniforms:a,vertexShader:EM,fragmentShader:AM})}var CM=`#define TOTO
#define MATCAP
#define USE_MATCAP

uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
uniform vec3 uColor;

varying vec3 vViewPosition;

uniform mat3 normalMatrix;
uniform float uIndirectDistanceAmplitude;
uniform float uIndirectDistanceStrength;
uniform float uIndirectDistancePower;
uniform float uIndirectAngleStrength;
uniform float uIndirectAngleOffset;
uniform float uIndirectAnglePower;
uniform vec3 uIndirectColor;

varying vec3 vWorldPosition;

#ifndef FLAT_SHADED

    varying vec3 vNormal;

#endif

#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>

#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

    if(vWorldPosition.z < 0.0)
    {
        discard;
    }

    #include <clipping_planes_fragment>

    vec4 diffuseColor = vec4( diffuse * uColor, opacity );

    #include <logdepthbuf_fragment>
    #include <map_fragment>
    #include <alphamap_fragment>
    #include <alphatest_fragment>
    #include <normal_fragment_begin>
    #include <normal_fragment_maps>

    vec3 viewDir = normalize( vViewPosition );
    vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
    vec3 y = cross( viewDir, x );
    vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; 

    #ifdef USE_MATCAP

        vec4 matcapColor = texture2D( matcap, uv );
        

    #else

        vec4 matcapColor = vec4( 1.0 );

    #endif

    vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;

    
    float indirectDistanceStrength = clamp(1.0 - vWorldPosition.z / uIndirectDistanceAmplitude, 0.0, 1.0) * uIndirectDistanceStrength;
    indirectDistanceStrength = pow(indirectDistanceStrength, uIndirectDistancePower);
    indirectDistanceStrength = clamp(indirectDistanceStrength, 0.0, 1.0);

    vec3 worldNormal = inverseTransformDirection(vNormal, viewMatrix);

    float indirectAngleStrength = dot(normalize(worldNormal), vec3(0.0, 0.0, - 1.0)) + uIndirectAngleOffset;
    indirectAngleStrength = clamp(indirectAngleStrength * uIndirectAngleStrength, 0.0, 1.0);
    indirectAngleStrength = pow(indirectAngleStrength, uIndirectAnglePower);

    
    float indirectStrength = indirectDistanceStrength * indirectAngleStrength;
    

    
    
    
    gl_FragColor = vec4(mix(outgoingLight, uIndirectColor, indirectStrength), diffuseColor.a);
    

	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,RM=`#define TOTO
#define MATCAP
#define USE_MATCAP

varying vec3 vViewPosition;

#ifndef FLAT_SHADED

    varying vec3 vNormal;

#endif

#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>

#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

uniform float uRevealProgress;

varying vec3 vWorldPosition;

#define M_PI 3.1415926535897932384626433832795

float easeSin(float _value)
{
    return sin((_value - 0.5) * M_PI) * 0.5 + 0.5;
}

void main() {

    #include <uv_vertex>

    #include <beginnormal_vertex>
    #include <morphnormal_vertex>
    #include <skinbase_vertex>
    #include <skinnormal_vertex>
    #include <defaultnormal_vertex>

    #ifndef FLAT_SHADED 

        vNormal = normalize( transformedNormal );

    #endif

    #include <begin_vertex>
    #include <morphtarget_vertex>
    #include <skinning_vertex>
    #include <displacementmap_vertex>

    
    vec4 worldNormal = modelMatrix * vec4(normal, 1.0);

    vec4 worldPosition = modelMatrix * vec4(transformed, 1.0);

    
    float distanceToCenter = length(worldPosition);
    float zAmplitude = 3.2;
    float revealProgress = (uRevealProgress - distanceToCenter / 30.0) * 5.0;
    revealProgress = 1.0 - clamp(revealProgress, - 0.1, 1.0);
    revealProgress = pow(revealProgress, 2.0);
    if(uRevealProgress > 0.9)
    {
        revealProgress = 0.0;
    }
    worldPosition.z -= revealProgress * zAmplitude;

    
    vWorldPosition = worldPosition.xyz;

    vec4 mvPosition = viewMatrix * worldPosition;
    gl_Position = projectionMatrix * mvPosition;
    

    

    #include <logdepthbuf_vertex>
    #include <clipping_planes_vertex>
    #include <fog_vertex>

    vViewPosition = - mvPosition.xyz;

}`;function ui(){const a={...He.common,...He.bumpmap,...He.normalmap,...He.displacementmap,...He.fog,matcap:{value:null},uColor:{value:new Le(16777215)},uRevealProgress:{value:null},uIndirectDistanceAmplitude:{value:null},uIndirectDistanceStrength:{value:null},uIndirectDistancePower:{value:null},uIndirectAngleStrength:{value:null},uIndirectAngleOffset:{value:null},uIndirectAnglePower:{value:null},uIndirectColor:{value:null}},e={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},t={MATCAP:""};return new fi({wireframe:!1,transparent:!1,uniforms:a,extensions:e,defines:t,lights:!1,vertexShader:RM,fragmentShader:CM})}class PM{constructor(e){this.resources=e.resources,this.debug=e.debug,this.debug&&(this.debugFolder=this.debug.addFolder("materials"),this.debugFolder.open()),this.items={},this.setPures(),this.setShades(),this.setFloorShadow()}setPures(){this.pures={},this.pures.items={},this.pures.items.uc=new fi({uniforms:{color1:{value:new Le("#04F404")},color2:{value:new Le("#02752c")}},vertexShader:`
                varying vec2 vUv;
                void main() {
                    vUv = uv;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `,fragmentShader:`
                uniform vec3 color1;
                uniform vec3 color2;
                varying vec2 vUv;
                void main() {
                    gl_FragColor = vec4(mix(color1, color2, vUv.y), 1.0);
                }
            `,name:"pureUc"}),this.pures.items.uc=new fi({uniforms:{color1:{value:new Le("#04F404")},color2:{value:new Le("#02752c")}},vertexShader:`
                varying vec2 vUv;
                void main() {
                    vUv = uv;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `,fragmentShader:`
                uniform vec3 color1;
                uniform vec3 color2;
                varying vec2 vUv;
                void main() {
                    gl_FragColor = vec4(mix(color1, color2, vUv.y), 1.0);
                }
            `,name:"00066F"}),this.pures.items.red=new Ne({color:16711680}),this.pures.items.red.name="pureRed",this.pures.items.white=new Ne({color:16777215}),this.pures.items.white.name="pureWhite",this.pures.items.yellow=new Ne({color:16771209}),this.pures.items.yellow.name="pureYellow",this.pures.items.golden=new Ne({color:16766720}),this.pures.items.golden.name="pureGolden",this.pures.items.customcolor1=new Ne({color:324612}),this.pures.items.customcolor1.name="04F404",this.pures.items.customcolor2=new Ne({color:3158064}),this.pures.items.customcolor2.name="303030",this.pures.items.customcolor3=new Ne({color:7172967}),this.pures.items.customcolor3.name="6D7367",this.pures.items.customcolor4=new Ne({color:14147298}),this.pures.items.customcolor4.name="D7DEE2",this.pures.items.customcolor5=new Ne({color:15417151}),this.pures.items.customcolor5.name="EB3F3F",this.pures.items.customcolor6=new Ne({color:5204628}),this.pures.items.customcolor6.name="4F6A94",this.pures.items.customcolor7=new Ne({color:15658734}),this.pures.items.customcolor7.name="EEEEEE",this.pures.items.customcolor8=new Ne({color:15417151}),this.pures.items.customcolor8.name="EB3F3F",this.pures.items.customcolor9=new Ne({color:41628}),this.pures.items.customcolor9.name="00A29C",this.pures.items.customcolor10=new Ne({color:3619389}),this.pures.items.customcolor10.name="373A3D",this.pures.items.customcolor11=new Ne({color:16712192}),this.pures.items.customcolor11.name="FF0200",this.pures.items.customcolor12=new Ne({color:16764912}),this.pures.items.customcolor12.name="FFCFF0",this.pures.items.customcolor13=new Ne({color:7434609}),this.pures.items.customcolor13.name="717171",this.pures.items.customcolor14=new Ne({color:1253927}),this.pures.items.customcolor14.name="132227",this.pures.items.customcolor15=new Ne({color:111587}),this.pures.items.customcolor15.name="01B3E3",this.pures.items.customcolor16=new Ne({color:14606046}),this.pures.items.customcolor16.name="DEDEDE",this.pures.items.customcolor17=new Ne({color:11645361}),this.pures.items.customcolor17.name="B1B1B1",this.pures.items.customcolor18=new Ne({color:1999871}),this.pures.items.customcolor18.name="1E83FF",this.pures.items.customcolor19=new Ne({color:15329769}),this.pures.items.customcolor19.name="E9E9E9",this.pures.items.customcolor20=new Ne({color:4837070}),this.pures.items.customcolor20.name="49CECE",this.pures.items.customcolor21=new Ne({color:2522219}),this.pures.items.customcolor21.name="267C6B",this.pures.items.customcolor22=new Ne({color:5019903}),this.pures.items.customcolor22.name="4C98FF",this.pures.items.customcolor23=new Ne({color:13410675}),this.pures.items.customcolor23.name="CCA173",this.pures.items.customcolor24=new Ne({color:13750737}),this.pures.items.customcolor24.name="D1D1D1",this.pures.items.customcolor25=new Ne({color:13295871}),this.pures.items.customcolor25.name="CAE0FF",this.pures.items.customcolor26=new Ne({color:12303291}),this.pures.items.customcolor26.name="BBBBBB",this.pures.items.customcolor27=new Ne({color:15447375}),this.pures.items.customcolor27.name="EBB54F",this.pures.items.customcolor28=new Ne({color:2576415}),this.pures.items.customcolor28.name="27501F",this.pures.items.customcolor29=new Ne({color:7750203}),this.pures.items.customcolor29.name="76423B",this.pures.items.customcolor30=new Ne({color:9227632}),this.pures.items.customcolor30.name="8CCD70",this.pures.items.customcolor31=new Ne({color:16777215}),this.pures.items.customcolor31.name="FFFFFF",this.pures.items.customcolor32=new Ne({color:14261081}),this.pures.items.customcolor32.name="D99B59",this.pures.items.customcolor33=new Ne({color:13893632}),this.pures.items.customcolor33.name="D40000",this.pures.items.customcolor34=new Ne({color:16776179}),this.pures.items.customcolor34.name="FFFBF3",this.pures.items.customcolor35=new Ne({color:9806257}),this.pures.items.customcolor35.name="95A1B1",this.pures.items.customcolor36=new Ne({color:16379351}),this.pures.items.customcolor36.name="F9EDD7",this.pures.items.customcolor37=new Ne({color:13618375}),this.pures.items.customcolor37.name="CFCCC7",this.pures.items.customcolor38=new Ne({color:16053235}),this.pures.items.customcolor38.name="F4F3F3",this.pures.items.customcolor39=new Ne({color:41728}),this.pures.items.customcolor39.name="00A300",this.pures.items.customcolor40=new Ne({color:16774086}),this.pures.items.customcolor40.name="FFF3C6",this.pures.items.customcolor41=new Ne({color:1253927}),this.pures.items.customcolor41.name="132227",this.pures.items.customcolor42=new Ne({color:16692042}),this.pures.items.customcolor42.name="FEB34A",this.pures.items.customcolor43=new Ne({color:4210753}),this.pures.items.customcolor43.name="404041",this.pures.items.customcolor44=new Ne({color:12435660}),this.pures.items.customcolor44.name="BDC0CC",this.pures.items.customcolor45=new Ne({color:7303023}),this.pures.items.customcolor45.name="6F6F6F",this.pures.items.customcolor46=new Ne({color:12311295}),this.pures.items.customcolor46.name="BBDAFF",this.pures.items.customcolor47=new Ne({color:12435660}),this.pures.items.customcolor47.name="BDC0CC",this.pures.items.customcolor48=new Ne({color:6052956}),this.pures.items.customcolor48.name="5C5C5C",this.pures.items.customcolor49=new Ne({color:13470561}),this.pures.items.customcolor49.name="CD8B61",this.pures.items.customcolor50=new Ne({color:7466220}),this.pures.items.customcolor50.name="71ECEC"}setShades(){if(this.shades={},this.shades.items={},this.shades.indirectColor="#d04500",this.shades.uniforms={uRevealProgress:0,uIndirectDistanceAmplitude:1.75,uIndirectDistanceStrength:.5,uIndirectDistancePower:2,uIndirectAngleStrength:1.5,uIndirectAngleOffset:.6,uIndirectAnglePower:1,uIndirectColor:null},this.shades.items.white=new ui,this.shades.items.white.name="shadeWhite",this.shades.items.white.uniforms.matcap.value=this.resources.items.matcapWhiteTexture,this.items.white=this.shades.items.white,this.shades.items.orange=new ui,this.shades.items.orange.name="shadeOrange",this.shades.items.orange.uniforms.matcap.value=this.resources.items.matcapOrangeTexture,this.items.orange=this.shades.items.orange,this.shades.items.green=new ui,this.shades.items.green.name="",this.shades.items.green.uniforms.matcap.value=this.resources.items.matcapGreenTexture,this.items.green=this.shades.items.green,this.shades.items.brown=new ui,this.shades.items.brown.name="shadeBrown",this.shades.items.brown.uniforms.matcap.value=this.resources.items.matcapBrownTexture,this.items.brown=this.shades.items.brown,this.shades.items.gray=new ui,this.shades.items.gray.name="shadeGray",this.shades.items.gray.uniforms.matcap.value=this.resources.items.matcapGrayTexture,this.items.gray=this.shades.items.gray,this.shades.items.beige=new ui,this.shades.items.beige.name="shadeBeige",this.shades.items.beige.uniforms.matcap.value=this.resources.items.matcapBeigeTexture,this.items.beige=this.shades.items.beige,this.shades.items.red=new ui,this.shades.items.red.name="shadeRed",this.shades.items.red.uniforms.matcap.value=this.resources.items.matcapRedTexture,this.items.red=this.shades.items.red,this.shades.items.black=new ui,this.shades.items.black.name="shadeBlack",this.shades.items.black.uniforms.matcap.value=this.resources.items.matcapBlackTexture,this.items.black=this.shades.items.black,this.shades.items.emeraldGreen=new ui,this.shades.items.emeraldGreen.name="shadeEmeraldGreen",this.shades.items.emeraldGreen.uniforms.matcap.value=this.resources.items.matcapEmeraldGreenTexture,this.items.emeraldGreen=this.shades.items.emeraldGreen,this.shades.items.purple=new ui,this.shades.items.purple.name="shadePurple",this.shades.items.purple.uniforms.matcap.value=this.resources.items.matcapPurpleTexture,this.items.purple=this.shades.items.purple,this.shades.items.blue=new ui,this.shades.items.blue.name="shadeBlue",this.shades.items.blue.uniforms.matcap.value=this.resources.items.matcapBlueTexture,this.items.blue=this.shades.items.blue,this.shades.items.yellow=new ui,this.shades.items.yellow.name="shadeYellow",this.shades.items.yellow.uniforms.matcap.value=this.resources.items.matcapYellowTexture,this.items.yellow=this.shades.items.yellow,this.shades.items.metal=new ui,this.shades.items.metal.name="shadeMetal",this.shades.items.metal.uniforms.matcap.value=this.resources.items.matcapMetalTexture,this.items.metal=this.shades.items.metal,this.shades.items.hubitBlack=new ui,this.shades.items.hubitBlack.name="shadeHubitBlack",this.shades.items.hubitBlack.uniforms.matcap.value=this.resources.items.matcapBlackTexture,this.shades.items.hubitBlack.uniforms.uColor.value=new Le(1973790),this.items.hubitBlack=this.shades.items.hubitBlack,this.shades.items.hubitBlue=new ui,this.shades.items.hubitBlue.name="shadeHubitBlue",this.shades.items.hubitBlue.uniforms.matcap.value=this.resources.items.matcapBlueTexture,this.shades.items.hubitBlue.uniforms.uColor.value=new Le(5999861),this.items.hubitBlue=this.shades.items.hubitBlue,this.shades.items.hubitDarkBlue=new ui,this.shades.items.hubitDarkBlue.name="shadeHubitDarkBlue",this.shades.items.hubitDarkBlue.uniforms.matcap.value=this.resources.items.matcapBlueTexture,this.shades.items.hubitDarkBlue.uniforms.uColor.value=new Le(2572165),this.items.hubitDarkBlue=this.shades.items.hubitDarkBlue,this.shades.items.hubitWhite=new ui,this.shades.items.hubitWhite.name="shadeHubitWhite",this.shades.items.hubitWhite.uniforms.matcap.value=this.resources.items.matcapWhiteTexture,this.shades.items.hubitWhite.uniforms.uColor.value=new Le(16119285),this.items.hubitWhite=this.shades.items.hubitWhite,this.shades.items.hubitRed=new ui,this.shades.items.hubitRed.name="shadeHubitRed",this.shades.items.hubitRed.uniforms.matcap.value=this.resources.items.matcapRedTexture,this.shades.items.hubitRed.uniforms.uColor.value=new Le(15022389),this.items.hubitRed=this.shades.items.hubitRed,this.shades.items.hubitGreen=new ui,this.shades.items.hubitGreen.name="shadeHubitGreen",this.shades.items.hubitGreen.uniforms.matcap.value=this.resources.items.matcapGreenTexture,this.shades.items.hubitGreen.uniforms.uColor.value=new Le(4431943),this.items.hubitGreen=this.shades.items.hubitGreen,this.shades.updateMaterials=()=>{this.shades.uniforms.uIndirectColor=new Le(this.shades.indirectColor);for(const e in this.shades.uniforms){const t=this.shades.uniforms[e];for(const i in this.shades.items){const s=this.shades.items[i];s.uniforms[e].value=t}}},this.shades.updateMaterials(),this.debug){const e=this.debugFolder.addFolder("shades");e.open(),e.add(this.shades.uniforms,"uIndirectDistanceAmplitude").step(.001).min(0).max(3).onChange(this.shades.updateMaterials),e.add(this.shades.uniforms,"uIndirectDistanceStrength").step(.001).min(0).max(2).onChange(this.shades.updateMaterials),e.add(this.shades.uniforms,"uIndirectDistancePower").step(.001).min(0).max(5).onChange(this.shades.updateMaterials),e.add(this.shades.uniforms,"uIndirectAngleStrength").step(.001).min(0).max(2).onChange(this.shades.updateMaterials),e.add(this.shades.uniforms,"uIndirectAngleOffset").step(.001).min(-2).max(2).onChange(this.shades.updateMaterials),e.add(this.shades.uniforms,"uIndirectAnglePower").step(.001).min(0).max(5).onChange(this.shades.updateMaterials),e.addColor(this.shades,"indirectColor").onChange(this.shades.updateMaterials)}}setFloorShadow(){if(this.items.floorShadow=new TM,this.items.floorShadow.depthWrite=!1,this.items.floorShadow.shadowColor="#5B8CF5",this.items.floorShadow.uniforms.uShadowColor.value=new Le(this.items.floorShadow.shadowColor),this.items.floorShadow.uniforms.uAlpha.value=0,this.items.floorShadow.updateMaterials=()=>{this.items.floorShadow.uniforms.uShadowColor.value=new Le(this.items.floorShadow.shadowColor);for(const e of this.objects.items)for(const t of e.container.children)t.material instanceof fi&&t.material.uniforms.uShadowColor&&(t.material.uniforms.uShadowColor.value=new Le(this.items.floorShadow.shadowColor))},this.debug){const e=this.debugFolder.addFolder("floorShadow");e.open(),e.addColor(this.items.floorShadow,"shadowColor").onChange(this.items.floorShadow.updateMaterials)}}}var IM=`uniform sampler2D tBackground;

varying vec2 vUv;

void main()
{
    vec4 backgroundColor = texture(tBackground, vUv);
    gl_FragColor = backgroundColor;
}`,LM=`varying vec2 vUv;

void main()
{
    vUv = uv;

    vec3 newPosition = position;
    newPosition.z = 1.0;
    gl_Position = vec4(newPosition, 1.0);
}`;function FM(){const a={tBackground:{value:null}};return new fi({wireframe:!1,transparent:!1,uniforms:a,vertexShader:LM,fragmentShader:IM})}class BM{constructor(e){if(this.debug=e.debug,this.container=new je,this.container.matrixAutoUpdate=!1,this.geometry=new pi(2,2,10,10),this.colors={},this.colors.topLeft="#808080",this.colors.topRight="#808080",this.colors.bottomRight="#808080",this.colors.bottomLeft="#808080",this.material=new FM,this.updateMaterial=()=>{const t=new Le(this.colors.topLeft),i=new Le(this.colors.topRight),s=new Le(this.colors.bottomRight),r=new Le(this.colors.bottomLeft);t.convertLinearToSRGB(),i.convertLinearToSRGB(),s.convertLinearToSRGB(),r.convertLinearToSRGB();const o=new Uint8Array([Math.round(r.r*255),Math.round(r.g*255),Math.round(r.b*255),255,Math.round(s.r*255),Math.round(s.g*255),Math.round(s.b*255),255,Math.round(t.r*255),Math.round(t.g*255),Math.round(t.b*255),255,Math.round(i.r*255),Math.round(i.g*255),Math.round(i.b*255),255]);this.backgroundTexture=new zh(o,2,2),this.backgroundTexture.magFilter=Nt,this.backgroundTexture.needsUpdate=!0,this.material.uniforms.tBackground.value=this.backgroundTexture},this.updateMaterial(),this.mesh=new Ae(this.geometry,this.material),this.mesh.frustumCulled=!1,this.mesh.matrixAutoUpdate=!1,this.mesh.updateMatrix(),this.container.add(this.mesh),this.debug){const t=this.debug.addFolder("floor");t.addColor(this.colors,"topLeft").onChange(this.updateMaterial),t.addColor(this.colors,"topRight").onChange(this.updateMaterial),t.addColor(this.colors,"bottomRight").onChange(this.updateMaterial),t.addColor(this.colors,"bottomLeft").onChange(this.updateMaterial)}}}var DM=`#define PI 3.141592653589793

uniform vec3 uColor;
uniform float uAlpha;
uniform float uFadeRadius;

varying vec2 vUv;

float sineInOut(float t)
{
    return - 0.5 * (cos(PI * t) - 1.0);
}

void main()
{
    float strength = 0.0;

    if(vUv.x < uFadeRadius && vUv.y < uFadeRadius)
    {
        strength = clamp(1.0 - distance(vUv, vec2(uFadeRadius)) / uFadeRadius, 0.0, 1.0);
    }

    else if(vUv.x > 1.0 - uFadeRadius && vUv.y < uFadeRadius)
    {
        strength = clamp(1.0 - distance(vUv, vec2(1.0 - uFadeRadius, uFadeRadius)) / uFadeRadius, 0.0, 1.0);
    }

    else if(vUv.x > 1.0 - uFadeRadius && vUv.y > 1.0 - uFadeRadius)
    {
        strength = clamp(1.0 - distance(vUv, vec2(1.0 - uFadeRadius, 1.0 - uFadeRadius)) / uFadeRadius, 0.0, 1.0);
    }

    else if(vUv.x < uFadeRadius && vUv.y > 1.0 - uFadeRadius)
    {
        strength = clamp(1.0 - distance(vUv, vec2(uFadeRadius, 1.0 - uFadeRadius)) / uFadeRadius, 0.0, 1.0);
    }

    else
    {
        float xNeg = clamp(vUv.x / uFadeRadius, 0.0, 1.0);
        float xPos = clamp((1.0 - vUv.x) / uFadeRadius, 0.0, 1.0);
        float yNeg = clamp(vUv.y / uFadeRadius, 0.0, 1.0);
        float yPos = clamp((1.0 - vUv.y) / uFadeRadius, 0.0, 1.0);

        strength = xNeg * xPos * yNeg * yPos;
    }

    strength = sineInOut(strength);
    strength *= uAlpha;

    gl_FragColor = vec4(uColor, strength);
	#include <colorspace_fragment>
}`,kM=`varying vec2 vUv;

void main()
{
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`;function NM(){const a={uColor:{value:null},uAlpha:{value:null},uFadeRadius:{value:null}};return new fi({wireframe:!1,transparent:!0,uniforms:a,vertexShader:kM,fragmentShader:DM})}const Ds=new $h,Ri=new T,as=new T,Yt=new Tt,wf={X:new T(1,0,0),Y:new T(0,1,0),Z:new T(0,0,1)},Ec={type:"change"},Mf={type:"mouseDown"},Sf={type:"mouseUp",mode:null},Af={type:"objectChange"};class sm extends je{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const i=new GM;this._gizmo=i,this.add(i);const s=new WM;this._plane=s,this.add(s);const r=this;function o(y,x){let b=x;Object.defineProperty(r,y,{get:function(){return b!==void 0?b:x},set:function(S){b!==S&&(b=S,s[y]=S,i[y]=S,r.dispatchEvent({type:y+"-changed",value:S}),r.dispatchEvent(Ec))}}),r[y]=x,s[y]=x,i[y]=x}o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const l=new T,h=new T,d=new Tt,f=new Tt,c=new T,u=new Tt,p=new T,m=new T,_=new T,g=0,v=new T;o("worldPosition",l),o("worldPositionStart",h),o("worldQuaternion",d),o("worldQuaternionStart",f),o("cameraPosition",c),o("cameraQuaternion",u),o("pointStart",p),o("pointEnd",m),o("rotationAxis",_),o("rotationAngle",g),o("eye",v),this._offset=new T,this._startNorm=new T,this._endNorm=new T,this._cameraScale=new T,this._parentPosition=new T,this._parentQuaternion=new Tt,this._parentQuaternionInv=new Tt,this._parentScale=new T,this._worldScaleStart=new T,this._worldQuaternionInv=new Tt,this._worldScale=new T,this._positionStart=new T,this._quaternionStart=new Tt,this._scaleStart=new T,this._getPointer=OM.bind(this),this._onPointerDown=zM.bind(this),this._onPointerHover=UM.bind(this),this._onPointerMove=VM.bind(this),this._onPointerUp=HM.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(e){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(e)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&Ds.setFromCamera(e,this.camera);const t=Tc(this._gizmo.picker[this.mode],Ds);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&Ds.setFromCamera(e,this.camera);const t=Tc(this._plane,Ds,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,Mf.mode=this.mode,this.dispatchEvent(Mf)}}pointerMove(e){const t=this.axis,i=this.mode,s=this.object;let r=this.space;if(i==="scale"?r="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(r="world"),s===void 0||t===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&Ds.setFromCamera(e,this.camera);const o=Tc(this._plane,Ds,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(s.position.applyQuaternion(Yt.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),r==="world"&&(s.parent&&s.position.add(Ri.setFromMatrixPosition(s.parent.matrixWorld)),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(Ri.setFromMatrixPosition(s.parent.matrixWorld))));else if(i==="scale"){if(t.search("XYZ")!==-1){let l=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(l*=-1),as.set(l,l,l)}else Ri.copy(this.pointStart),as.copy(this.pointEnd),Ri.applyQuaternion(this._worldQuaternionInv),as.applyQuaternion(this._worldQuaternionInv),as.divide(Ri),t.search("X")===-1&&(as.x=1),t.search("Y")===-1&&(as.y=1),t.search("Z")===-1&&(as.z=1);s.scale.copy(this._scaleStart).multiply(as),this.scaleSnap&&(t.search("X")!==-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const l=20/this.worldPosition.distanceTo(Ri.setFromMatrixPosition(this.camera.matrixWorld));let h=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Ri.copy(this.rotationAxis).cross(this.eye))*l):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(wf[t]),Ri.copy(wf[t]),r==="local"&&Ri.applyQuaternion(this.worldQuaternion),Ri.cross(this.eye),Ri.length()===0?h=!0:this.rotationAngle=this._offset.dot(Ri.normalize())*l),(t==="E"||h)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&t!=="E"&&t!=="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(Yt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(Yt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Ec),this.dispatchEvent(Af)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(Sf.mode=this.mode,this.dispatchEvent(Sf)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Ec),this.dispatchEvent(Af),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Ds}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function OM(a){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:a.button};{const e=this.domElement.getBoundingClientRect();return{x:(a.clientX-e.left)/e.width*2-1,y:-(a.clientY-e.top)/e.height*2+1,button:a.button}}}function UM(a){if(this.enabled)switch(a.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(a));break}}function zM(a){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(a.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(a)),this.pointerDown(this._getPointer(a)))}function VM(a){this.enabled&&this.pointerMove(this._getPointer(a))}function HM(a){this.enabled&&(this.domElement.releasePointerCapture(a.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(a)))}function Tc(a,e,t){const i=e.intersectObject(a,!0);for(let s=0;s<i.length;s++)if(i[s].object.visible||t)return i[s];return!1}const Xa=new At,Dt=new T(0,1,0),Ef=new T(0,0,0),Tf=new Je,ja=new Tt,tl=new Tt,Mn=new T,Cf=new Je,To=new T(1,0,0),zs=new T(0,1,0),Co=new T(0,0,1),Ya=new T,yo=new T,xo=new T;class GM extends je{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new Ne({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new tr({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;const s=t.clone();s.opacity=.5;const r=e.clone();r.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const l=e.clone();l.color.setHex(255);const h=e.clone();h.color.setHex(16711680),h.opacity=.5;const d=e.clone();d.color.setHex(65280),d.opacity=.5;const f=e.clone();f.color.setHex(255),f.opacity=.5;const c=e.clone();c.opacity=.25;const u=e.clone();u.color.setHex(16776960),u.opacity=.25,e.clone().color.setHex(16776960);const m=e.clone();m.color.setHex(7895160);const _=new oi(0,.04,.1,12);_.translate(0,.05,0);const g=new Ut(.08,.08,.08);g.translate(0,.04,0);const v=new Bt;v.setAttribute("position",new yt([0,0,0,1,0,0],3));const y=new oi(.0075,.0075,.5,3);y.translate(0,.25,0);function x(W,ee){const z=new Ws(W,.0075,3,64,ee*Math.PI*2);return z.rotateY(Math.PI/2),z.rotateX(Math.PI/2),z}function b(){const W=new Bt;return W.setAttribute("position",new yt([0,0,0,1,1,1],3)),W}const S={X:[[new Ae(_,r),[.5,0,0],[0,0,-Math.PI/2]],[new Ae(_,r),[-.5,0,0],[0,0,Math.PI/2]],[new Ae(y,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new Ae(_,o),[0,.5,0]],[new Ae(_,o),[0,-.5,0],[Math.PI,0,0]],[new Ae(y,o)]],Z:[[new Ae(_,l),[0,0,.5],[Math.PI/2,0,0]],[new Ae(_,l),[0,0,-.5],[-Math.PI/2,0,0]],[new Ae(y,l),null,[Math.PI/2,0,0]]],XYZ:[[new Ae(new Fr(.1,0),c.clone()),[0,0,0]]],XY:[[new Ae(new Ut(.15,.15,.01),f.clone()),[.15,.15,0]]],YZ:[[new Ae(new Ut(.15,.15,.01),h.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Ae(new Ut(.15,.15,.01),d.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},A={X:[[new Ae(new oi(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new Ae(new oi(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Ae(new oi(.2,0,.6,4),i),[0,.3,0]],[new Ae(new oi(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Ae(new oi(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new Ae(new oi(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new Ae(new Fr(.2,0),i)]],XY:[[new Ae(new Ut(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new Ae(new Ut(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Ae(new Ut(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},E={START:[[new Ae(new Fr(.01,2),s),null,null,null,"helper"]],END:[[new Ae(new Fr(.01,2),s),null,null,null,"helper"]],DELTA:[[new qi(b(),s),null,null,null,"helper"]],X:[[new qi(v,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new qi(v,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new qi(v,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},R={XYZE:[[new Ae(x(.5,1),m),null,[0,Math.PI/2,0]]],X:[[new Ae(x(.5,.5),r)]],Y:[[new Ae(x(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new Ae(x(.5,.5),l),null,[0,Math.PI/2,0]]],E:[[new Ae(x(.75,1),u),null,[0,Math.PI/2,0]]]},M={AXIS:[[new qi(v,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},w={XYZE:[[new Ae(new na(.25,10,8),i)]],X:[[new Ae(new Ws(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Ae(new Ws(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Ae(new Ws(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Ae(new Ws(.75,.1,2,24),i)]]},L={X:[[new Ae(g,r),[.5,0,0],[0,0,-Math.PI/2]],[new Ae(y,r),[0,0,0],[0,0,-Math.PI/2]],[new Ae(g,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new Ae(g,o),[0,.5,0]],[new Ae(y,o)],[new Ae(g,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new Ae(g,l),[0,0,.5],[Math.PI/2,0,0]],[new Ae(y,l),[0,0,0],[Math.PI/2,0,0]],[new Ae(g,l),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new Ae(new Ut(.15,.15,.01),f),[.15,.15,0]]],YZ:[[new Ae(new Ut(.15,.15,.01),h),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Ae(new Ut(.15,.15,.01),d),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Ae(new Ut(.1,.1,.1),c.clone())]]},N={X:[[new Ae(new oi(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new Ae(new oi(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Ae(new oi(.2,0,.6,4),i),[0,.3,0]],[new Ae(new oi(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Ae(new oi(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new Ae(new oi(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new Ae(new Ut(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new Ae(new Ut(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Ae(new Ut(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Ae(new Ut(.2,.2,.2),i),[0,0,0]]]},B={X:[[new qi(v,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new qi(v,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new qi(v,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function G(W){const ee=new je;for(const z in W)for(let k=W[z].length;k--;){const q=W[z][k][0].clone(),$=W[z][k][1],H=W[z][k][2],Q=W[z][k][3],X=W[z][k][4];q.name=z,q.tag=X,$&&q.position.set($[0],$[1],$[2]),H&&q.rotation.set(H[0],H[1],H[2]),Q&&q.scale.set(Q[0],Q[1],Q[2]),q.updateMatrix();const F=q.geometry.clone();F.applyMatrix4(q.matrix),q.geometry=F,q.renderOrder=1/0,q.position.set(0,0,0),q.rotation.set(0,0,0),q.scale.set(1,1,1),ee.add(q)}return ee}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=G(S)),this.add(this.gizmo.rotate=G(R)),this.add(this.gizmo.scale=G(L)),this.add(this.picker.translate=G(A)),this.add(this.picker.rotate=G(w)),this.add(this.picker.scale=G(N)),this.add(this.helper.translate=G(E)),this.add(this.helper.rotate=G(M)),this.add(this.helper.scale=G(B)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:tl;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let r=0;r<s.length;r++){const o=s[r];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let l;if(this.camera.isOrthographicCamera?l=(this.camera.top-this.camera.bottom)/this.camera.zoom:l=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(l*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(Yt.setFromEuler(Xa.set(0,0,0)),o.quaternion.copy(i).multiply(Yt),Math.abs(Dt.copy(To).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(Yt.setFromEuler(Xa.set(0,0,Math.PI/2)),o.quaternion.copy(i).multiply(Yt),Math.abs(Dt.copy(zs).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(Yt.setFromEuler(Xa.set(0,Math.PI/2,0)),o.quaternion.copy(i).multiply(Yt),Math.abs(Dt.copy(Co).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(Yt.setFromEuler(Xa.set(0,Math.PI/2,0)),Dt.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(Tf.lookAt(Ef,Dt,zs)),o.quaternion.multiply(Yt),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),Ri.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Ri.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(Ri),o.visible=this.dragging):(o.quaternion.copy(i),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(Dt.copy(To).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(Dt.copy(zs).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(Dt.copy(Co).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(Dt.copy(Co).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(Dt.copy(To).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(Dt.copy(zs).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(ja.copy(i),Dt.copy(this.eye).applyQuaternion(Yt.copy(i).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(Tf.lookAt(this.eye,Ef,zs)),o.name==="X"&&(Yt.setFromAxisAngle(To,Math.atan2(-Dt.y,Dt.z)),Yt.multiplyQuaternions(ja,Yt),o.quaternion.copy(Yt)),o.name==="Y"&&(Yt.setFromAxisAngle(zs,Math.atan2(Dt.x,Dt.z)),Yt.multiplyQuaternions(ja,Yt),o.quaternion.copy(Yt)),o.name==="Z"&&(Yt.setFromAxisAngle(Co,Math.atan2(Dt.y,Dt.x)),Yt.multiplyQuaternions(ja,Yt),o.quaternion.copy(Yt))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(h){return o.name===h}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(e)}}class WM extends Ae{constructor(){super(new pi(1e5,1e5,2,2),new Ne({visible:!1,wireframe:!0,side:Ui,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),Ya.copy(To).applyQuaternion(t==="local"?this.worldQuaternion:tl),yo.copy(zs).applyQuaternion(t==="local"?this.worldQuaternion:tl),xo.copy(Co).applyQuaternion(t==="local"?this.worldQuaternion:tl),Dt.copy(yo),this.mode){case"translate":case"scale":switch(this.axis){case"X":Dt.copy(this.eye).cross(Ya),Mn.copy(Ya).cross(Dt);break;case"Y":Dt.copy(this.eye).cross(yo),Mn.copy(yo).cross(Dt);break;case"Z":Dt.copy(this.eye).cross(xo),Mn.copy(xo).cross(Dt);break;case"XY":Mn.copy(xo);break;case"YZ":Mn.copy(Ya);break;case"XZ":Dt.copy(xo),Mn.copy(yo);break;case"XYZ":case"E":Mn.set(0,0,0);break}break;case"rotate":default:Mn.set(0,0,0)}Mn.length()===0?this.quaternion.copy(this.cameraQuaternion):(Cf.lookAt(Ri.set(0,0,0),Mn,Dt),this.quaternion.setFromRotationMatrix(Cf)),super.updateMatrixWorld(e)}}class XM{constructor(e){this.time=e.time,this.debug=e.debug,this.renderer=e.renderer,this.camera=e.camera,this.alpha=0,this.maxDistance=3,this.distancePower=2,this.zFightingDistance=.001,this.color="#d04500",this.wireframeVisible=!1,this.items=[],this.container=new je,this.container.matrixAutoUpdate=!1,this.container.updateMatrix(),this.debug&&(this.debugFolder=this.debug.addFolder("shadows"),this.debugFolder.add(this,"alpha").step(.01).min(0).max(1),this.debugFolder.add(this,"maxDistance").step(.01).min(0).max(10),this.debugFolder.add(this,"distancePower").step(.01).min(1).max(5),this.debugFolder.add(this,"wireframeVisible").name("wireframeVisible").onChange(()=>{for(const t of this.items)t.mesh.material=this.wireframeVisible?this.materials.wireframe:t.material}),this.debugFolder.addColor(this,"color").onChange(()=>{this.materials.base.uniforms.uColor.value=new Le(this.color);for(const t of this.items)t.material.uniforms.uColor.value=new Le(this.color)})),this.setSun(),this.setMaterials(),this.setGeometry(),this.setHelper(),this.time.on("tick",()=>{for(const t of this.items){const i=Math.max(t.reference.position.z+t.offsetZ,0),s=this.sun.vector.clone().multiplyScalar(i);t.mesh.position.x=t.reference.position.x+s.x,t.mesh.position.y=t.reference.position.y+s.y;const r=new T(1,0,0);r.applyQuaternion(t.reference.quaternion);const o=r.clone().projectOnPlane(new T(0,0,1));let l=Math.abs(r.angleTo(new T(0,0,1))-Math.PI*.5)/(Math.PI*.5);l/=.5,l-=1/.5,l=Math.abs(l),l=Math.min(Math.max(l,0),1);const h=Math.atan2(o.y,o.x);t.mesh.rotation.z=h;let d=(this.maxDistance-i)/this.maxDistance;d=Math.min(Math.max(d,0),1),d=Math.pow(d,this.distancePower),t.material.uniforms.uAlpha.value=this.alpha*t.alpha*l*d}})}setSun(){if(this.sun={},this.sun.position=new T(-2.5,-2.65,3.75),this.sun.vector=new T,this.sun.helper=new Jw(new T(0,0,1),new T(0,0,0),1,16777215,.1,.4),this.sun.helper.visible=!1,this.container.add(this.sun.helper),this.sun.update=()=>{this.sun.vector.copy(this.sun.position).multiplyScalar(1/this.sun.position.z).negate(),this.sun.helper.position.copy(this.sun.position);const e=this.sun.position.clone().negate().normalize();this.sun.helper.setDirection(e),this.sun.helper.setLength(this.sun.helper.position.length())},this.sun.update(),this.debug){const e=this.debugFolder.addFolder("sun");e.open(),e.add(this.sun.position,"x").step(.01).min(-10).max(10).name("sunX").onChange(this.sun.update),e.add(this.sun.position,"y").step(.01).min(-10).max(10).name("sunY").onChange(this.sun.update),e.add(this.sun.position,"z").step(.01).min(0).max(10).name("sunZ").onChange(this.sun.update),e.add(this.sun.helper,"visible").name("sunHelperVisible")}}setMaterials(){this.materials={},this.materials.wireframe=new Ne({color:16777215,wireframe:!0}),this.materials.base=new NM,this.materials.base.depthWrite=!1,this.materials.base.uniforms.uColor.value=new Le(this.color),this.materials.base.uniforms.uAlpha.value=0,this.materials.base.uniforms.uFadeRadius.value=.35}setGeometry(){this.geometry=new pi(1,1,1,1)}setHelper(){if(this.debug&&(this.helper={},this.helper.active=!1,this.helper.mesh=new Ae(new Ut(3,1,1,1),new el),this.helper.mesh.position.z=1.5,this.helper.mesh.position.y=-3,this.helper.mesh.visible=this.helper.active,this.container.add(this.helper.mesh),this.helper.transformControls=new sm(this.camera.instance,this.renderer.domElement),this.helper.transformControls.size=.5,this.helper.transformControls.attach(this.helper.mesh),this.helper.transformControls.visible=this.helper.active,this.helper.transformControls.enabled=this.helper.active,this.helper.shadow=this.add(this.helper.mesh,{sizeX:6,sizeY:2,offsetZ:-.35,alpha:.99}),this.helper.shadow.mesh.visible=this.helper.active,document.addEventListener("keydown",e=>{e.key==="r"?this.helper.transformControls.setMode("rotate"):e.key==="g"&&this.helper.transformControls.setMode("translate")}),this.helper.transformControls.addEventListener("dragging-changed",e=>{this.camera.orbitControls.enabled=!e.value}),this.container.add(this.helper.transformControls),this.debug)){const e=this.debugFolder.addFolder("helper");e.open(),e.add(this.helper,"active").name("visible").onChange(()=>{this.helper.mesh.visible=this.helper.active,this.helper.transformControls.visible=this.helper.active,this.helper.transformControls.enabled=this.helper.active,this.helper.shadow.mesh.visible=this.helper.active})}}add(e,t={}){const i={};return i.offsetZ=typeof t.offsetZ>"u"?0:t.offsetZ,i.alpha=typeof t.alpha>"u"?1:t.alpha,i.reference=e,i.material=this.materials.base.clone(),i.mesh=new Ae(this.geometry,this.wireframeVisible?this.materials.wireframe:i.material),i.mesh.position.z=this.zFightingDistance,i.mesh.scale.set(t.sizeX,t.sizeY,2.4),this.container.add(i.mesh),this.items.push(i),i}}var bo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function jM(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function qa(a){throw new Error('Could not dynamically require "'+a+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var rm={exports:{}};(function(a,e){(function(t){a.exports=t()})(function(){return function t(i,s,r){function o(d,f){if(!s[d]){if(!i[d]){var c=typeof qa=="function"&&qa;if(!f&&c)return c(d,!0);if(l)return l(d,!0);throw new Error("Cannot find module '"+d+"'")}var u=s[d]={exports:{}};i[d][0].call(u.exports,function(p){var m=i[d][1][p];return o(m||p)},u,u.exports,t,i,s,r)}return s[d].exports}for(var l=typeof qa=="function"&&qa,h=0;h<r.length;h++)o(r[h]);return o}({1:[function(t,i,s){i.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(t,i,s){i.exports={version:t("../package.json").version,AABB:t("./collision/AABB"),ArrayCollisionMatrix:t("./collision/ArrayCollisionMatrix"),Body:t("./objects/Body"),Box:t("./shapes/Box"),Broadphase:t("./collision/Broadphase"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),Narrowphase:t("./world/Narrowphase"),ConeTwistConstraint:t("./constraints/ConeTwistConstraint"),ContactMaterial:t("./material/ContactMaterial"),ConvexPolyhedron:t("./shapes/ConvexPolyhedron"),Cylinder:t("./shapes/Cylinder"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventTarget:t("./utils/EventTarget"),FrictionEquation:t("./equations/FrictionEquation"),GSSolver:t("./solver/GSSolver"),GridBroadphase:t("./collision/GridBroadphase"),Heightfield:t("./shapes/Heightfield"),HingeConstraint:t("./constraints/HingeConstraint"),LockConstraint:t("./constraints/LockConstraint"),Mat3:t("./math/Mat3"),Material:t("./material/Material"),NaiveBroadphase:t("./collision/NaiveBroadphase"),ObjectCollisionMatrix:t("./collision/ObjectCollisionMatrix"),Pool:t("./utils/Pool"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),PointToPointConstraint:t("./constraints/PointToPointConstraint"),Quaternion:t("./math/Quaternion"),Ray:t("./collision/Ray"),RaycastVehicle:t("./objects/RaycastVehicle"),RaycastResult:t("./collision/RaycastResult"),RigidVehicle:t("./objects/RigidVehicle"),RotationalEquation:t("./equations/RotationalEquation"),RotationalMotorEquation:t("./equations/RotationalMotorEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),SPHSystem:t("./objects/SPHSystem"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Sphere:t("./shapes/Sphere"),SplitSolver:t("./solver/SplitSolver"),Spring:t("./objects/Spring"),Trimesh:t("./shapes/Trimesh"),Vec3:t("./math/Vec3"),Vec3Pool:t("./utils/Vec3Pool"),World:t("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(t,i,s){var r=t("../math/Vec3");t("../utils/Utils"),i.exports=o;function o(d){d=d||{},this.lowerBound=new r,d.lowerBound&&this.lowerBound.copy(d.lowerBound),this.upperBound=new r,d.upperBound&&this.upperBound.copy(d.upperBound)}var l=new r;o.prototype.setFromPoints=function(d,f,c,u){var p=this.lowerBound,m=this.upperBound,_=c;p.copy(d[0]),_&&_.vmult(p,p),m.copy(p);for(var g=1;g<d.length;g++){var v=d[g];_&&(_.vmult(v,l),v=l),v.x>m.x&&(m.x=v.x),v.x<p.x&&(p.x=v.x),v.y>m.y&&(m.y=v.y),v.y<p.y&&(p.y=v.y),v.z>m.z&&(m.z=v.z),v.z<p.z&&(p.z=v.z)}return f&&(f.vadd(p,p),f.vadd(m,m)),u&&(p.x-=u,p.y-=u,p.z-=u,m.x+=u,m.y+=u,m.z+=u),this},o.prototype.copy=function(d){return this.lowerBound.copy(d.lowerBound),this.upperBound.copy(d.upperBound),this},o.prototype.clone=function(){return new o().copy(this)},o.prototype.extend=function(d){var f=d.lowerBound.x;this.lowerBound.x>f&&(this.lowerBound.x=f);var c=d.upperBound.x;this.upperBound.x<c&&(this.upperBound.x=c);var f=d.lowerBound.y;this.lowerBound.y>f&&(this.lowerBound.y=f);var c=d.upperBound.y;this.upperBound.y<c&&(this.upperBound.y=c);var f=d.lowerBound.z;this.lowerBound.z>f&&(this.lowerBound.z=f);var c=d.upperBound.z;this.upperBound.z<c&&(this.upperBound.z=c)},o.prototype.overlaps=function(d){var f=this.lowerBound,c=this.upperBound,u=d.lowerBound,p=d.upperBound;return(u.x<=c.x&&c.x<=p.x||f.x<=p.x&&p.x<=c.x)&&(u.y<=c.y&&c.y<=p.y||f.y<=p.y&&p.y<=c.y)&&(u.z<=c.z&&c.z<=p.z||f.z<=p.z&&p.z<=c.z)},o.prototype.contains=function(d){var f=this.lowerBound,c=this.upperBound,u=d.lowerBound,p=d.upperBound;return f.x<=u.x&&c.x>=p.x&&f.y<=u.y&&c.y>=p.y&&f.z<=u.z&&c.z>=p.z},o.prototype.getCorners=function(d,f,c,u,p,m,_,g){var v=this.lowerBound,y=this.upperBound;d.copy(v),f.set(y.x,v.y,v.z),c.set(y.x,y.y,v.z),u.set(v.x,y.y,y.z),p.set(y.x,v.y,v.z),m.set(v.x,y.y,v.z),_.set(v.x,v.y,y.z),g.copy(y)};var h=[new r,new r,new r,new r,new r,new r,new r,new r];o.prototype.toLocalFrame=function(d,f){var c=h,u=c[0],p=c[1],m=c[2],_=c[3],g=c[4],v=c[5],y=c[6],x=c[7];this.getCorners(u,p,m,_,g,v,y,x);for(var b=0;b!==8;b++){var S=c[b];d.pointToLocal(S,S)}return f.setFromPoints(c)},o.prototype.toWorldFrame=function(d,f){var c=h,u=c[0],p=c[1],m=c[2],_=c[3],g=c[4],v=c[5],y=c[6],x=c[7];this.getCorners(u,p,m,_,g,v,y,x);for(var b=0;b!==8;b++){var S=c[b];d.pointToWorld(S,S)}return f.setFromPoints(c)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(t,i,s){i.exports=r;function r(){this.matrix=[]}r.prototype.get=function(o,l){if(o=o.index,l=l.index,l>o){var h=l;l=o,o=h}return this.matrix[(o*(o+1)>>1)+l-1]},r.prototype.set=function(o,l,h){if(o=o.index,l=l.index,l>o){var d=l;l=o,o=d}this.matrix[(o*(o+1)>>1)+l-1]=h?1:0},r.prototype.reset=function(){for(var o=0,l=this.matrix.length;o!==l;o++)this.matrix[o]=0},r.prototype.setNumObjects=function(o){this.matrix.length=o*(o-1)>>1}},{}],5:[function(t,i,s){var r=t("../objects/Body"),o=t("../math/Vec3"),l=t("../math/Quaternion");t("../shapes/Shape"),t("../shapes/Plane"),i.exports=h;function h(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}h.prototype.collisionPairs=function(_,g,v){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var d=r.STATIC|r.KINEMATIC;h.prototype.needBroadphaseCollision=function(_,g){return!(!(_.collisionFilterGroup&g.collisionFilterMask)||!(g.collisionFilterGroup&_.collisionFilterMask)||(_.type&d||_.sleepState===r.SLEEPING)&&(g.type&d||g.sleepState===r.SLEEPING))},h.prototype.intersectionTest=function(_,g,v,y){this.useBoundingBoxes?this.doBoundingBoxBroadphase(_,g,v,y):this.doBoundingSphereBroadphase(_,g,v,y)};var f=new o;new o,new l,new o,h.prototype.doBoundingSphereBroadphase=function(_,g,v,y){var x=f;g.position.vsub(_.position,x);var b=Math.pow(_.boundingRadius+g.boundingRadius,2),S=x.norm2();S<b&&(v.push(_),y.push(g))},h.prototype.doBoundingBoxBroadphase=function(_,g,v,y){_.aabbNeedsUpdate&&_.computeAABB(),g.aabbNeedsUpdate&&g.computeAABB(),_.aabb.overlaps(g.aabb)&&(v.push(_),y.push(g))};var c={keys:[]},u=[],p=[];h.prototype.makePairsUnique=function(_,g){for(var v=c,y=u,x=p,b=_.length,S=0;S!==b;S++)y[S]=_[S],x[S]=g[S];_.length=0,g.length=0;for(var S=0;S!==b;S++){var A=y[S].id,E=x[S].id,R=A<E?A+","+E:E+","+A;v[R]=S,v.keys.push(R)}for(var S=0;S!==v.keys.length;S++){var R=v.keys.pop(),M=v[R];_.push(y[M]),g.push(x[M]),delete v[R]}},h.prototype.setWorld=function(_){};var m=new o;h.boundingSphereCheck=function(_,g){var v=m;return _.position.vsub(g.position,v),Math.pow(_.shape.boundingSphereRadius+g.shape.boundingSphereRadius,2)>v.norm2()},h.prototype.aabbQuery=function(_,g,v){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(t,i,s){i.exports=h;var r=t("./Broadphase"),o=t("../math/Vec3"),l=t("../shapes/Shape");function h(f,c,u,p,m){r.apply(this),this.nx=u||10,this.ny=p||10,this.nz=m||10,this.aabbMin=f||new o(100,100,100),this.aabbMax=c||new o(-100,-100,-100);var _=this.nx*this.ny*this.nz;if(_<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=_,this.binLengths.length=_;for(var g=0;g<_;g++)this.bins[g]=[],this.binLengths[g]=0}h.prototype=new r,h.prototype.constructor=h;var d=new o;new o,h.prototype.collisionPairs=function(f,c,u){var p=f.numObjects(),m=f.bodies,te=this.aabbMax,j=this.aabbMin,_=this.nx,g=this.ny,v=this.nz,y=g*v,x=v,b=1,S=te.x,A=te.y,E=te.z,R=j.x,M=j.y,w=j.z,L=_/(S-R),N=g/(A-M),B=v/(E-w),G=(S-R)/_,W=(A-M)/g,ee=(E-w)/v,z=Math.sqrt(G*G+W*W+ee*ee)*.5,k=l.types,q=k.SPHERE,$=k.PLANE;k.BOX,k.COMPOUND,k.CONVEXPOLYHEDRON;for(var H=this.bins,Q=this.binLengths,X=this.bins.length,F=0;F!==X;F++)Q[F]=0;var D=Math.ceil,j=Math.min,te=Math.max;function ae(et,ut,it,We,st,ct,xt){var rt=(et-R)*L|0,C=(ut-M)*N|0,ne=(it-w)*B|0,oe=D((We-R)*L),be=D((st-M)*N),Re=D((ct-w)*B);rt<0?rt=0:rt>=_&&(rt=_-1),C<0?C=0:C>=g&&(C=g-1),ne<0?ne=0:ne>=v&&(ne=v-1),oe<0?oe=0:oe>=_&&(oe=_-1),be<0?be=0:be>=g&&(be=g-1),Re<0?Re=0:Re>=v&&(Re=v-1),rt*=y,C*=x,ne*=b,oe*=y,be*=x,Re*=b;for(var ot=rt;ot<=oe;ot+=y)for(var ht=C;ht<=be;ht+=x)for(var Et=ne;Et<=Re;Et+=b){var Gt=ot+ht+Et;H[Gt][Q[Gt]++]=xt}}for(var F=0;F!==p;F++){var K=m[F],O=K.shape;switch(O.type){case q:var pe=K.position.x,xe=K.position.y,Ee=K.position.z,ve=O.radius;ae(pe-ve,xe-ve,Ee-ve,pe+ve,xe+ve,Ee+ve,K);break;case $:O.worldNormalNeedsUpdate&&O.computeWorldNormal(K.quaternion);var he=O.worldNormal,fe=R+G*.5-K.position.x,qe=M+W*.5-K.position.y,Ye=w+ee*.5-K.position.z,U=d;U.set(fe,qe,Ye);for(var P=0,re=0;P!==_;P++,re+=y,U.y=qe,U.x+=G)for(var de=0,me=0;de!==g;de++,me+=x,U.z=Ye,U.y+=W)for(var _e=0,De=0;_e!==v;_e++,De+=b,U.z+=ee)if(U.dot(he)<z){var Ce=re+me+De;H[Ce][Q[Ce]++]=K}break;default:K.aabbNeedsUpdate&&K.computeAABB(),ae(K.aabb.lowerBound.x,K.aabb.lowerBound.y,K.aabb.lowerBound.z,K.aabb.upperBound.x,K.aabb.upperBound.y,K.aabb.upperBound.z,K);break}}for(var F=0;F!==X;F++){var Me=Q[F];if(Me>1)for(var tt=H[F],P=0;P!==Me;P++)for(var K=tt[P],de=0;de!==P;de++){var Pe=tt[de];this.needBroadphaseCollision(K,Pe)&&this.intersectionTest(K,Pe,c,u)}}this.makePairsUnique(c,u)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(t,i,s){i.exports=l;var r=t("./Broadphase"),o=t("./AABB");function l(){r.apply(this)}l.prototype=new r,l.prototype.constructor=l,l.prototype.collisionPairs=function(h,d,f){var c=h.bodies,u=c.length,p,m,_,g;for(p=0;p!==u;p++)for(m=0;m!==p;m++)_=c[p],g=c[m],this.needBroadphaseCollision(_,g)&&this.intersectionTest(_,g,d,f)},new o,l.prototype.aabbQuery=function(h,d,f){f=f||[];for(var c=0;c<h.bodies.length;c++){var u=h.bodies[c];u.aabbNeedsUpdate&&u.computeAABB(),u.aabb.overlaps(d)&&f.push(u)}return f}},{"./AABB":3,"./Broadphase":5}],8:[function(t,i,s){i.exports=r;function r(){this.matrix={}}r.prototype.get=function(o,l){if(o=o.id,l=l.id,l>o){var h=l;l=o,o=h}return o+"-"+l in this.matrix},r.prototype.set=function(o,l,h){if(o=o.id,l=l.id,l>o){var d=l;l=o,o=d}h?this.matrix[o+"-"+l]=!0:delete this.matrix[o+"-"+l]},r.prototype.reset=function(){this.matrix={}},r.prototype.setNumObjects=function(o){}},{}],9:[function(t,i,s){i.exports=c;var r=t("../math/Vec3"),o=t("../math/Quaternion"),l=t("../math/Transform");t("../shapes/ConvexPolyhedron"),t("../shapes/Box");var h=t("../collision/RaycastResult"),d=t("../shapes/Shape"),f=t("../collision/AABB");function c(X,F){this.from=X?X.clone():new r,this.to=F?F.clone():new r,this._direction=new r,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=c.ANY,this.result=new h,this.hasHit=!1,this.callback=function(D){}}c.prototype.constructor=c,c.CLOSEST=1,c.ANY=2,c.ALL=4;var u=new f,p=[];c.prototype.intersectWorld=function(X,F){return this.mode=F.mode||c.ANY,this.result=F.result||new h,this.skipBackfaces=!!F.skipBackfaces,this.collisionFilterMask=typeof F.collisionFilterMask<"u"?F.collisionFilterMask:-1,this.collisionFilterGroup=typeof F.collisionFilterGroup<"u"?F.collisionFilterGroup:-1,F.from&&this.from.copy(F.from),F.to&&this.to.copy(F.to),this.callback=F.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(u),p.length=0,X.broadphase.aabbQuery(X,u,p),this.intersectBodies(p),this.hasHit};var m=new r,_=new r;c.pointInTriangle=g;function g(X,F,D,j){j.vsub(F,$),D.vsub(F,m),X.vsub(F,_);var te=$.dot($),ae=$.dot(m),K=$.dot(_),O=m.dot(m),pe=m.dot(_),xe,Ee;return(xe=O*K-ae*pe)>=0&&(Ee=te*pe-ae*K)>=0&&xe+Ee<te*O-ae*ae}var v=new r,y=new o;c.prototype.intersectBody=function(X,F){F&&(this.result=F,this._updateDirection());var D=this.checkCollisionResponse;if(!(D&&!X.collisionResponse)&&!(!(this.collisionFilterGroup&X.collisionFilterMask)||!(X.collisionFilterGroup&this.collisionFilterMask)))for(var j=v,te=y,ae=0,K=X.shapes.length;ae<K;ae++){var O=X.shapes[ae];if(!(D&&!O.collisionResponse)&&(X.quaternion.mult(X.shapeOrientations[ae],te),X.quaternion.vmult(X.shapeOffsets[ae],j),j.vadd(X.position,j),this.intersectShape(O,te,j,X),this.result._shouldStop))break}},c.prototype.intersectBodies=function(X,F){F&&(this.result=F,this._updateDirection());for(var D=0,j=X.length;!this.result._shouldStop&&D<j;D++)this.intersectBody(X[D])},c.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},c.prototype.intersectShape=function(X,F,D,j){var te=this.from,ae=Q(te,this._direction,D);if(!(ae>X.boundingSphereRadius)){var K=this[X.type];K&&K.call(this,X,F,D,j)}},new r,new r;var x=new r,b=new r,S=new r,A=new r;new r,new h,c.prototype.intersectBox=function(X,F,D,j){return this.intersectConvex(X.convexPolyhedronRepresentation,F,D,j)},c.prototype[d.types.BOX]=c.prototype.intersectBox,c.prototype.intersectPlane=function(X,F,D,j){var te=this.from,ae=this.to,K=this._direction,O=new r(0,0,1);F.vmult(O,O);var pe=new r;te.vsub(D,pe);var xe=pe.dot(O);ae.vsub(D,pe);var Ee=pe.dot(O);if(!(xe*Ee>0)&&!(te.distanceTo(ae)<xe)){var ve=O.dot(K);if(!(Math.abs(ve)<this.precision)){var he=new r,fe=new r,qe=new r;te.vsub(D,he);var Ye=-O.dot(he)/ve;K.scale(Ye,fe),te.vadd(fe,qe),this.reportIntersection(O,qe,X,j,-1)}}},c.prototype[d.types.PLANE]=c.prototype.intersectPlane,c.prototype.getAABB=function(X){var F=this.to,D=this.from;X.lowerBound.x=Math.min(F.x,D.x),X.lowerBound.y=Math.min(F.y,D.y),X.lowerBound.z=Math.min(F.z,D.z),X.upperBound.x=Math.max(F.x,D.x),X.upperBound.y=Math.max(F.y,D.y),X.upperBound.z=Math.max(F.z,D.z)};var E={faceList:[0]};c.prototype.intersectHeightfield=function(X,F,D,j){X.data,X.elementSize;var te=new r,ae=new c(this.from,this.to);l.pointToLocalFrame(D,F,ae.from,ae.from),l.pointToLocalFrame(D,F,ae.to,ae.to);var K=[],O=null,pe=null,xe=null,Ee=null,ve=X.getIndexOfPosition(ae.from.x,ae.from.y,K,!1);if(ve&&(O=K[0],pe=K[1],xe=K[0],Ee=K[1]),ve=X.getIndexOfPosition(ae.to.x,ae.to.y,K,!1),ve&&((O===null||K[0]<O)&&(O=K[0]),(xe===null||K[0]>xe)&&(xe=K[0]),(pe===null||K[1]<pe)&&(pe=K[1]),(Ee===null||K[1]>Ee)&&(Ee=K[1])),O!==null){var he=[];X.getRectMinMax(O,pe,xe,Ee,he),he[0],he[1];for(var fe=O;fe<=xe;fe++)for(var qe=pe;qe<=Ee;qe++){if(this.result._shouldStop||(X.getConvexTrianglePillar(fe,qe,!1),l.pointToWorldFrame(D,F,X.pillarOffset,te),this.intersectConvex(X.pillarConvex,F,te,j,E),this.result._shouldStop))return;X.getConvexTrianglePillar(fe,qe,!0),l.pointToWorldFrame(D,F,X.pillarOffset,te),this.intersectConvex(X.pillarConvex,F,te,j,E)}}},c.prototype[d.types.HEIGHTFIELD]=c.prototype.intersectHeightfield;var R=new r,M=new r;c.prototype.intersectSphere=function(X,F,D,j){var te=this.from,ae=this.to,K=X.radius,O=Math.pow(ae.x-te.x,2)+Math.pow(ae.y-te.y,2)+Math.pow(ae.z-te.z,2),pe=2*((ae.x-te.x)*(te.x-D.x)+(ae.y-te.y)*(te.y-D.y)+(ae.z-te.z)*(te.z-D.z)),xe=Math.pow(te.x-D.x,2)+Math.pow(te.y-D.y,2)+Math.pow(te.z-D.z,2)-Math.pow(K,2),Ee=Math.pow(pe,2)-4*O*xe,ve=R,he=M;if(!(Ee<0))if(Ee===0)te.lerp(ae,Ee,ve),ve.vsub(D,he),he.normalize(),this.reportIntersection(he,ve,X,j,-1);else{var fe=(-pe-Math.sqrt(Ee))/(2*O),qe=(-pe+Math.sqrt(Ee))/(2*O);if(fe>=0&&fe<=1&&(te.lerp(ae,fe,ve),ve.vsub(D,he),he.normalize(),this.reportIntersection(he,ve,X,j,-1)),this.result._shouldStop)return;qe>=0&&qe<=1&&(te.lerp(ae,qe,ve),ve.vsub(D,he),he.normalize(),this.reportIntersection(he,ve,X,j,-1))}},c.prototype[d.types.SPHERE]=c.prototype.intersectSphere;var w=new r;new r,new r;var L=new r;c.prototype.intersectConvex=function(F,D,j,te,ae){for(var K=w,O=L,pe=ae&&ae.faceList||null,xe=F.faces,Ee=F.vertices,ve=F.faceNormals,he=this._direction,fe=this.from,qe=this.to,Ye=fe.distanceTo(qe),U=pe?pe.length:xe.length,P=this.result,re=0;!P._shouldStop&&re<U;re++){var de=pe?pe[re]:re,me=xe[de],_e=ve[de],De=D,Ce=j;O.copy(Ee[me[0]]),De.vmult(O,O),O.vadd(Ce,O),O.vsub(fe,O),De.vmult(_e,K);var Me=he.dot(K);if(!(Math.abs(Me)<this.precision)){var tt=K.dot(O)/Me;if(!(tt<0)){he.mult(tt,x),x.vadd(fe,x),b.copy(Ee[me[0]]),De.vmult(b,b),Ce.vadd(b,b);for(var Pe=1;!P._shouldStop&&Pe<me.length-1;Pe++){S.copy(Ee[me[Pe]]),A.copy(Ee[me[Pe+1]]),De.vmult(S,S),De.vmult(A,A),Ce.vadd(S,S),Ce.vadd(A,A);var et=x.distanceTo(fe);!(g(x,b,S,A)||g(x,S,b,A))||et>Ye||this.reportIntersection(K,x,F,te,de)}}}}},c.prototype[d.types.CONVEXPOLYHEDRON]=c.prototype.intersectConvex;var N=new r,B=new r,G=new r,W=new r,ee=new r,z=new r;new f;var k=[],q=new l;c.prototype.intersectTrimesh=function(F,D,j,te,ae){var K=N,O=k,pe=q,xe=L,Ee=B,ve=G,he=W,fe=z,qe=ee;ae&&ae.faceList;var Ye=F.indices;F.vertices,F.faceNormals;var U=this.from,P=this.to,re=this._direction;pe.position.copy(j),pe.quaternion.copy(D),l.vectorToLocalFrame(j,D,re,Ee),l.pointToLocalFrame(j,D,U,ve),l.pointToLocalFrame(j,D,P,he);var de=ve.distanceSquared(he);F.tree.rayQuery(this,pe,O);for(var me=0,_e=O.length;!this.result._shouldStop&&me!==_e;me++){var De=O[me];F.getNormal(De,K),F.getVertex(Ye[De*3],b),b.vsub(ve,xe);var Ce=Ee.dot(K),Me=K.dot(xe)/Ce;if(!(Me<0)){Ee.scale(Me,x),x.vadd(ve,x),F.getVertex(Ye[De*3+1],S),F.getVertex(Ye[De*3+2],A);var tt=x.distanceSquared(ve);!(g(x,S,b,A)||g(x,b,S,A))||tt>de||(l.vectorToWorldFrame(D,K,qe),l.pointToWorldFrame(j,D,x,fe),this.reportIntersection(qe,fe,F,te,De))}}O.length=0},c.prototype[d.types.TRIMESH]=c.prototype.intersectTrimesh,c.prototype.reportIntersection=function(X,F,D,j,te){var ae=this.from,K=this.to,O=ae.distanceTo(F),pe=this.result;if(!(this.skipBackfaces&&X.dot(this._direction)>0))switch(pe.hitFaceIndex=typeof te<"u"?te:-1,this.mode){case c.ALL:this.hasHit=!0,pe.set(ae,K,X,F,D,j,O),pe.hasHit=!0,this.callback(pe);break;case c.CLOSEST:(O<pe.distance||!pe.hasHit)&&(this.hasHit=!0,pe.hasHit=!0,pe.set(ae,K,X,F,D,j,O));break;case c.ANY:this.hasHit=!0,pe.hasHit=!0,pe.set(ae,K,X,F,D,j,O),pe._shouldStop=!0;break}};var $=new r,H=new r;function Q(X,F,D){D.vsub(X,$);var j=$.dot(F);F.mult(j,H),H.vadd(X,H);var te=D.distanceTo(H);return te}},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(t,i,s){var r=t("../math/Vec3");i.exports=o;function o(){this.rayFromWorld=new r,this.rayToWorld=new r,this.hitNormalWorld=new r,this.hitPointWorld=new r,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}o.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},o.prototype.abort=function(){this._shouldStop=!0},o.prototype.set=function(l,h,d,f,c,u,p){this.rayFromWorld.copy(l),this.rayToWorld.copy(h),this.hitNormalWorld.copy(d),this.hitPointWorld.copy(f),this.shape=c,this.body=u,this.distance=p}},{"../math/Vec3":30}],11:[function(t,i,s){t("../shapes/Shape");var r=t("../collision/Broadphase");i.exports=o;function o(l){r.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var h=this.axisList;this._addBodyHandler=function(d){h.push(d.body)},this._removeBodyHandler=function(d){var f=h.indexOf(d.body);f!==-1&&h.splice(f,1)},l&&this.setWorld(l)}o.prototype=new r,o.prototype.setWorld=function(l){this.axisList.length=0;for(var h=0;h<l.bodies.length;h++)this.axisList.push(l.bodies[h]);l.removeEventListener("addBody",this._addBodyHandler),l.removeEventListener("removeBody",this._removeBodyHandler),l.addEventListener("addBody",this._addBodyHandler),l.addEventListener("removeBody",this._removeBodyHandler),this.world=l,this.dirty=!0},o.insertionSortX=function(l){for(var h=1,d=l.length;h<d;h++){for(var f=l[h],c=h-1;c>=0&&!(l[c].aabb.lowerBound.x<=f.aabb.lowerBound.x);c--)l[c+1]=l[c];l[c+1]=f}return l},o.insertionSortY=function(l){for(var h=1,d=l.length;h<d;h++){for(var f=l[h],c=h-1;c>=0&&!(l[c].aabb.lowerBound.y<=f.aabb.lowerBound.y);c--)l[c+1]=l[c];l[c+1]=f}return l},o.insertionSortZ=function(l){for(var h=1,d=l.length;h<d;h++){for(var f=l[h],c=h-1;c>=0&&!(l[c].aabb.lowerBound.z<=f.aabb.lowerBound.z);c--)l[c+1]=l[c];l[c+1]=f}return l},o.prototype.collisionPairs=function(l,h,d){var f=this.axisList,c=f.length,u=this.axisIndex,p,m;for(this.dirty&&(this.sortList(),this.dirty=!1),p=0;p!==c;p++){var _=f[p];for(m=p+1;m<c;m++){var g=f[m];if(this.needBroadphaseCollision(_,g)){if(!o.checkBounds(_,g,u))break;this.intersectionTest(_,g,h,d)}}}},o.prototype.sortList=function(){for(var l=this.axisList,h=this.axisIndex,d=l.length,f=0;f!==d;f++){var c=l[f];c.aabbNeedsUpdate&&c.computeAABB()}h===0?o.insertionSortX(l):h===1?o.insertionSortY(l):h===2&&o.insertionSortZ(l)},o.checkBounds=function(l,h,d){var f,c;d===0?(f=l.position.x,c=h.position.x):d===1?(f=l.position.y,c=h.position.y):d===2&&(f=l.position.z,c=h.position.z);var u=l.boundingRadius,p=h.boundingRadius,m=f+u,_=c-p;return _<m},o.prototype.autoDetectAxis=function(){for(var l=0,h=0,d=0,f=0,c=0,u=0,p=this.axisList,m=p.length,_=1/m,g=0;g!==m;g++){var v=p[g],y=v.position.x;l+=y,h+=y*y;var x=v.position.y;d+=x,f+=x*x;var b=v.position.z;c+=b,u+=b*b}var S=h-l*l*_,A=f-d*d*_,E=u-c*c*_;S>A?S>E?this.axisIndex=0:this.axisIndex=2:A>E?this.axisIndex=1:this.axisIndex=2},o.prototype.aabbQuery=function(l,h,d){d=d||[],this.dirty&&(this.sortList(),this.dirty=!1);var f=this.axisIndex,c="x";f===1&&(c="y"),f===2&&(c="z");var u=this.axisList;h.lowerBound[c],h.upperBound[c];for(var p=0;p<u.length;p++){var m=u[p];m.aabbNeedsUpdate&&m.computeAABB(),m.aabb.overlaps(h)&&d.push(m)}return d}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(t,i,s){i.exports=d,t("./Constraint");var r=t("./PointToPointConstraint"),o=t("../equations/ConeEquation"),l=t("../equations/RotationalEquation");t("../equations/ContactEquation");var h=t("../math/Vec3");function d(f,c,u){u=u||{};var p=typeof u.maxForce<"u"?u.maxForce:1e6,m=u.pivotA?u.pivotA.clone():new h,_=u.pivotB?u.pivotB.clone():new h;this.axisA=u.axisA?u.axisA.clone():new h,this.axisB=u.axisB?u.axisB.clone():new h,r.call(this,f,m,c,_,p),this.collideConnected=!!u.collideConnected,this.angle=typeof u.angle<"u"?u.angle:0;var g=this.coneEquation=new o(f,c,u),v=this.twistEquation=new l(f,c,u);this.twistAngle=typeof u.twistAngle<"u"?u.twistAngle:0,g.maxForce=0,g.minForce=-p,v.maxForce=0,v.minForce=-p,this.equations.push(g,v)}d.prototype=new r,d.constructor=d,new h,new h,d.prototype.update=function(){var f=this.bodyA,c=this.bodyB,u=this.coneEquation,p=this.twistEquation;r.prototype.update.call(this),f.vectorToWorldFrame(this.axisA,u.axisA),c.vectorToWorldFrame(this.axisB,u.axisB),this.axisA.tangents(p.axisA,p.axisA),f.vectorToWorldFrame(p.axisA,p.axisA),this.axisB.tangents(p.axisB,p.axisB),c.vectorToWorldFrame(p.axisB,p.axisB),u.angle=this.angle,p.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(t,i,s){i.exports=o;var r=t("../utils/Utils");function o(l,h,d){d=r.defaults(d,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=l,this.bodyB=h,this.id=o.idCounter++,this.collideConnected=d.collideConnected,d.wakeUpBodies&&(l&&l.wakeUp(),h&&h.wakeUp())}o.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},o.prototype.enable=function(){for(var l=this.equations,h=0;h<l.length;h++)l[h].enabled=!0},o.prototype.disable=function(){for(var l=this.equations,h=0;h<l.length;h++)l[h].enabled=!1},o.idCounter=0},{"../utils/Utils":53}],14:[function(t,i,s){i.exports=l;var r=t("./Constraint"),o=t("../equations/ContactEquation");function l(h,d,f,c){r.call(this,h,d),typeof f>"u"&&(f=h.position.distanceTo(d.position)),typeof c>"u"&&(c=1e6),this.distance=f;var u=this.distanceEquation=new o(h,d);this.equations.push(u),u.minForce=-c,u.maxForce=c}l.prototype=new r,l.prototype.update=function(){var h=this.bodyA,d=this.bodyB,f=this.distanceEquation,c=this.distance*.5,u=f.ni;d.position.vsub(h.position,u),u.normalize(),u.mult(c,f.ri),u.mult(-c,f.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(t,i,s){i.exports=d,t("./Constraint");var r=t("./PointToPointConstraint"),o=t("../equations/RotationalEquation"),l=t("../equations/RotationalMotorEquation");t("../equations/ContactEquation");var h=t("../math/Vec3");function d(u,p,m){m=m||{};var _=typeof m.maxForce<"u"?m.maxForce:1e6,g=m.pivotA?m.pivotA.clone():new h,v=m.pivotB?m.pivotB.clone():new h;r.call(this,u,g,p,v,_);var y=this.axisA=m.axisA?m.axisA.clone():new h(1,0,0);y.normalize();var x=this.axisB=m.axisB?m.axisB.clone():new h(1,0,0);x.normalize();var b=this.rotationalEquation1=new o(u,p,m),S=this.rotationalEquation2=new o(u,p,m),A=this.motorEquation=new l(u,p,_);A.enabled=!1,this.equations.push(b,S,A)}d.prototype=new r,d.constructor=d,d.prototype.enableMotor=function(){this.motorEquation.enabled=!0},d.prototype.disableMotor=function(){this.motorEquation.enabled=!1},d.prototype.setMotorSpeed=function(u){this.motorEquation.targetVelocity=u},d.prototype.setMotorMaxForce=function(u){this.motorEquation.maxForce=u,this.motorEquation.minForce=-u};var f=new h,c=new h;d.prototype.update=function(){var u=this.bodyA,p=this.bodyB,m=this.motorEquation,_=this.rotationalEquation1,g=this.rotationalEquation2,v=f,y=c,x=this.axisA,b=this.axisB;r.prototype.update.call(this),u.quaternion.vmult(x,v),p.quaternion.vmult(b,y),v.tangents(_.axisA,g.axisA),_.axisB.copy(y),g.axisB.copy(y),this.motorEquation.enabled&&(u.quaternion.vmult(this.axisA,m.axisA),p.quaternion.vmult(this.axisB,m.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(t,i,s){i.exports=h,t("./Constraint");var r=t("./PointToPointConstraint"),o=t("../equations/RotationalEquation");t("../equations/RotationalMotorEquation"),t("../equations/ContactEquation");var l=t("../math/Vec3");function h(d,f,c){c=c||{};var u=typeof c.maxForce<"u"?c.maxForce:1e6,p=new l,m=new l,_=new l;d.position.vadd(f.position,_),_.scale(.5,_),f.pointToLocalFrame(_,m),d.pointToLocalFrame(_,p),r.call(this,d,p,f,m,u);var g=this.rotationalEquation1=new o(d,f,c),v=this.rotationalEquation2=new o(d,f,c),y=this.rotationalEquation3=new o(d,f,c);this.equations.push(g,v,y)}h.prototype=new r,h.constructor=h,new l,new l,h.prototype.update=function(){var d=this.bodyA,f=this.bodyB;this.motorEquation;var c=this.rotationalEquation1,u=this.rotationalEquation2,p=this.rotationalEquation3;r.prototype.update.call(this),d.vectorToWorldFrame(l.UNIT_X,c.axisA),f.vectorToWorldFrame(l.UNIT_Y,c.axisB),d.vectorToWorldFrame(l.UNIT_Y,u.axisA),f.vectorToWorldFrame(l.UNIT_Z,u.axisB),d.vectorToWorldFrame(l.UNIT_Z,p.axisA),f.vectorToWorldFrame(l.UNIT_X,p.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(t,i,s){i.exports=h;var r=t("./Constraint"),o=t("../equations/ContactEquation"),l=t("../math/Vec3");function h(d,f,c,u,p){r.call(this,d,c),p=typeof p<"u"?p:1e6,this.pivotA=f?f.clone():new l,this.pivotB=u?u.clone():new l;var m=this.equationX=new o(d,c),_=this.equationY=new o(d,c),g=this.equationZ=new o(d,c);this.equations.push(m,_,g),m.minForce=_.minForce=g.minForce=-p,m.maxForce=_.maxForce=g.maxForce=p,m.ni.set(1,0,0),_.ni.set(0,1,0),g.ni.set(0,0,1)}h.prototype=new r,h.prototype.update=function(){var d=this.bodyA,f=this.bodyB,c=this.equationX,u=this.equationY,p=this.equationZ;d.quaternion.vmult(this.pivotA,c.ri),f.quaternion.vmult(this.pivotB,c.rj),u.ri.copy(c.ri),u.rj.copy(c.rj),p.ri.copy(c.ri),p.rj.copy(c.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(t,i,s){i.exports=l;var r=t("../math/Vec3");t("../math/Mat3");var o=t("./Equation");function l(f,c,u){u=u||{};var p=typeof u.maxForce<"u"?u.maxForce:1e6;o.call(this,f,c,-p,p),this.axisA=u.axisA?u.axisA.clone():new r(1,0,0),this.axisB=u.axisB?u.axisB.clone():new r(0,1,0),this.angle=typeof u.angle<"u"?u.angle:0}l.prototype=new o,l.prototype.constructor=l;var h=new r,d=new r;l.prototype.computeB=function(f){var c=this.a,u=this.b,p=this.axisA,m=this.axisB,_=h,g=d,v=this.jacobianElementA,y=this.jacobianElementB;p.cross(m,_),m.cross(p,g),v.rotational.copy(g),y.rotational.copy(_);var x=Math.cos(this.angle)-p.dot(m),b=this.computeGW(),S=this.computeGiMf(),A=-x*c-b*u-f*S;return A}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(t,i,s){i.exports=l;var r=t("./Equation"),o=t("../math/Vec3");t("../math/Mat3");function l(g,v,y){y=typeof y<"u"?y:1e6,r.call(this,g,v,0,y),this.restitution=0,this.ri=new o,this.rj=new o,this.ni=new o}l.prototype=new r,l.prototype.constructor=l;var h=new o,d=new o,f=new o;l.prototype.computeB=function(g){var v=this.a,y=this.b,x=this.bi,b=this.bj,S=this.ri,A=this.rj,E=h,R=d,M=x.velocity,w=x.angularVelocity;x.force,x.torque;var L=b.velocity,N=b.angularVelocity;b.force,b.torque;var B=f,G=this.jacobianElementA,W=this.jacobianElementB,ee=this.ni;S.cross(ee,E),A.cross(ee,R),ee.negate(G.spatial),E.negate(G.rotational),W.spatial.copy(ee),W.rotational.copy(R),B.copy(b.position),B.vadd(A,B),B.vsub(x.position,B),B.vsub(S,B);var z=ee.dot(B),k=this.restitution+1,q=k*L.dot(ee)-k*M.dot(ee)+N.dot(R)-w.dot(E),$=this.computeGiMf(),H=-z*v-q*y-g*$;return H};var c=new o,u=new o,p=new o,m=new o,_=new o;l.prototype.getImpactVelocityAlongNormal=function(){var g=c,v=u,y=p,x=m,b=_;return this.bi.position.vadd(this.ri,y),this.bj.position.vadd(this.rj,x),this.bi.getVelocityAtWorldPoint(y,g),this.bj.getVelocityAtWorldPoint(x,v),g.vsub(v,b),this.ni.dot(b)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(t,i,s){i.exports=l;var r=t("../math/JacobianElement"),o=t("../math/Vec3");function l(_,g,v,y){this.id=l.id++,this.minForce=typeof v>"u"?-1e6:v,this.maxForce=typeof y>"u"?1e6:y,this.bi=_,this.bj=g,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new r,this.jacobianElementB=new r,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}l.prototype.constructor=l,l.id=0,l.prototype.setSpookParams=function(_,g,v){var y=g,x=_,b=v;this.a=4/(b*(1+4*y)),this.b=4*y/(1+4*y),this.eps=4/(b*b*x*(1+4*y))},l.prototype.computeB=function(_,g,v){var y=this.computeGW(),x=this.computeGq(),b=this.computeGiMf();return-x*_-y*g-b*v},l.prototype.computeGq=function(){var _=this.jacobianElementA,g=this.jacobianElementB,v=this.bi,y=this.bj,x=v.position,b=y.position;return _.spatial.dot(x)+g.spatial.dot(b)};var h=new o;l.prototype.computeGW=function(){var _=this.jacobianElementA,g=this.jacobianElementB,v=this.bi,y=this.bj,x=v.velocity,b=y.velocity,S=v.angularVelocity||h,A=y.angularVelocity||h;return _.multiplyVectors(x,S)+g.multiplyVectors(b,A)},l.prototype.computeGWlambda=function(){var _=this.jacobianElementA,g=this.jacobianElementB,v=this.bi,y=this.bj,x=v.vlambda,b=y.vlambda,S=v.wlambda||h,A=y.wlambda||h;return _.multiplyVectors(x,S)+g.multiplyVectors(b,A)};var d=new o,f=new o,c=new o,u=new o;l.prototype.computeGiMf=function(){var _=this.jacobianElementA,g=this.jacobianElementB,v=this.bi,y=this.bj,x=v.force,b=v.torque,S=y.force,A=y.torque,E=v.invMassSolve,R=y.invMassSolve;return v.invInertiaWorldSolve?v.invInertiaWorldSolve.vmult(b,c):c.set(0,0,0),y.invInertiaWorldSolve?y.invInertiaWorldSolve.vmult(A,u):u.set(0,0,0),x.mult(E,d),S.mult(R,f),_.multiplyVectors(d,c)+g.multiplyVectors(f,u)};var p=new o;l.prototype.computeGiMGt=function(){var _=this.jacobianElementA,g=this.jacobianElementB,v=this.bi,y=this.bj,x=v.invMassSolve,b=y.invMassSolve,S=v.invInertiaWorldSolve,A=y.invInertiaWorldSolve,E=x+b;return S&&(S.vmult(_.rotational,p),E+=p.dot(_.rotational)),A&&(A.vmult(g.rotational,p),E+=p.dot(g.rotational)),E};var m=new o;new o,new o,new o,new o,new o,l.prototype.addToWlambda=function(_){var g=this.jacobianElementA,v=this.jacobianElementB,y=this.bi,x=this.bj,b=m;g.spatial.mult(y.invMassSolve*_,b),y.vlambda.vadd(b,y.vlambda),v.spatial.mult(x.invMassSolve*_,b),x.vlambda.vadd(b,x.vlambda),y.invInertiaWorldSolve&&(y.invInertiaWorldSolve.vmult(g.rotational,b),b.mult(_,b),y.wlambda.vadd(b,y.wlambda)),x.invInertiaWorldSolve&&(x.invInertiaWorldSolve.vmult(v.rotational,b),b.mult(_,b),x.wlambda.vadd(b,x.wlambda))},l.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(t,i,s){i.exports=l;var r=t("./Equation"),o=t("../math/Vec3");t("../math/Mat3");function l(f,c,u){r.call(this,f,c,-u,u),this.ri=new o,this.rj=new o,this.t=new o}l.prototype=new r,l.prototype.constructor=l;var h=new o,d=new o;l.prototype.computeB=function(f){this.a;var c=this.b;this.bi,this.bj;var u=this.ri,p=this.rj,m=h,_=d,g=this.t;u.cross(g,m),p.cross(g,_);var v=this.jacobianElementA,y=this.jacobianElementB;g.negate(v.spatial),m.negate(v.rotational),y.spatial.copy(g),y.rotational.copy(_);var x=this.computeGW(),b=this.computeGiMf(),S=-x*c-f*b;return S}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(t,i,s){i.exports=l;var r=t("../math/Vec3");t("../math/Mat3");var o=t("./Equation");function l(f,c,u){u=u||{};var p=typeof u.maxForce<"u"?u.maxForce:1e6;o.call(this,f,c,-p,p),this.axisA=u.axisA?u.axisA.clone():new r(1,0,0),this.axisB=u.axisB?u.axisB.clone():new r(0,1,0),this.maxAngle=Math.PI/2}l.prototype=new o,l.prototype.constructor=l;var h=new r,d=new r;l.prototype.computeB=function(f){var c=this.a,u=this.b,p=this.axisA,m=this.axisB,_=h,g=d,v=this.jacobianElementA,y=this.jacobianElementB;p.cross(m,_),m.cross(p,g),v.rotational.copy(g),y.rotational.copy(_);var x=Math.cos(this.maxAngle)-p.dot(m),b=this.computeGW(),S=this.computeGiMf(),A=-x*c-b*u-f*S;return A}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(t,i,s){i.exports=l;var r=t("../math/Vec3");t("../math/Mat3");var o=t("./Equation");function l(h,d,f){f=typeof f<"u"?f:1e6,o.call(this,h,d,-f,f),this.axisA=new r,this.axisB=new r,this.targetVelocity=0}l.prototype=new o,l.prototype.constructor=l,l.prototype.computeB=function(h){this.a;var d=this.b;this.bi,this.bj;var f=this.axisA,c=this.axisB,u=this.jacobianElementA,p=this.jacobianElementB;u.rotational.copy(f),c.negate(p.rotational);var m=this.computeGW()-this.targetVelocity,_=this.computeGiMf(),g=-m*d-h*_;return g}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(t,i,s){var r=t("../utils/Utils");i.exports=o;function o(l,h,d){d=r.defaults(d,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=o.idCounter++,this.materials=[l,h],this.friction=d.friction,this.restitution=d.restitution,this.contactEquationStiffness=d.contactEquationStiffness,this.contactEquationRelaxation=d.contactEquationRelaxation,this.frictionEquationStiffness=d.frictionEquationStiffness,this.frictionEquationRelaxation=d.frictionEquationRelaxation}o.idCounter=0},{"../utils/Utils":53}],25:[function(t,i,s){i.exports=r;function r(o){var l="";o=o||{},typeof o=="string"?(l=o,o={}):typeof o=="object"&&(l=""),this.name=l,this.id=r.idCounter++,this.friction=typeof o.friction<"u"?o.friction:-1,this.restitution=typeof o.restitution<"u"?o.restitution:-1}r.idCounter=0},{}],26:[function(t,i,s){i.exports=o;var r=t("./Vec3");function o(){this.spatial=new r,this.rotational=new r}o.prototype.multiplyElement=function(l){return l.spatial.dot(this.spatial)+l.rotational.dot(this.rotational)},o.prototype.multiplyVectors=function(l,h){return l.dot(this.spatial)+h.dot(this.rotational)}},{"./Vec3":30}],27:[function(t,i,s){i.exports=o;var r=t("./Vec3");function o(l){l?this.elements=l:this.elements=[0,0,0,0,0,0,0,0,0]}o.prototype.identity=function(){var l=this.elements;l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=1,l[5]=0,l[6]=0,l[7]=0,l[8]=1},o.prototype.setZero=function(){var l=this.elements;l[0]=0,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=0,l[6]=0,l[7]=0,l[8]=0},o.prototype.setTrace=function(l){var h=this.elements;h[0]=l.x,h[4]=l.y,h[8]=l.z},o.prototype.getTrace=function(h){var h=h||new r,d=this.elements;h.x=d[0],h.y=d[4],h.z=d[8]},o.prototype.vmult=function(l,h){h=h||new r;var d=this.elements,f=l.x,c=l.y,u=l.z;return h.x=d[0]*f+d[1]*c+d[2]*u,h.y=d[3]*f+d[4]*c+d[5]*u,h.z=d[6]*f+d[7]*c+d[8]*u,h},o.prototype.smult=function(l){for(var h=0;h<this.elements.length;h++)this.elements[h]*=l},o.prototype.mmult=function(l,h){for(var d=h||new o,f=0;f<3;f++)for(var c=0;c<3;c++){for(var u=0,p=0;p<3;p++)u+=l.elements[f+p*3]*this.elements[p+c*3];d.elements[f+c*3]=u}return d},o.prototype.scale=function(l,h){h=h||new o;for(var d=this.elements,f=h.elements,c=0;c!==3;c++)f[3*c+0]=l.x*d[3*c+0],f[3*c+1]=l.y*d[3*c+1],f[3*c+2]=l.z*d[3*c+2];return h},o.prototype.solve=function(l,h){h=h||new r;for(var d=3,f=4,c=[],u=0;u<d*f;u++)c.push(0);var u,p;for(u=0;u<3;u++)for(p=0;p<3;p++)c[u+f*p]=this.elements[u+3*p];c[3+4*0]=l.x,c[3+4*1]=l.y,c[3+4*2]=l.z;var m=3,_=m,g,v=4,y;do{if(u=_-m,c[u+f*u]===0){for(p=u+1;p<_;p++)if(c[u+f*p]!==0){g=v;do y=v-g,c[y+f*u]+=c[y+f*p];while(--g);break}}if(c[u+f*u]!==0)for(p=u+1;p<_;p++){var x=c[u+f*p]/c[u+f*u];g=v;do y=v-g,c[y+f*p]=y<=u?0:c[y+f*p]-c[y+f*u]*x;while(--g)}}while(--m);if(h.z=c[2*f+3]/c[2*f+2],h.y=(c[1*f+3]-c[1*f+2]*h.z)/c[1*f+1],h.x=(c[0*f+3]-c[0*f+2]*h.z-c[0*f+1]*h.y)/c[0*f+0],isNaN(h.x)||isNaN(h.y)||isNaN(h.z)||h.x===1/0||h.y===1/0||h.z===1/0)throw"Could not solve equation! Got x=["+h.toString()+"], b=["+l.toString()+"], A=["+this.toString()+"]";return h},o.prototype.e=function(l,h,d){if(d===void 0)return this.elements[h+3*l];this.elements[h+3*l]=d},o.prototype.copy=function(l){for(var h=0;h<l.elements.length;h++)this.elements[h]=l.elements[h];return this},o.prototype.toString=function(){for(var l="",h=",",d=0;d<9;d++)l+=this.elements[d]+h;return l},o.prototype.reverse=function(l){l=l||new o;for(var h=3,d=6,f=[],c=0;c<h*d;c++)f.push(0);var c,u;for(c=0;c<3;c++)for(u=0;u<3;u++)f[c+d*u]=this.elements[c+3*u];f[3+6*0]=1,f[3+6*1]=0,f[3+6*2]=0,f[4+6*0]=0,f[4+6*1]=1,f[4+6*2]=0,f[5+6*0]=0,f[5+6*1]=0,f[5+6*2]=1;var p=3,m=p,_,g=d,v;do{if(c=m-p,f[c+d*c]===0){for(u=c+1;u<m;u++)if(f[c+d*u]!==0){_=g;do v=g-_,f[v+d*c]+=f[v+d*u];while(--_);break}}if(f[c+d*c]!==0)for(u=c+1;u<m;u++){var y=f[c+d*u]/f[c+d*c];_=g;do v=g-_,f[v+d*u]=v<=c?0:f[v+d*u]-f[v+d*c]*y;while(--_)}}while(--p);c=2;do{u=c-1;do{var y=f[c+d*u]/f[c+d*c];_=d;do v=d-_,f[v+d*u]=f[v+d*u]-f[v+d*c]*y;while(--_)}while(u--)}while(--c);c=2;do{var y=1/f[c+d*c];_=d;do v=d-_,f[v+d*c]=f[v+d*c]*y;while(--_)}while(c--);c=2;do{u=2;do{if(v=f[h+u+d*c],isNaN(v)||v===1/0)throw"Could not reverse! A=["+this.toString()+"]";l.e(c,u,v)}while(u--)}while(c--);return l},o.prototype.setRotationFromQuaternion=function(l){var h=l.x,d=l.y,f=l.z,c=l.w,u=h+h,p=d+d,m=f+f,_=h*u,g=h*p,v=h*m,y=d*p,x=d*m,b=f*m,S=c*u,A=c*p,E=c*m,R=this.elements;return R[3*0+0]=1-(y+b),R[3*0+1]=g-E,R[3*0+2]=v+A,R[3*1+0]=g+E,R[3*1+1]=1-(_+b),R[3*1+2]=x-S,R[3*2+0]=v-A,R[3*2+1]=x+S,R[3*2+2]=1-(_+y),this},o.prototype.transpose=function(l){l=l||new o;for(var h=l.elements,d=this.elements,f=0;f!==3;f++)for(var c=0;c!==3;c++)h[3*f+c]=d[3*c+f];return l}},{"./Vec3":30}],28:[function(t,i,s){i.exports=o;var r=t("./Vec3");function o(u,p,m,_){this.x=u!==void 0?u:0,this.y=p!==void 0?p:0,this.z=m!==void 0?m:0,this.w=_!==void 0?_:1}o.prototype.set=function(u,p,m,_){this.x=u,this.y=p,this.z=m,this.w=_},o.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},o.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},o.prototype.setFromAxisAngle=function(u,p){var m=Math.sin(p*.5);this.x=u.x*m,this.y=u.y*m,this.z=u.z*m,this.w=Math.cos(p*.5)},o.prototype.toAxisAngle=function(u){u=u||new r,this.normalize();var p=2*Math.acos(this.w),m=Math.sqrt(1-this.w*this.w);return m<.001?(u.x=this.x,u.y=this.y,u.z=this.z):(u.x=this.x/m,u.y=this.y/m,u.z=this.z/m),[u,p]};var l=new r,h=new r;o.prototype.setFromVectors=function(u,p){if(u.isAntiparallelTo(p)){var m=l,_=h;u.tangents(m,_),this.setFromAxisAngle(m,Math.PI)}else{var g=u.cross(p);this.x=g.x,this.y=g.y,this.z=g.z,this.w=Math.sqrt(Math.pow(u.norm(),2)*Math.pow(p.norm(),2))+u.dot(p),this.normalize()}};var d=new r,f=new r,c=new r;o.prototype.mult=function(u,p){p=p||new o;var m=this.w,_=d,g=f,v=c;return _.set(this.x,this.y,this.z),g.set(u.x,u.y,u.z),p.w=m*u.w-_.dot(g),_.cross(g,v),p.x=m*g.x+u.w*_.x+v.x,p.y=m*g.y+u.w*_.y+v.y,p.z=m*g.z+u.w*_.z+v.z,p},o.prototype.inverse=function(u){var p=this.x,m=this.y,_=this.z,g=this.w;u=u||new o,this.conjugate(u);var v=1/(p*p+m*m+_*_+g*g);return u.x*=v,u.y*=v,u.z*=v,u.w*=v,u},o.prototype.conjugate=function(u){return u=u||new o,u.x=-this.x,u.y=-this.y,u.z=-this.z,u.w=this.w,u},o.prototype.normalize=function(){var u=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);u===0?(this.x=0,this.y=0,this.z=0,this.w=0):(u=1/u,this.x*=u,this.y*=u,this.z*=u,this.w*=u)},o.prototype.normalizeFast=function(){var u=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;u===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=u,this.y*=u,this.z*=u,this.w*=u)},o.prototype.vmult=function(u,p){p=p||new r;var m=u.x,_=u.y,g=u.z,v=this.x,y=this.y,x=this.z,b=this.w,S=b*m+y*g-x*_,A=b*_+x*m-v*g,E=b*g+v*_-y*m,R=-v*m-y*_-x*g;return p.x=S*b+R*-v+A*-x-E*-y,p.y=A*b+R*-y+E*-v-S*-x,p.z=E*b+R*-x+S*-y-A*-v,p},o.prototype.copy=function(u){return this.x=u.x,this.y=u.y,this.z=u.z,this.w=u.w,this},o.prototype.toEuler=function(u,p){p=p||"YZX";var m,_,g,v=this.x,y=this.y,x=this.z,b=this.w;switch(p){case"YZX":var S=v*y+x*b;if(S>.499&&(m=2*Math.atan2(v,b),_=Math.PI/2,g=0),S<-.499&&(m=-2*Math.atan2(v,b),_=-Math.PI/2,g=0),isNaN(m)){var A=v*v,E=y*y,R=x*x;m=Math.atan2(2*y*b-2*v*x,1-2*E-2*R),_=Math.asin(2*S),g=Math.atan2(2*v*b-2*y*x,1-2*A-2*R)}break;default:throw new Error("Euler order "+p+" not supported yet.")}u.y=m,u.z=_,u.x=g},o.prototype.setFromEuler=function(u,p,m,_){_=_||"XYZ";var g=Math.cos(u/2),v=Math.cos(p/2),y=Math.cos(m/2),x=Math.sin(u/2),b=Math.sin(p/2),S=Math.sin(m/2);return _==="XYZ"?(this.x=x*v*y+g*b*S,this.y=g*b*y-x*v*S,this.z=g*v*S+x*b*y,this.w=g*v*y-x*b*S):_==="YXZ"?(this.x=x*v*y+g*b*S,this.y=g*b*y-x*v*S,this.z=g*v*S-x*b*y,this.w=g*v*y+x*b*S):_==="ZXY"?(this.x=x*v*y-g*b*S,this.y=g*b*y+x*v*S,this.z=g*v*S+x*b*y,this.w=g*v*y-x*b*S):_==="ZYX"?(this.x=x*v*y-g*b*S,this.y=g*b*y+x*v*S,this.z=g*v*S-x*b*y,this.w=g*v*y+x*b*S):_==="YZX"?(this.x=x*v*y+g*b*S,this.y=g*b*y+x*v*S,this.z=g*v*S-x*b*y,this.w=g*v*y-x*b*S):_==="XZY"&&(this.x=x*v*y-g*b*S,this.y=g*b*y-x*v*S,this.z=g*v*S+x*b*y,this.w=g*v*y+x*b*S),this},o.prototype.clone=function(){return new o(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(t,i,s){var r=t("./Vec3"),o=t("./Quaternion");i.exports=l;function l(d){d=d||{},this.position=new r,d.position&&this.position.copy(d.position),this.quaternion=new o,d.quaternion&&this.quaternion.copy(d.quaternion)}var h=new o;l.pointToLocalFrame=function(d,f,c,p){var p=p||new r;return c.vsub(d,p),f.conjugate(h),h.vmult(p,p),p},l.prototype.pointToLocal=function(d,f){return l.pointToLocalFrame(this.position,this.quaternion,d,f)},l.pointToWorldFrame=function(d,f,c,p){var p=p||new r;return f.vmult(c,p),p.vadd(d,p),p},l.prototype.pointToWorld=function(d,f){return l.pointToWorldFrame(this.position,this.quaternion,d,f)},l.prototype.vectorToWorldFrame=function(d,c){var c=c||new r;return this.quaternion.vmult(d,c),c},l.vectorToWorldFrame=function(d,f,c){return d.vmult(f,c),c},l.vectorToLocalFrame=function(d,f,c,p){var p=p||new r;return f.w*=-1,f.vmult(c,p),f.w*=-1,p}},{"./Quaternion":28,"./Vec3":30}],30:[function(t,i,s){i.exports=o;var r=t("./Mat3");function o(f,c,u){this.x=f||0,this.y=c||0,this.z=u||0}o.ZERO=new o(0,0,0),o.UNIT_X=new o(1,0,0),o.UNIT_Y=new o(0,1,0),o.UNIT_Z=new o(0,0,1),o.prototype.cross=function(f,c){var u=f.x,p=f.y,m=f.z,_=this.x,g=this.y,v=this.z;return c=c||new o,c.x=g*m-v*p,c.y=v*u-_*m,c.z=_*p-g*u,c},o.prototype.set=function(f,c,u){return this.x=f,this.y=c,this.z=u,this},o.prototype.setZero=function(){this.x=this.y=this.z=0},o.prototype.vadd=function(f,c){if(c)c.x=f.x+this.x,c.y=f.y+this.y,c.z=f.z+this.z;else return new o(this.x+f.x,this.y+f.y,this.z+f.z)},o.prototype.vsub=function(f,c){if(c)c.x=this.x-f.x,c.y=this.y-f.y,c.z=this.z-f.z;else return new o(this.x-f.x,this.y-f.y,this.z-f.z)},o.prototype.crossmat=function(){return new r([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},o.prototype.normalize=function(){var f=this.x,c=this.y,u=this.z,p=Math.sqrt(f*f+c*c+u*u);if(p>0){var m=1/p;this.x*=m,this.y*=m,this.z*=m}else this.x=0,this.y=0,this.z=0;return p},o.prototype.unit=function(f){f=f||new o;var c=this.x,u=this.y,p=this.z,m=Math.sqrt(c*c+u*u+p*p);return m>0?(m=1/m,f.x=c*m,f.y=u*m,f.z=p*m):(f.x=1,f.y=0,f.z=0),f},o.prototype.norm=function(){var f=this.x,c=this.y,u=this.z;return Math.sqrt(f*f+c*c+u*u)},o.prototype.length=o.prototype.norm,o.prototype.norm2=function(){return this.dot(this)},o.prototype.lengthSquared=o.prototype.norm2,o.prototype.distanceTo=function(f){var c=this.x,u=this.y,p=this.z,m=f.x,_=f.y,g=f.z;return Math.sqrt((m-c)*(m-c)+(_-u)*(_-u)+(g-p)*(g-p))},o.prototype.distanceSquared=function(f){var c=this.x,u=this.y,p=this.z,m=f.x,_=f.y,g=f.z;return(m-c)*(m-c)+(_-u)*(_-u)+(g-p)*(g-p)},o.prototype.mult=function(f,c){c=c||new o;var u=this.x,p=this.y,m=this.z;return c.x=f*u,c.y=f*p,c.z=f*m,c},o.prototype.scale=o.prototype.mult,o.prototype.dot=function(f){return this.x*f.x+this.y*f.y+this.z*f.z},o.prototype.isZero=function(){return this.x===0&&this.y===0&&this.z===0},o.prototype.negate=function(f){return f=f||new o,f.x=-this.x,f.y=-this.y,f.z=-this.z,f};var l=new o,h=new o;o.prototype.tangents=function(f,c){var u=this.norm();if(u>0){var p=l,m=1/u;p.set(this.x*m,this.y*m,this.z*m);var _=h;Math.abs(p.x)<.9?(_.set(1,0,0),p.cross(_,f)):(_.set(0,1,0),p.cross(_,f)),p.cross(f,c)}else f.set(1,0,0),c.set(0,1,0)},o.prototype.toString=function(){return this.x+","+this.y+","+this.z},o.prototype.toArray=function(){return[this.x,this.y,this.z]},o.prototype.copy=function(f){return this.x=f.x,this.y=f.y,this.z=f.z,this},o.prototype.lerp=function(f,c,u){var p=this.x,m=this.y,_=this.z;u.x=p+(f.x-p)*c,u.y=m+(f.y-m)*c,u.z=_+(f.z-_)*c},o.prototype.almostEquals=function(f,c){return c===void 0&&(c=1e-6),!(Math.abs(this.x-f.x)>c||Math.abs(this.y-f.y)>c||Math.abs(this.z-f.z)>c)},o.prototype.almostZero=function(f){return f===void 0&&(f=1e-6),!(Math.abs(this.x)>f||Math.abs(this.y)>f||Math.abs(this.z)>f)};var d=new o;o.prototype.isAntiparallelTo=function(f,c){return this.negate(d),d.almostEquals(f,c)},o.prototype.clone=function(){return new o(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(t,i,s){i.exports=c;var r=t("../utils/EventTarget");t("../shapes/Shape");var o=t("../math/Vec3"),l=t("../math/Mat3"),h=t("../math/Quaternion");t("../material/Material");var d=t("../collision/AABB"),f=t("../shapes/Box");function c(L){L=L||{},r.apply(this),this.id=c.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new o,this.collisionFilterGroup=typeof L.collisionFilterGroup=="number"?L.collisionFilterGroup:1,this.collisionFilterMask=typeof L.collisionFilterMask=="number"?L.collisionFilterMask:1,this.collisionResponse=!0,this.position=new o,L.position&&this.position.copy(L.position),this.previousPosition=new o,this.initPosition=new o,this.velocity=new o,L.velocity&&this.velocity.copy(L.velocity),this.initVelocity=new o,this.force=new o;var N=typeof L.mass=="number"?L.mass:0;this.mass=N,this.invMass=N>0?1/N:0,this.material=L.material||null,this.linearDamping=typeof L.linearDamping=="number"?L.linearDamping:.01,this.type=N<=0?c.STATIC:c.DYNAMIC,typeof L.type==typeof c.STATIC&&(this.type=L.type),this.allowSleep=typeof L.allowSleep<"u"?L.allowSleep:!0,this.sleepState=0,this.sleepSpeedLimit=typeof L.sleepSpeedLimit<"u"?L.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof L.sleepTimeLimit<"u"?L.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new o,this.quaternion=new h,L.quaternion&&this.quaternion.copy(L.quaternion),this.initQuaternion=new h,this.angularVelocity=new o,L.angularVelocity&&this.angularVelocity.copy(L.angularVelocity),this.initAngularVelocity=new o,this.interpolatedPosition=new o,this.interpolatedQuaternion=new h,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new o,this.invInertia=new o,this.invInertiaWorld=new l,this.invMassSolve=0,this.invInertiaSolve=new o,this.invInertiaWorldSolve=new l,this.fixedRotation=typeof L.fixedRotation<"u"?L.fixedRotation:!1,this.angularDamping=typeof L.angularDamping<"u"?L.angularDamping:.01,this.aabb=new d,this.aabbNeedsUpdate=!0,this.wlambda=new o,L.shape&&this.addShape(L.shape),this.updateMassProperties()}c.prototype=new r,c.prototype.constructor=c,c.DYNAMIC=1,c.STATIC=2,c.KINEMATIC=4,c.AWAKE=0,c.SLEEPY=1,c.SLEEPING=2,c.idCounter=0,c.prototype.wakeUp=function(){var L=this.sleepState;this.sleepState=0,L===c.SLEEPING&&this.dispatchEvent({type:"wakeup"})},c.prototype.sleep=function(){this.sleepState=c.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},c.sleepyEvent={type:"sleepy"},c.sleepEvent={type:"sleep"},c.prototype.sleepTick=function(L){if(this.allowSleep){var N=this.sleepState,B=this.velocity.norm2()+this.angularVelocity.norm2(),G=Math.pow(this.sleepSpeedLimit,2);N===c.AWAKE&&B<G?(this.sleepState=c.SLEEPY,this.timeLastSleepy=L,this.dispatchEvent(c.sleepyEvent)):N===c.SLEEPY&&B>G?this.wakeUp():N===c.SLEEPY&&L-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(c.sleepEvent))}},c.prototype.updateSolveMassProperties=function(){this.sleepState===c.SLEEPING||this.type===c.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},c.prototype.pointToLocalFrame=function(L,B){var B=B||new o;return L.vsub(this.position,B),this.quaternion.conjugate().vmult(B,B),B},c.prototype.vectorToLocalFrame=function(L,B){var B=B||new o;return this.quaternion.conjugate().vmult(L,B),B},c.prototype.pointToWorldFrame=function(L,B){var B=B||new o;return this.quaternion.vmult(L,B),B.vadd(this.position,B),B},c.prototype.vectorToWorldFrame=function(L,B){var B=B||new o;return this.quaternion.vmult(L,B),B};var u=new o,p=new h;c.prototype.addShape=function(L,N,B){var G=new o,W=new h;return N&&G.copy(N),B&&W.copy(B),this.shapes.push(L),this.shapeOffsets.push(G),this.shapeOrientations.push(W),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},c.prototype.updateBoundingRadius=function(){for(var L=this.shapes,N=this.shapeOffsets,B=L.length,G=0,W=0;W!==B;W++){var ee=L[W];ee.updateBoundingSphereRadius();var z=N[W].norm(),k=ee.boundingSphereRadius;z+k>G&&(G=z+k)}this.boundingRadius=G};var m=new d;c.prototype.computeAABB=function(){for(var L=this.shapes,N=this.shapeOffsets,B=this.shapeOrientations,G=L.length,W=u,ee=p,z=this.quaternion,k=this.aabb,q=m,$=0;$!==G;$++){var H=L[$];B[$].mult(z,ee),ee.vmult(N[$],W),W.vadd(this.position,W),H.calculateWorldAABB(W,ee,q.lowerBound,q.upperBound),$===0?k.copy(q):k.extend(q)}this.aabbNeedsUpdate=!1};var _=new l,g=new l;new l,c.prototype.updateInertiaWorld=function(L){var N=this.invInertia;if(!(N.x===N.y&&N.y===N.z&&!L)){var B=_,G=g;B.setRotationFromQuaternion(this.quaternion),B.transpose(G),B.scale(N,B),B.mmult(G,this.invInertiaWorld)}};var v=new o,y=new o;c.prototype.applyForce=function(L,N){if(this.type===c.DYNAMIC){var B=v;N.vsub(this.position,B);var G=y;B.cross(L,G),this.force.vadd(L,this.force),this.torque.vadd(G,this.torque)}};var x=new o,b=new o;c.prototype.applyLocalForce=function(L,N){if(this.type===c.DYNAMIC){var B=x,G=b;this.vectorToWorldFrame(L,B),this.pointToWorldFrame(N,G),this.applyForce(B,G)}};var S=new o,A=new o,E=new o;c.prototype.applyImpulse=function(L,N){if(this.type===c.DYNAMIC){var B=S;N.vsub(this.position,B);var G=A;G.copy(L),G.mult(this.invMass,G),this.velocity.vadd(G,this.velocity);var W=E;B.cross(L,W),this.invInertiaWorld.vmult(W,W),this.angularVelocity.vadd(W,this.angularVelocity)}};var R=new o,M=new o;c.prototype.applyLocalImpulse=function(L,N){if(this.type===c.DYNAMIC){var B=R,G=M;this.vectorToWorldFrame(L,B),this.pointToWorldFrame(N,G),this.applyImpulse(B,G)}};var w=new o;c.prototype.updateMassProperties=function(){var L=w;this.invMass=this.mass>0?1/this.mass:0;var N=this.inertia,B=this.fixedRotation;this.computeAABB(),L.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),f.calculateInertia(L,this.mass,N),this.invInertia.set(N.x>0&&!B?1/N.x:0,N.y>0&&!B?1/N.y:0,N.z>0&&!B?1/N.z:0),this.updateInertiaWorld(!0)},c.prototype.getVelocityAtWorldPoint=function(L,N){var B=new o;return L.vsub(this.position,B),this.angularVelocity.cross(B,N),this.velocity.vadd(N,N),N}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(t,i,s){t("./Body");var r=t("../math/Vec3"),o=t("../math/Quaternion");t("../collision/RaycastResult");var l=t("../collision/Ray"),h=t("../objects/WheelInfo");i.exports=d;function d(z){this.chassisBody=z.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=typeof z.indexRightAxis<"u"?z.indexRightAxis:1,this.indexForwardAxis=typeof z.indexForwardAxis<"u"?z.indexForwardAxis:0,this.indexUpAxis=typeof z.indexUpAxis<"u"?z.indexUpAxis:2}new r,new r,new r;var f=new r,c=new r,u=new r;new l,d.prototype.addWheel=function(z){z=z||{};var k=new h(z),q=this.wheelInfos.length;return this.wheelInfos.push(k),q},d.prototype.setSteeringValue=function(z,k){var q=this.wheelInfos[k];q.steering=z},new r,d.prototype.applyEngineForce=function(z,k){this.wheelInfos[k].engineForce=z},d.prototype.setBrake=function(z,k){this.wheelInfos[k].brake=z},d.prototype.addToWorld=function(z){this.constraints,z.add(this.chassisBody);var k=this;this.preStepCallback=function(){k.updateVehicle(z.dt)},z.addEventListener("preStep",this.preStepCallback),this.world=z},d.prototype.getVehicleAxisWorld=function(z,k){k.set(z===0?1:0,z===1?1:0,z===2?1:0),this.chassisBody.vectorToWorldFrame(k,k)},d.prototype.updateVehicle=function(z){for(var k=this.wheelInfos,q=k.length,$=this.chassisBody,H=0;H<q;H++)this.updateWheelTransform(H);this.currentVehicleSpeedKmHour=3.6*$.velocity.norm();var Q=new r;this.getVehicleAxisWorld(this.indexForwardAxis,Q),Q.dot($.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(var H=0;H<q;H++)this.castRay(k[H]);this.updateSuspension(z);for(var X=new r,F=new r,H=0;H<q;H++){var D=k[H],j=D.suspensionForce;j>D.maxSuspensionForce&&(j=D.maxSuspensionForce),D.raycastResult.hitNormalWorld.scale(j*z,X),D.raycastResult.hitPointWorld.vsub($.position,F),$.applyImpulse(X,D.raycastResult.hitPointWorld)}this.updateFriction(z);var te=new r,ae=new r,K=new r;for(H=0;H<q;H++){var D=k[H];$.getVelocityAtWorldPoint(D.chassisConnectionPointWorld,K);var O=1;switch(this.indexUpAxis){case 1:O=-1;break}if(D.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,ae);var pe=ae.dot(D.raycastResult.hitNormalWorld);D.raycastResult.hitNormalWorld.scale(pe,te),ae.vsub(te,ae);var xe=ae.dot(K);D.deltaRotation=O*xe*z/D.radius}(D.sliding||!D.isInContact)&&D.engineForce!==0&&D.useCustomSlidingRotationalSpeed&&(D.deltaRotation=(D.engineForce>0?1:-1)*D.customSlidingRotationalSpeed*z),Math.abs(D.brake)>Math.abs(D.engineForce)&&(D.deltaRotation=0),D.rotation+=D.deltaRotation,D.deltaRotation*=.99}},d.prototype.updateSuspension=function(z){for(var k=this.chassisBody,q=k.mass,$=this.wheelInfos,H=$.length,Q=0;Q<H;Q++){var X=$[Q];if(X.isInContact){var F,D=X.suspensionRestLength,j=X.suspensionLength,te=D-j;F=X.suspensionStiffness*te*X.clippedInvContactDotSuspension;var ae=X.suspensionRelativeVelocity,K;ae<0?K=X.dampingCompression:K=X.dampingRelaxation,F-=K*ae,X.suspensionForce=F*q,X.suspensionForce<0&&(X.suspensionForce=0)}else X.suspensionForce=0}},d.prototype.removeFromWorld=function(z){this.constraints,z.remove(this.chassisBody),z.removeEventListener("preStep",this.preStepCallback),this.world=null};var p=new r,m=new r;d.prototype.castRay=function(z){var k=p,q=m;this.updateWheelTransformWorld(z);var $=this.chassisBody,H=-1,Q=z.suspensionRestLength+z.radius;z.directionWorld.scale(Q,k);var X=z.chassisConnectionPointWorld;X.vadd(k,q);var F=z.raycastResult;F.reset();var D=$.collisionResponse;$.collisionResponse=!1,this.world.rayTest(X,q,F),$.collisionResponse=D;var j=F.body;if(z.raycastResult.groundObject=0,j){H=F.distance,z.raycastResult.hitNormalWorld=F.hitNormalWorld,z.isInContact=!0;var te=F.distance;z.suspensionLength=te-z.radius;var ae=z.suspensionRestLength-z.maxSuspensionTravel,K=z.suspensionRestLength+z.maxSuspensionTravel;z.suspensionLength<ae&&(z.suspensionLength=ae),z.suspensionLength>K&&(z.suspensionLength=K,z.raycastResult.reset());var O=z.raycastResult.hitNormalWorld.dot(z.directionWorld),pe=new r;$.getVelocityAtWorldPoint(z.raycastResult.hitPointWorld,pe);var xe=z.raycastResult.hitNormalWorld.dot(pe);if(O>=-.1)z.suspensionRelativeVelocity=0,z.clippedInvContactDotSuspension=1/.1;else{var Ee=-1/O;z.suspensionRelativeVelocity=xe*Ee,z.clippedInvContactDotSuspension=Ee}}else z.suspensionLength=z.suspensionRestLength+0*z.maxSuspensionTravel,z.suspensionRelativeVelocity=0,z.directionWorld.scale(-1,z.raycastResult.hitNormalWorld),z.clippedInvContactDotSuspension=1;return H},d.prototype.updateWheelTransformWorld=function(z){z.isInContact=!1;var k=this.chassisBody;k.pointToWorldFrame(z.chassisConnectionPointLocal,z.chassisConnectionPointWorld),k.vectorToWorldFrame(z.directionLocal,z.directionWorld),k.vectorToWorldFrame(z.axleLocal,z.axleWorld)},d.prototype.updateWheelTransform=function(z){var k=f,q=c,$=u,H=this.wheelInfos[z];this.updateWheelTransformWorld(H),H.directionLocal.scale(-1,k),q.copy(H.axleLocal),k.cross(q,$),$.normalize(),q.normalize();var Q=H.steering,X=new o;X.setFromAxisAngle(k,Q);var F=new o;F.setFromAxisAngle(q,H.rotation);var D=H.worldTransform.quaternion;this.chassisBody.quaternion.mult(X,D),D.mult(F,D),D.normalize();var j=H.worldTransform.position;j.copy(H.directionWorld),j.scale(H.suspensionLength,j),j.vadd(H.chassisConnectionPointWorld,j)};var _=[new r(1,0,0),new r(0,1,0),new r(0,0,1)];d.prototype.getWheelTransformWorld=function(z){return this.wheelInfos[z].worldTransform};var g=new r,v=[],y=[],x=1;d.prototype.updateFriction=function(z){for(var k=g,q=this.wheelInfos,$=q.length,H=this.chassisBody,Q=y,X=v,F=0;F<$;F++){var D=q[F],j=D.raycastResult.body;D.sideImpulse=0,D.forwardImpulse=0,Q[F]||(Q[F]=new r),X[F]||(X[F]=new r)}for(var F=0;F<$;F++){var D=q[F],j=D.raycastResult.body;if(j){var te=X[F],ae=this.getWheelTransformWorld(F);ae.vectorToWorldFrame(_[this.indexRightAxis],te);var K=D.raycastResult.hitNormalWorld,O=te.dot(K);K.scale(O,k),te.vsub(k,te),te.normalize(),K.cross(te,Q[F]),Q[F].normalize(),D.sideImpulse=ee(H,D.raycastResult.hitPointWorld,j,D.raycastResult.hitPointWorld,te),D.sideImpulse*=x}}var pe=1,xe=.5;this.sliding=!1;for(var F=0;F<$;F++){var D=q[F],j=D.raycastResult.body,Ee=0;if(D.slipInfo=1,j){var ve=0,he=D.brake?D.brake:ve;Ee=E(H,j,D.raycastResult.hitPointWorld,Q[F],he),Ee+=D.engineForce*z;var fe=he/Ee;D.slipInfo*=fe}if(D.forwardImpulse=0,D.skidInfo=1,j){D.skidInfo=1;var qe=D.suspensionForce*z*D.frictionSlip,Ye=qe,U=qe*Ye;D.forwardImpulse=Ee;var P=D.forwardImpulse*xe,re=D.sideImpulse*pe,de=P*P+re*re;if(D.sliding=!1,de>U){this.sliding=!0,D.sliding=!0;var fe=qe/Math.sqrt(de);D.skidInfo*=fe}}}if(this.sliding)for(var F=0;F<$;F++){var D=q[F];D.sideImpulse!==0&&D.skidInfo<1&&(D.forwardImpulse*=D.skidInfo,D.sideImpulse*=D.skidInfo)}for(var F=0;F<$;F++){var D=q[F],me=new r;if(me.copy(D.raycastResult.hitPointWorld),D.forwardImpulse!==0){var _e=new r;Q[F].scale(D.forwardImpulse,_e),H.applyImpulse(_e,me)}if(D.sideImpulse!==0){var j=D.raycastResult.body,De=new r;De.copy(D.raycastResult.hitPointWorld);var Ce=new r;X[F].scale(D.sideImpulse,Ce),H.pointToLocalFrame(me,me),me["xyz"[this.indexUpAxis]]*=D.rollInfluence,H.pointToWorldFrame(me,me),H.applyImpulse(Ce,me),Ce.scale(-1,Ce),j.applyImpulse(Ce,De)}}};var b=new r,S=new r,A=new r;function E(z,k,q,$,H){var Q=0,X=q,F=b,D=S,j=A;z.getVelocityAtWorldPoint(X,F),k.getVelocityAtWorldPoint(X,D),F.vsub(D,j);var te=$.dot(j),ae=N(z,q,$),K=N(k,q,$),O=1,pe=O/(ae+K);return Q=-te*pe,H<Q&&(Q=H),Q<-H&&(Q=-H),Q}var R=new r,M=new r,w=new r,L=new r;function N(z,k,q){var $=R,H=M,Q=w,X=L;return k.vsub(z.position,$),$.cross(q,H),z.invInertiaWorld.vmult(H,X),X.cross($,Q),z.invMass+q.dot(Q)}var B=new r,G=new r,W=new r;function ee(z,k,q,$,H,O){var X=H.norm2();if(X>1.1)return 0;var F=B,D=G,j=W;z.getVelocityAtWorldPoint(k,F),q.getVelocityAtWorldPoint($,D),F.vsub(D,j);var te=H.dot(j),ae=.2,K=1/(z.invMass+q.invMass),O=-ae*te*K;return O}},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(t,i,s){var r=t("./Body"),o=t("../shapes/Sphere"),l=t("../shapes/Box"),h=t("../math/Vec3"),d=t("../constraints/HingeConstraint");i.exports=f;function f(p){if(this.wheelBodies=[],this.coordinateSystem=typeof p.coordinateSystem>"u"?new h(1,2,3):p.coordinateSystem.clone(),this.chassisBody=p.chassisBody,!this.chassisBody){var m=new l(new h(5,2,.5));this.chassisBody=new r(1,m)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}f.prototype.addWheel=function(p){p=p||{};var m=p.body;m||(m=new r(1,new o(1.2))),this.wheelBodies.push(m),this.wheelForces.push(0),new h;var _=typeof p.position<"u"?p.position.clone():new h,g=new h;this.chassisBody.pointToWorldFrame(_,g),m.position.set(g.x,g.y,g.z);var v=typeof p.axis<"u"?p.axis.clone():new h(0,1,0);this.wheelAxes.push(v);var y=new d(this.chassisBody,m,{pivotA:_,axisA:v,pivotB:h.ZERO,axisB:v,collideConnected:!1});return this.constraints.push(y),this.wheelBodies.length-1},f.prototype.setSteeringValue=function(p,m){var _=this.wheelAxes[m],g=Math.cos(p),v=Math.sin(p),y=_.x,x=_.y;this.constraints[m].axisA.set(g*y-v*x,v*y+g*x,0)},f.prototype.setMotorSpeed=function(p,m){var _=this.constraints[m];_.enableMotor(),_.motorTargetVelocity=p},f.prototype.disableMotor=function(p){var m=this.constraints[p];m.disableMotor()};var c=new h;f.prototype.setWheelForce=function(p,m){this.wheelForces[m]=p},f.prototype.applyWheelForce=function(p,m){var _=this.wheelAxes[m],g=this.wheelBodies[m],v=g.torque;_.scale(p,c),g.vectorToWorldFrame(c,c),v.vadd(c,v)},f.prototype.addToWorld=function(p){for(var m=this.constraints,_=this.wheelBodies.concat([this.chassisBody]),g=0;g<_.length;g++)p.add(_[g]);for(var g=0;g<m.length;g++)p.addConstraint(m[g]);p.addEventListener("preStep",this._update.bind(this))},f.prototype._update=function(){for(var p=this.wheelForces,m=0;m<p.length;m++)this.applyWheelForce(p[m],m)},f.prototype.removeFromWorld=function(p){for(var m=this.constraints,_=this.wheelBodies.concat([this.chassisBody]),g=0;g<_.length;g++)p.remove(_[g]);for(var g=0;g<m.length;g++)p.removeConstraint(m[g])};var u=new h;f.prototype.getWheelSpeed=function(p){var m=this.wheelAxes[p],_=this.wheelBodies[p],g=_.angularVelocity;return this.chassisBody.vectorToWorldFrame(m,u),g.dot(u)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(t,i,s){i.exports=o,t("../shapes/Shape");var r=t("../math/Vec3");t("../math/Quaternion"),t("../shapes/Particle"),t("../objects/Body"),t("../material/Material");function o(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}o.prototype.add=function(m){this.particles.push(m),this.neighbors.length<this.particles.length&&this.neighbors.push([])},o.prototype.remove=function(m){var _=this.particles.indexOf(m);_!==-1&&(this.particles.splice(_,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var l=new r;o.prototype.getNeighbors=function(m,_){for(var g=this.particles.length,v=m.id,y=this.smoothingRadius*this.smoothingRadius,x=l,b=0;b!==g;b++){var S=this.particles[b];S.position.vsub(m.position,x),v!==S.id&&x.norm2()<y&&_.push(S)}};var h=new r,d=new r,f=new r,c=new r,u=new r,p=new r;o.prototype.update=function(){for(var m=this.particles.length,_=h,g=this.speedOfSound,v=this.eps,y=0;y!==m;y++){var x=this.particles[y],b=this.neighbors[y];b.length=0,this.getNeighbors(x,b),b.push(this.particles[y]);for(var S=b.length,A=0,E=0;E!==S;E++){x.position.vsub(b[E].position,_);var R=_.norm(),M=this.w(R);A+=b[E].mass*M}this.densities[y]=A,this.pressures[y]=g*g*(this.densities[y]-this.density)}for(var w=d,L=f,N=c,B=u,G=p,y=0;y!==m;y++){var W=this.particles[y];w.set(0,0,0),L.set(0,0,0);for(var ee,z,b=this.neighbors[y],S=b.length,E=0;E!==S;E++){var k=b[E];W.position.vsub(k.position,B);var q=B.norm();ee=-k.mass*(this.pressures[y]/(this.densities[y]*this.densities[y]+v)+this.pressures[E]/(this.densities[E]*this.densities[E]+v)),this.gradw(B,N),N.mult(ee,N),w.vadd(N,w),k.velocity.vsub(W.velocity,G),G.mult(1/(1e-4+this.densities[y]*this.densities[E])*this.viscosity*k.mass,G),z=this.nablaw(q),G.mult(z,G),L.vadd(G,L)}L.mult(W.mass,L),w.mult(W.mass,w),W.force.vadd(L,W.force),W.force.vadd(w,W.force)}},o.prototype.w=function(m){var _=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(_,9))*Math.pow(_*_-m*m,3)},o.prototype.gradw=function(m,_){var g=m.norm(),v=this.smoothingRadius;m.mult(945/(32*Math.PI*Math.pow(v,9))*Math.pow(v*v-g*g,2),_)},o.prototype.nablaw=function(m){var _=this.smoothingRadius,g=945/(32*Math.PI*Math.pow(_,9))*(_*_-m*m)*(7*m*m-3*_*_);return g}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(t,i,s){var r=t("../math/Vec3");i.exports=o;function o(y,x,b){b=b||{},this.restLength=typeof b.restLength=="number"?b.restLength:1,this.stiffness=b.stiffness||100,this.damping=b.damping||1,this.bodyA=y,this.bodyB=x,this.localAnchorA=new r,this.localAnchorB=new r,b.localAnchorA&&this.localAnchorA.copy(b.localAnchorA),b.localAnchorB&&this.localAnchorB.copy(b.localAnchorB),b.worldAnchorA&&this.setWorldAnchorA(b.worldAnchorA),b.worldAnchorB&&this.setWorldAnchorB(b.worldAnchorB)}o.prototype.setWorldAnchorA=function(y){this.bodyA.pointToLocalFrame(y,this.localAnchorA)},o.prototype.setWorldAnchorB=function(y){this.bodyB.pointToLocalFrame(y,this.localAnchorB)},o.prototype.getWorldAnchorA=function(y){this.bodyA.pointToWorldFrame(this.localAnchorA,y)},o.prototype.getWorldAnchorB=function(y){this.bodyB.pointToWorldFrame(this.localAnchorB,y)};var l=new r,h=new r,d=new r,f=new r,c=new r,u=new r,p=new r,m=new r,_=new r,g=new r,v=new r;o.prototype.applyForce=function(){var y=this.stiffness,x=this.damping,b=this.restLength,S=this.bodyA,A=this.bodyB,E=l,R=h,M=d,w=f,L=v,N=c,B=u,G=p,W=m,ee=_,z=g;this.getWorldAnchorA(N),this.getWorldAnchorB(B),N.vsub(S.position,G),B.vsub(A.position,W),B.vsub(N,E);var k=E.norm();R.copy(E),R.normalize(),A.velocity.vsub(S.velocity,M),A.angularVelocity.cross(W,L),M.vadd(L,M),S.angularVelocity.cross(G,L),M.vsub(L,M),R.mult(-y*(k-b)-x*M.dot(R),w),S.force.vsub(w,S.force),A.force.vadd(w,A.force),G.cross(w,ee),W.cross(w,z),S.torque.vsub(ee,S.torque),A.torque.vadd(z,A.torque)}},{"../math/Vec3":30}],36:[function(t,i,s){var r=t("../math/Vec3"),o=t("../math/Transform"),l=t("../collision/RaycastResult"),h=t("../utils/Utils");i.exports=d;function d(u){u=h.defaults(u,{chassisConnectionPointLocal:new r,chassisConnectionPointWorld:new r,directionLocal:new r,directionWorld:new r,axleLocal:new r,axleWorld:new r,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=u.maxSuspensionTravel,this.customSlidingRotationalSpeed=u.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=u.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=u.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=u.chassisConnectionPointWorld.clone(),this.directionLocal=u.directionLocal.clone(),this.directionWorld=u.directionWorld.clone(),this.axleLocal=u.axleLocal.clone(),this.axleWorld=u.axleWorld.clone(),this.suspensionRestLength=u.suspensionRestLength,this.suspensionMaxLength=u.suspensionMaxLength,this.radius=u.radius,this.suspensionStiffness=u.suspensionStiffness,this.dampingCompression=u.dampingCompression,this.dampingRelaxation=u.dampingRelaxation,this.frictionSlip=u.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=u.rollInfluence,this.maxSuspensionForce=u.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=u.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new l,this.worldTransform=new o,this.isInContact=!1}var c=new r,f=new r,c=new r;d.prototype.updateWheel=function(u){var p=this.raycastResult;if(this.isInContact){var m=p.hitNormalWorld.dot(p.directionWorld);p.hitPointWorld.vsub(u.position,f),u.getVelocityAtWorldPoint(f,c);var _=p.hitNormalWorld.dot(c);if(m>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=1/.1;else{var g=-1/m;this.suspensionRelativeVelocity=_*g,this.clippedInvContactDotSuspension=g}}else p.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,p.directionWorld.scale(-1,p.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(t,i,s){i.exports=h;var r=t("./Shape"),o=t("../math/Vec3"),l=t("./ConvexPolyhedron");function h(c){r.call(this),this.type=r.types.BOX,this.halfExtents=c,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}h.prototype=new r,h.prototype.constructor=h,h.prototype.updateConvexPolyhedronRepresentation=function(){var c=this.halfExtents.x,u=this.halfExtents.y,p=this.halfExtents.z,m=o,_=[new m(-c,-u,-p),new m(c,-u,-p),new m(c,u,-p),new m(-c,u,-p),new m(-c,-u,p),new m(c,-u,p),new m(c,u,p),new m(-c,u,p)],g=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]];new m(0,0,1),new m(0,1,0),new m(1,0,0);var v=new l(_,g);this.convexPolyhedronRepresentation=v,v.material=this.material},h.prototype.calculateLocalInertia=function(c,u){return u=u||new o,h.calculateInertia(this.halfExtents,c,u),u},h.calculateInertia=function(c,u,p){var m=c;p.x=1/12*u*(2*m.y*2*m.y+2*m.z*2*m.z),p.y=1/12*u*(2*m.x*2*m.x+2*m.z*2*m.z),p.z=1/12*u*(2*m.y*2*m.y+2*m.x*2*m.x)},h.prototype.getSideNormals=function(c,u){var p=c,m=this.halfExtents;if(p[0].set(m.x,0,0),p[1].set(0,m.y,0),p[2].set(0,0,m.z),p[3].set(-m.x,0,0),p[4].set(0,-m.y,0),p[5].set(0,0,-m.z),u!==void 0)for(var _=0;_!==p.length;_++)u.vmult(p[_],p[_]);return p},h.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},h.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var d=new o;new o,h.prototype.forEachWorldCorner=function(c,u,p){for(var m=this.halfExtents,_=[[m.x,m.y,m.z],[-m.x,m.y,m.z],[-m.x,-m.y,m.z],[-m.x,-m.y,-m.z],[m.x,-m.y,-m.z],[m.x,m.y,-m.z],[-m.x,m.y,-m.z],[m.x,-m.y,m.z]],g=0;g<_.length;g++)d.set(_[g][0],_[g][1],_[g][2]),u.vmult(d,d),c.vadd(d,d),p(d.x,d.y,d.z)};var f=[new o,new o,new o,new o,new o,new o,new o,new o];h.prototype.calculateWorldAABB=function(c,u,p,m){var _=this.halfExtents;f[0].set(_.x,_.y,_.z),f[1].set(-_.x,_.y,_.z),f[2].set(-_.x,-_.y,_.z),f[3].set(-_.x,-_.y,-_.z),f[4].set(_.x,-_.y,-_.z),f[5].set(_.x,_.y,-_.z),f[6].set(-_.x,_.y,-_.z),f[7].set(_.x,-_.y,_.z);var g=f[0];u.vmult(g,g),c.vadd(g,g),m.copy(g),p.copy(g);for(var v=1;v<8;v++){var g=f[v];u.vmult(g,g),c.vadd(g,g);var y=g.x,x=g.y,b=g.z;y>m.x&&(m.x=y),x>m.y&&(m.y=x),b>m.z&&(m.z=b),y<p.x&&(p.x=y),x<p.y&&(p.y=x),b<p.z&&(p.z=b)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(t,i,s){i.exports=h;var r=t("./Shape"),o=t("../math/Vec3");t("../math/Quaternion");var l=t("../math/Transform");function h(H,Q,X){r.call(this),this.type=r.types.CONVEXPOLYHEDRON,this.vertices=H||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=Q||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=X?X.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}h.prototype=new r,h.prototype.constructor=h;var d=new o;h.prototype.computeEdges=function(){var H=this.faces,Q=this.vertices;Q.length;var X=this.uniqueEdges;X.length=0;for(var F=d,D=0;D!==H.length;D++)for(var j=H[D],te=j.length,ae=0;ae!==te;ae++){var K=(ae+1)%te;Q[j[ae]].vsub(Q[j[K]],F),F.normalize();for(var O=!1,pe=0;pe!==X.length;pe++)if(X[pe].almostEquals(F)||X[pe].almostEquals(F)){O=!0;break}O||X.push(F.clone())}},h.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var H=0;H<this.faces.length;H++){for(var Q=0;Q<this.faces[H].length;Q++)if(!this.vertices[this.faces[H][Q]])throw new Error("Vertex "+this.faces[H][Q]+" not found!");var X=this.faceNormals[H]||new o;this.getFaceNormal(H,X),X.negate(X),this.faceNormals[H]=X;var F=this.vertices[this.faces[H][0]];if(X.dot(F)<0){console.error(".faceNormals["+H+"] = Vec3("+X.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var Q=0;Q<this.faces[H].length;Q++)console.warn(".vertices["+this.faces[H][Q]+"] = Vec3("+this.vertices[this.faces[H][Q]].toString()+")")}}};var f=new o,c=new o;h.computeNormal=function(H,Q,X,F){Q.vsub(H,c),X.vsub(Q,f),f.cross(c,F),F.isZero()||F.normalize()},h.prototype.getFaceNormal=function(H,Q){var X=this.faces[H],F=this.vertices[X[0]],D=this.vertices[X[1]],j=this.vertices[X[2]];return h.computeNormal(F,D,j,Q)};var u=new o;h.prototype.clipAgainstHull=function(H,Q,X,F,D,j,te,ae,K){for(var O=u,pe=-1,xe=-Number.MAX_VALUE,Ee=0;Ee<X.faces.length;Ee++){O.copy(X.faceNormals[Ee]),D.vmult(O,O);var ve=O.dot(j);ve>xe&&(xe=ve,pe=Ee)}for(var he=[],fe=X.faces[pe],qe=fe.length,Ye=0;Ye<qe;Ye++){var U=X.vertices[fe[Ye]],P=new o;P.copy(U),D.vmult(P,P),F.vadd(P,P),he.push(P)}pe>=0&&this.clipFaceAgainstHull(j,H,Q,he,te,ae,K)};var p=new o,m=new o,_=new o,g=new o,v=new o,y=new o;h.prototype.findSeparatingAxis=function(H,Q,X,F,D,j,te,ae){var K=p,O=m,pe=_,xe=g,Ee=v,ve=y,he=Number.MAX_VALUE,fe=this;if(fe.uniqueAxes)for(var Ye=0;Ye!==fe.uniqueAxes.length;Ye++){X.vmult(fe.uniqueAxes[Ye],K);var P=fe.testSepAxis(K,H,Q,X,F,D);if(P===!1)return!1;P<he&&(he=P,j.copy(K))}else for(var qe=te?te.length:fe.faces.length,Ye=0;Ye<qe;Ye++){var U=te?te[Ye]:Ye;K.copy(fe.faceNormals[U]),X.vmult(K,K);var P=fe.testSepAxis(K,H,Q,X,F,D);if(P===!1)return!1;P<he&&(he=P,j.copy(K))}if(H.uniqueAxes)for(var Ye=0;Ye!==H.uniqueAxes.length;Ye++){D.vmult(H.uniqueAxes[Ye],O);var P=fe.testSepAxis(O,H,Q,X,F,D);if(P===!1)return!1;P<he&&(he=P,j.copy(O))}else for(var re=ae?ae.length:H.faces.length,Ye=0;Ye<re;Ye++){var U=ae?ae[Ye]:Ye;O.copy(H.faceNormals[U]),D.vmult(O,O);var P=fe.testSepAxis(O,H,Q,X,F,D);if(P===!1)return!1;P<he&&(he=P,j.copy(O))}for(var de=0;de!==fe.uniqueEdges.length;de++){X.vmult(fe.uniqueEdges[de],xe);for(var me=0;me!==H.uniqueEdges.length;me++)if(D.vmult(H.uniqueEdges[me],Ee),xe.cross(Ee,ve),!ve.almostZero()){ve.normalize();var _e=fe.testSepAxis(ve,H,Q,X,F,D);if(_e===!1)return!1;_e<he&&(he=_e,j.copy(ve))}}return F.vsub(Q,pe),pe.dot(j)>0&&j.negate(j),!0};var x=[],b=[];h.prototype.testSepAxis=function(H,Q,X,F,D,j){var te=this;h.project(te,H,X,F,x),h.project(Q,H,D,j,b);var ae=x[0],K=x[1],O=b[0],pe=b[1],xe=ae-pe,Ee=O-K,ve=xe<Ee?xe:Ee;return ve};var S=new o,A=new o;h.prototype.calculateLocalInertia=function(H,Q){this.computeLocalAABB(S,A);var X=A.x-S.x,F=A.y-S.y,D=A.z-S.z;Q.x=1/12*H*(2*F*2*F+2*D*2*D),Q.y=1/12*H*(2*X*2*X+2*D*2*D),Q.z=1/12*H*(2*F*2*F+2*X*2*X)},h.prototype.getPlaneConstantOfFace=function(H){var Q=this.faces[H],X=this.faceNormals[H],F=this.vertices[Q[0]],D=-X.dot(F);return D};var E=new o,R=new o,M=new o,w=new o,L=new o,N=new o,B=new o,G=new o;h.prototype.clipFaceAgainstHull=function(H,Q,X,F,D,j,te){for(var ae=E,K=R,O=M,pe=w,xe=L,Ee=N,ve=B,he=G,fe=this,qe=[],Ye=F,U=qe,P=-1,re=Number.MAX_VALUE,de=0;de<fe.faces.length;de++){ae.copy(fe.faceNormals[de]),X.vmult(ae,ae);var me=ae.dot(H);me<re&&(re=me,P=de)}if(!(P<0)){var _e=fe.faces[P];_e.connectedFaces=[];for(var De=0;De<fe.faces.length;De++)for(var Ce=0;Ce<fe.faces[De].length;Ce++)_e.indexOf(fe.faces[De][Ce])!==-1&&De!==P&&_e.connectedFaces.indexOf(De)===-1&&_e.connectedFaces.push(De);Ye.length;for(var Me=_e.length,tt=0;tt<Me;tt++){var Pe=fe.vertices[_e[tt]],et=fe.vertices[_e[(tt+1)%Me]];Pe.vsub(et,K),O.copy(K),X.vmult(O,O),Q.vadd(O,O),pe.copy(this.faceNormals[P]),X.vmult(pe,pe),Q.vadd(pe,pe),O.cross(pe,xe),xe.negate(xe),Ee.copy(Pe),X.vmult(Ee,Ee),Q.vadd(Ee,Ee),-Ee.dot(xe);var We;{var ut=_e.connectedFaces[tt];ve.copy(this.faceNormals[ut]);var it=this.getPlaneConstantOfFace(ut);he.copy(ve),X.vmult(he,he);var We=it-he.dot(Q)}for(this.clipFaceAgainstPlane(Ye,U,he,We);Ye.length;)Ye.shift();for(;U.length;)Ye.push(U.shift())}ve.copy(this.faceNormals[P]);var it=this.getPlaneConstantOfFace(P);he.copy(ve),X.vmult(he,he);for(var We=it-he.dot(Q),De=0;De<Ye.length;De++){var st=he.dot(Ye[De])+We;if(st<=D&&(console.log("clamped: depth="+st+" to minDist="+(D+"")),st=D),st<=j){var ct=Ye[De];if(st<=0){var xt={point:ct,normal:he,depth:st};te.push(xt)}}}}},h.prototype.clipFaceAgainstPlane=function(H,Q,X,F){var D,j,te=H.length;if(te<2)return Q;var ae=H[H.length-1],K=H[0];D=X.dot(ae)+F;for(var O=0;O<te;O++){if(K=H[O],j=X.dot(K)+F,D<0)if(j<0){var pe=new o;pe.copy(K),Q.push(pe)}else{var pe=new o;ae.lerp(K,D/(D-j),pe),Q.push(pe)}else if(j<0){var pe=new o;ae.lerp(K,D/(D-j),pe),Q.push(pe),Q.push(K)}ae=K,D=j}return Q},h.prototype.computeWorldVertices=function(H,Q){for(var X=this.vertices.length;this.worldVertices.length<X;)this.worldVertices.push(new o);for(var F=this.vertices,D=this.worldVertices,j=0;j!==X;j++)Q.vmult(F[j],D[j]),H.vadd(D[j],D[j]);this.worldVerticesNeedsUpdate=!1},new o,h.prototype.computeLocalAABB=function(H,Q){var X=this.vertices.length,F=this.vertices;H.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Q.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var D=0;D<X;D++){var j=F[D];j.x<H.x?H.x=j.x:j.x>Q.x&&(Q.x=j.x),j.y<H.y?H.y=j.y:j.y>Q.y&&(Q.y=j.y),j.z<H.z?H.z=j.z:j.z>Q.z&&(Q.z=j.z)}},h.prototype.computeWorldFaceNormals=function(H){for(var Q=this.faceNormals.length;this.worldFaceNormals.length<Q;)this.worldFaceNormals.push(new o);for(var X=this.faceNormals,F=this.worldFaceNormals,D=0;D!==Q;D++)H.vmult(X[D],F[D]);this.worldFaceNormalsNeedsUpdate=!1},h.prototype.updateBoundingSphereRadius=function(){for(var H=0,Q=this.vertices,X=0,F=Q.length;X!==F;X++){var D=Q[X].norm2();D>H&&(H=D)}this.boundingSphereRadius=Math.sqrt(H)};var W=new o;h.prototype.calculateWorldAABB=function(H,Q,X,F){for(var D=this.vertices.length,j=this.vertices,te,ae,K,O,pe,xe,Ee=0;Ee<D;Ee++){W.copy(j[Ee]),Q.vmult(W,W),H.vadd(W,W);var ve=W;ve.x<te||te===void 0?te=ve.x:(ve.x>O||O===void 0)&&(O=ve.x),ve.y<ae||ae===void 0?ae=ve.y:(ve.y>pe||pe===void 0)&&(pe=ve.y),ve.z<K||K===void 0?K=ve.z:(ve.z>xe||xe===void 0)&&(xe=ve.z)}X.set(te,ae,K),F.set(O,pe,xe)},h.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},h.prototype.getAveragePointLocal=function(H){H=H||new o;for(var Q=this.vertices.length,X=this.vertices,F=0;F<Q;F++)H.vadd(X[F],H);return H.mult(1/Q,H),H},h.prototype.transformAllPoints=function(H,Q){var X=this.vertices.length,F=this.vertices;if(Q){for(var D=0;D<X;D++){var j=F[D];Q.vmult(j,j)}for(var D=0;D<this.faceNormals.length;D++){var j=this.faceNormals[D];Q.vmult(j,j)}}if(H)for(var D=0;D<X;D++){var j=F[D];j.vadd(H,j)}};var ee=new o,z=new o,k=new o;h.prototype.pointIsInside=function(H){var Q=this.vertices.length,X=this.vertices,F=this.faces,D=this.faceNormals,j=null,te=this.faces.length,ae=ee;this.getAveragePointLocal(ae);for(var K=0;K<te;K++){this.faces[K].length;var Q=D[K],O=X[F[K][0]],pe=z;H.vsub(O,pe);var xe=Q.dot(pe),Ee=k;ae.vsub(O,Ee);var ve=Q.dot(Ee);if(xe<0&&ve>0||xe>0&&ve<0)return!1}return j?1:-1},new o;var q=new o,$=new o;h.project=function(H,Q,X,F,D){var j=H.vertices.length,te=q,ae=0,K=0,O=$,pe=H.vertices;O.setZero(),l.vectorToLocalFrame(X,F,Q,te),l.pointToLocalFrame(X,F,O,O);var xe=O.dot(te);K=ae=pe[0].dot(te);for(var Ee=1;Ee<j;Ee++){var ve=pe[Ee].dot(te);ve>ae&&(ae=ve),ve<K&&(K=ve)}if(K-=xe,ae-=xe,K>ae){var he=K;K=ae,ae=he}D[0]=ae,D[1]=K}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(t,i,s){i.exports=h;var r=t("./Shape"),o=t("../math/Vec3");t("../math/Quaternion");var l=t("./ConvexPolyhedron");function h(d,f,c,u){var p=u,m=[],_=[],g=[],v=[],y=[],x=Math.cos,b=Math.sin;m.push(new o(f*x(0),f*b(0),-c*.5)),v.push(0),m.push(new o(d*x(0),d*b(0),c*.5)),y.push(1);for(var S=0;S<p;S++){var A=2*Math.PI/p*(S+1),E=2*Math.PI/p*(S+.5);S<p-1?(m.push(new o(f*x(A),f*b(A),-c*.5)),v.push(2*S+2),m.push(new o(d*x(A),d*b(A),c*.5)),y.push(2*S+3),g.push([2*S+2,2*S+3,2*S+1,2*S])):g.push([0,1,2*S+1,2*S]),(p%2===1||S<p/2)&&_.push(new o(x(E),b(E),0))}g.push(y),_.push(new o(0,0,1));for(var R=[],S=0;S<v.length;S++)R.push(v[v.length-S-1]);g.push(R),this.type=r.types.CONVEXPOLYHEDRON,l.call(this,m,g,_)}h.prototype=new l},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(t,i,s){var r=t("./Shape"),o=t("./ConvexPolyhedron"),l=t("../math/Vec3"),h=t("../utils/Utils");i.exports=d;function d(f,c){c=h.defaults(c,{maxValue:null,minValue:null,elementSize:1}),this.data=f,this.maxValue=c.maxValue,this.minValue=c.minValue,this.elementSize=c.elementSize,c.minValue===null&&this.updateMinValue(),c.maxValue===null&&this.updateMaxValue(),this.cacheEnabled=!0,r.call(this),this.pillarConvex=new o,this.pillarOffset=new l,this.type=r.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}d.prototype=new r,d.prototype.update=function(){this._cachedPillars={}},d.prototype.updateMinValue=function(){for(var f=this.data,c=f[0][0],u=0;u!==f.length;u++)for(var p=0;p!==f[u].length;p++){var m=f[u][p];m<c&&(c=m)}this.minValue=c},d.prototype.updateMaxValue=function(){for(var f=this.data,c=f[0][0],u=0;u!==f.length;u++)for(var p=0;p!==f[u].length;p++){var m=f[u][p];m>c&&(c=m)}this.maxValue=c},d.prototype.setHeightValueAtIndex=function(f,c,u){var p=this.data;p[f][c]=u,this.clearCachedConvexTrianglePillar(f,c,!1),f>0&&(this.clearCachedConvexTrianglePillar(f-1,c,!0),this.clearCachedConvexTrianglePillar(f-1,c,!1)),c>0&&(this.clearCachedConvexTrianglePillar(f,c-1,!0),this.clearCachedConvexTrianglePillar(f,c-1,!1)),c>0&&f>0&&this.clearCachedConvexTrianglePillar(f-1,c-1,!0)},d.prototype.getRectMinMax=function(f,c,u,p,m){m=m||[];for(var _=this.data,g=this.minValue,v=f;v<=u;v++)for(var y=c;y<=p;y++){var x=_[v][y];x>g&&(g=x)}m[0]=this.minValue,m[1]=g},d.prototype.getIndexOfPosition=function(f,c,u,p){var m=this.elementSize,_=this.data,g=Math.floor(f/m),v=Math.floor(c/m);return u[0]=g,u[1]=v,p&&(g<0&&(g=0),v<0&&(v=0),g>=_.length-1&&(g=_.length-1),v>=_[0].length-1&&(v=_[0].length-1)),!(g<0||v<0||g>=_.length-1||v>=_[0].length-1)},d.prototype.getHeightAt=function(f,c,u){var p=[];this.getIndexOfPosition(f,c,p,u);var m=[];return this.getRectMinMax(p[0],p[1]+1,p[0],p[1]+1,m),(m[0]+m[1])/2},d.prototype.getCacheConvexTrianglePillarKey=function(f,c,u){return f+"_"+c+"_"+(u?1:0)},d.prototype.getCachedConvexTrianglePillar=function(f,c,u){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(f,c,u)]},d.prototype.setCachedConvexTrianglePillar=function(f,c,u,p,m){this._cachedPillars[this.getCacheConvexTrianglePillarKey(f,c,u)]={convex:p,offset:m}},d.prototype.clearCachedConvexTrianglePillar=function(f,c,u){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(f,c,u)]},d.prototype.getConvexTrianglePillar=function(f,c,u){var p=this.pillarConvex,m=this.pillarOffset;if(this.cacheEnabled){var _=this.getCachedConvexTrianglePillar(f,c,u);if(_){this.pillarConvex=_.convex,this.pillarOffset=_.offset;return}p=new o,m=new l,this.pillarConvex=p,this.pillarOffset=m}var _=this.data,g=this.elementSize,v=p.faces;p.vertices.length=6;for(var y=0;y<6;y++)p.vertices[y]||(p.vertices[y]=new l);v.length=5;for(var y=0;y<5;y++)v[y]||(v[y]=[]);var x=p.vertices,b=(Math.min(_[f][c],_[f+1][c],_[f][c+1],_[f+1][c+1])-this.minValue)/2+this.minValue;u?(m.set((f+.75)*g,(c+.75)*g,b),x[0].set(.25*g,.25*g,_[f+1][c+1]-b),x[1].set(-.75*g,.25*g,_[f][c+1]-b),x[2].set(.25*g,-.75*g,_[f+1][c]-b),x[3].set(.25*g,.25*g,-b-1),x[4].set(-.75*g,.25*g,-b-1),x[5].set(.25*g,-.75*g,-b-1),v[0][0]=0,v[0][1]=1,v[0][2]=2,v[1][0]=5,v[1][1]=4,v[1][2]=3,v[2][0]=2,v[2][1]=5,v[2][2]=3,v[2][3]=0,v[3][0]=3,v[3][1]=4,v[3][2]=1,v[3][3]=0,v[4][0]=1,v[4][1]=4,v[4][2]=5,v[4][3]=2):(m.set((f+.25)*g,(c+.25)*g,b),x[0].set(-.25*g,-.25*g,_[f][c]-b),x[1].set(.75*g,-.25*g,_[f+1][c]-b),x[2].set(-.25*g,.75*g,_[f][c+1]-b),x[3].set(-.25*g,-.25*g,-b-1),x[4].set(.75*g,-.25*g,-b-1),x[5].set(-.25*g,.75*g,-b-1),v[0][0]=0,v[0][1]=1,v[0][2]=2,v[1][0]=5,v[1][1]=4,v[1][2]=3,v[2][0]=0,v[2][1]=2,v[2][2]=5,v[2][3]=3,v[3][0]=1,v[3][1]=0,v[3][2]=3,v[3][3]=4,v[4][0]=4,v[4][1]=5,v[4][2]=2,v[4][3]=1),p.computeNormals(),p.computeEdges(),p.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(f,c,u,p,m)},d.prototype.calculateLocalInertia=function(f,c){return c=c||new l,c.set(0,0,0),c},d.prototype.volume=function(){return Number.MAX_VALUE},d.prototype.calculateWorldAABB=function(f,c,u,p){u.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),p.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},d.prototype.updateBoundingSphereRadius=function(){var f=this.data,c=this.elementSize;this.boundingSphereRadius=new l(f.length*c,f[0].length*c,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(t,i,s){i.exports=l;var r=t("./Shape"),o=t("../math/Vec3");function l(){r.call(this),this.type=r.types.PARTICLE}l.prototype=new r,l.prototype.constructor=l,l.prototype.calculateLocalInertia=function(h,d){return d=d||new o,d.set(0,0,0),d},l.prototype.volume=function(){return 0},l.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},l.prototype.calculateWorldAABB=function(h,d,f,c){f.copy(h),c.copy(h)}},{"../math/Vec3":30,"./Shape":43}],42:[function(t,i,s){i.exports=l;var r=t("./Shape"),o=t("../math/Vec3");function l(){r.call(this),this.type=r.types.PLANE,this.worldNormal=new o,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}l.prototype=new r,l.prototype.constructor=l,l.prototype.computeWorldNormal=function(d){var f=this.worldNormal;f.set(0,0,1),d.vmult(f,f),this.worldNormalNeedsUpdate=!1},l.prototype.calculateLocalInertia=function(d,f){return f=f||new o,f},l.prototype.volume=function(){return Number.MAX_VALUE};var h=new o;l.prototype.calculateWorldAABB=function(d,f,c,u){h.set(0,0,1),f.vmult(h,h);var p=Number.MAX_VALUE;c.set(-p,-p,-p),u.set(p,p,p),h.x===1&&(u.x=d.x),h.y===1&&(u.y=d.y),h.z===1&&(u.z=d.z),h.x===-1&&(c.x=d.x),h.y===-1&&(c.y=d.y),h.z===-1&&(c.z=d.z)},l.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(t,i,s){i.exports=r;var r=t("./Shape");t("../math/Vec3"),t("../math/Quaternion"),t("../material/Material");function r(){this.id=r.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}r.prototype.constructor=r,r.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},r.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},r.prototype.calculateLocalInertia=function(o,l){throw"calculateLocalInertia() not implemented for shape type "+this.type},r.idCounter=0,r.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(t,i,s){i.exports=l;var r=t("./Shape"),o=t("../math/Vec3");function l(h){if(r.call(this),this.radius=h!==void 0?Number(h):1,this.type=r.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}l.prototype=new r,l.prototype.constructor=l,l.prototype.calculateLocalInertia=function(h,d){d=d||new o;var f=2*h*this.radius*this.radius/5;return d.x=f,d.y=f,d.z=f,d},l.prototype.volume=function(){return 4*Math.PI*this.radius/3},l.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},l.prototype.calculateWorldAABB=function(h,d,f,c){for(var u=this.radius,p=["x","y","z"],m=0;m<p.length;m++){var _=p[m];f[_]=h[_]-u,c[_]=h[_]+u}}},{"../math/Vec3":30,"./Shape":43}],45:[function(t,i,s){i.exports=f;var r=t("./Shape"),o=t("../math/Vec3");t("../math/Quaternion");var l=t("../math/Transform"),h=t("../collision/AABB"),d=t("../utils/Octree");function f(R,M){r.call(this),this.type=r.types.TRIMESH,this.vertices=new Float32Array(R),this.indices=new Int16Array(M),this.normals=new Float32Array(M.length),this.aabb=new h,this.edges=null,this.scale=new o(1,1,1),this.tree=new d,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}f.prototype=new r,f.prototype.constructor=f;var c=new o;f.prototype.updateTree=function(){var R=this.tree;R.reset(),R.aabb.copy(this.aabb);var M=this.scale;R.aabb.lowerBound.x*=1/M.x,R.aabb.lowerBound.y*=1/M.y,R.aabb.lowerBound.z*=1/M.z,R.aabb.upperBound.x*=1/M.x,R.aabb.upperBound.y*=1/M.y,R.aabb.upperBound.z*=1/M.z;for(var w=new h,L=new o,N=new o,B=new o,G=[L,N,B],W=0;W<this.indices.length/3;W++){var ee=W*3;this._getUnscaledVertex(this.indices[ee],L),this._getUnscaledVertex(this.indices[ee+1],N),this._getUnscaledVertex(this.indices[ee+2],B),w.setFromPoints(G),R.insert(w,W)}R.removeEmptyNodes()};var u=new h;f.prototype.getTrianglesInAABB=function(R,M){u.copy(R);var w=this.scale,L=w.x,N=w.y,B=w.z,G=u.lowerBound,W=u.upperBound;return G.x/=L,G.y/=N,G.z/=B,W.x/=L,W.y/=N,W.z/=B,this.tree.aabbQuery(u,M)},f.prototype.setScale=function(R){var M=this.scale.x===this.scale.y===this.scale.z,w=R.x===R.y===R.z;M&&w||this.updateNormals(),this.scale.copy(R),this.updateAABB(),this.updateBoundingSphereRadius()},f.prototype.updateNormals=function(){for(var R=c,M=this.normals,w=0;w<this.indices.length/3;w++){var L=w*3,N=this.indices[L],B=this.indices[L+1],G=this.indices[L+2];this.getVertex(N,v),this.getVertex(B,y),this.getVertex(G,x),f.computeNormal(y,v,x,R),M[L]=R.x,M[L+1]=R.y,M[L+2]=R.z}},f.prototype.updateEdges=function(){for(var R={},M=function(ee,z){var k=N<B?N+"_"+B:B+"_"+N;R[k]=!0},w=0;w<this.indices.length/3;w++){var L=w*3,N=this.indices[L],B=this.indices[L+1];this.indices[L+2],M(),M(),M()}var G=Object.keys(R);this.edges=new Int16Array(G.length*2);for(var w=0;w<G.length;w++){var W=G[w].split("_");this.edges[2*w]=parseInt(W[0],10),this.edges[2*w+1]=parseInt(W[1],10)}},f.prototype.getEdgeVertex=function(R,M,w){var L=this.edges[R*2+(M?1:0)];this.getVertex(L,w)};var p=new o,m=new o;f.prototype.getEdgeVector=function(R,M){var w=p,L=m;this.getEdgeVertex(R,0,w),this.getEdgeVertex(R,1,L),L.vsub(w,M)};var _=new o,g=new o;f.computeNormal=function(R,M,w,L){M.vsub(R,g),w.vsub(M,_),_.cross(g,L),L.isZero()||L.normalize()};var v=new o,y=new o,x=new o;f.prototype.getVertex=function(R,M){var w=this.scale;return this._getUnscaledVertex(R,M),M.x*=w.x,M.y*=w.y,M.z*=w.z,M},f.prototype._getUnscaledVertex=function(R,M){var w=R*3,L=this.vertices;return M.set(L[w],L[w+1],L[w+2])},f.prototype.getWorldVertex=function(R,M,w,L){return this.getVertex(R,L),l.pointToWorldFrame(M,w,L,L),L},f.prototype.getTriangleVertices=function(R,M,w,L){var N=R*3;this.getVertex(this.indices[N],M),this.getVertex(this.indices[N+1],w),this.getVertex(this.indices[N+2],L)},f.prototype.getNormal=function(R,M){var w=R*3;return M.set(this.normals[w],this.normals[w+1],this.normals[w+2])};var b=new h;f.prototype.calculateLocalInertia=function(R,M){this.computeLocalAABB(b);var w=b.upperBound.x-b.lowerBound.x,L=b.upperBound.y-b.lowerBound.y,N=b.upperBound.z-b.lowerBound.z;return M.set(1/12*R*(2*L*2*L+2*N*2*N),1/12*R*(2*w*2*w+2*N*2*N),1/12*R*(2*L*2*L+2*w*2*w))};var S=new o;f.prototype.computeLocalAABB=function(R){var M=R.lowerBound,w=R.upperBound,L=this.vertices.length;this.vertices;var N=S;this.getVertex(0,N),M.copy(N),w.copy(N);for(var B=0;B!==L;B++)this.getVertex(B,N),N.x<M.x?M.x=N.x:N.x>w.x&&(w.x=N.x),N.y<M.y?M.y=N.y:N.y>w.y&&(w.y=N.y),N.z<M.z?M.z=N.z:N.z>w.z&&(w.z=N.z)},f.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},f.prototype.updateBoundingSphereRadius=function(){for(var R=0,M=this.vertices,w=new o,L=0,N=M.length/3;L!==N;L++){this.getVertex(L,w);var B=w.norm2();B>R&&(R=B)}this.boundingSphereRadius=Math.sqrt(R)},new o;var A=new l,E=new h;f.prototype.calculateWorldAABB=function(R,M,w,L){var N=A,B=E;N.position=R,N.quaternion=M,this.aabb.toWorldFrame(N,B),w.copy(B.lowerBound),L.copy(B.upperBound)},f.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},f.createTorus=function(R,M,w,L,N){R=R||1,M=M||.5,w=w||8,L=L||6,N=N||Math.PI*2;for(var B=[],G=[],W=0;W<=w;W++)for(var ee=0;ee<=L;ee++){var z=ee/L*N,k=W/w*Math.PI*2,q=(R+M*Math.cos(k))*Math.cos(z),$=(R+M*Math.cos(k))*Math.sin(z),H=M*Math.sin(k);B.push(q,$,H)}for(var W=1;W<=w;W++)for(var ee=1;ee<=L;ee++){var Q=(L+1)*W+ee-1,X=(L+1)*(W-1)+ee-1,F=(L+1)*(W-1)+ee,D=(L+1)*W+ee;G.push(Q,X,D),G.push(X,F,D)}return new f(B,G)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(t,i,s){i.exports=o,t("../math/Vec3"),t("../math/Quaternion");var r=t("./Solver");function o(){r.call(this),this.iterations=10,this.tolerance=1e-7}o.prototype=new r;var l=[],h=[],d=[];o.prototype.solve=function(f,c){var u=0,p=this.iterations,m=this.tolerance*this.tolerance,_=this.equations,g=_.length,v=c.bodies,y=v.length,x=f,b,S,A,E,R,M;if(g!==0)for(var w=0;w!==y;w++)v[w].updateSolveMassProperties();var L=h,N=d,B=l;L.length=g,N.length=g,B.length=g;for(var w=0;w!==g;w++){var G=_[w];B[w]=0,N[w]=G.computeB(x),L[w]=1/G.computeC()}if(g!==0){for(var w=0;w!==y;w++){var W=v[w],ee=W.vlambda,z=W.wlambda;ee.set(0,0,0),z&&z.set(0,0,0)}for(u=0;u!==p;u++){E=0;for(var k=0;k!==g;k++){var G=_[k];b=N[k],S=L[k],M=B[k],R=G.computeGWlambda(),A=S*(b-R-G.eps*M),M+A<G.minForce?A=G.minForce-M:M+A>G.maxForce&&(A=G.maxForce-M),B[k]+=A,E+=A>0?A:-A,G.addToWlambda(A)}if(E*E<m)break}for(var w=0;w!==y;w++){var W=v[w],q=W.velocity,$=W.angularVelocity;q.vadd(W.vlambda,q),$&&$.vadd(W.wlambda,$)}}return u}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(t,i,s){i.exports=r;function r(){this.equations=[]}r.prototype.solve=function(o,l){return 0},r.prototype.addEquation=function(o){o.enabled&&this.equations.push(o)},r.prototype.removeEquation=function(o){var l=this.equations,h=l.indexOf(o);h!==-1&&l.splice(h,1)},r.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(t,i,s){i.exports=l,t("../math/Vec3"),t("../math/Quaternion");var r=t("./Solver"),o=t("../objects/Body");function l(v){for(r.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=v,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}l.prototype=new r;var h=[],d=[],f={bodies:[]},c=o.STATIC;function u(v){for(var y=v.length,x=0;x!==y;x++){var b=v[x];if(!b.visited&&!(b.body.type&c))return b}return!1}var p=[];function m(v,y,x,b){for(p.push(v),v.visited=!0,y(v,x,b);p.length;)for(var S=p.pop(),A;A=u(S.children);)A.visited=!0,y(A,x,b),p.push(A)}function _(v,y,x){y.push(v.body);for(var b=v.eqs.length,S=0;S!==b;S++){var A=v.eqs[S];x.indexOf(A)===-1&&x.push(A)}}l.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},l.prototype.solve=function(v,y){for(var x=h,b=this.nodePool,S=y.bodies,A=this.equations,E=A.length,R=S.length,M=this.subsolver;b.length<R;)b.push(this.createNode());x.length=R;for(var w=0;w<R;w++)x[w]=b[w];for(var w=0;w!==R;w++){var L=x[w];L.body=S[w],L.children.length=0,L.eqs.length=0,L.visited=!1}for(var N=0;N!==E;N++){var B=A[N],w=S.indexOf(B.bi),G=S.indexOf(B.bj),W=x[w],ee=x[G];W.children.push(ee),W.eqs.push(B),ee.children.push(W),ee.eqs.push(B)}var z,k=0,q=d;M.tolerance=this.tolerance,M.iterations=this.iterations;for(var $=f;z=u(x);){q.length=0,$.bodies.length=0,m(z,_,$.bodies,q);var H=q.length;q=q.sort(g);for(var w=0;w!==H;w++)M.addEquation(q[w]);M.solve(v,$),M.removeAllEquations(),k++}return k};function g(v,y){return y.id-v.id}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(t,i,s){var r=function(){};i.exports=r,r.prototype={constructor:r,addEventListener:function(o,l){this._listeners===void 0&&(this._listeners={});var h=this._listeners;return h[o]===void 0&&(h[o]=[]),h[o].indexOf(l)===-1&&h[o].push(l),this},hasEventListener:function(o,l){if(this._listeners===void 0)return!1;var h=this._listeners;return h[o]!==void 0&&h[o].indexOf(l)!==-1},removeEventListener:function(o,l){if(this._listeners===void 0)return this;var h=this._listeners;if(h[o]===void 0)return this;var d=h[o].indexOf(l);return d!==-1&&h[o].splice(d,1),this},dispatchEvent:function(o){if(this._listeners===void 0)return this;var l=this._listeners,h=l[o.type];if(h!==void 0){o.target=this;for(var d=0,f=h.length;d<f;d++)h[d].call(this,o)}return this}}},{}],50:[function(t,i,s){var r=t("../collision/AABB"),o=t("../math/Vec3");i.exports=h;function l(c){c=c||{},this.root=c.root||null,this.aabb=c.aabb?c.aabb.clone():new r,this.data=[],this.children=[]}function h(c,u){u=u||{},u.root=null,u.aabb=c,l.call(this,u),this.maxDepth=typeof u.maxDepth<"u"?u.maxDepth:8}h.prototype=new l,l.prototype.reset=function(c,u){this.children.length=this.data.length=0},l.prototype.insert=function(c,u,p){var m=this.data;if(p=p||0,!this.aabb.contains(c))return!1;var _=this.children;if(p<(this.maxDepth||this.root.maxDepth)){var g=!1;_.length||(this.subdivide(),g=!0);for(var v=0;v!==8;v++)if(_[v].insert(c,u,p+1))return!0;g&&(_.length=0)}return m.push(u),!0};var d=new o;l.prototype.subdivide=function(){var c=this.aabb,u=c.lowerBound,p=c.upperBound,m=this.children;m.push(new l({aabb:new r({lowerBound:new o(0,0,0)})}),new l({aabb:new r({lowerBound:new o(1,0,0)})}),new l({aabb:new r({lowerBound:new o(1,1,0)})}),new l({aabb:new r({lowerBound:new o(1,1,1)})}),new l({aabb:new r({lowerBound:new o(0,1,1)})}),new l({aabb:new r({lowerBound:new o(0,0,1)})}),new l({aabb:new r({lowerBound:new o(1,0,1)})}),new l({aabb:new r({lowerBound:new o(0,1,0)})})),p.vsub(u,d),d.scale(.5,d);for(var _=this.root||this,g=0;g!==8;g++){var v=m[g];v.root=_;var y=v.aabb.lowerBound;y.x*=d.x,y.y*=d.y,y.z*=d.z,y.vadd(u,y),y.vadd(d,v.aabb.upperBound)}},l.prototype.aabbQuery=function(c,u){this.data,this.children;for(var p=[this];p.length;){var m=p.pop();m.aabb.overlaps(c)&&Array.prototype.push.apply(u,m.data),Array.prototype.push.apply(p,m.children)}return u};var f=new r;l.prototype.rayQuery=function(c,u,p){return c.getAABB(f),f.toLocalFrame(u,f),this.aabbQuery(f,p),p},l.prototype.removeEmptyNodes=function(){for(var c=[this];c.length;){for(var u=c.pop(),p=u.children.length-1;p>=0;p--)u.children[p].data.length||u.children.splice(p,1);Array.prototype.push.apply(c,u.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(t,i,s){i.exports=r;function r(){this.objects=[],this.type=Object}r.prototype.release=function(){for(var o=arguments.length,l=0;l!==o;l++)this.objects.push(arguments[l])},r.prototype.get=function(){return this.objects.length===0?this.constructObject():this.objects.pop()},r.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(t,i,s){i.exports=r;function r(){this.data={keys:[]}}r.prototype.get=function(o,l){if(o>l){var h=l;l=o,o=h}return this.data[o+"-"+l]},r.prototype.set=function(o,l,h){if(o>l){var d=l;l=o,o=d}var f=o+"-"+l;this.get(o,l)||this.data.keys.push(f),this.data[f]=h},r.prototype.reset=function(){for(var o=this.data,l=o.keys;l.length>0;){var h=l.pop();delete o[h]}}},{}],53:[function(t,i,s){function r(){}i.exports=r,r.defaults=function(o,l){o=o||{};for(var h in l)h in o||(o[h]=l[h]);return o}},{}],54:[function(t,i,s){i.exports=l;var r=t("../math/Vec3"),o=t("./Pool");function l(){o.call(this),this.type=r}l.prototype=new o,l.prototype.constructObject=function(){return new r}},{"../math/Vec3":30,"./Pool":51}],55:[function(t,i,s){i.exports=m;var r=t("../collision/AABB"),o=t("../shapes/Shape"),l=t("../collision/Ray"),h=t("../math/Vec3"),d=t("../math/Transform");t("../shapes/ConvexPolyhedron");var f=t("../math/Quaternion");t("../solver/Solver");var c=t("../utils/Vec3Pool"),u=t("../equations/ContactEquation"),p=t("../equations/FrictionEquation");function m(le){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new c,this.world=le,this.currentContactMaterial=null,this.enableFrictionReduction=!1}m.prototype.createContactEquation=function(le,ge,ye,we,nt,Ue){var Fe;this.contactPointPool.length?(Fe=this.contactPointPool.pop(),Fe.bi=le,Fe.bj=ge):Fe=new u(le,ge),Fe.enabled=le.collisionResponse&&ge.collisionResponse&&ye.collisionResponse&&we.collisionResponse;var Ve=this.currentContactMaterial;Fe.restitution=Ve.restitution,Fe.setSpookParams(Ve.contactEquationStiffness,Ve.contactEquationRelaxation,this.world.dt);var ce=ye.material||le.material,ke=we.material||ge.material;return ce&&ke&&ce.restitution>=0&&ke.restitution>=0&&(Fe.restitution=ce.restitution*ke.restitution),Fe.si=nt||ye,Fe.sj=Ue||we,Fe},m.prototype.createFrictionEquationsFromContact=function(le,ge){var ye=le.bi,we=le.bj,nt=le.si,Ue=le.sj,Fe=this.world,Ve=this.currentContactMaterial,ce=Ve.friction,ke=nt.material||ye.material,Ge=Ue.material||we.material;if(ke&&Ge&&ke.friction>=0&&Ge.friction>=0&&(ce=ke.friction*Ge.friction),ce>0){var Ke=ce*Fe.gravity.length(),I=ye.invMass+we.invMass;I>0&&(I=1/I);var V=this.frictionEquationPool,Y=V.length?V.pop():new p(ye,we,Ke*I),Z=V.length?V.pop():new p(ye,we,Ke*I);return Y.bi=Z.bi=ye,Y.bj=Z.bj=we,Y.minForce=Z.minForce=-Ke*I,Y.maxForce=Z.maxForce=Ke*I,Y.ri.copy(le.ri),Y.rj.copy(le.rj),Z.ri.copy(le.ri),Z.rj.copy(le.rj),le.ni.tangents(Y.t,Z.t),Y.setSpookParams(Ve.frictionEquationStiffness,Ve.frictionEquationRelaxation,Fe.dt),Z.setSpookParams(Ve.frictionEquationStiffness,Ve.frictionEquationRelaxation,Fe.dt),Y.enabled=Z.enabled=le.enabled,ge.push(Y,Z),!0}return!1};var _=new h,g=new h,v=new h;m.prototype.createFrictionFromAverage=function(le){var ge=this.result[this.result.length-1];if(!(!this.createFrictionEquationsFromContact(ge,this.frictionResult)||le===1)){var ye=this.frictionResult[this.frictionResult.length-2],we=this.frictionResult[this.frictionResult.length-1];_.setZero(),g.setZero(),v.setZero();var nt=ge.bi;ge.bj;for(var Ue=0;Ue!==le;Ue++)ge=this.result[this.result.length-1-Ue],ge.bodyA!==nt?(_.vadd(ge.ni,_),g.vadd(ge.ri,g),v.vadd(ge.rj,v)):(_.vsub(ge.ni,_),g.vadd(ge.rj,g),v.vadd(ge.ri,v));var Fe=1/le;g.scale(Fe,ye.ri),v.scale(Fe,ye.rj),we.ri.copy(ye.ri),we.rj.copy(ye.rj),_.normalize(),_.tangents(ye.t,we.t)}};var y=new h,x=new h,b=new f,S=new f;m.prototype.getContacts=function(le,ge,ye,we,nt,Ue,Fe){this.contactPointPool=nt,this.frictionEquationPool=Fe,this.result=we,this.frictionResult=Ue;for(var Ve=b,ce=S,ke=y,Ge=x,Ke=0,I=le.length;Ke!==I;Ke++){var V=le[Ke],Y=ge[Ke],Z=null;V.material&&Y.material&&(Z=ye.getContactMaterial(V.material,Y.material)||null);for(var J=0;J<V.shapes.length;J++){V.quaternion.mult(V.shapeOrientations[J],Ve),V.quaternion.vmult(V.shapeOffsets[J],ke),ke.vadd(V.position,ke);for(var se=V.shapes[J],Te=0;Te<Y.shapes.length;Te++){Y.quaternion.mult(Y.shapeOrientations[Te],ce),Y.quaternion.vmult(Y.shapeOffsets[Te],Ge),Ge.vadd(Y.position,Ge);var Ie=Y.shapes[Te];if(!(ke.distanceTo(Ge)>se.boundingSphereRadius+Ie.boundingSphereRadius)){var $e=null;se.material&&Ie.material&&($e=ye.getContactMaterial(se.material,Ie.material)||null),this.currentContactMaterial=$e||Z||ye.defaultContactMaterial;var ze=this[se.type|Ie.type];ze&&(se.type<Ie.type?ze.call(this,se,Ie,ke,Ge,Ve,ce,V,Y,se,Ie):ze.call(this,Ie,se,Ge,ke,ce,Ve,Y,V,se,Ie))}}}}},m.prototype[o.types.BOX|o.types.BOX]=m.prototype.boxBox=function(le,ge,ye,we,nt,Ue,Fe,Ve){le.convexPolyhedronRepresentation.material=le.material,ge.convexPolyhedronRepresentation.material=ge.material,le.convexPolyhedronRepresentation.collisionResponse=le.collisionResponse,ge.convexPolyhedronRepresentation.collisionResponse=ge.collisionResponse,this.convexConvex(le.convexPolyhedronRepresentation,ge.convexPolyhedronRepresentation,ye,we,nt,Ue,Fe,Ve,le,ge)},m.prototype[o.types.BOX|o.types.CONVEXPOLYHEDRON]=m.prototype.boxConvex=function(le,ge,ye,we,nt,Ue,Fe,Ve){le.convexPolyhedronRepresentation.material=le.material,le.convexPolyhedronRepresentation.collisionResponse=le.collisionResponse,this.convexConvex(le.convexPolyhedronRepresentation,ge,ye,we,nt,Ue,Fe,Ve,le,ge)},m.prototype[o.types.BOX|o.types.PARTICLE]=m.prototype.boxParticle=function(le,ge,ye,we,nt,Ue,Fe,Ve){le.convexPolyhedronRepresentation.material=le.material,le.convexPolyhedronRepresentation.collisionResponse=le.collisionResponse,this.convexParticle(le.convexPolyhedronRepresentation,ge,ye,we,nt,Ue,Fe,Ve,le,ge)},m.prototype[o.types.SPHERE]=m.prototype.sphereSphere=function(le,ge,ye,we,nt,Ue,Fe,Ve){var ce=this.createContactEquation(Fe,Ve,le,ge);we.vsub(ye,ce.ni),ce.ni.normalize(),ce.ri.copy(ce.ni),ce.rj.copy(ce.ni),ce.ri.mult(le.radius,ce.ri),ce.rj.mult(-ge.radius,ce.rj),ce.ri.vadd(ye,ce.ri),ce.ri.vsub(Fe.position,ce.ri),ce.rj.vadd(we,ce.rj),ce.rj.vsub(Ve.position,ce.rj),this.result.push(ce),this.createFrictionEquationsFromContact(ce,this.frictionResult)};var A=new h,E=new h,R=new h;m.prototype[o.types.PLANE|o.types.TRIMESH]=m.prototype.planeTrimesh=function(le,ge,ye,we,nt,Ue,Fe,Ve){var ce=new h,ke=A;ke.set(0,0,1),nt.vmult(ke,ke);for(var Ge=0;Ge<ge.vertices.length/3;Ge++){ge.getVertex(Ge,ce);var Ke=new h;Ke.copy(ce),d.pointToWorldFrame(we,Ue,Ke,ce);var I=E;ce.vsub(ye,I);var V=ke.dot(I);if(V<=0){var Y=this.createContactEquation(Fe,Ve,le,ge);Y.ni.copy(ke);var Z=R;ke.scale(I.dot(ke),Z),ce.vsub(Z,Z),Y.ri.copy(Z),Y.ri.vsub(Fe.position,Y.ri),Y.rj.copy(ce),Y.rj.vsub(Ve.position,Y.rj),this.result.push(Y),this.createFrictionEquationsFromContact(Y,this.frictionResult)}}};var M=new h,w=new h;new h;var L=new h,N=new h,B=new h,G=new h,W=new h,ee=new h,z=new h,k=new h,q=new h,$=new h,H=new h,Q=new r,X=[];m.prototype[o.types.SPHERE|o.types.TRIMESH]=m.prototype.sphereTrimesh=function(le,ge,ye,we,nt,Ue,Fe,Ve){var ce=B,ke=G,Ge=W,Ke=ee,I=z,V=k,Y=Q,Z=N,J=w,se=X;d.pointToLocalFrame(we,Ue,ye,I);var Te=le.radius;Y.lowerBound.set(I.x-Te,I.y-Te,I.z-Te),Y.upperBound.set(I.x+Te,I.y+Te,I.z+Te),ge.getTrianglesInAABB(Y,se);for(var Ie=L,$e=le.radius*le.radius,ze=0;ze<se.length;ze++)for(var Xe=0;Xe<3;Xe++)if(ge.getVertex(ge.indices[se[ze]*3+Xe],Ie),Ie.vsub(I,J),J.norm2()<=$e){Z.copy(Ie),d.pointToWorldFrame(we,Ue,Z,Ie),Ie.vsub(ye,J);var Be=this.createContactEquation(Fe,Ve,le,ge);Be.ni.copy(J),Be.ni.normalize(),Be.ri.copy(Be.ni),Be.ri.scale(le.radius,Be.ri),Be.ri.vadd(ye,Be.ri),Be.ri.vsub(Fe.position,Be.ri),Be.rj.copy(Ie),Be.rj.vsub(Ve.position,Be.rj),this.result.push(Be),this.createFrictionEquationsFromContact(Be,this.frictionResult)}for(var ze=0;ze<se.length;ze++)for(var Xe=0;Xe<3;Xe++){ge.getVertex(ge.indices[se[ze]*3+Xe],ce),ge.getVertex(ge.indices[se[ze]*3+(Xe+1)%3],ke),ke.vsub(ce,Ge),I.vsub(ke,V);var St=V.dot(Ge);I.vsub(ce,V);var Pt=V.dot(Ge);if(Pt>0&&St<0){I.vsub(ce,V),Ke.copy(Ge),Ke.normalize(),Pt=V.dot(Ke),Ke.scale(Pt,V),V.vadd(ce,V);var Ft=V.distanceTo(I);if(Ft<le.radius){var Be=this.createContactEquation(Fe,Ve,le,ge);V.vsub(I,Be.ni),Be.ni.normalize(),Be.ni.scale(le.radius,Be.ri),d.pointToWorldFrame(we,Ue,V,V),V.vsub(Ve.position,Be.rj),d.vectorToWorldFrame(Ue,Be.ni,Be.ni),d.vectorToWorldFrame(Ue,Be.ri,Be.ri),this.result.push(Be),this.createFrictionEquationsFromContact(Be,this.frictionResult)}}}for(var hi=q,dt=$,Ze=H,Bi=M,ze=0,at=se.length;ze!==at;ze++){ge.getTriangleVertices(se[ze],hi,dt,Ze),ge.getNormal(se[ze],Bi),I.vsub(hi,V);var Ft=V.dot(Bi);if(Bi.scale(Ft,V),I.vsub(V,V),Ft=V.distanceTo(I),l.pointInTriangle(V,hi,dt,Ze)&&Ft<le.radius){var Be=this.createContactEquation(Fe,Ve,le,ge);V.vsub(I,Be.ni),Be.ni.normalize(),Be.ni.scale(le.radius,Be.ri),d.pointToWorldFrame(we,Ue,V,V),V.vsub(Ve.position,Be.rj),d.vectorToWorldFrame(Ue,Be.ni,Be.ni),d.vectorToWorldFrame(Ue,Be.ri,Be.ri),this.result.push(Be),this.createFrictionEquationsFromContact(Be,this.frictionResult)}}se.length=0};var F=new h,D=new h;m.prototype[o.types.SPHERE|o.types.PLANE]=m.prototype.spherePlane=function(le,ge,ye,we,nt,Ue,Fe,Ve){var ce=this.createContactEquation(Fe,Ve,le,ge);if(ce.ni.set(0,0,1),Ue.vmult(ce.ni,ce.ni),ce.ni.negate(ce.ni),ce.ni.normalize(),ce.ni.mult(le.radius,ce.ri),ye.vsub(we,F),ce.ni.mult(ce.ni.dot(F),D),F.vsub(D,ce.rj),-F.dot(ce.ni)<=le.radius){var ke=ce.ri,Ge=ce.rj;ke.vadd(ye,ke),ke.vsub(Fe.position,ke),Ge.vadd(we,Ge),Ge.vsub(Ve.position,Ge),this.result.push(ce),this.createFrictionEquationsFromContact(ce,this.frictionResult)}};var j=new h,te=new h,ae=new h;function K(le,ge,ye){for(var we=null,nt=le.length,Ue=0;Ue!==nt;Ue++){var Fe=le[Ue],Ve=j;le[(Ue+1)%nt].vsub(Fe,Ve);var ce=te;Ve.cross(ge,ce);var ke=ae;ye.vsub(Fe,ke);var Ge=ce.dot(ke);if(we===null||Ge>0&&we===!0||Ge<=0&&we===!1){we===null&&(we=Ge>0);continue}else return!1}return!0}var O=new h,pe=new h,xe=new h,Ee=new h,ve=[new h,new h,new h,new h,new h,new h],he=new h,fe=new h,qe=new h,Ye=new h;m.prototype[o.types.SPHERE|o.types.BOX]=m.prototype.sphereBox=function(le,ge,ye,we,nt,Ue,Fe,Ve){var ce=this.v3pool,ke=ve;ye.vsub(we,O),ge.getSideNormals(ke,Ue);for(var Ge=le.radius,Ke=!1,I=fe,V=qe,Y=Ye,Z=null,J=0,se=0,Te=0,Ie=null,$e=0,ze=ke.length;$e!==ze&&Ke===!1;$e++){var Xe=pe;Xe.copy(ke[$e]);var Be=Xe.norm();Xe.normalize();var St=O.dot(Xe);if(St<Be+Ge&&St>0){var Pt=xe,Ft=Ee;Pt.copy(ke[($e+1)%3]),Ft.copy(ke[($e+2)%3]);var hi=Pt.norm(),dt=Ft.norm();Pt.normalize(),Ft.normalize();var Ze=O.dot(Pt),Bi=O.dot(Ft);if(Ze<hi&&Ze>-hi&&Bi<dt&&Bi>-dt){var Jt=Math.abs(St-Be-Ge);(Ie===null||Jt<Ie)&&(Ie=Jt,se=Ze,Te=Bi,Z=Be,I.copy(Xe),V.copy(Pt),Y.copy(Ft),J++)}}}if(J){Ke=!0;var lt=this.createContactEquation(Fe,Ve,le,ge);I.mult(-Ge,lt.ri),lt.ni.copy(I),lt.ni.negate(lt.ni),I.mult(Z,I),V.mult(se,V),I.vadd(V,I),Y.mult(Te,Y),I.vadd(Y,lt.rj),lt.ri.vadd(ye,lt.ri),lt.ri.vsub(Fe.position,lt.ri),lt.rj.vadd(we,lt.rj),lt.rj.vsub(Ve.position,lt.rj),this.result.push(lt),this.createFrictionEquationsFromContact(lt,this.frictionResult)}for(var at=ce.get(),Mi=he,Si=0;Si!==2&&!Ke;Si++)for(var Qt=0;Qt!==2&&!Ke;Qt++)for(var ii=0;ii!==2&&!Ke;ii++)if(at.set(0,0,0),Si?at.vadd(ke[0],at):at.vsub(ke[0],at),Qt?at.vadd(ke[1],at):at.vsub(ke[1],at),ii?at.vadd(ke[2],at):at.vsub(ke[2],at),we.vadd(at,Mi),Mi.vsub(ye,Mi),Mi.norm2()<Ge*Ge){Ke=!0;var lt=this.createContactEquation(Fe,Ve,le,ge);lt.ri.copy(Mi),lt.ri.normalize(),lt.ni.copy(lt.ri),lt.ri.mult(Ge,lt.ri),lt.rj.copy(at),lt.ri.vadd(ye,lt.ri),lt.ri.vsub(Fe.position,lt.ri),lt.rj.vadd(we,lt.rj),lt.rj.vsub(Ve.position,lt.rj),this.result.push(lt),this.createFrictionEquationsFromContact(lt,this.frictionResult)}ce.release(at),at=null;for(var It=ce.get(),vi=ce.get(),lt=ce.get(),Ot=ce.get(),Jt=ce.get(),Nn=ke.length,Si=0;Si!==Nn&&!Ke;Si++)for(var Qt=0;Qt!==Nn&&!Ke;Qt++)if(Si%3!==Qt%3){ke[Qt].cross(ke[Si],It),It.normalize(),ke[Si].vadd(ke[Qt],vi),lt.copy(ye),lt.vsub(vi,lt),lt.vsub(we,lt);var bn=lt.dot(It);It.mult(bn,Ot);for(var ii=0;ii===Si%3||ii===Qt%3;)ii++;Jt.copy(ye),Jt.vsub(Ot,Jt),Jt.vsub(vi,Jt),Jt.vsub(we,Jt);var _g=Math.abs(bn),yg=Jt.norm();if(_g<ke[ii].norm()&&yg<Ge){Ke=!0;var jt=this.createContactEquation(Fe,Ve,le,ge);vi.vadd(Ot,jt.rj),jt.rj.copy(jt.rj),Jt.negate(jt.ni),jt.ni.normalize(),jt.ri.copy(jt.rj),jt.ri.vadd(we,jt.ri),jt.ri.vsub(ye,jt.ri),jt.ri.normalize(),jt.ri.mult(Ge,jt.ri),jt.ri.vadd(ye,jt.ri),jt.ri.vsub(Fe.position,jt.ri),jt.rj.vadd(we,jt.rj),jt.rj.vsub(Ve.position,jt.rj),this.result.push(jt),this.createFrictionEquationsFromContact(jt,this.frictionResult)}}ce.release(It,vi,lt,Ot,Jt)};var U=new h,P=new h,re=new h,de=new h,me=new h,_e=new h,De=new h,Ce=new h,Me=new h,tt=new h;m.prototype[o.types.SPHERE|o.types.CONVEXPOLYHEDRON]=m.prototype.sphereConvex=function(le,ge,ye,we,nt,Ue,Fe,Ve){var ce=this.v3pool;ye.vsub(we,U);for(var ke=ge.faceNormals,Ge=ge.faces,Ke=ge.vertices,I=le.radius,V=0;V!==Ke.length;V++){var Y=Ke[V],Z=me;Ue.vmult(Y,Z),we.vadd(Z,Z);var J=de;if(Z.vsub(ye,J),J.norm2()<I*I){Te=!0;var se=this.createContactEquation(Fe,Ve,le,ge);se.ri.copy(J),se.ri.normalize(),se.ni.copy(se.ri),se.ri.mult(I,se.ri),Z.vsub(we,se.rj),se.ri.vadd(ye,se.ri),se.ri.vsub(Fe.position,se.ri),se.rj.vadd(we,se.rj),se.rj.vsub(Ve.position,se.rj),this.result.push(se),this.createFrictionEquationsFromContact(se,this.frictionResult);return}}for(var Te=!1,V=0,Ie=Ge.length;V!==Ie&&Te===!1;V++){var $e=ke[V],ze=Ge[V],Xe=_e;Ue.vmult($e,Xe);var Be=De;Ue.vmult(Ke[ze[0]],Be),Be.vadd(we,Be);var St=Ce;Xe.mult(-I,St),ye.vadd(St,St);var Pt=Me;St.vsub(Be,Pt);var Ft=Pt.dot(Xe),hi=tt;if(ye.vsub(Be,hi),Ft<0&&hi.dot(Xe)>0){for(var dt=[],Ze=0,Bi=ze.length;Ze!==Bi;Ze++){var at=ce.get();Ue.vmult(Ke[ze[Ze]],at),we.vadd(at,at),dt.push(at)}if(K(dt,Xe,ye)){Te=!0;var se=this.createContactEquation(Fe,Ve,le,ge);Xe.mult(-I,se.ri),Xe.negate(se.ni);var Mi=ce.get();Xe.mult(-Ft,Mi);var Si=ce.get();Xe.mult(-I,Si),ye.vsub(we,se.rj),se.rj.vadd(Si,se.rj),se.rj.vadd(Mi,se.rj),se.rj.vadd(we,se.rj),se.rj.vsub(Ve.position,se.rj),se.ri.vadd(ye,se.ri),se.ri.vsub(Fe.position,se.ri),ce.release(Mi),ce.release(Si),this.result.push(se),this.createFrictionEquationsFromContact(se,this.frictionResult);for(var Ze=0,Qt=dt.length;Ze!==Qt;Ze++)ce.release(dt[Ze]);return}else for(var Ze=0;Ze!==ze.length;Ze++){var ii=ce.get(),It=ce.get();Ue.vmult(Ke[ze[(Ze+1)%ze.length]],ii),Ue.vmult(Ke[ze[(Ze+2)%ze.length]],It),we.vadd(ii,ii),we.vadd(It,It);var vi=P;It.vsub(ii,vi);var lt=re;vi.unit(lt);var Ot=ce.get(),Jt=ce.get();ye.vsub(ii,Jt);var Nn=Jt.dot(lt);lt.mult(Nn,Ot),Ot.vadd(ii,Ot);var bn=ce.get();if(Ot.vsub(ye,bn),Nn>0&&Nn*Nn<vi.norm2()&&bn.norm2()<I*I){var se=this.createContactEquation(Fe,Ve,le,ge);Ot.vsub(we,se.rj),Ot.vsub(ye,se.ni),se.ni.normalize(),se.ni.mult(I,se.ri),se.rj.vadd(we,se.rj),se.rj.vsub(Ve.position,se.rj),se.ri.vadd(ye,se.ri),se.ri.vsub(Fe.position,se.ri),this.result.push(se),this.createFrictionEquationsFromContact(se,this.frictionResult);for(var Ze=0,Qt=dt.length;Ze!==Qt;Ze++)ce.release(dt[Ze]);ce.release(ii),ce.release(It),ce.release(Ot),ce.release(bn),ce.release(Jt);return}ce.release(ii),ce.release(It),ce.release(Ot),ce.release(bn),ce.release(Jt)}for(var Ze=0,Qt=dt.length;Ze!==Qt;Ze++)ce.release(dt[Ze])}}},new h,new h,m.prototype[o.types.PLANE|o.types.BOX]=m.prototype.planeBox=function(le,ge,ye,we,nt,Ue,Fe,Ve){ge.convexPolyhedronRepresentation.material=ge.material,ge.convexPolyhedronRepresentation.collisionResponse=ge.collisionResponse,this.planeConvex(le,ge.convexPolyhedronRepresentation,ye,we,nt,Ue,Fe,Ve)};var Pe=new h,et=new h,ut=new h,it=new h;m.prototype[o.types.PLANE|o.types.CONVEXPOLYHEDRON]=m.prototype.planeConvex=function(le,ge,ye,we,nt,Ue,Fe,Ve){var ce=Pe,ke=et;ke.set(0,0,1),nt.vmult(ke,ke);for(var Ge=0,Ke=ut,I=0;I!==ge.vertices.length;I++){ce.copy(ge.vertices[I]),Ue.vmult(ce,ce),we.vadd(ce,ce),ce.vsub(ye,Ke);var V=ke.dot(Ke);if(V<=0){var Y=this.createContactEquation(Fe,Ve,le,ge),Z=it;ke.mult(ke.dot(Ke),Z),ce.vsub(Z,Z),Z.vsub(ye,Y.ri),Y.ni.copy(ke),ce.vsub(we,Y.rj),Y.ri.vadd(ye,Y.ri),Y.ri.vsub(Fe.position,Y.ri),Y.rj.vadd(we,Y.rj),Y.rj.vsub(Ve.position,Y.rj),this.result.push(Y),Ge++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(Y,this.frictionResult)}}this.enableFrictionReduction&&Ge&&this.createFrictionFromAverage(Ge)};var We=new h,st=new h;m.prototype[o.types.CONVEXPOLYHEDRON]=m.prototype.convexConvex=function(le,ge,ye,we,nt,Ue,Fe,Ve,ce,ke,Ge,Ke){var I=We;if(!(ye.distanceTo(we)>le.boundingSphereRadius+ge.boundingSphereRadius)&&le.findSeparatingAxis(ge,ye,nt,we,Ue,I,Ge,Ke)){var V=[],Y=st;le.clipAgainstHull(ye,nt,ge,we,Ue,I,-100,100,V);for(var Z=0,J=0;J!==V.length;J++){var se=this.createContactEquation(Fe,Ve,le,ge,ce,ke),Te=se.ri,Ie=se.rj;I.negate(se.ni),V[J].normal.negate(Y),Y.mult(V[J].depth,Y),V[J].point.vadd(Y,Te),Ie.copy(V[J].point),Te.vsub(ye,Te),Ie.vsub(we,Ie),Te.vadd(ye,Te),Te.vsub(Fe.position,Te),Ie.vadd(we,Ie),Ie.vsub(Ve.position,Ie),this.result.push(se),Z++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(se,this.frictionResult)}this.enableFrictionReduction&&Z&&this.createFrictionFromAverage(Z)}};var ct=new h,xt=new h,rt=new h;m.prototype[o.types.PLANE|o.types.PARTICLE]=m.prototype.planeParticle=function(le,ge,ye,we,nt,Ue,Fe,Ve){var ce=ct;ce.set(0,0,1),Fe.quaternion.vmult(ce,ce);var ke=xt;we.vsub(Fe.position,ke);var Ge=ce.dot(ke);if(Ge<=0){var Ke=this.createContactEquation(Ve,Fe,ge,le);Ke.ni.copy(ce),Ke.ni.negate(Ke.ni),Ke.ri.set(0,0,0);var I=rt;ce.mult(ce.dot(we),I),we.vsub(I,I),Ke.rj.copy(I),this.result.push(Ke),this.createFrictionEquationsFromContact(Ke,this.frictionResult)}};var C=new h;m.prototype[o.types.PARTICLE|o.types.SPHERE]=m.prototype.sphereParticle=function(le,ge,ye,we,nt,Ue,Fe,Ve){var ce=C;ce.set(0,0,1),we.vsub(ye,ce);var ke=ce.norm2();if(ke<=le.radius*le.radius){var Ge=this.createContactEquation(Ve,Fe,ge,le);ce.normalize(),Ge.rj.copy(ce),Ge.rj.mult(le.radius,Ge.rj),Ge.ni.copy(ce),Ge.ni.negate(Ge.ni),Ge.ri.set(0,0,0),this.result.push(Ge),this.createFrictionEquationsFromContact(Ge,this.frictionResult)}};var ne=new f,oe=new h;new h;var be=new h,Re=new h,ot=new h;m.prototype[o.types.PARTICLE|o.types.CONVEXPOLYHEDRON]=m.prototype.convexParticle=function(le,ge,ye,we,nt,Ue,Fe,Ve){var ce=-1,ke=be,Ge=ot,Ke=null,I=oe;if(I.copy(we),I.vsub(ye,I),nt.conjugate(ne),ne.vmult(I,I),le.pointIsInside(I)){le.worldVerticesNeedsUpdate&&le.computeWorldVertices(ye,nt),le.worldFaceNormalsNeedsUpdate&&le.computeWorldFaceNormals(nt);for(var V=0,Y=le.faces.length;V!==Y;V++){var Z=[le.worldVertices[le.faces[V][0]]],J=le.worldFaceNormals[V];we.vsub(Z[0],Re);var se=-J.dot(Re);(Ke===null||Math.abs(se)<Math.abs(Ke))&&(Ke=se,ce=V,ke.copy(J))}if(ce!==-1){var Te=this.createContactEquation(Ve,Fe,ge,le);ke.mult(Ke,Ge),Ge.vadd(we,Ge),Ge.vsub(ye,Ge),Te.rj.copy(Ge),ke.negate(Te.ni),Te.ri.set(0,0,0);var Ie=Te.ri,$e=Te.rj;Ie.vadd(we,Ie),Ie.vsub(Ve.position,Ie),$e.vadd(ye,$e),$e.vsub(Fe.position,$e),this.result.push(Te),this.createFrictionEquationsFromContact(Te,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},m.prototype[o.types.BOX|o.types.HEIGHTFIELD]=m.prototype.boxHeightfield=function(le,ge,ye,we,nt,Ue,Fe,Ve){le.convexPolyhedronRepresentation.material=le.material,le.convexPolyhedronRepresentation.collisionResponse=le.collisionResponse,this.convexHeightfield(le.convexPolyhedronRepresentation,ge,ye,we,nt,Ue,Fe,Ve)};var ht=new h,Et=new h,Gt=[0];m.prototype[o.types.CONVEXPOLYHEDRON|o.types.HEIGHTFIELD]=m.prototype.convexHeightfield=function(le,ge,ye,we,nt,Ue,Fe,Ve){var ce=ge.data,ke=ge.elementSize,Ge=le.boundingSphereRadius,Ke=Et,I=Gt,V=ht;d.pointToLocalFrame(we,Ue,ye,V);var Y=Math.floor((V.x-Ge)/ke)-1,Z=Math.ceil((V.x+Ge)/ke)+1,J=Math.floor((V.y-Ge)/ke)-1,se=Math.ceil((V.y+Ge)/ke)+1;if(!(Z<0||se<0||Y>ce.length||J>ce[0].length)){Y<0&&(Y=0),Z<0&&(Z=0),J<0&&(J=0),se<0&&(se=0),Y>=ce.length&&(Y=ce.length-1),Z>=ce.length&&(Z=ce.length-1),se>=ce[0].length&&(se=ce[0].length-1),J>=ce[0].length&&(J=ce[0].length-1);var Te=[];ge.getRectMinMax(Y,J,Z,se,Te);var Ie=Te[0],$e=Te[1];if(!(V.z-Ge>$e||V.z+Ge<Ie))for(var ze=Y;ze<Z;ze++)for(var Xe=J;Xe<se;Xe++)ge.getConvexTrianglePillar(ze,Xe,!1),d.pointToWorldFrame(we,Ue,ge.pillarOffset,Ke),ye.distanceTo(Ke)<ge.pillarConvex.boundingSphereRadius+le.boundingSphereRadius&&this.convexConvex(le,ge.pillarConvex,ye,Ke,nt,Ue,Fe,Ve,null,null,I,null),ge.getConvexTrianglePillar(ze,Xe,!0),d.pointToWorldFrame(we,Ue,ge.pillarOffset,Ke),ye.distanceTo(Ke)<ge.pillarConvex.boundingSphereRadius+le.boundingSphereRadius&&this.convexConvex(le,ge.pillarConvex,ye,Ke,nt,Ue,Fe,Ve,null,null,I,null)}};var gt=new h,vt=new h;m.prototype[o.types.SPHERE|o.types.HEIGHTFIELD]=m.prototype.sphereHeightfield=function(le,ge,ye,we,nt,Ue,Fe,Ve){var ce=ge.data,ke=le.radius,Ge=ge.elementSize,Ke=vt,I=gt;d.pointToLocalFrame(we,Ue,ye,I);var V=Math.floor((I.x-ke)/Ge)-1,Y=Math.ceil((I.x+ke)/Ge)+1,Z=Math.floor((I.y-ke)/Ge)-1,J=Math.ceil((I.y+ke)/Ge)+1;if(!(Y<0||J<0||V>ce.length||J>ce[0].length)){V<0&&(V=0),Y<0&&(Y=0),Z<0&&(Z=0),J<0&&(J=0),V>=ce.length&&(V=ce.length-1),Y>=ce.length&&(Y=ce.length-1),J>=ce[0].length&&(J=ce[0].length-1),Z>=ce[0].length&&(Z=ce[0].length-1);var se=[];ge.getRectMinMax(V,Z,Y,J,se);var Te=se[0],Ie=se[1];if(!(I.z-ke>Ie||I.z+ke<Te))for(var $e=this.result,ze=V;ze<Y;ze++)for(var Xe=Z;Xe<J;Xe++){var Be=$e.length;ge.getConvexTrianglePillar(ze,Xe,!1),d.pointToWorldFrame(we,Ue,ge.pillarOffset,Ke),ye.distanceTo(Ke)<ge.pillarConvex.boundingSphereRadius+le.boundingSphereRadius&&this.sphereConvex(le,ge.pillarConvex,ye,Ke,nt,Ue,Fe,Ve),ge.getConvexTrianglePillar(ze,Xe,!0),d.pointToWorldFrame(we,Ue,ge.pillarOffset,Ke),ye.distanceTo(Ke)<ge.pillarConvex.boundingSphereRadius+le.boundingSphereRadius&&this.sphereConvex(le,ge.pillarConvex,ye,Ke,nt,Ue,Fe,Ve);var St=$e.length-Be;if(St>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(t,i,s){i.exports=b;var r=t("../shapes/Shape"),o=t("../math/Vec3"),l=t("../math/Quaternion"),h=t("../solver/GSSolver");t("../utils/Vec3Pool"),t("../equations/ContactEquation"),t("../equations/FrictionEquation");var d=t("./Narrowphase"),f=t("../utils/EventTarget"),c=t("../collision/ArrayCollisionMatrix"),u=t("../material/Material"),p=t("../material/ContactMaterial"),m=t("../objects/Body"),_=t("../utils/TupleDictionary"),g=t("../collision/RaycastResult"),v=t("../collision/AABB"),y=t("../collision/Ray"),x=t("../collision/NaiveBroadphase");function b(){f.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new o,this.broadphase=new x,this.bodies=[],this.solver=new h,this.constraints=[],this.narrowphase=new d(this),this.collisionMatrix=new c,this.collisionMatrixPrevious=new c,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new _,this.defaultMaterial=new u("default"),this.defaultContactMaterial=new p(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}b.prototype=new f,new v;var S=new y;if(b.prototype.getContactMaterial=function(k,q){return this.contactMaterialTable.get(k.id,q.id)},b.prototype.numObjects=function(){return this.bodies.length},b.prototype.collisionMatrixTick=function(){var k=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=k,this.collisionMatrix.reset()},b.prototype.add=b.prototype.addBody=function(k){this.bodies.indexOf(k)===-1&&(k.index=this.bodies.length,this.bodies.push(k),k.world=this,k.initPosition.copy(k.position),k.initVelocity.copy(k.velocity),k.timeLastSleepy=this.time,k instanceof m&&(k.initAngularVelocity.copy(k.angularVelocity),k.initQuaternion.copy(k.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=k,this.dispatchEvent(this.addBodyEvent))},b.prototype.addConstraint=function(k){this.constraints.push(k)},b.prototype.removeConstraint=function(k){var q=this.constraints.indexOf(k);q!==-1&&this.constraints.splice(q,1)},b.prototype.rayTest=function(k,q,$){$ instanceof g?this.raycastClosest(k,q,{skipBackfaces:!0},$):this.raycastAll(k,q,{skipBackfaces:!0},$)},b.prototype.raycastAll=function(k,q,$,H){return $.mode=y.ALL,$.from=k,$.to=q,$.callback=H,S.intersectWorld(this,$)},b.prototype.raycastAny=function(k,q,$,H){return $.mode=y.ANY,$.from=k,$.to=q,$.result=H,S.intersectWorld(this,$)},b.prototype.raycastClosest=function(k,q,$,H){return $.mode=y.CLOSEST,$.from=k,$.to=q,$.result=H,S.intersectWorld(this,$)},b.prototype.remove=function(k){k.world=null;var q=this.bodies.length-1,$=this.bodies,H=$.indexOf(k);if(H!==-1){$.splice(H,1);for(var Q=0;Q!==$.length;Q++)$[Q].index=Q;this.collisionMatrix.setNumObjects(q),this.removeBodyEvent.body=k,this.dispatchEvent(this.removeBodyEvent)}},b.prototype.removeBody=b.prototype.remove,b.prototype.addMaterial=function(k){this.materials.push(k)},b.prototype.addContactMaterial=function(k){this.contactmaterials.push(k),this.contactMaterialTable.set(k.materials[0].id,k.materials[1].id,k)},typeof performance>"u"&&(performance={}),!performance.now){var A=Date.now();performance.timing&&performance.timing.navigationStart&&(A=performance.timing.navigationStart),performance.now=function(){return Date.now()-A}}var E=new o;b.prototype.step=function(k,q,$){if($=$||10,q=q||0,q===0)this.internalStep(k),this.time+=k;else{var H=Math.floor((this.time+q)/k)-Math.floor(this.time/k);H=Math.min(H,$);for(var Q=performance.now(),X=0;X!==H&&(this.internalStep(k),!(performance.now()-Q>k*1e3));X++);this.time+=q;for(var F=this.time%k,D=F/k,j=E,te=this.bodies,ae=0;ae!==te.length;ae++){var K=te[ae];K.type!==m.STATIC&&K.sleepState!==m.SLEEPING?(K.position.vsub(K.previousPosition,j),j.scale(D,j),K.position.vadd(j,K.interpolatedPosition)):(K.interpolatedPosition.copy(K.position),K.interpolatedQuaternion.copy(K.quaternion))}}};var R={type:"postStep"},M={type:"preStep"},w={type:"collide",body:null,contact:null},L=[],N=[],B=[],G=[];new o,new o,new o,new o,new o,new o,new o,new o,new o,new l;var W=new l,ee=new l,z=new o;b.prototype.internalStep=function(k){this.dt=k;var q=this.contacts,$=B,H=G,Q=this.numObjects(),X=this.bodies,F=this.solver,D=this.gravity,j=this.doProfiling,te=this.profile,ae=m.DYNAMIC,K,O=this.constraints,pe=N;D.norm();var xe=D.x,Ee=D.y,ve=D.z,he=0;for(j&&(K=performance.now()),he=0;he!==Q;he++){var fe=X[he];if(fe.type&ae){var qe=fe.force,Ye=fe.mass;qe.x+=Ye*xe,qe.y+=Ye*Ee,qe.z+=Ye*ve}}for(var he=0,U=this.subsystems.length;he!==U;he++)this.subsystems[he].update();j&&(K=performance.now()),$.length=0,H.length=0,this.broadphase.collisionPairs(this,$,H),j&&(te.broadphase=performance.now()-K);var We=O.length;for(he=0;he!==We;he++){var P=O[he];if(!P.collideConnected)for(var re=$.length-1;re>=0;re-=1)(P.bodyA===$[re]&&P.bodyB===H[re]||P.bodyB===$[re]&&P.bodyA===H[re])&&($.splice(re,1),H.splice(re,1))}this.collisionMatrixTick(),j&&(K=performance.now());var de=L,me=q.length;for(he=0;he!==me;he++)de.push(q[he]);q.length=0;var _e=this.frictionEquations.length;for(he=0;he!==_e;he++)pe.push(this.frictionEquations[he]);this.frictionEquations.length=0,this.narrowphase.getContacts($,H,this,q,de,this.frictionEquations,pe),j&&(te.narrowphase=performance.now()-K),j&&(K=performance.now());for(var he=0;he<this.frictionEquations.length;he++)F.addEquation(this.frictionEquations[he]);for(var De=q.length,Ce=0;Ce!==De;Ce++){var P=q[Ce],fe=P.bi,Me=P.bj;P.si,P.sj;var tt;if(fe.material&&Me.material?tt=this.getContactMaterial(fe.material,Me.material)||this.defaultContactMaterial:tt=this.defaultContactMaterial,tt.friction,fe.material&&Me.material&&(fe.material.friction>=0&&Me.material.friction>=0&&fe.material.friction*Me.material.friction,fe.material.restitution>=0&&Me.material.restitution>=0&&(P.restitution=fe.material.restitution*Me.material.restitution)),F.addEquation(P),fe.allowSleep&&fe.type===m.DYNAMIC&&fe.sleepState===m.SLEEPING&&Me.sleepState===m.AWAKE&&Me.type!==m.STATIC){var Pe=Me.velocity.norm2()+Me.angularVelocity.norm2(),et=Math.pow(Me.sleepSpeedLimit,2);Pe>=et*2&&(fe._wakeUpAfterNarrowphase=!0)}if(Me.allowSleep&&Me.type===m.DYNAMIC&&Me.sleepState===m.SLEEPING&&fe.sleepState===m.AWAKE&&fe.type!==m.STATIC){var ut=fe.velocity.norm2()+fe.angularVelocity.norm2(),it=Math.pow(fe.sleepSpeedLimit,2);ut>=it*2&&(Me._wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(fe,Me,!0),this.collisionMatrixPrevious.get(fe,Me)||(w.body=Me,w.contact=P,fe.dispatchEvent(w),w.body=fe,Me.dispatchEvent(w))}for(j&&(te.makeContactConstraints=performance.now()-K,K=performance.now()),he=0;he!==Q;he++){var fe=X[he];fe._wakeUpAfterNarrowphase&&(fe.wakeUp(),fe._wakeUpAfterNarrowphase=!1)}var We=O.length;for(he=0;he!==We;he++){var P=O[he];P.update();for(var re=0,st=P.equations.length;re!==st;re++){var ct=P.equations[re];F.addEquation(ct)}}F.solve(k,this),j&&(te.solve=performance.now()-K),F.removeAllEquations();var xt=Math.pow;for(he=0;he!==Q;he++){var fe=X[he];if(fe.type&ae){var rt=xt(1-fe.linearDamping,k),C=fe.velocity;C.mult(rt,C);var ne=fe.angularVelocity;if(ne){var oe=xt(1-fe.angularDamping,k);ne.mult(oe,ne)}}}for(this.dispatchEvent(M),he=0;he!==Q;he++){var fe=X[he];fe.preStep&&fe.preStep.call(fe)}j&&(K=performance.now());var be=W,Re=ee,ot=this.stepnumber,ht=m.DYNAMIC|m.KINEMATIC,Et=ot%(this.quatNormalizeSkip+1)===0,Gt=this.quatNormalizeFast,gt=k*.5;for(r.types.PLANE,r.types.CONVEXPOLYHEDRON,he=0;he!==Q;he++){var vt=X[he],le=vt.force,ge=vt.torque;if(vt.type&ht&&vt.sleepState!==m.SLEEPING){var ye=vt.velocity,we=vt.angularVelocity,nt=vt.position,Ue=vt.quaternion,Fe=vt.invMass,Ve=vt.invInertiaWorld;ye.x+=le.x*Fe*k,ye.y+=le.y*Fe*k,ye.z+=le.z*Fe*k,vt.angularVelocity&&(Ve.vmult(ge,z),z.mult(k,z),z.vadd(we,we)),nt.x+=ye.x*k,nt.y+=ye.y*k,nt.z+=ye.z*k,vt.angularVelocity&&(be.set(we.x,we.y,we.z,0),be.mult(Ue,Re),Ue.x+=gt*Re.x,Ue.y+=gt*Re.y,Ue.z+=gt*Re.z,Ue.w+=gt*Re.w,Et&&(Gt?Ue.normalizeFast():Ue.normalize())),vt.aabb&&(vt.aabbNeedsUpdate=!0),vt.updateInertiaWorld&&vt.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,j&&(te.integrate=performance.now()-K),this.time+=k,this.stepnumber+=1,this.dispatchEvent(R),he=0;he!==Q;he++){var fe=X[he],ce=fe.postStep;ce&&ce.call(fe)}if(this.allowSleep)for(he=0;he!==Q;he++)X[he].sleepTick(this.time)},b.prototype.clearForces=function(){for(var k=this.bodies,q=k.length,$=0;$!==q;$++){var H=k[$];H.force,H.torque,H.force.set(0,0,0),H.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)})})(rm);var YM=rm.exports;const ie=jM(YM);class qM{constructor(e){this.config=e.config,this.debug=e.debug,this.time=e.time,this.sizes=e.sizes,this.controls=e.controls,this.sounds=e.sounds,this.debug&&(this.debugFolder=this.debug.addFolder("physics")),this.setWorld(),this.setModels(),this.setMaterials(),this.setFloor(),this.setCar(),this.time.on("tick",()=>{this.world.step(this.time.delta/1e3)})}setWorld(){this.world=new ie.World,this.world.gravity.set(0,0,-3.25*4.5),this.world.allowSleep=!0,this.world.defaultContactMaterial.friction=0,this.world.defaultContactMaterial.restitution=.2,this.debug&&this.debugFolder.add(this.world.gravity,"z").step(.001).min(-20).max(20).name("gravity")}setModels(){this.models={},this.models.container=new je,this.models.container.visible=!1,this.models.materials={},this.models.materials.static=new Ne({color:255,wireframe:!0}),this.models.materials.dynamic=new Ne({color:16711680,wireframe:!0}),this.models.materials.dynamicSleeping=new Ne({color:16776960,wireframe:!0}),this.debug&&this.debugFolder.add(this.models.container,"visible").name("modelsVisible")}setMaterials(){this.materials={},this.materials.items={},this.materials.items.floor=new ie.Material("floorMaterial"),this.materials.items.dummy=new ie.Material("dummyMaterial"),this.materials.items.wheel=new ie.Material("wheelMaterial"),this.materials.contacts={},this.materials.contacts.floorDummy=new ie.ContactMaterial(this.materials.items.floor,this.materials.items.dummy,{friction:.05,restitution:.3,contactEquationStiffness:1e3}),this.world.addContactMaterial(this.materials.contacts.floorDummy),this.materials.contacts.dummyDummy=new ie.ContactMaterial(this.materials.items.dummy,this.materials.items.dummy,{friction:.5,restitution:.3,contactEquationStiffness:1e3}),this.world.addContactMaterial(this.materials.contacts.dummyDummy),this.materials.contacts.floorWheel=new ie.ContactMaterial(this.materials.items.floor,this.materials.items.wheel,{friction:.3,restitution:0,contactEquationStiffness:1e3}),this.world.addContactMaterial(this.materials.contacts.floorWheel)}setFloor(){this.floor={},this.floor.body=new ie.Body({mass:0,shape:new ie.Plane,material:this.materials.items.floor}),this.world.addBody(this.floor.body)}setCar(){if(this.car={},this.car.steering=0,this.car.accelerating=0,this.car.speed=0,this.car.worldForward=new ie.Vec3,this.car.angle=0,this.car.forwardSpeed=0,this.car.oldPosition=new ie.Vec3,this.car.goingForward=!0,this.car.options={},this.car.options.chassisWidth=1,this.car.options.chassisHeight=.7,this.car.options.chassisDepth=2.03,this.car.options.chassisOffset=new ie.Vec3(0,0,.2),this.car.options.chassisMass=40,this.config&&this.config.togg?(this.car.options.wheelFrontLeftPosition={depth:.65,width:.35},this.car.options.wheelFrontRightPosition={depth:.65,width:-.4},this.car.options.wheelBackLeftPosition={depth:-.7,width:.35},this.car.options.wheelBackRightPosition={depth:-.7,width:-.4}):(this.car.options.wheelFrontLeftPosition={depth:.65,width:.35},this.car.options.wheelFrontRightPosition={depth:.65,width:-.4},this.car.options.wheelBackLeftPosition={depth:-.7,width:.35},this.car.options.wheelBackRightPosition={depth:-.7,width:-.4}),this.car.options.wheelFrontOffsetDepth=this.car.options.wheelFrontLeftPosition.depth,this.car.options.wheelBackOffsetDepth=this.car.options.wheelBackLeftPosition.depth,this.car.options.wheelOffsetWidth=Math.abs(this.car.options.wheelFrontLeftPosition.width),this.car.options.wheelRadius=.25,this.car.options.wheelHeight=.24,this.car.options.wheelSuspensionStiffness=30,this.car.options.wheelSuspensionRestLength=.1,this.car.options.wheelFrictionSlip=10,this.car.options.wheelDampingRelaxation=1.8,this.car.options.wheelDampingCompression=1.5,this.car.options.wheelMaxSuspensionForce=1e5,this.car.options.wheelRollInfluence=.01,this.car.options.wheelMaxSuspensionTravel=.3,this.car.options.wheelCustomSlidingRotationalSpeed=-30,this.car.options.wheelMass=5,this.car.options.controlsSteeringSpeed=.005*3,this.car.options.controlsSteeringMax=Math.PI*.17,this.car.options.controlsSteeringQuad=!1,this.car.options.controlsAcceleratinMaxSpeed=.055*3/17,this.car.options.controlsAcceleratinMaxSpeedBoost=.11*3/17,this.car.options.controlsAcceleratingSpeed=2*4*2,this.car.options.controlsAcceleratingSpeedBoost=3.5*4*2,this.car.options.controlsAcceleratingQuad=!0,this.car.options.controlsBrakeStrength=.45*3,this.car.upsideDown={},this.car.upsideDown.state="watching",this.car.upsideDown.pendingTimeout=null,this.car.upsideDown.turningTimeout=null,this.car.jump=(e=!0,t=150)=>{let i=this.car.chassis.body.position;i=i.vadd(new ie.Vec3(e?.1:0,0,0)),this.car.chassis.body.applyImpulse(new ie.Vec3(0,0,t),i)},this.car.create=()=>{this.car.chassis={},this.car.chassis.shape=new ie.Box(new ie.Vec3(this.car.options.chassisDepth*.5,this.car.options.chassisWidth*.5,this.car.options.chassisHeight*.5)),this.car.chassis.body=new ie.Body({mass:this.car.options.chassisMass}),this.car.chassis.body.allowSleep=!1,this.car.chassis.body.position.set(0,0,1),this.car.chassis.body.sleep(),this.car.chassis.body.addShape(this.car.chassis.shape,this.car.options.chassisOffset),this.car.chassis.body.quaternion.setFromAxisAngle(new ie.Vec3(0,0,1),-Math.PI*.5),this.car.chassis.body.addEventListener("collide",t=>{if(t.body.mass===0){const i=t.contact.getImpactVelocityAlongNormal();this.sounds.play("carHit",i)}}),this.car.vehicle=new ie.RaycastVehicle({chassisBody:this.car.chassis.body}),this.car.wheels={},this.car.wheels.options={radius:this.car.options.wheelRadius,height:this.car.options.wheelHeight,suspensionStiffness:this.car.options.wheelSuspensionStiffness,suspensionRestLength:this.car.options.wheelSuspensionRestLength,frictionSlip:this.car.options.wheelFrictionSlip,dampingRelaxation:this.car.options.wheelDampingRelaxation,dampingCompression:this.car.options.wheelDampingCompression,maxSuspensionForce:this.car.options.wheelMaxSuspensionForce,rollInfluence:this.car.options.wheelRollInfluence,maxSuspensionTravel:this.car.options.wheelMaxSuspensionTravel,customSlidingRotationalSpeed:this.car.options.wheelCustomSlidingRotationalSpeed,useCustomSlidingRotationalSpeed:!0,directionLocal:new ie.Vec3(0,0,-1),axleLocal:new ie.Vec3(0,1,0),chassisConnectionPointLocal:new ie.Vec3(1,1,0)},this.car.wheels.options.chassisConnectionPointLocal.set(this.car.options.wheelFrontLeftPosition.depth,this.car.options.wheelFrontLeftPosition.width,0),this.car.vehicle.addWheel(this.car.wheels.options),this.car.wheels.options.chassisConnectionPointLocal.set(this.car.options.wheelFrontRightPosition.depth,this.car.options.wheelFrontRightPosition.width,0),this.car.vehicle.addWheel(this.car.wheels.options),this.car.wheels.options.chassisConnectionPointLocal.set(this.car.options.wheelBackLeftPosition.depth,this.car.options.wheelBackLeftPosition.width,0),this.car.vehicle.addWheel(this.car.wheels.options),this.car.wheels.options.chassisConnectionPointLocal.set(this.car.options.wheelBackRightPosition.depth,this.car.options.wheelBackRightPosition.width,0),this.car.vehicle.addWheel(this.car.wheels.options),this.car.vehicle.addToWorld(this.world),this.car.wheels.indexes={},this.car.wheels.indexes.frontLeft=0,this.car.wheels.indexes.frontRight=1,this.car.wheels.indexes.backLeft=2,this.car.wheels.indexes.backRight=3,this.car.wheels.bodies=[];for(const t of this.car.vehicle.wheelInfos){const i=new ie.Cylinder(t.radius,t.radius,this.car.wheels.options.height,20),s=new ie.Body({mass:this.car.options.wheelMass,material:this.materials.items.wheel}),r=new ie.Quaternion;r.setFromAxisAngle(new ie.Vec3(1,0,0),Math.PI/2),s.type=ie.Body.KINEMATIC,s.addShape(i,new ie.Vec3,r),this.car.wheels.bodies.push(s)}this.car.model={},this.car.model.container=new je,this.models.container.add(this.car.model.container),this.car.model.material=new Ne({color:16777215,wireframe:!0}),this.car.model.chassis=new Ae(new Ut(this.car.options.chassisDepth,this.car.options.chassisWidth,this.car.options.chassisHeight),this.car.model.material),this.car.model.container.add(this.car.model.chassis),this.car.model.wheels=[];const e=new oi(this.car.options.wheelRadius,this.car.options.wheelRadius,this.car.options.wheelHeight,8,1);for(let t=0;t<4;t++){const i=new Ae(e,this.car.model.material);this.car.model.container.add(i),this.car.model.wheels.push(i)}},this.car.destroy=()=>{this.car.vehicle.removeFromWorld(this.world),this.models.container.remove(this.car.model.container)},this.car.recreate=()=>{this.car.destroy(),this.car.create(),this.car.chassis.body.wakeUp()},this.car.brake=()=>{this.car.vehicle.setBrake(1,0),this.car.vehicle.setBrake(1,1),this.car.vehicle.setBrake(1,2),this.car.vehicle.setBrake(1,3)},this.car.unbrake=()=>{this.car.vehicle.setBrake(0,0),this.car.vehicle.setBrake(0,1),this.car.vehicle.setBrake(0,2),this.car.vehicle.setBrake(0,3)},this.controls.on("action",e=>{switch(e){case"reset":this.car.recreate();break}}),this.world.addEventListener("postStep",()=>{let e=new ie.Vec3;e=e.copy(this.car.chassis.body.position),e=e.vsub(this.car.oldPosition),this.car.oldPosition.copy(this.car.chassis.body.position),this.car.speed=e.length()/this.time.delta;const t=new ie.Vec3(1,0,0);this.car.chassis.body.vectorToWorldFrame(t,this.car.worldForward),this.car.angle=Math.atan2(this.car.worldForward.y,this.car.worldForward.x),this.car.forwardSpeed=this.car.worldForward.dot(e),this.car.goingForward=this.car.forwardSpeed>0;const i=new ie.Vec3(0,0,1),s=new ie.Vec3;this.car.chassis.body.vectorToWorldFrame(i,s),s.dot(i)<.5?this.car.upsideDown.state==="watching"&&(this.car.upsideDown.state="pending",this.car.upsideDown.pendingTimeout=window.setTimeout(()=>{this.car.upsideDown.state="turning",this.car.jump(!0),this.car.upsideDown.turningTimeout=window.setTimeout(()=>{this.car.upsideDown.state="watching"},1e3)},1e3)):this.car.upsideDown.state==="pending"&&(this.car.upsideDown.state="watching",window.clearTimeout(this.car.upsideDown.pendingTimeout));for(let r=0;r<this.car.vehicle.wheelInfos.length;r++){this.car.vehicle.updateWheelTransform(r);const o=this.car.vehicle.wheelInfos[r].worldTransform;if(this.car.wheels.bodies[r].position.copy(o.position),this.car.wheels.bodies[r].quaternion.copy(o.quaternion),r===1||r===3){const l=new ie.Quaternion(0,0,0,1);l.setFromAxisAngle(new ie.Vec3(0,0,1),Math.PI),this.car.wheels.bodies[r].quaternion=this.car.wheels.bodies[r].quaternion.mult(l)}}if(!this.controls.actions.up&&!this.controls.actions.down){let r=this.car.worldForward.clone();this.car.goingForward&&(r=r.negate()),r=r.scale(this.car.chassis.body.velocity.length()*.1),this.car.chassis.body.applyImpulse(r,this.car.chassis.body.position)}}),this.time.on("tick",()=>{this.car.model.chassis.position.copy(this.car.chassis.body.position).add(this.car.options.chassisOffset),this.car.model.chassis.quaternion.copy(this.car.chassis.body.quaternion);for(const s in this.car.wheels.bodies){const r=this.car.wheels.bodies[s],o=this.car.model.wheels[s];o.position.copy(r.position),o.quaternion.copy(r.quaternion)}if(this.controls.touch){let s=0;this.controls.touch.joystick.active&&(s=(this.controls.touch.joystick.angle.value-this.car.angle+Math.PI)%(Math.PI*2)-Math.PI,s=s<-Math.PI?s+Math.PI*2:s);const r=Math.abs(this.car.forwardSpeed)<.01?!0:this.car.goingForward;this.car.steering=s*(r?-1:1),Math.abs(this.car.steering)>this.car.options.controlsSteeringMax&&(this.car.steering=Math.sign(this.car.steering)*this.car.options.controlsSteeringMax)}if(!this.controls.touch||!this.controls.touch.joystick.active){const s=this.time.delta*this.car.options.controlsSteeringSpeed;this.controls.actions.right?this.car.steering+=s:this.controls.actions.left?this.car.steering-=s:Math.abs(this.car.steering)>s?this.car.steering-=s*Math.sign(this.car.steering):this.car.steering=0,Math.abs(this.car.steering)>this.car.options.controlsSteeringMax&&(this.car.steering=Math.sign(this.car.steering)*this.car.options.controlsSteeringMax)}this.car.vehicle.setSteeringValue(-this.car.steering,this.car.wheels.indexes.frontLeft),this.car.vehicle.setSteeringValue(-this.car.steering,this.car.wheels.indexes.frontRight),this.car.options.controlsSteeringQuad&&(this.car.vehicle.setSteeringValue(this.car.steering,this.car.wheels.indexes.backLeft),this.car.vehicle.setSteeringValue(this.car.steering,this.car.wheels.indexes.backRight));const t=17*(this.controls.actions.boost?this.car.options.controlsAcceleratingSpeedBoost:this.car.options.controlsAcceleratingSpeed),i=this.controls.actions.boost?this.car.options.controlsAcceleratinMaxSpeedBoost:this.car.options.controlsAcceleratinMaxSpeed;this.controls.actions.up?this.car.speed<i||!this.car.goingForward?this.car.accelerating=t:this.car.accelerating=0:this.controls.actions.down?this.car.speed<i||this.car.goingForward?this.car.accelerating=-t:this.car.accelerating=0:this.car.accelerating=0,this.car.vehicle.applyEngineForce(-this.car.accelerating,this.car.wheels.indexes.backLeft),this.car.vehicle.applyEngineForce(-this.car.accelerating,this.car.wheels.indexes.backRight),this.car.options.controlsSteeringQuad&&(this.car.vehicle.applyEngineForce(-this.car.accelerating,this.car.wheels.indexes.frontLeft),this.car.vehicle.applyEngineForce(-this.car.accelerating,this.car.wheels.indexes.frontRight)),this.controls.actions.brake?(this.car.vehicle.setBrake(this.car.options.controlsBrakeStrength,0),this.car.vehicle.setBrake(this.car.options.controlsBrakeStrength,1),this.car.vehicle.setBrake(this.car.options.controlsBrakeStrength,2),this.car.vehicle.setBrake(this.car.options.controlsBrakeStrength,3)):(this.car.vehicle.setBrake(0,0),this.car.vehicle.setBrake(0,1),this.car.vehicle.setBrake(0,2),this.car.vehicle.setBrake(0,3))}),this.car.create(),this.debug){this.car.debugFolder=this.debugFolder.addFolder("car"),this.car.debugFolder.open(),this.car.debugFolder.add(this.car.options,"chassisWidth").step(.001).min(0).max(5).name("chassisWidth").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"chassisHeight").step(.001).min(0).max(5).name("chassisHeight").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"chassisDepth").step(.001).min(0).max(5).name("chassisDepth").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options.chassisOffset,"z").step(.001).min(0).max(5).name("chassisOffset").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"chassisMass").step(.001).min(0).max(1e3).name("chassisMass").onFinishChange(this.car.recreate);const e=this.car.debugFolder.addFolder("Tekerlek Pozisyonları");e.open();const t=e.addFolder("Ön Sol Tekerlek");t.add(this.car.options.wheelFrontLeftPosition,"depth").step(.01).min(-2).max(2).name("İleri/Geri").onFinishChange(this.car.recreate),t.add(this.car.options.wheelFrontLeftPosition,"width").step(.01).min(-2).max(2).name("Sağ/Sol").onFinishChange(this.car.recreate);const i=e.addFolder("Ön Sağ Tekerlek");i.add(this.car.options.wheelFrontRightPosition,"depth").step(.01).min(-2).max(2).name("İleri/Geri").onFinishChange(this.car.recreate),i.add(this.car.options.wheelFrontRightPosition,"width").step(.01).min(-2).max(2).name("Sağ/Sol").onFinishChange(this.car.recreate);const s=e.addFolder("Arka Sol Tekerlek");s.add(this.car.options.wheelBackLeftPosition,"depth").step(.01).min(-2).max(2).name("İleri/Geri").onFinishChange(this.car.recreate),s.add(this.car.options.wheelBackLeftPosition,"width").step(.01).min(-2).max(2).name("Sağ/Sol").onFinishChange(this.car.recreate);const r=e.addFolder("Arka Sağ Tekerlek");r.add(this.car.options.wheelBackRightPosition,"depth").step(.01).min(-2).max(2).name("İleri/Geri").onFinishChange(this.car.recreate),r.add(this.car.options.wheelBackRightPosition,"width").step(.01).min(-2).max(2).name("Sağ/Sol").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelRadius").step(.001).min(0).max(2).name("wheelRadius").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelHeight").step(.001).min(0).max(2).name("wheelHeight").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelSuspensionStiffness").step(.001).min(0).max(300).name("wheelSuspensionStiffness").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelSuspensionRestLength").step(.001).min(0).max(5).name("wheelSuspensionRestLength").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelFrictionSlip").step(.001).min(0).max(30).name("wheelFrictionSlip").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelDampingRelaxation").step(.001).min(0).max(30).name("wheelDampingRelaxation").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelDampingCompression").step(.001).min(0).max(30).name("wheelDampingCompression").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelMaxSuspensionForce").step(.001).min(0).max(1e6).name("wheelMaxSuspensionForce").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelRollInfluence").step(.001).min(0).max(1).name("wheelRollInfluence").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelMaxSuspensionTravel").step(.001).min(0).max(5).name("wheelMaxSuspensionTravel").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelCustomSlidingRotationalSpeed").step(.001).min(-45).max(45).name("wheelCustomSlidingRotationalSpeed").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelMass").step(.001).min(0).max(1e3).name("wheelMass").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"controlsSteeringSpeed").step(.001).min(0).max(.1).name("controlsSteeringSpeed"),this.car.debugFolder.add(this.car.options,"controlsSteeringMax").step(.001).min(0).max(Math.PI*.5).name("controlsSteeringMax"),this.car.debugFolder.add(this.car.options,"controlsSteeringQuad").name("controlsSteeringQuad"),this.car.debugFolder.add(this.car.options,"controlsAcceleratingSpeed").step(.001).min(0).max(30).name("controlsAcceleratingSpeed"),this.car.debugFolder.add(this.car.options,"controlsAcceleratingSpeedBoost").step(.001).min(0).max(30).name("controlsAcceleratingSpeedBoost"),this.car.debugFolder.add(this.car.options,"controlsAcceleratingQuad").name("controlsAcceleratingQuad"),this.car.debugFolder.add(this.car.options,"controlsBrakeStrength").step(.001).min(0).max(5).name("controlsBrakeStrength"),this.car.debugFolder.add(this.car,"recreate"),this.car.debugFolder.add(this.car,"jump")}}addObjectFromThree(e){const t={};t.model={},t.model.meshes=[],t.model.container=new je,this.models.container.add(t.model.container),t.children=[];const i=this.materials.items.dummy;if(t.body=new ie.Body({position:new ie.Vec3(e.offset.x,e.offset.y,e.offset.z),mass:e.mass,material:i}),t.body.allowSleep=!0,t.body.sleepSpeedLimit=.01,e.sleep&&t.body.sleep(),this.world.addBody(t.body),e.rotation){const r=new ie.Quaternion;r.setFromEuler(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.order),t.body.quaternion=t.body.quaternion.mult(r)}t.center=new ie.Vec3(0,0,0);const s=[];for(let r=0;r<e.meshes.length;r++){const o=e.meshes[r];let l=null;if(o.name.match(/^cube_?[0-9]{0,3}?|box[0-9]{0,3}?$/i)?l="box":o.name.match(/^cylinder_?[0-9]{0,3}?$/i)?l="cylinder":o.name.match(/^sphere_?[0-9]{0,3}?$/i)?l="sphere":o.name.match(/^center_?[0-9]{0,3}?$/i)&&(l="center"),l==="center")t.center.set(o.position.x,o.position.y,o.position.z);else if(l){let h=null;if(l==="cylinder")h=new ie.Cylinder(o.scale.x,o.scale.x,o.scale.z,8);else if(l==="box"){const p=new ie.Vec3(o.scale.x*.5,o.scale.y*.5,o.scale.z*.5);h=new ie.Box(p)}else l==="sphere"&&(h=new ie.Sphere(o.scale.x));const d=new ie.Vec3(o.position.x,o.position.y,o.position.z),f=new ie.Quaternion(o.quaternion.x,o.quaternion.y,o.quaternion.z,o.quaternion.w);s.push({shapeGeometry:h,shapePosition:d,shapeQuaternion:f});let c=null;l==="cylinder"?(c=new oi(1,1,1,8,1),c.rotateX(Math.PI*.5)):l==="box"?c=new Ut(1,1,1):l==="sphere"&&(c=new na(1,8,8));const u=new Ae(c,this.models.materials[e.mass===0?"static":"dynamic"]);u.position.copy(o.position),u.scale.copy(o.scale),u.quaternion.copy(o.quaternion),t.model.meshes.push(u)}}for(const r of t.model.meshes)r.position.x-=t.center.x,r.position.y-=t.center.y,r.position.z-=t.center.z,t.model.container.add(r);for(const r of s)r.shapePosition.x-=t.center.x,r.shapePosition.y-=t.center.y,r.shapePosition.z-=t.center.z,t.body.addShape(r.shapeGeometry,r.shapePosition,r.shapeQuaternion);return t.body.position.x+=t.center.x,t.body.position.y+=t.center.y,t.body.position.z+=t.center.z,t.origin={},t.origin.position=t.body.position.clone(),t.origin.quaternion=t.body.quaternion.clone(),t.origin.sleep=e.sleep,this.time.on("tick",()=>{if(t.model.container.position.set(t.body.position.x,t.body.position.y,t.body.position.z),t.model.container.quaternion.set(t.body.quaternion.x,t.body.quaternion.y,t.body.quaternion.z,t.body.quaternion.w),this.models.container.visible&&e.mass>0)for(const r of t.model.container.children)r.material=t.body.sleepState===2?this.models.materials.dynamicSleeping:this.models.materials.dynamic}),t.reset=()=>{t.body.position.copy(t.origin.position),t.body.quaternion.copy(t.origin.quaternion),t.origin.sleep&&t.body.sleep()},t}}class $M extends nr{constructor(e){super(),this.position=e.position,this.halfExtents=e.halfExtents,this.data=e.data,this.isIn=!1,this.mesh=new Ae(new Ut(e.halfExtents.x*2,e.halfExtents.y*2,3,1,1,1),new Ne({color:16711935,wireframe:!0})),this.mesh.position.x=e.position.x,this.mesh.position.y=e.position.y,this.mesh.position.z=1.5}}class ZM{constructor(e){this.time=e.time,this.sizes=e.sizes,this.physics=e.physics,this.debug=e.debug,this.container=new je,this.container.visible=!1,this.container.matrixAutoUpdate=!1,this.debug&&(this.debugFolder=this.debug.addFolder("zones"),this.debugFolder.open(),this.debugFolder.add(this.container,"visible").name("visible")),this.setTester(),this.setItems()}setTester(){this.tester={},this.tester.x=0,this.tester.y=0,this.time.on("tick",()=>{this.tester.x=this.physics.car.chassis.body.position.x,this.tester.y=this.physics.car.chassis.body.position.y})}setItems(){this.items=[],this.time.on("tick",()=>{for(const e of this.items){const t=this.tester.x<e.position.x+e.halfExtents.x&&this.tester.x>e.position.x-e.halfExtents.x&&this.tester.y<e.position.y+e.halfExtents.y&&this.tester.y>e.position.y-e.halfExtents.y;t&&!e.isIn?e.trigger("in",[e.data]):!t&&e.isIn&&e.trigger("out",[e.data]),e.isIn=t}})}add(e){const t=new $M(e);return this.container.add(t.mesh),this.items.push(t),t}}function KM(a,e=!1){const t=a[0].index!==null,i=new Set(Object.keys(a[0].attributes)),s=new Set(Object.keys(a[0].morphAttributes)),r={},o={},l=a[0].morphTargetsRelative,h=new Bt;let d=0;for(let f=0;f<a.length;++f){const c=a[f];let u=0;if(t!==(c.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+f+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const p in c.attributes){if(!i.has(p))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+f+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;r[p]===void 0&&(r[p]=[]),r[p].push(c.attributes[p]),u++}if(u!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+f+". Make sure all geometries have the same number of attributes."),null;if(l!==c.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+f+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const p in c.morphAttributes){if(!s.has(p))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+f+".  .morphAttributes must be consistent throughout all geometries."),null;o[p]===void 0&&(o[p]=[]),o[p].push(c.morphAttributes[p])}if(e){let p;if(t)p=c.index.count;else if(c.attributes.position!==void 0)p=c.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+f+". The geometry must have either an index or a position attribute"),null;h.addGroup(d,p,f),d+=p}}if(t){let f=0;const c=[];for(let u=0;u<a.length;++u){const p=a[u].index;for(let m=0;m<p.count;++m)c.push(p.getX(m)+f);f+=a[u].attributes.position.count}h.setIndex(c)}for(const f in r){const c=Rf(r[f]);if(!c)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+f+" attribute."),null;h.setAttribute(f,c)}for(const f in o){const c=o[f][0].length;if(c===0)break;h.morphAttributes=h.morphAttributes||{},h.morphAttributes[f]=[];for(let u=0;u<c;++u){const p=[];for(let _=0;_<o[f].length;++_)p.push(o[f][_][u]);const m=Rf(p);if(!m)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+f+" morphAttribute."),null;h.morphAttributes[f].push(m)}}return h}function Rf(a){let e,t,i,s=-1,r=0;for(let d=0;d<a.length;++d){const f=a[d];if(e===void 0&&(e=f.array.constructor),e!==f.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=f.itemSize),t!==f.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(i===void 0&&(i=f.normalized),i!==f.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(s===-1&&(s=f.gpuType),s!==f.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;r+=f.count*t}const o=new e(r),l=new ci(o,t,i);let h=0;for(let d=0;d<a.length;++d){const f=a[d];if(f.isInterleavedBufferAttribute){const c=h/t;for(let u=0,p=f.count;u<p;u++)for(let m=0;m<t;m++){const _=f.getComponent(u,m);l.setComponent(u+c,m,_)}}else o.set(f.array,h);h+=f.count*t}return s!==void 0&&(l.gpuType=s),l}function Pf(a,e){if(e===v0)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),a;if(e===Kc||e===Mp){let t=a.getIndex();if(t===null){const o=[],l=a.getAttribute("position");if(l!==void 0){for(let h=0;h<l.count;h++)o.push(h);a.setIndex(o),t=a.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a}const i=t.count-2,s=[];if(e===Kc)for(let o=1;o<=i;o++)s.push(t.getX(0)),s.push(t.getX(o)),s.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(s.push(t.getX(o)),s.push(t.getX(o+1)),s.push(t.getX(o+2))):(s.push(t.getX(o+2)),s.push(t.getX(o+1)),s.push(t.getX(o)));s.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=a.clone();return r.setIndex(s),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),a}class QM{constructor(e){this.time=e.time,this.resources=e.resources,this.materials=e.materials,this.physics=e.physics,this.shadows=e.shadows,this.sounds=e.sounds,this.debug=e.debug,this.container=new je,this.container.matrixAutoUpdate=!1,this.items=[],this.floorShadows=[],this.setParsers(),this.setMerge()}setParsers(){this.parsers={},this.parsers.items=[{regex:/^shade([a-z]+)_?[0-9]{0,3}?/i,apply:(e,t)=>{const i=e.name.match(/^shade([a-z]+)_?[0-9]{0,3}?/i),s=`${i[1].substring(0,1).toLowerCase()}${i[1].substring(1)}`;let r=this.materials.shades.items[s];typeof r>"u"&&(r=new el);const o=t.duplicated?e.clone():e;if(o.material=r,o.children.length)for(const l of o.children)l instanceof Ae&&(l.material=r);return o}},{regex:/^hubit([a-zA-Z]+)_?[0-9]{0,3}?/i,apply:(e,t)=>{const s=`hubit${e.name.match(/^hubit([a-zA-Z]+)_?[0-9]{0,3}?/i)[1]}`;let r=this.materials.shades.items[s];typeof r>"u"&&(r=new el);const o=t.duplicated?e.clone():e;if(o.material=r,o.children.length)for(const l of o.children)l instanceof Ae&&(l.material=r);return o}},{regex:/^pure([a-z]+)_?[0-9]{0,3}?/i,apply:(e,t)=>{const s=e.name.match(/^pure([a-z]+)_?[0-9]{0,3}?/i)[1].toLowerCase();let r=this.materials.pures.items[s];typeof r>"u"&&(r=new el);const o=t.duplicated?e.clone():e;return o.material=r,o}},{regex:/^floor_?[0-9]{0,3}?/i,apply:(e,t)=>{const i=new pi(e.scale.x,e.scale.y,10,10),s=this.materials.items.floorShadow.clone();s.uniforms.tShadow.value=t.floorShadowTexture,s.uniforms.uShadowColor.value=new Le(this.materials.items.floorShadow.shadowColor),s.uniforms.uAlpha.value=0;const r=new Ae(i,s);return r.matrixAutoUpdate=!1,r.updateMatrix(),this.floorShadows.push(r),r}}],this.parsers.default={},this.parsers.default.apply=e=>{const t=e.clone();return t.material=this.materials.shades.items.white,t}}setMerge(){this.merge={},this.merge.items={},this.merge.container=new je,this.merge.container.matrixAutoUpdate=!1,this.container.add(this.merge.container),this.merge.add=(e,t)=>{let i=this.merge.items[e];i||(i={},i.geometry=new Bt,i.geometriesToMerge=[],i.material=t.material,i.material.side=Ui,i.mesh=new Ae(i.geometry,i.material),this.merge.container.add(i.mesh),this.merge.items[e]=i);const s=t.geometry;t.updateMatrixWorld(),s.applyMatrix(t.matrixWorld),i.geometriesToMerge.push(s)},this.merge.applyMerge=()=>{for(const e in this.merge.items){const t=this.merge.items[e];t.geometry=KM(t.geometriesToMerge),t.mesh.geometry=t.geometry}},this.merge.update=()=>{for(const e of this.items)if(e.shouldMerge){const t=[...e.container.children];for(const i of t){const s=i.material.name;s!==""&&(this.merge.add(s,i),e.container.remove(i))}e.shouldMerge=!1}this.merge.applyMerge()}}getConvertedMesh(e,t={}){const i=new je,s=new T,r=[...e];for(const o of r)if(o.name.match(/^center_?[0-9]{0,3}?/i)&&s.set(o.position.x,o.position.y,o.position.z),o instanceof Ae){let l=this.parsers.items.find(d=>o.name.match(d.regex));typeof l>"u"&&(l=this.parsers.default);const h=l.apply(o,t);i.add(h)}if(s.length()>0){for(const o of i.children)o.position.sub(s);i.position.add(s)}return t.mass&&t.mass===0&&(i.matrixAutoUpdate=!1,i.updateMatrix()),i}add(e){const t={};t.merged=!1,t.shouldMerge=e.mass===0;const i=new T;e.offset&&i.copy(e.offset);const s=new At;e.rotation&&s.copy(e.rotation);const r=typeof e.sleep>"u"?!0:e.sleep;if(t.container=this.getConvertedMesh(e.base.children,e),t.container.position.copy(i),t.container.rotation.copy(s),this.container.add(t.container),e.mass===0){t.container.matrixAutoUpdate=!1,t.container.updateMatrix();for(const o of t.container.children)o.matrixAutoUpdate=!1,o.updateMatrix()}t.collision=this.physics.addObjectFromThree({meshes:[...e.collision.children],offset:i,rotation:s,mass:e.mass,sleep:r});for(const o of t.container.children)o.position.sub(t.collision.center);return e.soundName&&t.collision.body.addEventListener("collide",o=>{const l=o.contact.getImpactVelocityAlongNormal();this.sounds.play(e.soundName,l)}),e.shadow&&this.shadows.add(t.container,e.shadow),e.mass>0&&this.time.on("tick",()=>{t.container.position.copy(t.collision.body.position),t.container.quaternion.copy(t.collision.body.quaternion)}),this.items.push(t),t}}class JM{constructor(e){this.time=e.time,this.resources=e.resources,this.objects=e.objects,this.physics=e.physics,this.shadows=e.shadows,this.materials=e.materials,this.controls=e.controls,this.sounds=e.sounds,this.renderer=e.renderer,this.camera=e.camera,this.debug=e.debug,this.config=e.config,this.scene=e.scene,this.soundRoom=e.soundRoom,this.container=new je,this.position=new T,this.debug&&(this.debugFolder=this.debug.addFolder("car")),this.setModels(),this.setMovement(),this.setChassis(),this.setBackLights(),this.setWheels(),this.setTransformControls(),this.setShootingBall(),this.setKlaxon(),this.soundController()}setModels(){this.models={},this.config.cyberTruck?(this.models.chassis=this.resources.items.carCyberTruckChassis,this.models.antena=this.resources.items.carCyberTruckAntena,this.models.backLightsBrake=this.resources.items.carCyberTruckBackLightsBrake,this.models.backLightsReverse=this.resources.items.carCyberTruckBackLightsReverse,this.models.wheel=this.resources.items.carCyberTruckWheel):this.config.togg?(this.models.chassis=this.resources.items.carToggChassis,this.models.backLightsBrake=this.resources.items.carToggBackLightsBrake,this.models.backLightsReverse=this.resources.items.carToggBackLightsReverse,this.models.wheel=this.resources.items.carToggWheel):(this.models.chassis=this.resources.items.carDefaultChassis,this.models.antena=this.resources.items.carDefaultAntena,this.models.backLightsBrake=this.resources.items.carDefaultBackLightsBrake,this.models.backLightsReverse=this.resources.items.carDefaultBackLightsReverse,this.models.wheel=this.resources.items.carDefaultWheel)}setMovement(){this.movement={},this.movement.speed=new T,this.movement.localSpeed=new T,this.movement.acceleration=new T,this.movement.localAcceleration=new T,this.movement.lastScreech=this.time.elapsed,this.time.on("tick",()=>{const e=new T;e.copy(this.chassis.object.position).sub(this.chassis.oldPosition),e.multiplyScalar(1/this.time.delta*17),this.movement.acceleration=e.clone().sub(this.movement.speed),this.movement.speed.copy(e),this.movement.localSpeed=this.movement.speed.clone().applyAxisAngle(new T(0,0,1),-this.chassis.object.rotation.z),this.movement.localAcceleration=this.movement.acceleration.clone().applyAxisAngle(new T(0,0,1),-this.chassis.object.rotation.z),this.sounds.engine.speed=this.movement.localSpeed.x,this.sounds.engine.acceleration=this.controls.actions.up?this.controls.actions.boost?1:.5:0,this.movement.localAcceleration.x>.03&&this.time.elapsed-this.movement.lastScreech>5e3&&(this.movement.lastScreech=this.time.elapsed,this.sounds.play("screech"))})}setChassis(){this.chassis={},this.chassis.offset=new T(0,0,-.32),this.chassis.object=this.objects.getConvertedMesh(this.models.chassis.scene.children),this.chassis.object.position.copy(this.physics.car.chassis.body.position),this.chassis.oldPosition=this.chassis.object.position.clone(),this.container.add(this.chassis.object),this.shadows.add(this.chassis.object,{sizeX:3,sizeY:2,offsetZ:.35}),this.time.on("tick",()=>{this.chassis.oldPosition=this.chassis.object.position.clone(),this.transformControls.enabled||(this.chassis.object.position.copy(this.physics.car.chassis.body.position).add(this.chassis.offset),this.chassis.object.quaternion.copy(this.physics.car.chassis.body.quaternion)),this.position.copy(this.chassis.object.position)})}setBackLights(){this.backLightsBrake={},this.backLightsBrake.material=this.materials.pures.items.red.clone(),this.backLightsBrake.material.transparent=!0,this.backLightsBrake.material.opacity=1,this.backLightsBrake.object=this.objects.getConvertedMesh(this.models.backLightsBrake.scene.children);for(const e of this.backLightsBrake.object.children)e.material=this.backLightsBrake.material;this.chassis.object.add(this.backLightsBrake.object),this.backLightsReverse={},this.backLightsReverse.material=this.materials.pures.items.yellow.clone(),this.backLightsReverse.material.transparent=!0,this.backLightsReverse.material.opacity=.5,this.backLightsReverse.object=this.objects.getConvertedMesh(this.models.backLightsReverse.scene.children);for(const e of this.backLightsReverse.object.children)e.material=this.backLightsReverse.material;this.chassis.object.add(this.backLightsReverse.object),this.time.on("tick",()=>{this.backLightsBrake.material.opacity=this.physics.controls.actions.brake?1:.5,this.backLightsReverse.material.opacity=this.physics.controls.actions.down?1:.5})}setWheels(){this.wheels={},this.wheels.object=this.objects.getConvertedMesh(this.models.wheel.scene.children),this.wheels.items=[];for(let e=0;e<4;e++){const t=this.wheels.object.clone();t.position.z=-.02,this.wheels.items.push(t),this.container.add(t)}this.time.on("tick",()=>{if(!this.transformControls.enabled)for(const e in this.physics.car.wheels.bodies){const t=this.physics.car.wheels.bodies[e],i=this.wheels.items[e];i.position.copy(t.position),i.position.y-=-.02,i.quaternion.copy(t.quaternion)}})}setTransformControls(){if(this.transformControls=new sm(this.camera.instance,this.renderer.domElement),this.transformControls.size=.5,this.transformControls.attach(this.chassis.object),this.transformControls.enabled=!1,this.transformControls.visible=this.transformControls.enabled,document.addEventListener("keydown",e=>{this.mode==="transformControls"&&(e.key==="r"?this.transformControls.setMode("rotate"):e.key==="g"&&this.transformControls.setMode("translate"))}),this.transformControls.addEventListener("dragging-changed",e=>{this.camera.orbitControls.enabled=!e.value}),this.container.add(this.transformControls),this.debug){const e=this.debugFolder.addFolder("controls");e.open(),e.add(this.transformControls,"enabled").onChange(()=>{this.transformControls.visible=this.transformControls.enabled})}}setShootingBall(){this.config.cyberTruck&&window.addEventListener("keydown",e=>{if(e.key==="b"){const t=Math.random()*Math.PI*2,i=10,s=this.position.x+Math.cos(t)*i,r=this.position.y+Math.sin(t)*i,o=2+2*Math.random(),l=this.objects.add({base:this.resources.items.bowlingBallBase.scene,collision:this.resources.items.bowlingBallCollision.scene,offset:new T(s,r,o),rotation:new At(Math.PI*.5,0,0),duplicated:!0,shadow:{sizeX:1.5,sizeY:1.5,offsetZ:-.15,alpha:.35},mass:5,soundName:"bowlingBall",sleep:!1});let d=new ie.Vec3(this.position.x,this.position.y,this.position.z+1).vsub(l.collision.body.position);d.normalize(),d=d.scale(100),l.collision.body.applyImpulse(d,l.collision.body.position)}})}setKlaxon(){this.klaxon={},this.klaxon.lastTime=this.time.elapsed,window.addEventListener("keydown",e=>{if(e.code==="KeyH"&&(this.time.elapsed-this.klaxon.lastTime>400&&(this.physics.car.jump(!1,150),this.klaxon.lastTime=this.time.elapsed),this.sounds.play(Math.random()<.002?"carHorn2":"carHorn1")),e.key==="k"){const t=this.position.x+(Math.random()-.5)*3,i=this.position.y+(Math.random()-.5)*3,s=6+2*Math.random();this.objects.add({base:this.resources.items.hornBase.scene,collision:this.resources.items.hornCollision.scene,offset:new T(t,i,s),rotation:new At(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),duplicated:!0,shadow:{sizeX:1.5,sizeY:1.5,offsetZ:-.15,alpha:.35},mass:5,soundName:"horn",sleep:!1})}})}findClosestObject(){return this.soundRoom===null&&(this.soundRoom=this.scene.children.find(t=>t.name==="SoundRoom")),this.position.distanceTo(this.soundRoom.position)}soundController(){var e=new Howl({src:["./sounds/sound-room/sound-room.mp3"],loop:!0,volume:0});e.play(),this.time.on("tick",()=>{const t=this.findClosestObject(),i=Math.max(0,1-t/20);e.volume(i)})}}function Xn(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function om(a,e){a.prototype=Object.create(e.prototype),a.prototype.constructor=a,a.__proto__=e}/*!
 * GSAP 3.12.5
 * https://gsap.com
 *
 * @license Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Ji={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Jr={duration:.5,overwrite:!1,delay:0},Jh,Li,qt,on=1e8,zt=1/on,dh=Math.PI*2,eS=dh/4,tS=0,am=Math.sqrt,iS=Math.cos,nS=Math.sin,wi=function(e){return typeof e=="string"},ti=function(e){return typeof e=="function"},Jn=function(e){return typeof e=="number"},eu=function(e){return typeof e>"u"},Fn=function(e){return typeof e=="object"},Vi=function(e){return e!==!1},tu=function(){return typeof window<"u"},$a=function(e){return ti(e)||wi(e)},lm=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},Fi=Array.isArray,fh=/(?:-?\.?\d|\.)+/gi,cm=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Dr=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Cc=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,hm=/[+-]=-?[.\d]+/,um=/[^,'"\[\]\s]+/gi,sS=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,$t,Sn,ph,iu,en={},bl={},dm,fm=function(e){return(bl=Js(e,en))&&Xi},nu=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},jo=function(e,t){return!t&&console.warn(e)},pm=function(e,t){return e&&(en[e]=t)&&bl&&(bl[e]=t)||en},Yo=function(){return 0},rS={suppressEvents:!0,isStart:!0,kill:!1},il={suppressEvents:!0,kill:!1},oS={suppressEvents:!0},su={},_s=[],mh={},mm,$i={},Rc={},If=30,nl=[],ru="",ou=function(e){var t=e[0],i,s;if(Fn(t)||ti(t)||(e=[e]),!(i=(t._gsap||{}).harness)){for(s=nl.length;s--&&!nl[s].targetTest(t););i=nl[s]}for(s=e.length;s--;)e[s]&&(e[s]._gsap||(e[s]._gsap=new Um(e[s],i)))||e.splice(s,1);return e},js=function(e){return e._gsap||ou(an(e))[0]._gsap},gm=function(e,t,i){return(i=e[t])&&ti(i)?e[t]():eu(i)&&e.getAttribute&&e.getAttribute(t)||i},Hi=function(e,t){return(e=e.split(",")).forEach(t)||e},si=function(e){return Math.round(e*1e5)/1e5||0},yi=function(e){return Math.round(e*1e7)/1e7||0},Gr=function(e,t){var i=t.charAt(0),s=parseFloat(t.substr(2));return e=parseFloat(e),i==="+"?e+s:i==="-"?e-s:i==="*"?e*s:e/s},aS=function(e,t){for(var i=t.length,s=0;e.indexOf(t[s])<0&&++s<i;);return s<i},wl=function(){var e=_s.length,t=_s.slice(0),i,s;for(mh={},_s.length=0,i=0;i<e;i++)s=t[i],s&&s._lazy&&(s.render(s._lazy[0],s._lazy[1],!0)._lazy=0)},vm=function(e,t,i,s){_s.length&&!Li&&wl(),e.render(t,i,Li&&t<0&&(e._initted||e._startAt)),_s.length&&!Li&&wl()},_m=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(um).length<2?t:wi(e)?e.trim():e},ym=function(e){return e},ln=function(e,t){for(var i in t)i in e||(e[i]=t[i]);return e},lS=function(e){return function(t,i){for(var s in i)s in t||s==="duration"&&e||s==="ease"||(t[s]=i[s])}},Js=function(e,t){for(var i in t)e[i]=t[i];return e},Lf=function a(e,t){for(var i in t)i!=="__proto__"&&i!=="constructor"&&i!=="prototype"&&(e[i]=Fn(t[i])?a(e[i]||(e[i]={}),t[i]):t[i]);return e},Ml=function(e,t){var i={},s;for(s in e)s in t||(i[s]=e[s]);return i},Bo=function(e){var t=e.parent||$t,i=e.keyframes?lS(Fi(e.keyframes)):ln;if(Vi(e.inherit))for(;t;)i(e,t.vars.defaults),t=t.parent||t._dp;return e},cS=function(e,t){for(var i=e.length,s=i===t.length;s&&i--&&e[i]===t[i];);return i<0},xm=function(e,t,i,s,r){var o=e[s],l;if(r)for(l=t[r];o&&o[r]>l;)o=o._prev;return o?(t._next=o._next,o._next=t):(t._next=e[i],e[i]=t),t._next?t._next._prev=t:e[s]=t,t._prev=o,t.parent=t._dp=e,t},kl=function(e,t,i,s){i===void 0&&(i="_first"),s===void 0&&(s="_last");var r=t._prev,o=t._next;r?r._next=o:e[i]===t&&(e[i]=o),o?o._prev=r:e[s]===t&&(e[s]=r),t._next=t._prev=t.parent=null},Ms=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},Ys=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var i=e;i;)i._dirty=1,i=i.parent;return e},hS=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},gh=function(e,t,i,s){return e._startAt&&(Li?e._startAt.revert(il):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,s))},uS=function a(e){return!e||e._ts&&a(e.parent)},Ff=function(e){return e._repeat?eo(e._tTime,e=e.duration()+e._rDelay)*e:0},eo=function(e,t){var i=Math.floor(e/=t);return e&&i===e?i-1:i},Sl=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},Nl=function(e){return e._end=yi(e._start+(e._tDur/Math.abs(e._ts||e._rts||zt)||0))},Ol=function(e,t){var i=e._dp;return i&&i.smoothChildTiming&&e._ts&&(e._start=yi(i._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),Nl(e),i._dirty||Ys(i,e)),e},bm=function(e,t){var i;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(i=Sl(e.rawTime(),t),(!t._dur||oa(0,t.totalDuration(),i)-t._tTime>zt)&&t.render(i,!0)),Ys(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(i=e;i._dp;)i.rawTime()>=0&&i.totalTime(i._tTime),i=i._dp;e._zTime=-zt}},En=function(e,t,i,s){return t.parent&&Ms(t),t._start=yi((Jn(i)?i:i||e!==$t?nn(e,i,t):e._time)+t._delay),t._end=yi(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),xm(e,t,"_first","_last",e._sort?"_start":0),vh(t)||(e._recent=t),s||bm(e,t),e._ts<0&&Ol(e,e._tTime),e},wm=function(e,t){return(en.ScrollTrigger||nu("scrollTrigger",t))&&en.ScrollTrigger.create(t,e)},Mm=function(e,t,i,s,r){if(lu(e,t,r),!e._initted)return 1;if(!i&&e._pt&&!Li&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&mm!==Zi.frame)return _s.push(e),e._lazy=[r,s],1},dS=function a(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||a(t))},vh=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},fS=function(e,t,i,s){var r=e.ratio,o=t<0||!t&&(!e._start&&dS(e)&&!(!e._initted&&vh(e))||(e._ts<0||e._dp._ts<0)&&!vh(e))?0:1,l=e._rDelay,h=0,d,f,c;if(l&&e._repeat&&(h=oa(0,e._tDur,t),f=eo(h,l),e._yoyo&&f&1&&(o=1-o),f!==eo(e._tTime,l)&&(r=1-o,e.vars.repeatRefresh&&e._initted&&e.invalidate())),o!==r||Li||s||e._zTime===zt||!t&&e._zTime){if(!e._initted&&Mm(e,t,s,i,h))return;for(c=e._zTime,e._zTime=t||(i?zt:0),i||(i=t&&!c),e.ratio=o,e._from&&(o=1-o),e._time=0,e._tTime=h,d=e._pt;d;)d.r(o,d.d),d=d._next;t<0&&gh(e,t,i,!0),e._onUpdate&&!i&&Ki(e,"onUpdate"),h&&e._repeat&&!i&&e.parent&&Ki(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===o&&(o&&Ms(e,1),!i&&!Li&&(Ki(e,o?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},pS=function(e,t,i){var s;if(i>t)for(s=e._first;s&&s._start<=i;){if(s.data==="isPause"&&s._start>t)return s;s=s._next}else for(s=e._last;s&&s._start>=i;){if(s.data==="isPause"&&s._start<t)return s;s=s._prev}},to=function(e,t,i,s){var r=e._repeat,o=yi(t)||0,l=e._tTime/e._tDur;return l&&!s&&(e._time*=o/e._dur),e._dur=o,e._tDur=r?r<0?1e10:yi(o*(r+1)+e._rDelay*r):o,l>0&&!s&&Ol(e,e._tTime=e._tDur*l),e.parent&&Nl(e),i||Ys(e.parent,e),e},Bf=function(e){return e instanceof Oi?Ys(e):to(e,e._dur)},mS={_start:0,endTime:Yo,totalDuration:Yo},nn=function a(e,t,i){var s=e.labels,r=e._recent||mS,o=e.duration()>=on?r.endTime(!1):e._dur,l,h,d;return wi(t)&&(isNaN(t)||t in s)?(h=t.charAt(0),d=t.substr(-1)==="%",l=t.indexOf("="),h==="<"||h===">"?(l>=0&&(t=t.replace(/=/,"")),(h==="<"?r._start:r.endTime(r._repeat>=0))+(parseFloat(t.substr(1))||0)*(d?(l<0?r:i).totalDuration()/100:1)):l<0?(t in s||(s[t]=o),s[t]):(h=parseFloat(t.charAt(l-1)+t.substr(l+1)),d&&i&&(h=h/100*(Fi(i)?i[0]:i).totalDuration()),l>1?a(e,t.substr(0,l-1),i)+h:o+h)):t==null?o:+t},Do=function(e,t,i){var s=Jn(t[1]),r=(s?2:1)+(e<2?0:1),o=t[r],l,h;if(s&&(o.duration=t[1]),o.parent=i,e){for(l=o,h=i;h&&!("immediateRender"in l);)l=h.vars.defaults||{},h=Vi(h.vars.inherit)&&h.parent;o.immediateRender=Vi(l.immediateRender),e<2?o.runBackwards=1:o.startAt=t[r-1]}return new ai(t[0],o,t[r+1])},Cs=function(e,t){return e||e===0?t(e):t},oa=function(e,t,i){return i<e?e:i>t?t:i},Ii=function(e,t){return!wi(e)||!(t=sS.exec(e))?"":t[1]},gS=function(e,t,i){return Cs(i,function(s){return oa(e,t,s)})},_h=[].slice,Sm=function(e,t){return e&&Fn(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&Fn(e[0]))&&!e.nodeType&&e!==Sn},vS=function(e,t,i){return i===void 0&&(i=[]),e.forEach(function(s){var r;return wi(s)&&!t||Sm(s,1)?(r=i).push.apply(r,an(s)):i.push(s)})||i},an=function(e,t,i){return qt&&!t&&qt.selector?qt.selector(e):wi(e)&&!i&&(ph||!io())?_h.call((t||iu).querySelectorAll(e),0):Fi(e)?vS(e,i):Sm(e)?_h.call(e,0):e?[e]:[]},yh=function(e){return e=an(e)[0]||jo("Invalid scope")||{},function(t){var i=e.current||e.nativeElement||e;return an(t,i.querySelectorAll?i:i===e?jo("Invalid scope")||iu.createElement("div"):e)}},Am=function(e){return e.sort(function(){return .5-Math.random()})},Em=function(e){if(ti(e))return e;var t=Fn(e)?e:{each:e},i=qs(t.ease),s=t.from||0,r=parseFloat(t.base)||0,o={},l=s>0&&s<1,h=isNaN(s)||l,d=t.axis,f=s,c=s;return wi(s)?f=c={center:.5,edges:.5,end:1}[s]||0:!l&&h&&(f=s[0],c=s[1]),function(u,p,m){var _=(m||t).length,g=o[_],v,y,x,b,S,A,E,R,M;if(!g){if(M=t.grid==="auto"?0:(t.grid||[1,on])[1],!M){for(E=-on;E<(E=m[M++].getBoundingClientRect().left)&&M<_;);M<_&&M--}for(g=o[_]=[],v=h?Math.min(M,_)*f-.5:s%M,y=M===on?0:h?_*c/M-.5:s/M|0,E=0,R=on,A=0;A<_;A++)x=A%M-v,b=y-(A/M|0),g[A]=S=d?Math.abs(d==="y"?b:x):am(x*x+b*b),S>E&&(E=S),S<R&&(R=S);s==="random"&&Am(g),g.max=E-R,g.min=R,g.v=_=(parseFloat(t.amount)||parseFloat(t.each)*(M>_?_-1:d?d==="y"?_/M:M:Math.max(M,_/M))||0)*(s==="edges"?-1:1),g.b=_<0?r-_:r,g.u=Ii(t.amount||t.each)||0,i=i&&_<0?km(i):i}return _=(g[u]-g.min)/g.max||0,yi(g.b+(i?i(_):_)*g.v)+g.u}},xh=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(i){var s=yi(Math.round(parseFloat(i)/e)*e*t);return(s-s%1)/t+(Jn(i)?0:Ii(i))}},Tm=function(e,t){var i=Fi(e),s,r;return!i&&Fn(e)&&(s=i=e.radius||on,e.values?(e=an(e.values),(r=!Jn(e[0]))&&(s*=s)):e=xh(e.increment)),Cs(t,i?ti(e)?function(o){return r=e(o),Math.abs(r-o)<=s?r:o}:function(o){for(var l=parseFloat(r?o.x:o),h=parseFloat(r?o.y:0),d=on,f=0,c=e.length,u,p;c--;)r?(u=e[c].x-l,p=e[c].y-h,u=u*u+p*p):u=Math.abs(e[c]-l),u<d&&(d=u,f=c);return f=!s||d<=s?e[f]:o,r||f===o||Jn(o)?f:f+Ii(o)}:xh(e))},Cm=function(e,t,i,s){return Cs(Fi(e)?!t:i===!0?!!(i=0):!s,function(){return Fi(e)?e[~~(Math.random()*e.length)]:(i=i||1e-5)&&(s=i<1?Math.pow(10,(i+"").length-2):1)&&Math.floor(Math.round((e-i/2+Math.random()*(t-e+i*.99))/i)*i*s)/s})},_S=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(s){return t.reduce(function(r,o){return o(r)},s)}},yS=function(e,t){return function(i){return e(parseFloat(i))+(t||Ii(i))}},xS=function(e,t,i){return Pm(e,t,0,1,i)},Rm=function(e,t,i){return Cs(i,function(s){return e[~~t(s)]})},bS=function a(e,t,i){var s=t-e;return Fi(e)?Rm(e,a(0,e.length),t):Cs(i,function(r){return(s+(r-e)%s)%s+e})},wS=function a(e,t,i){var s=t-e,r=s*2;return Fi(e)?Rm(e,a(0,e.length-1),t):Cs(i,function(o){return o=(r+(o-e)%r)%r||0,e+(o>s?r-o:o)})},qo=function(e){for(var t=0,i="",s,r,o,l;~(s=e.indexOf("random(",t));)o=e.indexOf(")",s),l=e.charAt(s+7)==="[",r=e.substr(s+7,o-s-7).match(l?um:fh),i+=e.substr(t,s-t)+Cm(l?r:+r[0],l?0:+r[1],+r[2]||1e-5),t=o+1;return i+e.substr(t,e.length-t)},Pm=function(e,t,i,s,r){var o=t-e,l=s-i;return Cs(r,function(h){return i+((h-e)/o*l||0)})},MS=function a(e,t,i,s){var r=isNaN(e+t)?0:function(p){return(1-p)*e+p*t};if(!r){var o=wi(e),l={},h,d,f,c,u;if(i===!0&&(s=1)&&(i=null),o)e={p:e},t={p:t};else if(Fi(e)&&!Fi(t)){for(f=[],c=e.length,u=c-2,d=1;d<c;d++)f.push(a(e[d-1],e[d]));c--,r=function(m){m*=c;var _=Math.min(u,~~m);return f[_](m-_)},i=t}else s||(e=Js(Fi(e)?[]:{},e));if(!f){for(h in t)au.call(l,e,h,"get",t[h]);r=function(m){return uu(m,l)||(o?e.p:e)}}}return Cs(i,r)},Df=function(e,t,i){var s=e.labels,r=on,o,l,h;for(o in s)l=s[o]-t,l<0==!!i&&l&&r>(l=Math.abs(l))&&(h=o,r=l);return h},Ki=function(e,t,i){var s=e.vars,r=s[t],o=qt,l=e._ctx,h,d,f;if(r)return h=s[t+"Params"],d=s.callbackScope||e,i&&_s.length&&wl(),l&&(qt=l),f=h?r.apply(d,h):r.call(d),qt=o,f},Ro=function(e){return Ms(e),e.scrollTrigger&&e.scrollTrigger.kill(!!Li),e.progress()<1&&Ki(e,"onInterrupt"),e},kr,Im=[],Lm=function(e){if(e)if(e=!e.name&&e.default||e,tu()||e.headless){var t=e.name,i=ti(e),s=t&&!i&&e.init?function(){this._props=[]}:e,r={init:Yo,render:uu,add:au,kill:US,modifier:OS,rawVars:0},o={targetTest:0,get:0,getSetter:hu,aliases:{},register:0};if(io(),e!==s){if($i[t])return;ln(s,ln(Ml(e,r),o)),Js(s.prototype,Js(r,Ml(e,o))),$i[s.prop=t]=s,e.targetTest&&(nl.push(s),su[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}pm(t,s),e.register&&e.register(Xi,s,Gi)}else Im.push(e)},kt=255,Po={aqua:[0,kt,kt],lime:[0,kt,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,kt],navy:[0,0,128],white:[kt,kt,kt],olive:[128,128,0],yellow:[kt,kt,0],orange:[kt,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[kt,0,0],pink:[kt,192,203],cyan:[0,kt,kt],transparent:[kt,kt,kt,0]},Pc=function(e,t,i){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(i-t)*e*6:e<.5?i:e*3<2?t+(i-t)*(2/3-e)*6:t)*kt+.5|0},Fm=function(e,t,i){var s=e?Jn(e)?[e>>16,e>>8&kt,e&kt]:0:Po.black,r,o,l,h,d,f,c,u,p,m;if(!s){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),Po[e])s=Po[e];else if(e.charAt(0)==="#"){if(e.length<6&&(r=e.charAt(1),o=e.charAt(2),l=e.charAt(3),e="#"+r+r+o+o+l+l+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return s=parseInt(e.substr(1,6),16),[s>>16,s>>8&kt,s&kt,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),s=[e>>16,e>>8&kt,e&kt]}else if(e.substr(0,3)==="hsl"){if(s=m=e.match(fh),!t)h=+s[0]%360/360,d=+s[1]/100,f=+s[2]/100,o=f<=.5?f*(d+1):f+d-f*d,r=f*2-o,s.length>3&&(s[3]*=1),s[0]=Pc(h+1/3,r,o),s[1]=Pc(h,r,o),s[2]=Pc(h-1/3,r,o);else if(~e.indexOf("="))return s=e.match(cm),i&&s.length<4&&(s[3]=1),s}else s=e.match(fh)||Po.transparent;s=s.map(Number)}return t&&!m&&(r=s[0]/kt,o=s[1]/kt,l=s[2]/kt,c=Math.max(r,o,l),u=Math.min(r,o,l),f=(c+u)/2,c===u?h=d=0:(p=c-u,d=f>.5?p/(2-c-u):p/(c+u),h=c===r?(o-l)/p+(o<l?6:0):c===o?(l-r)/p+2:(r-o)/p+4,h*=60),s[0]=~~(h+.5),s[1]=~~(d*100+.5),s[2]=~~(f*100+.5)),i&&s.length<4&&(s[3]=1),s},Bm=function(e){var t=[],i=[],s=-1;return e.split(ys).forEach(function(r){var o=r.match(Dr)||[];t.push.apply(t,o),i.push(s+=o.length+1)}),t.c=i,t},kf=function(e,t,i){var s="",r=(e+s).match(ys),o=t?"hsla(":"rgba(",l=0,h,d,f,c;if(!r)return e;if(r=r.map(function(u){return(u=Fm(u,t,1))&&o+(t?u[0]+","+u[1]+"%,"+u[2]+"%,"+u[3]:u.join(","))+")"}),i&&(f=Bm(e),h=i.c,h.join(s)!==f.c.join(s)))for(d=e.replace(ys,"1").split(Dr),c=d.length-1;l<c;l++)s+=d[l]+(~h.indexOf(l)?r.shift()||o+"0,0,0,0)":(f.length?f:r.length?r:i).shift());if(!d)for(d=e.split(ys),c=d.length-1;l<c;l++)s+=d[l]+r[l];return s+d[c]},ys=function(){var a="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in Po)a+="|"+e+"\\b";return new RegExp(a+")","gi")}(),SS=/hsl[a]?\(/,Dm=function(e){var t=e.join(" "),i;if(ys.lastIndex=0,ys.test(t))return i=SS.test(t),e[1]=kf(e[1],i),e[0]=kf(e[0],i,Bm(e[1])),!0},$o,Zi=function(){var a=Date.now,e=500,t=33,i=a(),s=i,r=1e3/240,o=r,l=[],h,d,f,c,u,p,m=function _(g){var v=a()-s,y=g===!0,x,b,S,A;if((v>e||v<0)&&(i+=v-t),s+=v,S=s-i,x=S-o,(x>0||y)&&(A=++c.frame,u=S-c.time*1e3,c.time=S=S/1e3,o+=x+(x>=r?4:r-x),b=1),y||(h=d(_)),b)for(p=0;p<l.length;p++)l[p](S,u,A,g)};return c={time:0,frame:0,tick:function(){m(!0)},deltaRatio:function(g){return u/(1e3/(g||60))},wake:function(){dm&&(!ph&&tu()&&(Sn=ph=window,iu=Sn.document||{},en.gsap=Xi,(Sn.gsapVersions||(Sn.gsapVersions=[])).push(Xi.version),fm(bl||Sn.GreenSockGlobals||!Sn.gsap&&Sn||{}),Im.forEach(Lm)),f=typeof requestAnimationFrame<"u"&&requestAnimationFrame,h&&c.sleep(),d=f||function(g){return setTimeout(g,o-c.time*1e3+1|0)},$o=1,m(2))},sleep:function(){(f?cancelAnimationFrame:clearTimeout)(h),$o=0,d=Yo},lagSmoothing:function(g,v){e=g||1/0,t=Math.min(v||33,e)},fps:function(g){r=1e3/(g||240),o=c.time*1e3+r},add:function(g,v,y){var x=v?function(b,S,A,E){g(b,S,A,E),c.remove(x)}:g;return c.remove(g),l[y?"unshift":"push"](x),io(),x},remove:function(g,v){~(v=l.indexOf(g))&&l.splice(v,1)&&p>=v&&p--},_listeners:l},c}(),io=function(){return!$o&&Zi.wake()},wt={},AS=/^[\d.\-M][\d.\-,\s]/,ES=/["']/g,TS=function(e){for(var t={},i=e.substr(1,e.length-3).split(":"),s=i[0],r=1,o=i.length,l,h,d;r<o;r++)h=i[r],l=r!==o-1?h.lastIndexOf(","):h.length,d=h.substr(0,l),t[s]=isNaN(d)?d.replace(ES,"").trim():+d,s=h.substr(l+1).trim();return t},CS=function(e){var t=e.indexOf("(")+1,i=e.indexOf(")"),s=e.indexOf("(",t);return e.substring(t,~s&&s<i?e.indexOf(")",i+1):i)},RS=function(e){var t=(e+"").split("("),i=wt[t[0]];return i&&t.length>1&&i.config?i.config.apply(null,~e.indexOf("{")?[TS(t[1])]:CS(e).split(",").map(_m)):wt._CE&&AS.test(e)?wt._CE("",e):i},km=function(e){return function(t){return 1-e(1-t)}},Nm=function a(e,t){for(var i=e._first,s;i;)i instanceof Oi?a(i,t):i.vars.yoyoEase&&(!i._yoyo||!i._repeat)&&i._yoyo!==t&&(i.timeline?a(i.timeline,t):(s=i._ease,i._ease=i._yEase,i._yEase=s,i._yoyo=t)),i=i._next},qs=function(e,t){return e&&(ti(e)?e:wt[e]||RS(e))||t},sr=function(e,t,i,s){i===void 0&&(i=function(h){return 1-t(1-h)}),s===void 0&&(s=function(h){return h<.5?t(h*2)/2:1-t((1-h)*2)/2});var r={easeIn:t,easeOut:i,easeInOut:s},o;return Hi(e,function(l){wt[l]=en[l]=r,wt[o=l.toLowerCase()]=i;for(var h in r)wt[o+(h==="easeIn"?".in":h==="easeOut"?".out":".inOut")]=wt[l+"."+h]=r[h]}),r},Om=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},Ic=function a(e,t,i){var s=t>=1?t:1,r=(i||(e?.3:.45))/(t<1?t:1),o=r/dh*(Math.asin(1/s)||0),l=function(f){return f===1?1:s*Math.pow(2,-10*f)*nS((f-o)*r)+1},h=e==="out"?l:e==="in"?function(d){return 1-l(1-d)}:Om(l);return r=dh/r,h.config=function(d,f){return a(e,d,f)},h},Lc=function a(e,t){t===void 0&&(t=1.70158);var i=function(o){return o?--o*o*((t+1)*o+t)+1:0},s=e==="out"?i:e==="in"?function(r){return 1-i(1-r)}:Om(i);return s.config=function(r){return a(e,r)},s};Hi("Linear,Quad,Cubic,Quart,Quint,Strong",function(a,e){var t=e<5?e+1:e;sr(a+",Power"+(t-1),e?function(i){return Math.pow(i,t)}:function(i){return i},function(i){return 1-Math.pow(1-i,t)},function(i){return i<.5?Math.pow(i*2,t)/2:1-Math.pow((1-i)*2,t)/2})});wt.Linear.easeNone=wt.none=wt.Linear.easeIn;sr("Elastic",Ic("in"),Ic("out"),Ic());(function(a,e){var t=1/e,i=2*t,s=2.5*t,r=function(l){return l<t?a*l*l:l<i?a*Math.pow(l-1.5/e,2)+.75:l<s?a*(l-=2.25/e)*l+.9375:a*Math.pow(l-2.625/e,2)+.984375};sr("Bounce",function(o){return 1-r(1-o)},r)})(7.5625,2.75);sr("Expo",function(a){return a?Math.pow(2,10*(a-1)):0});sr("Circ",function(a){return-(am(1-a*a)-1)});sr("Sine",function(a){return a===1?1:-iS(a*eS)+1});sr("Back",Lc("in"),Lc("out"),Lc());wt.SteppedEase=wt.steps=en.SteppedEase={config:function(e,t){e===void 0&&(e=1);var i=1/e,s=e+(t?0:1),r=t?1:0,o=1-zt;return function(l){return((s*oa(0,o,l)|0)+r)*i}}};Jr.ease=wt["quad.out"];Hi("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(a){return ru+=a+","+a+"Params,"});var Um=function(e,t){this.id=tS++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:gm,this.set=t?t.getSetter:hu},Zo=function(){function a(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,to(this,+t.duration,1,1),this.data=t.data,qt&&(this._ctx=qt,qt.data.push(this)),$o||Zi.wake()}var e=a.prototype;return e.delay=function(i){return i||i===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+i-this._delay),this._delay=i,this):this._delay},e.duration=function(i){return arguments.length?this.totalDuration(this._repeat>0?i+(i+this._rDelay)*this._repeat:i):this.totalDuration()&&this._dur},e.totalDuration=function(i){return arguments.length?(this._dirty=0,to(this,this._repeat<0?i:(i-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(i,s){if(io(),!arguments.length)return this._tTime;var r=this._dp;if(r&&r.smoothChildTiming&&this._ts){for(Ol(this,i),!r._dp||r.parent||bm(r,this);r&&r.parent;)r.parent._time!==r._start+(r._ts>=0?r._tTime/r._ts:(r.totalDuration()-r._tTime)/-r._ts)&&r.totalTime(r._tTime,!0),r=r.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&i<this._tDur||this._ts<0&&i>0||!this._tDur&&!i)&&En(this._dp,this,this._start-this._delay)}return(this._tTime!==i||!this._dur&&!s||this._initted&&Math.abs(this._zTime)===zt||!i&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=i),vm(this,i,s)),this},e.time=function(i,s){return arguments.length?this.totalTime(Math.min(this.totalDuration(),i+Ff(this))%(this._dur+this._rDelay)||(i?this._dur:0),s):this._time},e.totalProgress=function(i,s){return arguments.length?this.totalTime(this.totalDuration()*i,s):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},e.progress=function(i,s){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-i:i)+Ff(this),s):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(i,s){var r=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(i-1)*r,s):this._repeat?eo(this._tTime,r)+1:1},e.timeScale=function(i,s){if(!arguments.length)return this._rts===-zt?0:this._rts;if(this._rts===i)return this;var r=this.parent&&this._ts?Sl(this.parent._time,this):this._tTime;return this._rts=+i||0,this._ts=this._ps||i===-zt?0:this._rts,this.totalTime(oa(-Math.abs(this._delay),this._tDur,r),s!==!1),Nl(this),hS(this)},e.paused=function(i){return arguments.length?(this._ps!==i&&(this._ps=i,i?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(io(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==zt&&(this._tTime-=zt)))),this):this._ps},e.startTime=function(i){if(arguments.length){this._start=i;var s=this.parent||this._dp;return s&&(s._sort||!this.parent)&&En(s,this,i-this._delay),this}return this._start},e.endTime=function(i){return this._start+(Vi(i)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(i){var s=this.parent||this._dp;return s?i&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Sl(s.rawTime(i),this):this._tTime:this._tTime},e.revert=function(i){i===void 0&&(i=oS);var s=Li;return Li=i,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(i),this.totalTime(-.01,i.suppressEvents)),this.data!=="nested"&&i.kill!==!1&&this.kill(),Li=s,this},e.globalTime=function(i){for(var s=this,r=arguments.length?i:s.rawTime();s;)r=s._start+r/(Math.abs(s._ts)||1),s=s._dp;return!this.parent&&this._sat?this._sat.globalTime(i):r},e.repeat=function(i){return arguments.length?(this._repeat=i===1/0?-2:i,Bf(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(i){if(arguments.length){var s=this._time;return this._rDelay=i,Bf(this),s?this.time(s):this}return this._rDelay},e.yoyo=function(i){return arguments.length?(this._yoyo=i,this):this._yoyo},e.seek=function(i,s){return this.totalTime(nn(this,i),Vi(s))},e.restart=function(i,s){return this.play().totalTime(i?-this._delay:0,Vi(s))},e.play=function(i,s){return i!=null&&this.seek(i,s),this.reversed(!1).paused(!1)},e.reverse=function(i,s){return i!=null&&this.seek(i||this.totalDuration(),s),this.reversed(!0).paused(!1)},e.pause=function(i,s){return i!=null&&this.seek(i,s),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(i){return arguments.length?(!!i!==this.reversed()&&this.timeScale(-this._rts||(i?-zt:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-zt,this},e.isActive=function(){var i=this.parent||this._dp,s=this._start,r;return!!(!i||this._ts&&this._initted&&i.isActive()&&(r=i.rawTime(!0))>=s&&r<this.endTime(!0)-zt)},e.eventCallback=function(i,s,r){var o=this.vars;return arguments.length>1?(s?(o[i]=s,r&&(o[i+"Params"]=r),i==="onUpdate"&&(this._onUpdate=s)):delete o[i],this):o[i]},e.then=function(i){var s=this;return new Promise(function(r){var o=ti(i)?i:ym,l=function(){var d=s.then;s.then=null,ti(o)&&(o=o(s))&&(o.then||o===s)&&(s.then=d),r(o),s.then=d};s._initted&&s.totalProgress()===1&&s._ts>=0||!s._tTime&&s._ts<0?l():s._prom=l})},e.kill=function(){Ro(this)},a}();ln(Zo.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-zt,_prom:0,_ps:!1,_rts:1});var Oi=function(a){om(e,a);function e(i,s){var r;return i===void 0&&(i={}),r=a.call(this,i)||this,r.labels={},r.smoothChildTiming=!!i.smoothChildTiming,r.autoRemoveChildren=!!i.autoRemoveChildren,r._sort=Vi(i.sortChildren),$t&&En(i.parent||$t,Xn(r),s),i.reversed&&r.reverse(),i.paused&&r.paused(!0),i.scrollTrigger&&wm(Xn(r),i.scrollTrigger),r}var t=e.prototype;return t.to=function(s,r,o){return Do(0,arguments,this),this},t.from=function(s,r,o){return Do(1,arguments,this),this},t.fromTo=function(s,r,o,l){return Do(2,arguments,this),this},t.set=function(s,r,o){return r.duration=0,r.parent=this,Bo(r).repeatDelay||(r.repeat=0),r.immediateRender=!!r.immediateRender,new ai(s,r,nn(this,o),1),this},t.call=function(s,r,o){return En(this,ai.delayedCall(0,s,r),o)},t.staggerTo=function(s,r,o,l,h,d,f){return o.duration=r,o.stagger=o.stagger||l,o.onComplete=d,o.onCompleteParams=f,o.parent=this,new ai(s,o,nn(this,h)),this},t.staggerFrom=function(s,r,o,l,h,d,f){return o.runBackwards=1,Bo(o).immediateRender=Vi(o.immediateRender),this.staggerTo(s,r,o,l,h,d,f)},t.staggerFromTo=function(s,r,o,l,h,d,f,c){return l.startAt=o,Bo(l).immediateRender=Vi(l.immediateRender),this.staggerTo(s,r,l,h,d,f,c)},t.render=function(s,r,o){var l=this._time,h=this._dirty?this.totalDuration():this._tDur,d=this._dur,f=s<=0?0:yi(s),c=this._zTime<0!=s<0&&(this._initted||!d),u,p,m,_,g,v,y,x,b,S,A,E;if(this!==$t&&f>h&&s>=0&&(f=h),f!==this._tTime||o||c){if(l!==this._time&&d&&(f+=this._time-l,s+=this._time-l),u=f,b=this._start,x=this._ts,v=!x,c&&(d||(l=this._zTime),(s||!r)&&(this._zTime=s)),this._repeat){if(A=this._yoyo,g=d+this._rDelay,this._repeat<-1&&s<0)return this.totalTime(g*100+s,r,o);if(u=yi(f%g),f===h?(_=this._repeat,u=d):(_=~~(f/g),_&&_===f/g&&(u=d,_--),u>d&&(u=d)),S=eo(this._tTime,g),!l&&this._tTime&&S!==_&&this._tTime-S*g-this._dur<=0&&(S=_),A&&_&1&&(u=d-u,E=1),_!==S&&!this._lock){var R=A&&S&1,M=R===(A&&_&1);if(_<S&&(R=!R),l=R?0:f%d?d:f,this._lock=1,this.render(l||(E?0:yi(_*g)),r,!d)._lock=0,this._tTime=f,!r&&this.parent&&Ki(this,"onRepeat"),this.vars.repeatRefresh&&!E&&(this.invalidate()._lock=1),l&&l!==this._time||v!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(d=this._dur,h=this._tDur,M&&(this._lock=2,l=R?d:-1e-4,this.render(l,!0),this.vars.repeatRefresh&&!E&&this.invalidate()),this._lock=0,!this._ts&&!v)return this;Nm(this,E)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(y=pS(this,yi(l),yi(u)),y&&(f-=u-(u=y._start))),this._tTime=f,this._time=u,this._act=!x,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=s,l=0),!l&&u&&!r&&!_&&(Ki(this,"onStart"),this._tTime!==f))return this;if(u>=l&&s>=0)for(p=this._first;p;){if(m=p._next,(p._act||u>=p._start)&&p._ts&&y!==p){if(p.parent!==this)return this.render(s,r,o);if(p.render(p._ts>0?(u-p._start)*p._ts:(p._dirty?p.totalDuration():p._tDur)+(u-p._start)*p._ts,r,o),u!==this._time||!this._ts&&!v){y=0,m&&(f+=this._zTime=-zt);break}}p=m}else{p=this._last;for(var w=s<0?s:u;p;){if(m=p._prev,(p._act||w<=p._end)&&p._ts&&y!==p){if(p.parent!==this)return this.render(s,r,o);if(p.render(p._ts>0?(w-p._start)*p._ts:(p._dirty?p.totalDuration():p._tDur)+(w-p._start)*p._ts,r,o||Li&&(p._initted||p._startAt)),u!==this._time||!this._ts&&!v){y=0,m&&(f+=this._zTime=w?-zt:zt);break}}p=m}}if(y&&!r&&(this.pause(),y.render(u>=l?0:-zt)._zTime=u>=l?1:-1,this._ts))return this._start=b,Nl(this),this.render(s,r,o);this._onUpdate&&!r&&Ki(this,"onUpdate",!0),(f===h&&this._tTime>=this.totalDuration()||!f&&l)&&(b===this._start||Math.abs(x)!==Math.abs(this._ts))&&(this._lock||((s||!d)&&(f===h&&this._ts>0||!f&&this._ts<0)&&Ms(this,1),!r&&!(s<0&&!l)&&(f||l||!h)&&(Ki(this,f===h&&s>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(f<h&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(s,r){var o=this;if(Jn(r)||(r=nn(this,r,s)),!(s instanceof Zo)){if(Fi(s))return s.forEach(function(l){return o.add(l,r)}),this;if(wi(s))return this.addLabel(s,r);if(ti(s))s=ai.delayedCall(0,s);else return this}return this!==s?En(this,s,r):this},t.getChildren=function(s,r,o,l){s===void 0&&(s=!0),r===void 0&&(r=!0),o===void 0&&(o=!0),l===void 0&&(l=-on);for(var h=[],d=this._first;d;)d._start>=l&&(d instanceof ai?r&&h.push(d):(o&&h.push(d),s&&h.push.apply(h,d.getChildren(!0,r,o)))),d=d._next;return h},t.getById=function(s){for(var r=this.getChildren(1,1,1),o=r.length;o--;)if(r[o].vars.id===s)return r[o]},t.remove=function(s){return wi(s)?this.removeLabel(s):ti(s)?this.killTweensOf(s):(kl(this,s),s===this._recent&&(this._recent=this._last),Ys(this))},t.totalTime=function(s,r){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=yi(Zi.time-(this._ts>0?s/this._ts:(this.totalDuration()-s)/-this._ts))),a.prototype.totalTime.call(this,s,r),this._forcing=0,this):this._tTime},t.addLabel=function(s,r){return this.labels[s]=nn(this,r),this},t.removeLabel=function(s){return delete this.labels[s],this},t.addPause=function(s,r,o){var l=ai.delayedCall(0,r||Yo,o);return l.data="isPause",this._hasPause=1,En(this,l,nn(this,s))},t.removePause=function(s){var r=this._first;for(s=nn(this,s);r;)r._start===s&&r.data==="isPause"&&Ms(r),r=r._next},t.killTweensOf=function(s,r,o){for(var l=this.getTweensOf(s,o),h=l.length;h--;)ps!==l[h]&&l[h].kill(s,r);return this},t.getTweensOf=function(s,r){for(var o=[],l=an(s),h=this._first,d=Jn(r),f;h;)h instanceof ai?aS(h._targets,l)&&(d?(!ps||h._initted&&h._ts)&&h.globalTime(0)<=r&&h.globalTime(h.totalDuration())>r:!r||h.isActive())&&o.push(h):(f=h.getTweensOf(l,r)).length&&o.push.apply(o,f),h=h._next;return o},t.tweenTo=function(s,r){r=r||{};var o=this,l=nn(o,s),h=r,d=h.startAt,f=h.onStart,c=h.onStartParams,u=h.immediateRender,p,m=ai.to(o,ln({ease:r.ease||"none",lazy:!1,immediateRender:!1,time:l,overwrite:"auto",duration:r.duration||Math.abs((l-(d&&"time"in d?d.time:o._time))/o.timeScale())||zt,onStart:function(){if(o.pause(),!p){var g=r.duration||Math.abs((l-(d&&"time"in d?d.time:o._time))/o.timeScale());m._dur!==g&&to(m,g,0,1).render(m._time,!0,!0),p=1}f&&f.apply(m,c||[])}},r));return u?m.render(0):m},t.tweenFromTo=function(s,r,o){return this.tweenTo(r,ln({startAt:{time:nn(this,s)}},o))},t.recent=function(){return this._recent},t.nextLabel=function(s){return s===void 0&&(s=this._time),Df(this,nn(this,s))},t.previousLabel=function(s){return s===void 0&&(s=this._time),Df(this,nn(this,s),1)},t.currentLabel=function(s){return arguments.length?this.seek(s,!0):this.previousLabel(this._time+zt)},t.shiftChildren=function(s,r,o){o===void 0&&(o=0);for(var l=this._first,h=this.labels,d;l;)l._start>=o&&(l._start+=s,l._end+=s),l=l._next;if(r)for(d in h)h[d]>=o&&(h[d]+=s);return Ys(this)},t.invalidate=function(s){var r=this._first;for(this._lock=0;r;)r.invalidate(s),r=r._next;return a.prototype.invalidate.call(this,s)},t.clear=function(s){s===void 0&&(s=!0);for(var r=this._first,o;r;)o=r._next,this.remove(r),r=o;return this._dp&&(this._time=this._tTime=this._pTime=0),s&&(this.labels={}),Ys(this)},t.totalDuration=function(s){var r=0,o=this,l=o._last,h=on,d,f,c;if(arguments.length)return o.timeScale((o._repeat<0?o.duration():o.totalDuration())/(o.reversed()?-s:s));if(o._dirty){for(c=o.parent;l;)d=l._prev,l._dirty&&l.totalDuration(),f=l._start,f>h&&o._sort&&l._ts&&!o._lock?(o._lock=1,En(o,l,f-l._delay,1)._lock=0):h=f,f<0&&l._ts&&(r-=f,(!c&&!o._dp||c&&c.smoothChildTiming)&&(o._start+=f/o._ts,o._time-=f,o._tTime-=f),o.shiftChildren(-f,!1,-1/0),h=0),l._end>r&&l._ts&&(r=l._end),l=d;to(o,o===$t&&o._time>r?o._time:r,1,1),o._dirty=0}return o._tDur},e.updateRoot=function(s){if($t._ts&&(vm($t,Sl(s,$t)),mm=Zi.frame),Zi.frame>=If){If+=Ji.autoSleep||120;var r=$t._first;if((!r||!r._ts)&&Ji.autoSleep&&Zi._listeners.length<2){for(;r&&!r._ts;)r=r._next;r||Zi.sleep()}}},e}(Zo);ln(Oi.prototype,{_lock:0,_hasPause:0,_forcing:0});var PS=function(e,t,i,s,r,o,l){var h=new Gi(this._pt,e,t,0,1,Xm,null,r),d=0,f=0,c,u,p,m,_,g,v,y;for(h.b=i,h.e=s,i+="",s+="",(v=~s.indexOf("random("))&&(s=qo(s)),o&&(y=[i,s],o(y,e,t),i=y[0],s=y[1]),u=i.match(Cc)||[];c=Cc.exec(s);)m=c[0],_=s.substring(d,c.index),p?p=(p+1)%5:_.substr(-5)==="rgba("&&(p=1),m!==u[f++]&&(g=parseFloat(u[f-1])||0,h._pt={_next:h._pt,p:_||f===1?_:",",s:g,c:m.charAt(1)==="="?Gr(g,m)-g:parseFloat(m)-g,m:p&&p<4?Math.round:0},d=Cc.lastIndex);return h.c=d<s.length?s.substring(d,s.length):"",h.fp=l,(hm.test(s)||v)&&(h.e=0),this._pt=h,h},au=function(e,t,i,s,r,o,l,h,d,f){ti(s)&&(s=s(r||0,e,o));var c=e[t],u=i!=="get"?i:ti(c)?d?e[t.indexOf("set")||!ti(e["get"+t.substr(3)])?t:"get"+t.substr(3)](d):e[t]():c,p=ti(c)?d?DS:Gm:cu,m;if(wi(s)&&(~s.indexOf("random(")&&(s=qo(s)),s.charAt(1)==="="&&(m=Gr(u,s)+(Ii(u)||0),(m||m===0)&&(s=m))),!f||u!==s||bh)return!isNaN(u*s)&&s!==""?(m=new Gi(this._pt,e,t,+u||0,s-(u||0),typeof c=="boolean"?NS:Wm,0,p),d&&(m.fp=d),l&&m.modifier(l,this,e),this._pt=m):(!c&&!(t in e)&&nu(t,s),PS.call(this,e,t,u,s,p,h||Ji.stringFilter,d))},IS=function(e,t,i,s,r){if(ti(e)&&(e=ko(e,r,t,i,s)),!Fn(e)||e.style&&e.nodeType||Fi(e)||lm(e))return wi(e)?ko(e,r,t,i,s):e;var o={},l;for(l in e)o[l]=ko(e[l],r,t,i,s);return o},zm=function(e,t,i,s,r,o){var l,h,d,f;if($i[e]&&(l=new $i[e]).init(r,l.rawVars?t[e]:IS(t[e],s,r,o,i),i,s,o)!==!1&&(i._pt=h=new Gi(i._pt,r,e,0,1,l.render,l,0,l.priority),i!==kr))for(d=i._ptLookup[i._targets.indexOf(r)],f=l._props.length;f--;)d[l._props[f]]=h;return l},ps,bh,lu=function a(e,t,i){var s=e.vars,r=s.ease,o=s.startAt,l=s.immediateRender,h=s.lazy,d=s.onUpdate,f=s.runBackwards,c=s.yoyoEase,u=s.keyframes,p=s.autoRevert,m=e._dur,_=e._startAt,g=e._targets,v=e.parent,y=v&&v.data==="nested"?v.vars.targets:g,x=e._overwrite==="auto"&&!Jh,b=e.timeline,S,A,E,R,M,w,L,N,B,G,W,ee,z;if(b&&(!u||!r)&&(r="none"),e._ease=qs(r,Jr.ease),e._yEase=c?km(qs(c===!0?r:c,Jr.ease)):0,c&&e._yoyo&&!e._repeat&&(c=e._yEase,e._yEase=e._ease,e._ease=c),e._from=!b&&!!s.runBackwards,!b||u&&!s.stagger){if(N=g[0]?js(g[0]).harness:0,ee=N&&s[N.prop],S=Ml(s,su),_&&(_._zTime<0&&_.progress(1),t<0&&f&&l&&!p?_.render(-1,!0):_.revert(f&&m?il:rS),_._lazy=0),o){if(Ms(e._startAt=ai.set(g,ln({data:"isStart",overwrite:!1,parent:v,immediateRender:!0,lazy:!_&&Vi(h),startAt:null,delay:0,onUpdate:d&&function(){return Ki(e,"onUpdate")},stagger:0},o))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Li||!l&&!p)&&e._startAt.revert(il),l&&m&&t<=0&&i<=0){t&&(e._zTime=t);return}}else if(f&&m&&!_){if(t&&(l=!1),E=ln({overwrite:!1,data:"isFromStart",lazy:l&&!_&&Vi(h),immediateRender:l,stagger:0,parent:v},S),ee&&(E[N.prop]=ee),Ms(e._startAt=ai.set(g,E)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Li?e._startAt.revert(il):e._startAt.render(-1,!0)),e._zTime=t,!l)a(e._startAt,zt,zt);else if(!t)return}for(e._pt=e._ptCache=0,h=m&&Vi(h)||h&&!m,A=0;A<g.length;A++){if(M=g[A],L=M._gsap||ou(g)[A]._gsap,e._ptLookup[A]=G={},mh[L.id]&&_s.length&&wl(),W=y===g?A:y.indexOf(M),N&&(B=new N).init(M,ee||S,e,W,y)!==!1&&(e._pt=R=new Gi(e._pt,M,B.name,0,1,B.render,B,0,B.priority),B._props.forEach(function(k){G[k]=R}),B.priority&&(w=1)),!N||ee)for(E in S)$i[E]&&(B=zm(E,S,e,W,M,y))?B.priority&&(w=1):G[E]=R=au.call(e,M,E,"get",S[E],W,y,0,s.stringFilter);e._op&&e._op[A]&&e.kill(M,e._op[A]),x&&e._pt&&(ps=e,$t.killTweensOf(M,G,e.globalTime(t)),z=!e.parent,ps=0),e._pt&&h&&(mh[L.id]=1)}w&&jm(e),e._onInit&&e._onInit(e)}e._onUpdate=d,e._initted=(!e._op||e._pt)&&!z,u&&t<=0&&b.render(on,!0,!0)},LS=function(e,t,i,s,r,o,l,h){var d=(e._pt&&e._ptCache||(e._ptCache={}))[t],f,c,u,p;if(!d)for(d=e._ptCache[t]=[],u=e._ptLookup,p=e._targets.length;p--;){if(f=u[p][t],f&&f.d&&f.d._pt)for(f=f.d._pt;f&&f.p!==t&&f.fp!==t;)f=f._next;if(!f)return bh=1,e.vars[t]="+=0",lu(e,l),bh=0,h?jo(t+" not eligible for reset"):1;d.push(f)}for(p=d.length;p--;)c=d[p],f=c._pt||c,f.s=(s||s===0)&&!r?s:f.s+(s||0)+o*f.c,f.c=i-f.s,c.e&&(c.e=si(i)+Ii(c.e)),c.b&&(c.b=f.s+Ii(c.b))},FS=function(e,t){var i=e[0]?js(e[0]).harness:0,s=i&&i.aliases,r,o,l,h;if(!s)return t;r=Js({},t);for(o in s)if(o in r)for(h=s[o].split(","),l=h.length;l--;)r[h[l]]=r[o];return r},BS=function(e,t,i,s){var r=t.ease||s||"power1.inOut",o,l;if(Fi(t))l=i[e]||(i[e]=[]),t.forEach(function(h,d){return l.push({t:d/(t.length-1)*100,v:h,e:r})});else for(o in t)l=i[o]||(i[o]=[]),o==="ease"||l.push({t:parseFloat(e),v:t[o],e:r})},ko=function(e,t,i,s,r){return ti(e)?e.call(t,i,s,r):wi(e)&&~e.indexOf("random(")?qo(e):e},Vm=ru+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",Hm={};Hi(Vm+",id,stagger,delay,duration,paused,scrollTrigger",function(a){return Hm[a]=1});var ai=function(a){om(e,a);function e(i,s,r,o){var l;typeof s=="number"&&(r.duration=s,s=r,r=null),l=a.call(this,o?s:Bo(s))||this;var h=l.vars,d=h.duration,f=h.delay,c=h.immediateRender,u=h.stagger,p=h.overwrite,m=h.keyframes,_=h.defaults,g=h.scrollTrigger,v=h.yoyoEase,y=s.parent||$t,x=(Fi(i)||lm(i)?Jn(i[0]):"length"in s)?[i]:an(i),b,S,A,E,R,M,w,L;if(l._targets=x.length?ou(x):jo("GSAP target "+i+" not found. https://gsap.com",!Ji.nullTargetWarn)||[],l._ptLookup=[],l._overwrite=p,m||u||$a(d)||$a(f)){if(s=l.vars,b=l.timeline=new Oi({data:"nested",defaults:_||{},targets:y&&y.data==="nested"?y.vars.targets:x}),b.kill(),b.parent=b._dp=Xn(l),b._start=0,u||$a(d)||$a(f)){if(E=x.length,w=u&&Em(u),Fn(u))for(R in u)~Vm.indexOf(R)&&(L||(L={}),L[R]=u[R]);for(S=0;S<E;S++)A=Ml(s,Hm),A.stagger=0,v&&(A.yoyoEase=v),L&&Js(A,L),M=x[S],A.duration=+ko(d,Xn(l),S,M,x),A.delay=(+ko(f,Xn(l),S,M,x)||0)-l._delay,!u&&E===1&&A.delay&&(l._delay=f=A.delay,l._start+=f,A.delay=0),b.to(M,A,w?w(S,M,x):0),b._ease=wt.none;b.duration()?d=f=0:l.timeline=0}else if(m){Bo(ln(b.vars.defaults,{ease:"none"})),b._ease=qs(m.ease||s.ease||"none");var N=0,B,G,W;if(Fi(m))m.forEach(function(ee){return b.to(x,ee,">")}),b.duration();else{A={};for(R in m)R==="ease"||R==="easeEach"||BS(R,m[R],A,m.easeEach);for(R in A)for(B=A[R].sort(function(ee,z){return ee.t-z.t}),N=0,S=0;S<B.length;S++)G=B[S],W={ease:G.e,duration:(G.t-(S?B[S-1].t:0))/100*d},W[R]=G.v,b.to(x,W,N),N+=W.duration;b.duration()<d&&b.to({},{duration:d-b.duration()})}}d||l.duration(d=b.duration())}else l.timeline=0;return p===!0&&!Jh&&(ps=Xn(l),$t.killTweensOf(x),ps=0),En(y,Xn(l),r),s.reversed&&l.reverse(),s.paused&&l.paused(!0),(c||!d&&!m&&l._start===yi(y._time)&&Vi(c)&&uS(Xn(l))&&y.data!=="nested")&&(l._tTime=-zt,l.render(Math.max(0,-f)||0)),g&&wm(Xn(l),g),l}var t=e.prototype;return t.render=function(s,r,o){var l=this._time,h=this._tDur,d=this._dur,f=s<0,c=s>h-zt&&!f?h:s<zt?0:s,u,p,m,_,g,v,y,x,b;if(!d)fS(this,s,r,o);else if(c!==this._tTime||!s||o||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==f){if(u=c,x=this.timeline,this._repeat){if(_=d+this._rDelay,this._repeat<-1&&f)return this.totalTime(_*100+s,r,o);if(u=yi(c%_),c===h?(m=this._repeat,u=d):(m=~~(c/_),m&&m===yi(c/_)&&(u=d,m--),u>d&&(u=d)),v=this._yoyo&&m&1,v&&(b=this._yEase,u=d-u),g=eo(this._tTime,_),u===l&&!o&&this._initted&&m===g)return this._tTime=c,this;m!==g&&(x&&this._yEase&&Nm(x,v),this.vars.repeatRefresh&&!v&&!this._lock&&this._time!==_&&this._initted&&(this._lock=o=1,this.render(yi(_*m),!0).invalidate()._lock=0))}if(!this._initted){if(Mm(this,f?s:u,o,r,c))return this._tTime=0,this;if(l!==this._time&&!(o&&this.vars.repeatRefresh&&m!==g))return this;if(d!==this._dur)return this.render(s,r,o)}if(this._tTime=c,this._time=u,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=y=(b||this._ease)(u/d),this._from&&(this.ratio=y=1-y),u&&!l&&!r&&!m&&(Ki(this,"onStart"),this._tTime!==c))return this;for(p=this._pt;p;)p.r(y,p.d),p=p._next;x&&x.render(s<0?s:x._dur*x._ease(u/this._dur),r,o)||this._startAt&&(this._zTime=s),this._onUpdate&&!r&&(f&&gh(this,s,r,o),Ki(this,"onUpdate")),this._repeat&&m!==g&&this.vars.onRepeat&&!r&&this.parent&&Ki(this,"onRepeat"),(c===this._tDur||!c)&&this._tTime===c&&(f&&!this._onUpdate&&gh(this,s,!0,!0),(s||!d)&&(c===this._tDur&&this._ts>0||!c&&this._ts<0)&&Ms(this,1),!r&&!(f&&!l)&&(c||l||v)&&(Ki(this,c===h?"onComplete":"onReverseComplete",!0),this._prom&&!(c<h&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(s){return(!s||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(s),a.prototype.invalidate.call(this,s)},t.resetTo=function(s,r,o,l,h){$o||Zi.wake(),this._ts||this.play();var d=Math.min(this._dur,(this._dp._time-this._start)*this._ts),f;return this._initted||lu(this,d),f=this._ease(d/this._dur),LS(this,s,r,o,l,f,d,h)?this.resetTo(s,r,o,l,1):(Ol(this,0),this.parent||xm(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(s,r){if(r===void 0&&(r="all"),!s&&(!r||r==="all"))return this._lazy=this._pt=0,this.parent?Ro(this):this;if(this.timeline){var o=this.timeline.totalDuration();return this.timeline.killTweensOf(s,r,ps&&ps.vars.overwrite!==!0)._first||Ro(this),this.parent&&o!==this.timeline.totalDuration()&&to(this,this._dur*this.timeline._tDur/o,0,1),this}var l=this._targets,h=s?an(s):l,d=this._ptLookup,f=this._pt,c,u,p,m,_,g,v;if((!r||r==="all")&&cS(l,h))return r==="all"&&(this._pt=0),Ro(this);for(c=this._op=this._op||[],r!=="all"&&(wi(r)&&(_={},Hi(r,function(y){return _[y]=1}),r=_),r=FS(l,r)),v=l.length;v--;)if(~h.indexOf(l[v])){u=d[v],r==="all"?(c[v]=r,m=u,p={}):(p=c[v]=c[v]||{},m=r);for(_ in m)g=u&&u[_],g&&((!("kill"in g.d)||g.d.kill(_)===!0)&&kl(this,g,"_pt"),delete u[_]),p!=="all"&&(p[_]=1)}return this._initted&&!this._pt&&f&&Ro(this),this},e.to=function(s,r){return new e(s,r,arguments[2])},e.from=function(s,r){return Do(1,arguments)},e.delayedCall=function(s,r,o,l){return new e(r,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:s,onComplete:r,onReverseComplete:r,onCompleteParams:o,onReverseCompleteParams:o,callbackScope:l})},e.fromTo=function(s,r,o){return Do(2,arguments)},e.set=function(s,r){return r.duration=0,r.repeatDelay||(r.repeat=0),new e(s,r)},e.killTweensOf=function(s,r,o){return $t.killTweensOf(s,r,o)},e}(Zo);ln(ai.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Hi("staggerTo,staggerFrom,staggerFromTo",function(a){ai[a]=function(){var e=new Oi,t=_h.call(arguments,0);return t.splice(a==="staggerFromTo"?5:4,0,0),e[a].apply(e,t)}});var cu=function(e,t,i){return e[t]=i},Gm=function(e,t,i){return e[t](i)},DS=function(e,t,i,s){return e[t](s.fp,i)},kS=function(e,t,i){return e.setAttribute(t,i)},hu=function(e,t){return ti(e[t])?Gm:eu(e[t])&&e.setAttribute?kS:cu},Wm=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},NS=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},Xm=function(e,t){var i=t._pt,s="";if(!e&&t.b)s=t.b;else if(e===1&&t.e)s=t.e;else{for(;i;)s=i.p+(i.m?i.m(i.s+i.c*e):Math.round((i.s+i.c*e)*1e4)/1e4)+s,i=i._next;s+=t.c}t.set(t.t,t.p,s,t)},uu=function(e,t){for(var i=t._pt;i;)i.r(e,i.d),i=i._next},OS=function(e,t,i,s){for(var r=this._pt,o;r;)o=r._next,r.p===s&&r.modifier(e,t,i),r=o},US=function(e){for(var t=this._pt,i,s;t;)s=t._next,t.p===e&&!t.op||t.op===e?kl(this,t,"_pt"):t.dep||(i=1),t=s;return!i},zS=function(e,t,i,s){s.mSet(e,t,s.m.call(s.tween,i,s.mt),s)},jm=function(e){for(var t=e._pt,i,s,r,o;t;){for(i=t._next,s=r;s&&s.pr>t.pr;)s=s._next;(t._prev=s?s._prev:o)?t._prev._next=t:r=t,(t._next=s)?s._prev=t:o=t,t=i}e._pt=r},Gi=function(){function a(t,i,s,r,o,l,h,d,f){this.t=i,this.s=r,this.c=o,this.p=s,this.r=l||Wm,this.d=h||this,this.set=d||cu,this.pr=f||0,this._next=t,t&&(t._prev=this)}var e=a.prototype;return e.modifier=function(i,s,r){this.mSet=this.mSet||this.set,this.set=zS,this.m=i,this.mt=r,this.tween=s},a}();Hi(ru+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(a){return su[a]=1});en.TweenMax=en.TweenLite=ai;en.TimelineLite=en.TimelineMax=Oi;$t=new Oi({sortChildren:!1,defaults:Jr,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});Ji.stringFilter=Dm;var $s=[],sl={},VS=[],Nf=0,HS=0,Fc=function(e){return(sl[e]||VS).map(function(t){return t()})},wh=function(){var e=Date.now(),t=[];e-Nf>2&&(Fc("matchMediaInit"),$s.forEach(function(i){var s=i.queries,r=i.conditions,o,l,h,d;for(l in s)o=Sn.matchMedia(s[l]).matches,o&&(h=1),o!==r[l]&&(r[l]=o,d=1);d&&(i.revert(),h&&t.push(i))}),Fc("matchMediaRevert"),t.forEach(function(i){return i.onMatch(i,function(s){return i.add(null,s)})}),Nf=e,Fc("matchMedia"))},Ym=function(){function a(t,i){this.selector=i&&yh(i),this.data=[],this._r=[],this.isReverted=!1,this.id=HS++,t&&this.add(t)}var e=a.prototype;return e.add=function(i,s,r){ti(i)&&(r=s,s=i,i=ti);var o=this,l=function(){var d=qt,f=o.selector,c;return d&&d!==o&&d.data.push(o),r&&(o.selector=yh(r)),qt=o,c=s.apply(o,arguments),ti(c)&&o._r.push(c),qt=d,o.selector=f,o.isReverted=!1,c};return o.last=l,i===ti?l(o,function(h){return o.add(null,h)}):i?o[i]=l:l},e.ignore=function(i){var s=qt;qt=null,i(this),qt=s},e.getTweens=function(){var i=[];return this.data.forEach(function(s){return s instanceof a?i.push.apply(i,s.getTweens()):s instanceof ai&&!(s.parent&&s.parent.data==="nested")&&i.push(s)}),i},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(i,s){var r=this;if(i?function(){for(var l=r.getTweens(),h=r.data.length,d;h--;)d=r.data[h],d.data==="isFlip"&&(d.revert(),d.getChildren(!0,!0,!1).forEach(function(f){return l.splice(l.indexOf(f),1)}));for(l.map(function(f){return{g:f._dur||f._delay||f._sat&&!f._sat.vars.immediateRender?f.globalTime(0):-1/0,t:f}}).sort(function(f,c){return c.g-f.g||-1/0}).forEach(function(f){return f.t.revert(i)}),h=r.data.length;h--;)d=r.data[h],d instanceof Oi?d.data!=="nested"&&(d.scrollTrigger&&d.scrollTrigger.revert(),d.kill()):!(d instanceof ai)&&d.revert&&d.revert(i);r._r.forEach(function(f){return f(i,r)}),r.isReverted=!0}():this.data.forEach(function(l){return l.kill&&l.kill()}),this.clear(),s)for(var o=$s.length;o--;)$s[o].id===this.id&&$s.splice(o,1)},e.revert=function(i){this.kill(i||{})},a}(),GS=function(){function a(t){this.contexts=[],this.scope=t,qt&&qt.data.push(this)}var e=a.prototype;return e.add=function(i,s,r){Fn(i)||(i={matches:i});var o=new Ym(0,r||this.scope),l=o.conditions={},h,d,f;qt&&!o.selector&&(o.selector=qt.selector),this.contexts.push(o),s=o.add("onMatch",s),o.queries=i;for(d in i)d==="all"?f=1:(h=Sn.matchMedia(i[d]),h&&($s.indexOf(o)<0&&$s.push(o),(l[d]=h.matches)&&(f=1),h.addListener?h.addListener(wh):h.addEventListener("change",wh)));return f&&s(o,function(c){return o.add(null,c)}),this},e.revert=function(i){this.kill(i||{})},e.kill=function(i){this.contexts.forEach(function(s){return s.kill(i,!0)})},a}(),Al={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(function(s){return Lm(s)})},timeline:function(e){return new Oi(e)},getTweensOf:function(e,t){return $t.getTweensOf(e,t)},getProperty:function(e,t,i,s){wi(e)&&(e=an(e)[0]);var r=js(e||{}).get,o=i?ym:_m;return i==="native"&&(i=""),e&&(t?o(($i[t]&&$i[t].get||r)(e,t,i,s)):function(l,h,d){return o(($i[l]&&$i[l].get||r)(e,l,h,d))})},quickSetter:function(e,t,i){if(e=an(e),e.length>1){var s=e.map(function(f){return Xi.quickSetter(f,t,i)}),r=s.length;return function(f){for(var c=r;c--;)s[c](f)}}e=e[0]||{};var o=$i[t],l=js(e),h=l.harness&&(l.harness.aliases||{})[t]||t,d=o?function(f){var c=new o;kr._pt=0,c.init(e,i?f+i:f,kr,0,[e]),c.render(1,c),kr._pt&&uu(1,kr)}:l.set(e,h);return o?d:function(f){return d(e,h,i?f+i:f,l,1)}},quickTo:function(e,t,i){var s,r=Xi.to(e,Js((s={},s[t]="+=0.1",s.paused=!0,s),i||{})),o=function(h,d,f){return r.resetTo(t,h,d,f)};return o.tween=r,o},isTweening:function(e){return $t.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=qs(e.ease,Jr.ease)),Lf(Jr,e||{})},config:function(e){return Lf(Ji,e||{})},registerEffect:function(e){var t=e.name,i=e.effect,s=e.plugins,r=e.defaults,o=e.extendTimeline;(s||"").split(",").forEach(function(l){return l&&!$i[l]&&!en[l]&&jo(t+" effect requires "+l+" plugin.")}),Rc[t]=function(l,h,d){return i(an(l),ln(h||{},r),d)},o&&(Oi.prototype[t]=function(l,h,d){return this.add(Rc[t](l,Fn(h)?h:(d=h)&&{},this),d)})},registerEase:function(e,t){wt[e]=qs(t)},parseEase:function(e,t){return arguments.length?qs(e,t):wt},getById:function(e){return $t.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var i=new Oi(e),s,r;for(i.smoothChildTiming=Vi(e.smoothChildTiming),$t.remove(i),i._dp=0,i._time=i._tTime=$t._time,s=$t._first;s;)r=s._next,(t||!(!s._dur&&s instanceof ai&&s.vars.onComplete===s._targets[0]))&&En(i,s,s._start-s._delay),s=r;return En($t,i,0),i},context:function(e,t){return e?new Ym(e,t):qt},matchMedia:function(e){return new GS(e)},matchMediaRefresh:function(){return $s.forEach(function(e){var t=e.conditions,i,s;for(s in t)t[s]&&(t[s]=!1,i=1);i&&e.revert()})||wh()},addEventListener:function(e,t){var i=sl[e]||(sl[e]=[]);~i.indexOf(t)||i.push(t)},removeEventListener:function(e,t){var i=sl[e],s=i&&i.indexOf(t);s>=0&&i.splice(s,1)},utils:{wrap:bS,wrapYoyo:wS,distribute:Em,random:Cm,snap:Tm,normalize:xS,getUnit:Ii,clamp:gS,splitColor:Fm,toArray:an,selector:yh,mapRange:Pm,pipe:_S,unitize:yS,interpolate:MS,shuffle:Am},install:fm,effects:Rc,ticker:Zi,updateRoot:Oi.updateRoot,plugins:$i,globalTimeline:$t,core:{PropTween:Gi,globals:pm,Tween:ai,Timeline:Oi,Animation:Zo,getCache:js,_removeLinkedListItem:kl,reverting:function(){return Li},context:function(e){return e&&qt&&(qt.data.push(e),e._ctx=qt),qt},suppressOverwrites:function(e){return Jh=e}}};Hi("to,from,fromTo,delayedCall,set,killTweensOf",function(a){return Al[a]=ai[a]});Zi.add(Oi.updateRoot);kr=Al.to({},{duration:0});var WS=function(e,t){for(var i=e._pt;i&&i.p!==t&&i.op!==t&&i.fp!==t;)i=i._next;return i},XS=function(e,t){var i=e._targets,s,r,o;for(s in t)for(r=i.length;r--;)o=e._ptLookup[r][s],o&&(o=o.d)&&(o._pt&&(o=WS(o,s)),o&&o.modifier&&o.modifier(t[s],e,i[r],s))},Bc=function(e,t){return{name:e,rawVars:1,init:function(s,r,o){o._onInit=function(l){var h,d;if(wi(r)&&(h={},Hi(r,function(f){return h[f]=1}),r=h),t){h={};for(d in r)h[d]=t(r[d]);r=h}XS(l,r)}}}},Xi=Al.registerPlugin({name:"attr",init:function(e,t,i,s,r){var o,l,h;this.tween=i;for(o in t)h=e.getAttribute(o)||"",l=this.add(e,"setAttribute",(h||0)+"",t[o],s,r,0,0,o),l.op=o,l.b=h,this._props.push(o)},render:function(e,t){for(var i=t._pt;i;)Li?i.set(i.t,i.p,i.b,i):i.r(e,i.d),i=i._next}},{name:"endArray",init:function(e,t){for(var i=t.length;i--;)this.add(e,i,e[i]||0,t[i],0,0,0,0,0,1)}},Bc("roundProps",xh),Bc("modifiers"),Bc("snap",Tm))||Al;ai.version=Oi.version=Xi.version="3.12.5";dm=1;tu()&&io();wt.Power0;wt.Power1;wt.Power2;wt.Power3;wt.Power4;wt.Linear;wt.Quad;wt.Cubic;wt.Quart;wt.Quint;wt.Strong;wt.Elastic;wt.Back;wt.SteppedEase;wt.Bounce;wt.Sine;wt.Expo;wt.Circ;/*!
 * CSSPlugin 3.12.5
 * https://gsap.com
 *
 * Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Of,ms,Wr,du,Xs,Uf,fu,jS=function(){return typeof window<"u"},es={},Vs=180/Math.PI,Xr=Math.PI/180,Ar=Math.atan2,zf=1e8,pu=/([A-Z])/g,YS=/(left|right|width|margin|padding|x)/i,qS=/[\s,\(]\S/,Rn={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Mh=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},$S=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},ZS=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},KS=function(e,t){var i=t.s+t.c*e;t.set(t.t,t.p,~~(i+(i<0?-.5:.5))+t.u,t)},qm=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},$m=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},QS=function(e,t,i){return e.style[t]=i},JS=function(e,t,i){return e.style.setProperty(t,i)},eA=function(e,t,i){return e._gsap[t]=i},tA=function(e,t,i){return e._gsap.scaleX=e._gsap.scaleY=i},iA=function(e,t,i,s,r){var o=e._gsap;o.scaleX=o.scaleY=i,o.renderTransform(r,o)},nA=function(e,t,i,s,r){var o=e._gsap;o[t]=i,o.renderTransform(r,o)},Kt="transform",Wi=Kt+"Origin",sA=function a(e,t){var i=this,s=this.target,r=s.style,o=s._gsap;if(e in es&&r){if(this.tfm=this.tfm||{},e!=="transform")e=Rn[e]||e,~e.indexOf(",")?e.split(",").forEach(function(l){return i.tfm[l]=jn(s,l)}):this.tfm[e]=o.x?o[e]:jn(s,e),e===Wi&&(this.tfm.zOrigin=o.zOrigin);else return Rn.transform.split(",").forEach(function(l){return a.call(i,l,t)});if(this.props.indexOf(Kt)>=0)return;o.svg&&(this.svgo=s.getAttribute("data-svg-origin"),this.props.push(Wi,t,"")),e=Kt}(r||t)&&this.props.push(e,t,r[e])},Zm=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},rA=function(){var e=this.props,t=this.target,i=t.style,s=t._gsap,r,o;for(r=0;r<e.length;r+=3)e[r+1]?t[e[r]]=e[r+2]:e[r+2]?i[e[r]]=e[r+2]:i.removeProperty(e[r].substr(0,2)==="--"?e[r]:e[r].replace(pu,"-$1").toLowerCase());if(this.tfm){for(o in this.tfm)s[o]=this.tfm[o];s.svg&&(s.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),r=fu(),(!r||!r.isStart)&&!i[Kt]&&(Zm(i),s.zOrigin&&i[Wi]&&(i[Wi]+=" "+s.zOrigin+"px",s.zOrigin=0,s.renderTransform()),s.uncache=1)}},Km=function(e,t){var i={target:e,props:[],revert:rA,save:sA};return e._gsap||Xi.core.getCache(e),t&&t.split(",").forEach(function(s){return i.save(s)}),i},Qm,Sh=function(e,t){var i=ms.createElementNS?ms.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):ms.createElement(e);return i&&i.style?i:ms.createElement(e)},Pn=function a(e,t,i){var s=getComputedStyle(e);return s[t]||s.getPropertyValue(t.replace(pu,"-$1").toLowerCase())||s.getPropertyValue(t)||!i&&a(e,no(t)||t,1)||""},Vf="O,Moz,ms,Ms,Webkit".split(","),no=function(e,t,i){var s=t||Xs,r=s.style,o=5;if(e in r&&!i)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);o--&&!(Vf[o]+e in r););return o<0?null:(o===3?"ms":o>=0?Vf[o]:"")+e},Ah=function(){jS()&&window.document&&(Of=window,ms=Of.document,Wr=ms.documentElement,Xs=Sh("div")||{style:{}},Sh("div"),Kt=no(Kt),Wi=Kt+"Origin",Xs.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",Qm=!!no("perspective"),fu=Xi.core.reverting,du=1)},Dc=function a(e){var t=Sh("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=this.parentNode,s=this.nextSibling,r=this.style.cssText,o;if(Wr.appendChild(t),t.appendChild(this),this.style.display="block",e)try{o=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=a}catch{}else this._gsapBBox&&(o=this._gsapBBox());return i&&(s?i.insertBefore(this,s):i.appendChild(this)),Wr.removeChild(t),this.style.cssText=r,o},Hf=function(e,t){for(var i=t.length;i--;)if(e.hasAttribute(t[i]))return e.getAttribute(t[i])},Jm=function(e){var t;try{t=e.getBBox()}catch{t=Dc.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===Dc||(t=Dc.call(e,!0)),t&&!t.width&&!t.x&&!t.y?{x:+Hf(e,["x","cx","x1"])||0,y:+Hf(e,["y","cy","y1"])||0,width:0,height:0}:t},eg=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&Jm(e))},er=function(e,t){if(t){var i=e.style,s;t in es&&t!==Wi&&(t=Kt),i.removeProperty?(s=t.substr(0,2),(s==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),i.removeProperty(s==="--"?t:t.replace(pu,"-$1").toLowerCase())):i.removeAttribute(t)}},gs=function(e,t,i,s,r,o){var l=new Gi(e._pt,t,i,0,1,o?$m:qm);return e._pt=l,l.b=s,l.e=r,e._props.push(i),l},Gf={deg:1,rad:1,turn:1},oA={grid:1,flex:1},Ss=function a(e,t,i,s){var r=parseFloat(i)||0,o=(i+"").trim().substr((r+"").length)||"px",l=Xs.style,h=YS.test(t),d=e.tagName.toLowerCase()==="svg",f=(d?"client":"offset")+(h?"Width":"Height"),c=100,u=s==="px",p=s==="%",m,_,g,v;if(s===o||!r||Gf[s]||Gf[o])return r;if(o!=="px"&&!u&&(r=a(e,t,i,"px")),v=e.getCTM&&eg(e),(p||o==="%")&&(es[t]||~t.indexOf("adius")))return m=v?e.getBBox()[h?"width":"height"]:e[f],si(p?r/m*c:r/100*m);if(l[h?"width":"height"]=c+(u?o:s),_=~t.indexOf("adius")||s==="em"&&e.appendChild&&!d?e:e.parentNode,v&&(_=(e.ownerSVGElement||{}).parentNode),(!_||_===ms||!_.appendChild)&&(_=ms.body),g=_._gsap,g&&p&&g.width&&h&&g.time===Zi.time&&!g.uncache)return si(r/g.width*c);if(p&&(t==="height"||t==="width")){var y=e.style[t];e.style[t]=c+s,m=e[f],y?e.style[t]=y:er(e,t)}else(p||o==="%")&&!oA[Pn(_,"display")]&&(l.position=Pn(e,"position")),_===e&&(l.position="static"),_.appendChild(Xs),m=Xs[f],_.removeChild(Xs),l.position="absolute";return h&&p&&(g=js(_),g.time=Zi.time,g.width=_[f]),si(u?m*r/c:m&&r?c/m*r:0)},jn=function(e,t,i,s){var r;return du||Ah(),t in Rn&&t!=="transform"&&(t=Rn[t],~t.indexOf(",")&&(t=t.split(",")[0])),es[t]&&t!=="transform"?(r=Qo(e,s),r=t!=="transformOrigin"?r[t]:r.svg?r.origin:Tl(Pn(e,Wi))+" "+r.zOrigin+"px"):(r=e.style[t],(!r||r==="auto"||s||~(r+"").indexOf("calc("))&&(r=El[t]&&El[t](e,t,i)||Pn(e,t)||gm(e,t)||(t==="opacity"?1:0))),i&&!~(r+"").trim().indexOf(" ")?Ss(e,t,r,i)+i:r},aA=function(e,t,i,s){if(!i||i==="none"){var r=no(t,e,1),o=r&&Pn(e,r,1);o&&o!==i?(t=r,i=o):t==="borderColor"&&(i=Pn(e,"borderTopColor"))}var l=new Gi(this._pt,e.style,t,0,1,Xm),h=0,d=0,f,c,u,p,m,_,g,v,y,x,b,S;if(l.b=i,l.e=s,i+="",s+="",s==="auto"&&(_=e.style[t],e.style[t]=s,s=Pn(e,t)||s,_?e.style[t]=_:er(e,t)),f=[i,s],Dm(f),i=f[0],s=f[1],u=i.match(Dr)||[],S=s.match(Dr)||[],S.length){for(;c=Dr.exec(s);)g=c[0],y=s.substring(h,c.index),m?m=(m+1)%5:(y.substr(-5)==="rgba("||y.substr(-5)==="hsla(")&&(m=1),g!==(_=u[d++]||"")&&(p=parseFloat(_)||0,b=_.substr((p+"").length),g.charAt(1)==="="&&(g=Gr(p,g)+b),v=parseFloat(g),x=g.substr((v+"").length),h=Dr.lastIndex-x.length,x||(x=x||Ji.units[t]||b,h===s.length&&(s+=x,l.e+=x)),b!==x&&(p=Ss(e,t,_,x)||0),l._pt={_next:l._pt,p:y||d===1?y:",",s:p,c:v-p,m:m&&m<4||t==="zIndex"?Math.round:0});l.c=h<s.length?s.substring(h,s.length):""}else l.r=t==="display"&&s==="none"?$m:qm;return hm.test(s)&&(l.e=0),this._pt=l,l},Wf={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},lA=function(e){var t=e.split(" "),i=t[0],s=t[1]||"50%";return(i==="top"||i==="bottom"||s==="left"||s==="right")&&(e=i,i=s,s=e),t[0]=Wf[i]||i,t[1]=Wf[s]||s,t.join(" ")},cA=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var i=t.t,s=i.style,r=t.u,o=i._gsap,l,h,d;if(r==="all"||r===!0)s.cssText="",h=1;else for(r=r.split(","),d=r.length;--d>-1;)l=r[d],es[l]&&(h=1,l=l==="transformOrigin"?Wi:Kt),er(i,l);h&&(er(i,Kt),o&&(o.svg&&i.removeAttribute("transform"),Qo(i,1),o.uncache=1,Zm(s)))}},El={clearProps:function(e,t,i,s,r){if(r.data!=="isFromStart"){var o=e._pt=new Gi(e._pt,t,i,0,0,cA);return o.u=s,o.pr=-10,o.tween=r,e._props.push(i),1}}},Ko=[1,0,0,1,0,0],tg={},ig=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},Xf=function(e){var t=Pn(e,Kt);return ig(t)?Ko:t.substr(7).match(cm).map(si)},mu=function(e,t){var i=e._gsap||js(e),s=e.style,r=Xf(e),o,l,h,d;return i.svg&&e.getAttribute("transform")?(h=e.transform.baseVal.consolidate().matrix,r=[h.a,h.b,h.c,h.d,h.e,h.f],r.join(",")==="1,0,0,1,0,0"?Ko:r):(r===Ko&&!e.offsetParent&&e!==Wr&&!i.svg&&(h=s.display,s.display="block",o=e.parentNode,(!o||!e.offsetParent)&&(d=1,l=e.nextElementSibling,Wr.appendChild(e)),r=Xf(e),h?s.display=h:er(e,"display"),d&&(l?o.insertBefore(e,l):o?o.appendChild(e):Wr.removeChild(e))),t&&r.length>6?[r[0],r[1],r[4],r[5],r[12],r[13]]:r)},Eh=function(e,t,i,s,r,o){var l=e._gsap,h=r||mu(e,!0),d=l.xOrigin||0,f=l.yOrigin||0,c=l.xOffset||0,u=l.yOffset||0,p=h[0],m=h[1],_=h[2],g=h[3],v=h[4],y=h[5],x=t.split(" "),b=parseFloat(x[0])||0,S=parseFloat(x[1])||0,A,E,R,M;i?h!==Ko&&(E=p*g-m*_)&&(R=b*(g/E)+S*(-_/E)+(_*y-g*v)/E,M=b*(-m/E)+S*(p/E)-(p*y-m*v)/E,b=R,S=M):(A=Jm(e),b=A.x+(~x[0].indexOf("%")?b/100*A.width:b),S=A.y+(~(x[1]||x[0]).indexOf("%")?S/100*A.height:S)),s||s!==!1&&l.smooth?(v=b-d,y=S-f,l.xOffset=c+(v*p+y*_)-v,l.yOffset=u+(v*m+y*g)-y):l.xOffset=l.yOffset=0,l.xOrigin=b,l.yOrigin=S,l.smooth=!!s,l.origin=t,l.originIsAbsolute=!!i,e.style[Wi]="0px 0px",o&&(gs(o,l,"xOrigin",d,b),gs(o,l,"yOrigin",f,S),gs(o,l,"xOffset",c,l.xOffset),gs(o,l,"yOffset",u,l.yOffset)),e.setAttribute("data-svg-origin",b+" "+S)},Qo=function(e,t){var i=e._gsap||new Um(e);if("x"in i&&!t&&!i.uncache)return i;var s=e.style,r=i.scaleX<0,o="px",l="deg",h=getComputedStyle(e),d=Pn(e,Wi)||"0",f,c,u,p,m,_,g,v,y,x,b,S,A,E,R,M,w,L,N,B,G,W,ee,z,k,q,$,H,Q,X,F,D;return f=c=u=_=g=v=y=x=b=0,p=m=1,i.svg=!!(e.getCTM&&eg(e)),h.translate&&((h.translate!=="none"||h.scale!=="none"||h.rotate!=="none")&&(s[Kt]=(h.translate!=="none"?"translate3d("+(h.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(h.rotate!=="none"?"rotate("+h.rotate+") ":"")+(h.scale!=="none"?"scale("+h.scale.split(" ").join(",")+") ":"")+(h[Kt]!=="none"?h[Kt]:"")),s.scale=s.rotate=s.translate="none"),E=mu(e,i.svg),i.svg&&(i.uncache?(k=e.getBBox(),d=i.xOrigin-k.x+"px "+(i.yOrigin-k.y)+"px",z=""):z=!t&&e.getAttribute("data-svg-origin"),Eh(e,z||d,!!z||i.originIsAbsolute,i.smooth!==!1,E)),S=i.xOrigin||0,A=i.yOrigin||0,E!==Ko&&(L=E[0],N=E[1],B=E[2],G=E[3],f=W=E[4],c=ee=E[5],E.length===6?(p=Math.sqrt(L*L+N*N),m=Math.sqrt(G*G+B*B),_=L||N?Ar(N,L)*Vs:0,y=B||G?Ar(B,G)*Vs+_:0,y&&(m*=Math.abs(Math.cos(y*Xr))),i.svg&&(f-=S-(S*L+A*B),c-=A-(S*N+A*G))):(D=E[6],X=E[7],$=E[8],H=E[9],Q=E[10],F=E[11],f=E[12],c=E[13],u=E[14],R=Ar(D,Q),g=R*Vs,R&&(M=Math.cos(-R),w=Math.sin(-R),z=W*M+$*w,k=ee*M+H*w,q=D*M+Q*w,$=W*-w+$*M,H=ee*-w+H*M,Q=D*-w+Q*M,F=X*-w+F*M,W=z,ee=k,D=q),R=Ar(-B,Q),v=R*Vs,R&&(M=Math.cos(-R),w=Math.sin(-R),z=L*M-$*w,k=N*M-H*w,q=B*M-Q*w,F=G*w+F*M,L=z,N=k,B=q),R=Ar(N,L),_=R*Vs,R&&(M=Math.cos(R),w=Math.sin(R),z=L*M+N*w,k=W*M+ee*w,N=N*M-L*w,ee=ee*M-W*w,L=z,W=k),g&&Math.abs(g)+Math.abs(_)>359.9&&(g=_=0,v=180-v),p=si(Math.sqrt(L*L+N*N+B*B)),m=si(Math.sqrt(ee*ee+D*D)),R=Ar(W,ee),y=Math.abs(R)>2e-4?R*Vs:0,b=F?1/(F<0?-F:F):0),i.svg&&(z=e.getAttribute("transform"),i.forceCSS=e.setAttribute("transform","")||!ig(Pn(e,Kt)),z&&e.setAttribute("transform",z))),Math.abs(y)>90&&Math.abs(y)<270&&(r?(p*=-1,y+=_<=0?180:-180,_+=_<=0?180:-180):(m*=-1,y+=y<=0?180:-180)),t=t||i.uncache,i.x=f-((i.xPercent=f&&(!t&&i.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-f)?-50:0)))?e.offsetWidth*i.xPercent/100:0)+o,i.y=c-((i.yPercent=c&&(!t&&i.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-c)?-50:0)))?e.offsetHeight*i.yPercent/100:0)+o,i.z=u+o,i.scaleX=si(p),i.scaleY=si(m),i.rotation=si(_)+l,i.rotationX=si(g)+l,i.rotationY=si(v)+l,i.skewX=y+l,i.skewY=x+l,i.transformPerspective=b+o,(i.zOrigin=parseFloat(d.split(" ")[2])||!t&&i.zOrigin||0)&&(s[Wi]=Tl(d)),i.xOffset=i.yOffset=0,i.force3D=Ji.force3D,i.renderTransform=i.svg?uA:Qm?ng:hA,i.uncache=0,i},Tl=function(e){return(e=e.split(" "))[0]+" "+e[1]},kc=function(e,t,i){var s=Ii(t);return si(parseFloat(t)+parseFloat(Ss(e,"x",i+"px",s)))+s},hA=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,ng(e,t)},ks="0deg",wo="0px",Ns=") ",ng=function(e,t){var i=t||this,s=i.xPercent,r=i.yPercent,o=i.x,l=i.y,h=i.z,d=i.rotation,f=i.rotationY,c=i.rotationX,u=i.skewX,p=i.skewY,m=i.scaleX,_=i.scaleY,g=i.transformPerspective,v=i.force3D,y=i.target,x=i.zOrigin,b="",S=v==="auto"&&e&&e!==1||v===!0;if(x&&(c!==ks||f!==ks)){var A=parseFloat(f)*Xr,E=Math.sin(A),R=Math.cos(A),M;A=parseFloat(c)*Xr,M=Math.cos(A),o=kc(y,o,E*M*-x),l=kc(y,l,-Math.sin(A)*-x),h=kc(y,h,R*M*-x+x)}g!==wo&&(b+="perspective("+g+Ns),(s||r)&&(b+="translate("+s+"%, "+r+"%) "),(S||o!==wo||l!==wo||h!==wo)&&(b+=h!==wo||S?"translate3d("+o+", "+l+", "+h+") ":"translate("+o+", "+l+Ns),d!==ks&&(b+="rotate("+d+Ns),f!==ks&&(b+="rotateY("+f+Ns),c!==ks&&(b+="rotateX("+c+Ns),(u!==ks||p!==ks)&&(b+="skew("+u+", "+p+Ns),(m!==1||_!==1)&&(b+="scale("+m+", "+_+Ns),y.style[Kt]=b||"translate(0, 0)"},uA=function(e,t){var i=t||this,s=i.xPercent,r=i.yPercent,o=i.x,l=i.y,h=i.rotation,d=i.skewX,f=i.skewY,c=i.scaleX,u=i.scaleY,p=i.target,m=i.xOrigin,_=i.yOrigin,g=i.xOffset,v=i.yOffset,y=i.forceCSS,x=parseFloat(o),b=parseFloat(l),S,A,E,R,M;h=parseFloat(h),d=parseFloat(d),f=parseFloat(f),f&&(f=parseFloat(f),d+=f,h+=f),h||d?(h*=Xr,d*=Xr,S=Math.cos(h)*c,A=Math.sin(h)*c,E=Math.sin(h-d)*-u,R=Math.cos(h-d)*u,d&&(f*=Xr,M=Math.tan(d-f),M=Math.sqrt(1+M*M),E*=M,R*=M,f&&(M=Math.tan(f),M=Math.sqrt(1+M*M),S*=M,A*=M)),S=si(S),A=si(A),E=si(E),R=si(R)):(S=c,R=u,A=E=0),(x&&!~(o+"").indexOf("px")||b&&!~(l+"").indexOf("px"))&&(x=Ss(p,"x",o,"px"),b=Ss(p,"y",l,"px")),(m||_||g||v)&&(x=si(x+m-(m*S+_*E)+g),b=si(b+_-(m*A+_*R)+v)),(s||r)&&(M=p.getBBox(),x=si(x+s/100*M.width),b=si(b+r/100*M.height)),M="matrix("+S+","+A+","+E+","+R+","+x+","+b+")",p.setAttribute("transform",M),y&&(p.style[Kt]=M)},dA=function(e,t,i,s,r){var o=360,l=wi(r),h=parseFloat(r)*(l&&~r.indexOf("rad")?Vs:1),d=h-s,f=s+d+"deg",c,u;return l&&(c=r.split("_")[1],c==="short"&&(d%=o,d!==d%(o/2)&&(d+=d<0?o:-o)),c==="cw"&&d<0?d=(d+o*zf)%o-~~(d/o)*o:c==="ccw"&&d>0&&(d=(d-o*zf)%o-~~(d/o)*o)),e._pt=u=new Gi(e._pt,t,i,s,d,$S),u.e=f,u.u="deg",e._props.push(i),u},jf=function(e,t){for(var i in t)e[i]=t[i];return e},fA=function(e,t,i){var s=jf({},i._gsap),r="perspective,force3D,transformOrigin,svgOrigin",o=i.style,l,h,d,f,c,u,p,m;s.svg?(d=i.getAttribute("transform"),i.setAttribute("transform",""),o[Kt]=t,l=Qo(i,1),er(i,Kt),i.setAttribute("transform",d)):(d=getComputedStyle(i)[Kt],o[Kt]=t,l=Qo(i,1),o[Kt]=d);for(h in es)d=s[h],f=l[h],d!==f&&r.indexOf(h)<0&&(p=Ii(d),m=Ii(f),c=p!==m?Ss(i,h,d,m):parseFloat(d),u=parseFloat(f),e._pt=new Gi(e._pt,l,h,c,u-c,Mh),e._pt.u=m||0,e._props.push(h));jf(l,s)};Hi("padding,margin,Width,Radius",function(a,e){var t="Top",i="Right",s="Bottom",r="Left",o=(e<3?[t,i,s,r]:[t+r,t+i,s+i,s+r]).map(function(l){return e<2?a+l:"border"+l+a});El[e>1?"border"+a:a]=function(l,h,d,f,c){var u,p;if(arguments.length<4)return u=o.map(function(m){return jn(l,m,d)}),p=u.join(" "),p.split(u[0]).length===5?u[0]:p;u=(f+"").split(" "),p={},o.forEach(function(m,_){return p[m]=u[_]=u[_]||u[(_-1)/2|0]}),l.init(h,p,c)}});var sg={name:"css",register:Ah,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,i,s,r){var o=this._props,l=e.style,h=i.vars.startAt,d,f,c,u,p,m,_,g,v,y,x,b,S,A,E,R;du||Ah(),this.styles=this.styles||Km(e),R=this.styles.props,this.tween=i;for(_ in t)if(_!=="autoRound"&&(f=t[_],!($i[_]&&zm(_,t,i,s,e,r)))){if(p=typeof f,m=El[_],p==="function"&&(f=f.call(i,s,e,r),p=typeof f),p==="string"&&~f.indexOf("random(")&&(f=qo(f)),m)m(this,e,_,f,i)&&(E=1);else if(_.substr(0,2)==="--")d=(getComputedStyle(e).getPropertyValue(_)+"").trim(),f+="",ys.lastIndex=0,ys.test(d)||(g=Ii(d),v=Ii(f)),v?g!==v&&(d=Ss(e,_,d,v)+v):g&&(f+=g),this.add(l,"setProperty",d,f,s,r,0,0,_),o.push(_),R.push(_,0,l[_]);else if(p!=="undefined"){if(h&&_ in h?(d=typeof h[_]=="function"?h[_].call(i,s,e,r):h[_],wi(d)&&~d.indexOf("random(")&&(d=qo(d)),Ii(d+"")||d==="auto"||(d+=Ji.units[_]||Ii(jn(e,_))||""),(d+"").charAt(1)==="="&&(d=jn(e,_))):d=jn(e,_),u=parseFloat(d),y=p==="string"&&f.charAt(1)==="="&&f.substr(0,2),y&&(f=f.substr(2)),c=parseFloat(f),_ in Rn&&(_==="autoAlpha"&&(u===1&&jn(e,"visibility")==="hidden"&&c&&(u=0),R.push("visibility",0,l.visibility),gs(this,l,"visibility",u?"inherit":"hidden",c?"inherit":"hidden",!c)),_!=="scale"&&_!=="transform"&&(_=Rn[_],~_.indexOf(",")&&(_=_.split(",")[0]))),x=_ in es,x){if(this.styles.save(_),b||(S=e._gsap,S.renderTransform&&!t.parseTransform||Qo(e,t.parseTransform),A=t.smoothOrigin!==!1&&S.smooth,b=this._pt=new Gi(this._pt,l,Kt,0,1,S.renderTransform,S,0,-1),b.dep=1),_==="scale")this._pt=new Gi(this._pt,S,"scaleY",S.scaleY,(y?Gr(S.scaleY,y+c):c)-S.scaleY||0,Mh),this._pt.u=0,o.push("scaleY",_),_+="X";else if(_==="transformOrigin"){R.push(Wi,0,l[Wi]),f=lA(f),S.svg?Eh(e,f,0,A,0,this):(v=parseFloat(f.split(" ")[2])||0,v!==S.zOrigin&&gs(this,S,"zOrigin",S.zOrigin,v),gs(this,l,_,Tl(d),Tl(f)));continue}else if(_==="svgOrigin"){Eh(e,f,1,A,0,this);continue}else if(_ in tg){dA(this,S,_,u,y?Gr(u,y+f):f);continue}else if(_==="smoothOrigin"){gs(this,S,"smooth",S.smooth,f);continue}else if(_==="force3D"){S[_]=f;continue}else if(_==="transform"){fA(this,f,e);continue}}else _ in l||(_=no(_)||_);if(x||(c||c===0)&&(u||u===0)&&!qS.test(f)&&_ in l)g=(d+"").substr((u+"").length),c||(c=0),v=Ii(f)||(_ in Ji.units?Ji.units[_]:g),g!==v&&(u=Ss(e,_,d,v)),this._pt=new Gi(this._pt,x?S:l,_,u,(y?Gr(u,y+c):c)-u,!x&&(v==="px"||_==="zIndex")&&t.autoRound!==!1?KS:Mh),this._pt.u=v||0,g!==v&&v!=="%"&&(this._pt.b=d,this._pt.r=ZS);else if(_ in l)aA.call(this,e,_,d,y?y+f:f);else if(_ in e)this.add(e,_,d||e[_],y?y+f:f,s,r);else if(_!=="parseTransform"){nu(_,f);continue}x||(_ in l?R.push(_,0,l[_]):R.push(_,1,d||e[_])),o.push(_)}}E&&jm(this)},render:function(e,t){if(t.tween._time||!fu())for(var i=t._pt;i;)i.r(e,i.d),i=i._next;else t.styles.revert()},get:jn,aliases:Rn,getSetter:function(e,t,i){var s=Rn[t];return s&&s.indexOf(",")<0&&(t=s),t in es&&t!==Wi&&(e._gsap.x||jn(e,"x"))?i&&Uf===i?t==="scale"?tA:eA:(Uf=i||{})&&(t==="scale"?iA:nA):e.style&&!eu(e.style[t])?QS:~t.indexOf("-")?JS:hu(e,t)},core:{_removeProperty:er,_getMatrix:mu}};Xi.utils.checkPrefix=no;Xi.core.getStyleSaver=Km;(function(a,e,t,i){var s=Hi(a+","+e+","+t,function(r){es[r]=1});Hi(e,function(r){Ji.units[r]="deg",tg[r]=1}),Rn[s[13]]=a+","+e,Hi(i,function(r){var o=r.split(":");Rn[o[1]]=s[o[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Hi("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(a){Ji.units[a]="px"});Xi.registerPlugin(sg);var Qe=Xi.registerPlugin(sg)||Xi;Qe.core.Tween;class pA{constructor(e,t,i){this.parameters={width:e,height:t,thickness:i},this.type="AreaFloorGeometry";const s=8,r=new Float32Array(s*3),o=new Uint32Array(s*6),l=e,h=t,d=l-i,f=h-i;r[0*3+0]=d*.5,r[0*3+1]=f*.5,r[0*3+2]=0,r[1*3+0]=d*.5,r[1*3+1]=-f*.5,r[1*3+2]=0,r[2*3+0]=-d*.5,r[2*3+1]=-f*.5,r[2*3+2]=0,r[3*3+0]=-d*.5,r[3*3+1]=f*.5,r[3*3+2]=0,r[4*3+0]=l*.5,r[4*3+1]=h*.5,r[4*3+2]=0,r[5*3+0]=l*.5,r[5*3+1]=-h*.5,r[5*3+2]=0,r[6*3+0]=-l*.5,r[6*3+1]=-h*.5,r[6*3+2]=0,r[7*3+0]=-l*.5,r[7*3+1]=h*.5,r[7*3+2]=0,o[0*3+0]=4,o[0*3+1]=0,o[0*3+2]=1,o[1*3+0]=1,o[1*3+1]=5,o[1*3+2]=4,o[2*3+0]=5,o[2*3+1]=1,o[2*3+2]=2,o[3*3+0]=2,o[3*3+1]=6,o[3*3+2]=5,o[4*3+0]=6,o[4*3+1]=2,o[4*3+2]=3,o[5*3+0]=3,o[5*3+1]=7,o[5*3+2]=6,o[6*3+0]=7,o[6*3+1]=3,o[6*3+2]=0,o[7*3+0]=0,o[7*3+1]=4,o[7*3+2]=7;const c=new Bt;return c.setIndex(new ci(o,1,!1)),c.setAttribute("position",new yt(r,3)),c}}class mA{constructor(e,t,i){this.parameters={width:e,height:t,depth:i},this.type="AreaFloorGeometry";const s=8,r=new Float32Array(s*3),o=new Uint32Array(s*2),l=new Uint32Array(s*6);r[0*3+0]=e*.5,r[0*3+1]=t*.5,r[0*3+2]=0,r[1*3+0]=e*.5,r[1*3+1]=-t*.5,r[1*3+2]=0,r[2*3+0]=-e*.5,r[2*3+1]=-t*.5,r[2*3+2]=0,r[3*3+0]=-e*.5,r[3*3+1]=t*.5,r[3*3+2]=0,r[4*3+0]=e*.5,r[4*3+1]=t*.5,r[4*3+2]=i,r[5*3+0]=e*.5,r[5*3+1]=-t*.5,r[5*3+2]=i,r[6*3+0]=-e*.5,r[6*3+1]=-t*.5,r[6*3+2]=i,r[7*3+0]=-e*.5,r[7*3+1]=t*.5,r[7*3+2]=i,o[0*2+0]=0,o[0*2+1]=0,o[1*2+0]=1/3,o[1*2+1]=0,o[2*2+0]=1/3*2,o[2*2+1]=0,o[3*2+0]=1,o[3*2+1]=0,o[4*2+0]=0,o[4*2+1]=1,o[5*2+0]=1/3,o[5*2+1]=1,o[6*2+0]=1/3*2,o[6*2+1]=1,o[7*2+0]=1,o[7*2+1]=1,l[0*3+0]=0,l[0*3+1]=4,l[0*3+2]=1,l[1*3+0]=5,l[1*3+1]=1,l[1*3+2]=4,l[2*3+0]=1,l[2*3+1]=5,l[2*3+2]=2,l[3*3+0]=6,l[3*3+1]=2,l[3*3+2]=5,l[4*3+0]=2,l[4*3+1]=6,l[4*3+2]=3,l[5*3+0]=7,l[5*3+1]=3,l[5*3+2]=6,l[6*3+0]=3,l[6*3+1]=7,l[6*3+2]=0,l[7*3+0]=4,l[7*3+1]=0,l[7*3+2]=7;const h=new Bt;return h.setIndex(new ci(l,1,!1)),h.setAttribute("position",new yt(r,3)),h.setAttribute("uv",new yt(o,2)),h}}var gA=`uniform float uTime;
uniform float uBorderAlpha;
uniform float uStrikeAlpha;

varying vec3 vPosition;
varying vec3 vModelPosition;
varying vec2 vUv;

void main()
{
    float uStrikeWidth = 0.5;
    
    float uBorderWidth = 0.1;
    

    if(vModelPosition.z < 0.0)
    {
        discard;
    }

    float strikeStrength = mod((vPosition.x + vPosition.y - uTime * 0.00035 + vPosition.z) / uStrikeWidth * 0.5, 1.0);
    strikeStrength = step(strikeStrength, 0.5) * uStrikeAlpha;

    float borderStrength = max(step(1.0 - vUv.y, uBorderWidth), step(vUv.y, uBorderWidth)) * uBorderAlpha;

    float alpha = max(strikeStrength, borderStrength);

    gl_FragColor = vec4(vec3(1.0), alpha);

    
}`,vA=`varying vec3 vPosition;
varying vec3 vModelPosition;
varying vec2 vUv;

void main()
{
    vec4 modelPosition = modelMatrix * vec4(position, 1.0);
    gl_Position = projectionMatrix * viewMatrix * modelPosition;

    vPosition = position.xyz;
    vModelPosition = modelPosition.xyz;
    vUv = uv;
}`;function _A(){const a={uTime:{value:null},uBorderAlpha:{value:null},uStrikeAlpha:{value:null}};return new fi({wireframe:!1,transparent:!0,side:Ui,depthTest:!0,depthWrite:!1,uniforms:a,vertexShader:vA,fragmentShader:gA})}var yA=`#define M_PI 3.1415926535897932384626433832795

uniform vec3 uColor;
uniform float uAlpha;
uniform float uLoadProgress;
uniform float uProgress;

varying vec3 vPosition;

void main()
{
    float angle = atan(vPosition.x, vPosition.y);
    float loadProgress = step(abs(angle / M_PI), uLoadProgress);
    float progress = step(1.0 - abs(angle / M_PI), uProgress);

    float alpha = uAlpha;
    alpha -= uAlpha * 0.5 * (1.0 - loadProgress);
    alpha *= progress;

    gl_FragColor = vec4(uColor, alpha);
    
}`,xA=`varying vec3 vPosition;

void main()
{
    vec4 modelPosition = modelMatrix * vec4(position, 1.0);
    gl_Position = projectionMatrix * viewMatrix * modelPosition;

    vPosition = position;
}`;function bA(){const a={uColor:{value:null},uAlpha:{value:null},uLoadProgress:{value:null},uProgress:{value:null}};return new fi({wireframe:!1,transparent:!0,depthTest:!0,depthWrite:!1,uniforms:a,vertexShader:xA,fragmentShader:yA})}class wA extends nr{constructor(e){super(),this.config=e.config,this.renderer=e.renderer,this.resources=e.resources,this.car=e.car,this.sounds=e.sounds,this.time=e.time,this.position=e.position,this.halfExtents=e.halfExtents,this.hasKey=e.hasKey,this.active=e.active,this.billboardLink=e.billboardLink,this.isBillboard=e.isBillboard,this.isBuilding=e.isBuilding,this.areaSize=e.areaSize,this.name=e.name,this.link=e.link,this.description=e.description,this.container=new je,this.container.position.x=this.position.x,this.container.position.y=this.position.y,this.container.matrixAutoUpdate=!1,this.container.updateMatrix(),this.initialTestCar=this.testCar,this.isIn=!1,this.setFloorBorder(),this.setFence(),this.setInteractions(),this.hasKey&&this.setKey()}activate(){this.active=!0,this.isIn&&this.in()}deactivate(){this.active=!1,this.isIn&&this.out()}setFloorBorder(){this.floorBorder={},this.floorBorder.geometry=new pA(this.halfExtents.x*2,this.halfExtents.y*2,.25),this.floorBorder.material=new bA,this.isBillboard||this.isBuilding?(this.floorBorder.material.uniforms.uColor.value=new Le(16753920),this.floorBorder.material.uniforms.uAlpha.value=0,this.floorBorder.material.uniforms.uLoadProgress.value=0):(this.floorBorder.material.uniforms.uColor.value=new Le(16777215),this.floorBorder.material.uniforms.uAlpha.value=.8,this.floorBorder.material.uniforms.uLoadProgress.value=1),this.floorBorder.material.uniforms.uProgress.value=1,this.floorBorder.mesh=new Ae(this.floorBorder.geometry,this.floorBorder.material),this.floorBorder.mesh.matrixAutoUpdate=!1,this.container.add(this.floorBorder.mesh)}setFence(){this.fence={},this.fence.depth=.5,this.fence.offset=.5,this.fence.geometry=new mA(this.halfExtents.x*2,this.halfExtents.y*2,this.fence.depth),this.fence.material=new _A,this.fence.material.uniforms.uBorderAlpha.value=1,this.fence.material.uniforms.uStrikeAlpha.value=1,this.fence.mesh=new Ae(this.fence.geometry,this.fence.material),this.fence.mesh.position.z=-this.fence.depth,this.container.add(this.fence.mesh),this.time.on("tick",()=>{this.fence.material.uniforms.uTime.value=this.time.elapsed})}setKey(){this.key={},this.key.hiddenZ=1.5,this.key.shownZ=2.5,this.key.container=new je,this.key.container.position.z=this.key.hiddenZ,this.container.add(this.key.container),this.key.enter={},this.key.enter.size=1.4,this.key.enter.geometry=new pi(this.key.enter.size,this.key.enter.size/4,1,1),this.key.enter.texture=this.resources.items.areaEnterTexture,this.key.enter.texture.magFilter=li,this.key.enter.texture.minFilter=Nt,this.key.enter.material=new Ne({color:16777215,alphaMap:this.key.enter.texture,transparent:!0,opacity:0,depthWrite:!1}),this.key.enter.mesh=new Ae(this.key.enter.geometry,this.key.enter.material),this.key.enter.mesh.rotation.x=Math.PI*.5,this.key.enter.mesh.position.x=this.key.enter.size*.75,this.key.enter.mesh.matrixAutoUpdate=!1,this.key.enter.mesh.updateMatrix(),this.key.container.add(this.key.enter.mesh),this.key.icon={},this.key.icon.size=.75,this.key.icon.geometry=new pi(this.key.icon.size,this.key.icon.size,1,1),this.key.icon.texture=this.resources.items.areaKeyEnterTexture,this.key.icon.texture.magFilter=li,this.key.icon.texture.minFilter=Nt,this.key.icon.material=new Ne({color:16777215,alphaMap:this.key.icon.texture,transparent:!0,opacity:0,depthWrite:!1}),this.key.icon.mesh=new Ae(this.key.icon.geometry,this.key.icon.material),this.key.icon.mesh.rotation.x=Math.PI*.5,this.key.icon.mesh.position.x=-this.key.enter.size*.15,this.key.icon.mesh.matrixAutoUpdate=!1,this.key.icon.mesh.updateMatrix(),this.key.container.add(this.key.icon.mesh)}interact(e=!0,t=!1){if(!(!t&&(this.isBillboard||this.isBuilding))&&this.active&&(Qe.killTweensOf(this.fence.mesh.position),Qe.killTweensOf(this.floorBorder.material.uniforms.uAlpha),Qe.killTweensOf(this.fence.material.uniforms.uBorderAlpha),this.hasKey&&(Qe.killTweensOf(this.key.container.position),Qe.killTweensOf(this.key.icon.material),Qe.killTweensOf(this.key.enter.material)),this.isBillboard||this.isBuilding?Qe.to(this.fence.mesh.position,{z:0,duration:.05,onComplete:()=>{Qe.to(this.fence.mesh.position,{z:.5,duration:.25,ease:"back.out(2)"}),Qe.fromTo(this.floorBorder.material.uniforms.uAlpha,{value:.5},{value:0,duration:1.5}),Qe.fromTo(this.fence.material.uniforms.uBorderAlpha,{value:.5},{value:0,duration:1.5})}}):Qe.to(this.fence.mesh.position,{z:0,duration:.05,onComplete:()=>{Qe.to(this.fence.mesh.position,{z:.5,duration:.25,ease:"back.out(2)"}),Qe.fromTo(this.floorBorder.material.uniforms.uAlpha,{value:1},{value:.5,duration:1.5}),Qe.fromTo(this.fence.material.uniforms.uBorderAlpha,{value:1},{value:.5,duration:1.5})}}),this.hasKey&&e&&(this.key.container.position.z=this.key.shownZ,Qe.fromTo(this.key.icon.material,{opacity:1},{opacity:.5,duration:1.5}),Qe.fromTo(this.key.enter.material,{opacity:1},{opacity:.5,duration:1.5})),this.sounds.play("uiArea"),this.trigger("interact"),this.billboardLink!=null&&window.open(this.billboardLink,"_blank"),this.isBuilding)){console.log();const i=document.createElement("div"),s=`
                position: fixed;
                bottom: 20px;
                right: 20px;
                background-color: rgba(255, 255, 255, 1);
                padding: 15px;
                padding-top: 30px;
                border-radius: 8px;
                border: 4px solid rgb(255, 190, 49);
                color: white;
                z-index: 1000;
                max-width: 300px;
                display: flex;
                flex-direction: column;
                gap: 10px;
                font-family: 'Comic Neue', cursive;
            `;i.style.cssText=s;const r=document.createElement("h6"),o=`
                margin: 0;
                color: rgb(0, 0, 0);
                font-size: 20px;
                font-family: "Poppins", sans-serif;
            `;r.textContent=this.name||"Building title not available",r.style.cssText=o,i.appendChild(r);const l=document.createElement("p"),h=`
                margin: 0;
                color: rgb(0, 0, 0);
                font-size: 16px;
                font-family: "Poppins", sans-serif;
            `;if(l.textContent=this.description||"Building description not available",l.style.cssText=h,i.appendChild(l),this.link){const f=document.createElement("a");f.href=this.link,f.textContent="Websitesini Ziyaret Et",f.target="_blank";const c=`
                    color: '#4a9eff';
                    font-size: 14px;
                    text-decoration: none;
                    font-family: "Poppins", sans-serif;
                `;f.style.cssText=c,i.appendChild(f)}const d=document.createElement("button");d.textContent="×",d.style.position="absolute",d.style.top="5px",d.style.right="8px",d.style.background="none",d.style.border="none",d.style.color="black",d.style.fontSize="20px",d.style.cursor="pointer",d.onclick=()=>document.body.removeChild(i),i.appendChild(d),document.body.appendChild(i),setTimeout(()=>{document.body.contains(i)&&document.body.removeChild(i)},5e3)}}in(e=!0){this.isIn=!0,this.active&&(Qe.killTweensOf(this.fence.mesh.position),Qe.to(this.fence.mesh.position,{z:this.fence.offset,duration:.35,ease:"back.out(3)"}),this.hasKey&&(Qe.killTweensOf(this.key.container.position),Qe.killTweensOf(this.key.icon.material),Qe.killTweensOf(this.key.enter.material),e&&(Qe.to(this.key.container.position,{z:this.key.shownZ,duration:.35,ease:"back.out(3)",delay:.1}),Qe.to(this.key.icon.material,{opacity:.5,duration:.35,ease:"back.out(3)",delay:.1}),Qe.to(this.key.enter.material,{opacity:.5,duration:.35,ease:"back.out(3)",delay:.1}))),this.config.touch||this.renderer.domElement.classList.add("has-cursor-pointer"),this.trigger("in"))}out(){this.isIn=!1,Qe.killTweensOf(this.fence.mesh.position),Qe.to(this.fence.mesh.position,{z:-this.fence.depth,duration:.35,ease:"back.in(4)"}),this.hasKey&&(Qe.killTweensOf(this.key.container.position),Qe.killTweensOf(this.key.icon.material),Qe.killTweensOf(this.key.enter.material),Qe.to(this.key.container.position,{z:this.key.hiddenZ,duration:.35,ease:"back.in(4)",delay:.1}),Qe.to(this.key.icon.material,{opacity:0,duration:.35,ease:"back.in(4)",delay:.1}),Qe.to(this.key.enter.material,{opacity:0,duration:.35,ease:"back.in(4)",delay:.1})),this.config.touch||this.renderer.domElement.classList.remove("has-cursor-pointer"),this.trigger("out")}setInteractions(){this.mouseMesh=new Ae(new pi(this.halfExtents.x*2,this.halfExtents.y*2,1,1),new Ne({transparent:!0,opacity:0})),this.mouseMesh.position.z=-.01,this.mouseMesh.matrixAutoUpdate=!1,this.mouseMesh.updateMatrix(),this.container.add(this.mouseMesh),this.time.on("tick",()=>{if(this.car){const e=Math.abs(this.car.position.x-this.position.x)<this.areaSize&&Math.abs(this.car.position.y-this.position.y)<this.areaSize;e!==this.isIn&&(e?this.in(!this.config.touch):this.out())}}),window.addEventListener("keydown",e=>{(e.key==="Enter"||e.code==="Space")&&this.isIn&&this.interact(!0,!0)})}}class MA{constructor(e){this.config=e.config,this.resources=e.resources,this.car=e.car,this.sounds=e.sounds,this.renderer=e.renderer,this.camera=e.camera,this.time=e.time,this.debug=e.debug,this.items=[],this.container=new je,this.container.matrixAutoUpdate=!1,this.setMouse()}setMouse(){this.mouse={},this.mouse.raycaster=new $h,this.mouse.coordinates=new Oe,this.mouse.currentArea=null,this.mouse.needsUpdate=!1,window.addEventListener("mousemove",e=>{this.mouse.coordinates.x=e.clientX/window.innerWidth*2-1,this.mouse.coordinates.y=-(e.clientY/window.innerHeight)*2+1,this.mouse.needsUpdate=!0}),window.addEventListener("mousedown",()=>{this.mouse.currentArea&&this.mouse.currentArea.interact(!1)}),this.renderer.domElement.addEventListener("touchstart",e=>{this.mouse.coordinates.x=e.changedTouches[0].clientX/window.innerWidth*2-1,this.mouse.coordinates.y=-(e.changedTouches[0].clientY/window.innerHeight)*2+1,this.mouse.needsUpdate=!0}),this.time.on("tick",()=>{if(this.mouse.needsUpdate){this.mouse.needsUpdate=!1,this.mouse.raycaster.setFromCamera(this.mouse.coordinates,this.camera.instance);const e=this.items.map(i=>i.mouseMesh),t=this.mouse.raycaster.intersectObjects(e);if(t.length){const i=this.items.find(s=>s.mouseMesh===t[0].object);i!==this.mouse.currentArea&&(this.mouse.currentArea!==null&&(this.mouse.currentArea.out(),this.mouse.currentArea.testCar=this.mouse.currentArea.initialTestCar),this.mouse.currentArea=i,this.mouse.currentArea.in(!1),this.mouse.currentArea.testCar=!1)}else this.mouse.currentArea!==null&&(this.mouse.currentArea.out(),this.mouse.currentArea.testCar=this.mouse.currentArea.initialTestCar,this.mouse.currentArea=null)}})}add(e){const t=new wA({config:this.config,renderer:this.renderer,resources:this.resources,car:this.car,sounds:this.sounds,time:this.time,hasKey:!0,testCar:!0,active:!0,...e});return this.area=t,this.container.add(t.container),this.items.push(t),t}setCar(e){this.area.car=e}}class SA{constructor(e){this.resources=e.resources,this.objects=e.objects}add(e){const t={};t.coordinates=[],t.items=[];const i=e.shape;let s=i.widthCount,r=i.heightCount;switch(e.shape.type){case"rectangle":case"brick":for(let o=0;o<r;o++){const l=o===r-1;let h=0,d=s;for(e.shape.type==="brick"&&l&&e.shape.equilibrateLastLine&&(o%2===0?d--:h++);h<d;h++){const f=new T;f.add(i.offsetWidth.clone().multiplyScalar(h-(i.widthCount-1)*.5)),f.add(i.offsetHeight.clone().multiplyScalar(o)),f.x+=(Math.random()-.5)*i.randomOffset.x,f.y+=(Math.random()-.5)*i.randomOffset.y,f.z+=(Math.random()-.5)*i.randomOffset.z,e.shape.type==="brick"&&o%2===0&&f.add(i.offsetWidth.clone().multiplyScalar(.5));const c=new At;c.x+=(Math.random()-.5)*i.randomRotation.x,c.y+=(Math.random()-.5)*i.randomRotation.y,c.z+=(Math.random()-.5)*i.randomRotation.z,t.coordinates.push({offset:f,rotation:c})}}break;case"triangle":r=i.widthCount;for(let o=0;o<r;o++){for(let l=0;l<s;l++){const h=new T;h.add(i.offsetWidth.clone().multiplyScalar(l-(i.widthCount-1)*.5)),h.add(i.offsetWidth.clone().multiplyScalar(o*.5)),h.add(i.offsetHeight.clone().multiplyScalar(o)),h.x+=(Math.random()-.5)*i.randomOffset.x,h.y+=(Math.random()-.5)*i.randomOffset.y,h.z+=(Math.random()-.5)*i.randomOffset.z,e.shape.type==="brick"&&o%2===0&&h.add(i.offsetWidth.clone().multiplyScalar(.5));const d=new At;d.x+=(Math.random()-.5)*i.randomRotation.x,d.y+=(Math.random()-.5)*i.randomRotation.y,d.z+=(Math.random()-.5)*i.randomRotation.z,t.coordinates.push({offset:h,rotation:d})}s--}break}for(const o of t.coordinates){const l={...e.object};l.offset=e.object.offset.clone().add(o.offset).add(i.position),l.rotation=e.object.rotation.clone(),l.rotation.x+=o.rotation.x,l.rotation.y+=o.rotation.y,l.rotation.z+=o.rotation.z,t.items.push(this.objects.add(l))}return t}}const AA="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAA0CAMAAADG3yrFAAAAYFBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////98JRy6AAAAH3RSTlMAu0T56AQTUMyoLX97pM+vn1QwlCsOzoh2cGtFQDnR6vXj9wAAANpJREFUSMft08sOgjAQheERKJRrEQQVL33/t7S3tAk1OU1cmfAvJrPo4ltM6UtsE2JjlNTCpYovlFIvTT0lVElXRbCyUO/egxpFmYTIpyl3EIxoiVoLwYiBETEHwQi9NRaCEToHwQgTWy0EIzykxggECQgf4wYCEBEEIgIEIADEIhq9AUhARHUWEiNWg8CQ2iMAJEbEkPMOwQ0CQwICQRyi0xuA7BAAAhCmi4cEBIYsAYEhd4+AkBuNaooMJox6lsnN9JLJPfVvSOxKqmw8JTQ+6G87TvQ40Z/7AKq5RWVOmj58AAAAAElFTkSuQmCC",Yf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAkCAMAAADFCSheAAAAXVBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9RKvvlAAAAHnRSTlMARLvoBBP4UC3MqKR9z3lTMK+A+p8OlGvRuohwRTwkmquJAAAAxUlEQVQ4y5XOtxLCQBRDURnWORsH4v7/Z/Jmx2MVwGi5hSoVB19y2zhuDlEtpbfKBTHVPlQjotzv5ZClZ/tdW5tzGoW4DENGiEBMQLNDJKJ1gCNEIGAVhAgEQIhCWIRoxAGpNEJBiDhyJSGMiCwgNCQgGjBCBEJAAqIAGCERCEL6nwgNqYiQECI+6wghogwIDSFCQ4jQECKgIURoSO+tDpaGLERoyIMIBekw246JbAzq1Ue34hV/ToAp9nuHlcy3k25+4r/eTIAs8/NO/cUAAAAASUVORK5CYII=",EA="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAMAAAAM7l6QAAAANlBMVEUAAAD////////////////////////////////////////////////////////////////////xY8b8AAAAEXRSTlMA/OdVKViVlFDu3nHpGAi2RvH48bcAAACESURBVCjPdc8xFoMwEANR4YVkbQPJ3v+y8CjUSKj9jQaYvwm72Hsgq+rrdFuqOmbRRWvH0eiiSwIrXTQAulVxUbqquir9IypOtU71XlTvVPX+sCqL+N/ru8fzudOdBvutst/pBtCtWqeqq9JV1ZNqfVDV82aq+gT+rSVgfNQ48L5zPXEBEccPFOsAa88AAAAASUVORK5CYII=";class TA extends nr{constructor(e){super(),this.config=e.config,this.sizes=e.sizes,this.time=e.time,this.camera=e.camera,this.sounds=e.sounds,this.setActions(),this.setKeyboard()}setActions(){this.actions={},this.actions.up=!1,this.actions.right=!1,this.actions.down=!1,this.actions.left=!1,this.actions.brake=!1,this.actions.boost=!1,document.addEventListener("visibilitychange",()=>{document.hidden||(this.actions.up=!1,this.actions.right=!1,this.actions.down=!1,this.actions.left=!1,this.actions.brake=!1,this.actions.boost=!1)})}setKeyboard(){this.keyboard={},this.keyboard.events={},this.keyboard.events.keyDown=e=>{switch(e.code){case"ArrowUp":case"KeyW":this.camera.pan.reset(),this.actions.up=!0;break;case"ArrowRight":case"KeyD":this.actions.right=!0;break;case"ArrowDown":case"KeyS":this.camera.pan.reset(),this.actions.down=!0;break;case"ArrowLeft":case"KeyA":this.actions.left=!0;break;case"ControlLeft":case"ControlRight":case"Space":this.actions.brake=!0;break;case"ShiftLeft":case"ShiftRight":this.actions.boost=!0;break}},this.keyboard.events.keyUp=e=>{switch(e.code){case"ArrowUp":case"KeyW":this.actions.up=!1;break;case"ArrowRight":case"KeyD":this.actions.right=!1;break;case"ArrowDown":case"KeyS":this.actions.down=!1;break;case"ArrowLeft":case"KeyA":this.actions.left=!1;break;case"ControlLeft":case"ControlRight":case"Space":this.actions.brake=!1;break;case"ShiftLeft":case"ShiftRight":this.actions.boost=!1;break;case"KeyR":this.trigger("action",["reset"]);break}},document.addEventListener("keydown",this.keyboard.events.keyDown),document.addEventListener("keyup",this.keyboard.events.keyUp)}setTouch(){this.touch={},this.touch.joystick={},this.touch.joystick.active=!1,this.touch.joystick.$element=document.createElement("div"),this.touch.joystick.$element.style.userSelect="none",this.touch.joystick.$element.style.position="fixed",this.touch.joystick.$element.style.bottom="10px",this.touch.joystick.$element.style.left="10px",this.touch.joystick.$element.style.width="170px",this.touch.joystick.$element.style.height="170px",this.touch.joystick.$element.style.borderRadius="50%",this.touch.joystick.$element.style.transition="opacity 0.3s 0.0s",this.touch.joystick.$element.style.willChange="opacity",this.touch.joystick.$element.style.opacity="0",document.body.appendChild(this.touch.joystick.$element),this.touch.joystick.$cursor=document.createElement("div"),this.touch.joystick.$cursor.style.position="absolute",this.touch.joystick.$cursor.style.top="calc(50% - 30px)",this.touch.joystick.$cursor.style.left="calc(50% - 30px)",this.touch.joystick.$cursor.style.width="60px",this.touch.joystick.$cursor.style.height="60px",this.touch.joystick.$cursor.style.border="2px solid #ffffff",this.touch.joystick.$cursor.style.borderRadius="50%",this.touch.joystick.$cursor.style.boxSizing="border-box",this.touch.joystick.$cursor.style.pointerEvents="none",this.touch.joystick.$cursor.style.willChange="transform",this.touch.joystick.$element.appendChild(this.touch.joystick.$cursor),this.touch.joystick.$limit=document.createElement("div"),this.touch.joystick.$limit.style.position="absolute",this.touch.joystick.$limit.style.top="calc(50% - 75px)",this.touch.joystick.$limit.style.left="calc(50% - 75px)",this.touch.joystick.$limit.style.width="150px",this.touch.joystick.$limit.style.height="150px",this.touch.joystick.$limit.style.border="2px solid #ffffff",this.touch.joystick.$limit.style.borderRadius="50%",this.touch.joystick.$limit.style.opacity="0.25",this.touch.joystick.$limit.style.pointerEvents="none",this.touch.joystick.$limit.style.boxSizing="border-box",this.touch.joystick.$element.appendChild(this.touch.joystick.$limit),this.touch.joystick.angle={},this.touch.joystick.angle.offset=Math.PI*.18,this.touch.joystick.angle.center={},this.touch.joystick.angle.center.x=0,this.touch.joystick.angle.center.y=0,this.touch.joystick.angle.current={},this.touch.joystick.angle.current.x=0,this.touch.joystick.angle.current.y=0,this.touch.joystick.angle.originalValue=0,this.touch.joystick.angle.value=-Math.PI*.5,this.touch.joystick.resize=()=>{const e=this.touch.joystick.$element.getBoundingClientRect();this.touch.joystick.angle.center.x=e.left+e.width*.5,this.touch.joystick.angle.center.y=e.top+e.height*.5},this.sizes.on("resize",this.touch.joystick.resize),this.touch.joystick.resize(),this.time.on("tick",()=>{if(this.touch.joystick.active){this.touch.joystick.angle.originalValue=-Math.atan2(this.touch.joystick.angle.current.y-this.touch.joystick.angle.center.y,this.touch.joystick.angle.current.x-this.touch.joystick.angle.center.x),this.touch.joystick.angle.value=this.touch.joystick.angle.originalValue+this.touch.joystick.angle.offset;const e=Math.hypot(this.touch.joystick.angle.current.y-this.touch.joystick.angle.center.y,this.touch.joystick.angle.current.x-this.touch.joystick.angle.center.x);let t=e;t>20&&(t=20+Math.log(e-20)*5),t>43&&(t=43);const i=Math.sin(this.touch.joystick.angle.originalValue+Math.PI*.5)*t,s=Math.cos(this.touch.joystick.angle.originalValue+Math.PI*.5)*t;this.touch.joystick.$cursor.style.transform=`translateX(${i}px) translateY(${s}px)`}}),this.touch.joystick.events={},this.touch.joystick.touchIdentifier=null,this.touch.joystick.events.touchstart=e=>{e.preventDefault();const t=e.changedTouches[0];t&&(this.touch.joystick.active=!0,this.touch.joystick.touchIdentifier=t.identifier,this.touch.joystick.angle.current.x=t.clientX,this.touch.joystick.angle.current.y=t.clientY,this.touch.joystick.$limit.style.opacity="0.5",document.addEventListener("touchend",this.touch.joystick.events.touchend),document.addEventListener("touchmove",this.touch.joystick.events.touchmove,{passive:!1}),this.trigger("joystickStart"))},this.touch.joystick.events.touchmove=e=>{e.preventDefault();const i=[...e.changedTouches].find(s=>s.identifier===this.touch.joystick.touchIdentifier);i&&(this.touch.joystick.angle.current.x=i.clientX,this.touch.joystick.angle.current.y=i.clientY,this.trigger("joystickMove"))},this.touch.joystick.events.touchend=e=>{[...e.changedTouches].find(s=>s.identifier===this.touch.joystick.touchIdentifier)&&(this.touch.joystick.active=!1,this.touch.joystick.$limit.style.opacity="0.25",this.touch.joystick.$cursor.style.transform="translateX(0px) translateY(0px)",document.removeEventListener("touchend",this.touch.joystick.events.touchend),this.trigger("joystickEnd"))},this.touch.joystick.$element.addEventListener("touchstart",this.touch.joystick.events.touchstart,{passive:!1}),this.touch.boost={},this.touch.boost.$element=document.createElement("div"),this.touch.boost.$element.style.userSelect="none",this.touch.boost.$element.style.position="fixed",this.touch.boost.$element.style.bottom="calc(70px * 3 + 15px)",this.touch.boost.$element.style.right="0px",this.touch.boost.$element.style.width="95px",this.touch.boost.$element.style.height="70px",this.touch.boost.$element.style.transition="opacity 0.3s 0.4s",this.touch.boost.$element.style.willChange="opacity",this.touch.boost.$element.style.opacity="0",document.body.appendChild(this.touch.boost.$element),this.touch.boost.$border=document.createElement("div"),this.touch.boost.$border.style.position="absolute",this.touch.boost.$border.style.top="calc(50% - 30px)",this.touch.boost.$border.style.left="calc(50% - 30px)",this.touch.boost.$border.style.width="60px",this.touch.boost.$border.style.height="60px",this.touch.boost.$border.style.border="2px solid #ffffff",this.touch.boost.$border.style.borderRadius="10px",this.touch.boost.$border.style.boxSizing="border-box",this.touch.boost.$border.style.opacity="0.25",this.touch.boost.$border.style.willChange="opacity",this.touch.boost.$element.appendChild(this.touch.boost.$border),this.touch.boost.$icon=document.createElement("div"),this.touch.boost.$icon.style.position="absolute",this.touch.boost.$icon.style.top="calc(50% - 13px)",this.touch.boost.$icon.style.left="calc(50% - 11px)",this.touch.boost.$icon.style.width="22px",this.touch.boost.$icon.style.height="26px",this.touch.boost.$icon.style.backgroundImage=`url(${AA})`,this.touch.boost.$icon.style.backgroundSize="cover",this.touch.boost.$element.appendChild(this.touch.boost.$icon),this.touch.boost.events={},this.touch.boost.touchIdentifier=null,this.touch.boost.events.touchstart=e=>{e.preventDefault();const t=e.changedTouches[0];t&&(this.camera.pan.reset(),this.touch.boost.touchIdentifier=t.identifier,this.actions.up=!0,this.actions.boost=!0,this.touch.boost.$border.style.opacity="0.5",document.addEventListener("touchend",this.touch.boost.events.touchend))},this.touch.boost.events.touchend=e=>{[...e.changedTouches].find(s=>s.identifier===this.touch.boost.touchIdentifier)&&(this.actions.up=!1,this.actions.boost=!1,this.touch.boost.$border.style.opacity="0.25",document.removeEventListener("touchend",this.touch.boost.events.touchend))},this.touch.boost.$element.addEventListener("touchstart",this.touch.boost.events.touchstart),this.touch.forward={},this.touch.forward.$element=document.createElement("div"),this.touch.forward.$element.style.userSelect="none",this.touch.forward.$element.style.position="fixed",this.touch.forward.$element.style.bottom="calc(70px * 2 + 15px)",this.touch.forward.$element.style.right="0px",this.touch.forward.$element.style.width="95px",this.touch.forward.$element.style.height="70px",this.touch.forward.$element.style.transition="opacity 0.3s 0.3s",this.touch.forward.$element.style.willChange="opacity",this.touch.forward.$element.style.opacity="0",document.body.appendChild(this.touch.forward.$element),this.touch.forward.$border=document.createElement("div"),this.touch.forward.$border.style.position="absolute",this.touch.forward.$border.style.top="calc(50% - 30px)",this.touch.forward.$border.style.left="calc(50% - 30px)",this.touch.forward.$border.style.width="60px",this.touch.forward.$border.style.height="60px",this.touch.forward.$border.style.border="2px solid #ffffff",this.touch.forward.$border.style.borderRadius="10px",this.touch.forward.$border.style.boxSizing="border-box",this.touch.forward.$border.style.opacity="0.25",this.touch.forward.$border.style.willChange="opacity",this.touch.forward.$element.appendChild(this.touch.forward.$border),this.touch.forward.$icon=document.createElement("div"),this.touch.forward.$icon.style.position="absolute",this.touch.forward.$icon.style.top="calc(50% - 9px)",this.touch.forward.$icon.style.left="calc(50% - 11px)",this.touch.forward.$icon.style.width="22px",this.touch.forward.$icon.style.height="18px",this.touch.forward.$icon.style.backgroundImage=`url(${Yf})`,this.touch.forward.$icon.style.backgroundSize="cover",this.touch.forward.$element.appendChild(this.touch.forward.$icon),this.touch.forward.events={},this.touch.forward.touchIdentifier=null,this.touch.forward.events.touchstart=e=>{e.preventDefault();const t=e.changedTouches[0];t&&(this.camera.pan.reset(),this.touch.forward.touchIdentifier=t.identifier,this.actions.up=!0,this.touch.forward.$border.style.opacity="0.5",document.addEventListener("touchend",this.touch.forward.events.touchend))},this.touch.forward.events.touchend=e=>{[...e.changedTouches].find(s=>s.identifier===this.touch.forward.touchIdentifier)&&(this.actions.up=!1,this.touch.forward.$border.style.opacity="0.25",document.removeEventListener("touchend",this.touch.forward.events.touchend))},this.touch.forward.$element.addEventListener("touchstart",this.touch.forward.events.touchstart),this.touch.brake={},this.touch.brake.$element=document.createElement("div"),this.touch.brake.$element.style.userSelect="none",this.touch.brake.$element.style.position="fixed",this.touch.brake.$element.style.bottom="calc(70px + 15px)",this.touch.brake.$element.style.right="0px",this.touch.brake.$element.style.width="95px",this.touch.brake.$element.style.height="70px",this.touch.brake.$element.style.transition="opacity 0.3s 0.2s",this.touch.brake.$element.style.willChange="opacity",this.touch.brake.$element.style.opacity="0",document.body.appendChild(this.touch.brake.$element),this.touch.brake.$border=document.createElement("div"),this.touch.brake.$border.style.position="absolute",this.touch.brake.$border.style.top="calc(50% - 30px)",this.touch.brake.$border.style.left="calc(50% - 30px)",this.touch.brake.$border.style.width="60px",this.touch.brake.$border.style.height="60px",this.touch.brake.$border.style.border="2px solid #ffffff",this.touch.brake.$border.style.borderRadius="10px",this.touch.brake.$border.style.boxSizing="border-box",this.touch.brake.$border.style.opacity="0.25",this.touch.brake.$border.style.willChange="opacity",this.touch.brake.$element.appendChild(this.touch.brake.$border),this.touch.brake.$icon=document.createElement("div"),this.touch.brake.$icon.style.position="absolute",this.touch.brake.$icon.style.top="calc(50% - 7px)",this.touch.brake.$icon.style.left="calc(50% - 7px)",this.touch.brake.$icon.style.width="15px",this.touch.brake.$icon.style.height="15px",this.touch.brake.$icon.style.backgroundImage=`url(${EA})`,this.touch.brake.$icon.style.backgroundSize="cover",this.touch.brake.$icon.style.transform="rotate(180deg)",this.touch.brake.$element.appendChild(this.touch.brake.$icon),this.touch.brake.events={},this.touch.brake.touchIdentifier=null,this.touch.brake.events.touchstart=e=>{e.preventDefault();const t=e.changedTouches[0];t&&(this.touch.brake.touchIdentifier=t.identifier,this.actions.brake=!0,this.touch.brake.$border.style.opacity="0.5",document.addEventListener("touchend",this.touch.brake.events.touchend))},this.touch.brake.events.touchend=e=>{[...e.changedTouches].find(s=>s.identifier===this.touch.brake.touchIdentifier)&&(this.actions.brake=!1,this.touch.brake.$border.style.opacity="0.25",document.removeEventListener("touchend",this.touch.brake.events.touchend))},this.touch.brake.$element.addEventListener("touchstart",this.touch.brake.events.touchstart),this.touch.backward={},this.touch.backward.$element=document.createElement("div"),this.touch.backward.$element.style.userSelect="none",this.touch.backward.$element.style.position="fixed",this.touch.backward.$element.style.bottom="15px",this.touch.backward.$element.style.right="0px",this.touch.backward.$element.style.width="95px",this.touch.backward.$element.style.height="70px",this.touch.backward.$element.style.transition="opacity 0.3s 0.1s",this.touch.backward.$element.style.willChange="opacity",this.touch.backward.$element.style.opacity="0",document.body.appendChild(this.touch.backward.$element),this.touch.backward.$border=document.createElement("div"),this.touch.backward.$border.style.position="absolute",this.touch.backward.$border.style.top="calc(50% - 30px)",this.touch.backward.$border.style.left="calc(50% - 30px)",this.touch.backward.$border.style.width="60px",this.touch.backward.$border.style.height="60px",this.touch.backward.$border.style.border="2px solid #ffffff",this.touch.backward.$border.style.borderRadius="10px",this.touch.backward.$border.style.boxSizing="border-box",this.touch.backward.$border.style.opacity="0.25",this.touch.backward.$border.style.willChange="opacity",this.touch.backward.$element.appendChild(this.touch.backward.$border),this.touch.backward.$icon=document.createElement("div"),this.touch.backward.$icon.style.position="absolute",this.touch.backward.$icon.style.top="calc(50% - 9px)",this.touch.backward.$icon.style.left="calc(50% - 11px)",this.touch.backward.$icon.style.width="22px",this.touch.backward.$icon.style.height="18px",this.touch.backward.$icon.style.backgroundImage=`url(${Yf})`,this.touch.backward.$icon.style.backgroundSize="cover",this.touch.backward.$icon.style.transform="rotate(180deg)",this.touch.backward.$element.appendChild(this.touch.backward.$icon),this.touch.backward.events={},this.touch.backward.touchIdentifier=null,this.touch.backward.events.touchstart=e=>{e.preventDefault();const t=e.changedTouches[0];t&&(this.camera.pan.reset(),this.touch.backward.touchIdentifier=t.identifier,this.actions.down=!0,this.touch.backward.$border.style.opacity="0.5",document.addEventListener("touchend",this.touch.backward.events.touchend))},this.touch.backward.events.touchend=e=>{[...e.changedTouches].find(s=>s.identifier===this.touch.backward.touchIdentifier)&&(this.actions.down=!1,this.touch.backward.$border.style.opacity="0.25",document.removeEventListener("touchend",this.touch.backward.events.touchend))},this.touch.backward.$element.addEventListener("touchstart",this.touch.backward.events.touchstart),this.touch.reveal=()=>{this.touch.joystick.$element.style.opacity=1,this.touch.backward.$element.style.opacity=1,this.touch.brake.$element.style.opacity=1,this.touch.forward.$element.style.opacity=1,this.touch.boost.$element.style.opacity=1}}}var fn={};/*!
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(a){(function(){var e=function(){this.init()};e.prototype={init:function(){var c=this||t;return c._counter=1e3,c._html5AudioPool=[],c.html5PoolSize=10,c._codecs={},c._howls=[],c._muted=!1,c._volume=1,c._canPlayEvent="canplaythrough",c._navigator=typeof window<"u"&&window.navigator?window.navigator:null,c.masterGain=null,c.noAudio=!1,c.usingWebAudio=!0,c.autoSuspend=!0,c.ctx=null,c.autoUnlock=!0,c._setup(),c},volume:function(c){var u=this||t;if(c=parseFloat(c),u.ctx||f(),typeof c<"u"&&c>=0&&c<=1){if(u._volume=c,u._muted)return u;u.usingWebAudio&&u.masterGain.gain.setValueAtTime(c,t.ctx.currentTime);for(var p=0;p<u._howls.length;p++)if(!u._howls[p]._webAudio)for(var m=u._howls[p]._getSoundIds(),_=0;_<m.length;_++){var g=u._howls[p]._soundById(m[_]);g&&g._node&&(g._node.volume=g._volume*c)}return u}return u._volume},mute:function(c){var u=this||t;u.ctx||f(),u._muted=c,u.usingWebAudio&&u.masterGain.gain.setValueAtTime(c?0:u._volume,t.ctx.currentTime);for(var p=0;p<u._howls.length;p++)if(!u._howls[p]._webAudio)for(var m=u._howls[p]._getSoundIds(),_=0;_<m.length;_++){var g=u._howls[p]._soundById(m[_]);g&&g._node&&(g._node.muted=c?!0:g._muted)}return u},stop:function(){for(var c=this||t,u=0;u<c._howls.length;u++)c._howls[u].stop();return c},unload:function(){for(var c=this||t,u=c._howls.length-1;u>=0;u--)c._howls[u].unload();return c.usingWebAudio&&c.ctx&&typeof c.ctx.close<"u"&&(c.ctx.close(),c.ctx=null,f()),c},codecs:function(c){return(this||t)._codecs[c.replace(/^x-/,"")]},_setup:function(){var c=this||t;if(c.state=c.ctx&&c.ctx.state||"suspended",c._autoSuspend(),!c.usingWebAudio)if(typeof Audio<"u")try{var u=new Audio;typeof u.oncanplaythrough>"u"&&(c._canPlayEvent="canplay")}catch{c.noAudio=!0}else c.noAudio=!0;try{var u=new Audio;u.muted&&(c.noAudio=!0)}catch{}return c.noAudio||c._setupCodecs(),c},_setupCodecs:function(){var c=this||t,u=null;try{u=typeof Audio<"u"?new Audio:null}catch{return c}if(!u||typeof u.canPlayType!="function")return c;var p=u.canPlayType("audio/mpeg;").replace(/^no$/,""),m=c._navigator?c._navigator.userAgent:"",_=m.match(/OPR\/(\d+)/g),g=_&&parseInt(_[0].split("/")[1],10)<33,v=m.indexOf("Safari")!==-1&&m.indexOf("Chrome")===-1,y=m.match(/Version\/(.*?) /),x=v&&y&&parseInt(y[1],10)<15;return c._codecs={mp3:!!(!g&&(p||u.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!p,opus:!!u.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!u.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!u.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(u.canPlayType('audio/wav; codecs="1"')||u.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!u.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!u.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(u.canPlayType("audio/x-m4a;")||u.canPlayType("audio/m4a;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(u.canPlayType("audio/x-m4b;")||u.canPlayType("audio/m4b;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(u.canPlayType("audio/x-mp4;")||u.canPlayType("audio/mp4;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!x&&u.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!x&&u.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!u.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(u.canPlayType("audio/x-flac;")||u.canPlayType("audio/flac;")).replace(/^no$/,"")},c},_unlockAudio:function(){var c=this||t;if(!(c._audioUnlocked||!c.ctx)){c._audioUnlocked=!1,c.autoUnlock=!1,!c._mobileUnloaded&&c.ctx.sampleRate!==44100&&(c._mobileUnloaded=!0,c.unload()),c._scratchBuffer=c.ctx.createBuffer(1,1,22050);var u=function(p){for(;c._html5AudioPool.length<c.html5PoolSize;)try{var m=new Audio;m._unlocked=!0,c._releaseHtml5Audio(m)}catch{c.noAudio=!0;break}for(var _=0;_<c._howls.length;_++)if(!c._howls[_]._webAudio)for(var g=c._howls[_]._getSoundIds(),v=0;v<g.length;v++){var y=c._howls[_]._soundById(g[v]);y&&y._node&&!y._node._unlocked&&(y._node._unlocked=!0,y._node.load())}c._autoResume();var x=c.ctx.createBufferSource();x.buffer=c._scratchBuffer,x.connect(c.ctx.destination),typeof x.start>"u"?x.noteOn(0):x.start(0),typeof c.ctx.resume=="function"&&c.ctx.resume(),x.onended=function(){x.disconnect(0),c._audioUnlocked=!0,document.removeEventListener("touchstart",u,!0),document.removeEventListener("touchend",u,!0),document.removeEventListener("click",u,!0),document.removeEventListener("keydown",u,!0);for(var b=0;b<c._howls.length;b++)c._howls[b]._emit("unlock")}};return document.addEventListener("touchstart",u,!0),document.addEventListener("touchend",u,!0),document.addEventListener("click",u,!0),document.addEventListener("keydown",u,!0),c}},_obtainHtml5Audio:function(){var c=this||t;if(c._html5AudioPool.length)return c._html5AudioPool.pop();var u=new Audio().play();return u&&typeof Promise<"u"&&(u instanceof Promise||typeof u.then=="function")&&u.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(c){var u=this||t;return c._unlocked&&u._html5AudioPool.push(c),u},_autoSuspend:function(){var c=this;if(!(!c.autoSuspend||!c.ctx||typeof c.ctx.suspend>"u"||!t.usingWebAudio)){for(var u=0;u<c._howls.length;u++)if(c._howls[u]._webAudio){for(var p=0;p<c._howls[u]._sounds.length;p++)if(!c._howls[u]._sounds[p]._paused)return c}return c._suspendTimer&&clearTimeout(c._suspendTimer),c._suspendTimer=setTimeout(function(){if(c.autoSuspend){c._suspendTimer=null,c.state="suspending";var m=function(){c.state="suspended",c._resumeAfterSuspend&&(delete c._resumeAfterSuspend,c._autoResume())};c.ctx.suspend().then(m,m)}},3e4),c}},_autoResume:function(){var c=this;if(!(!c.ctx||typeof c.ctx.resume>"u"||!t.usingWebAudio))return c.state==="running"&&c.ctx.state!=="interrupted"&&c._suspendTimer?(clearTimeout(c._suspendTimer),c._suspendTimer=null):c.state==="suspended"||c.state==="running"&&c.ctx.state==="interrupted"?(c.ctx.resume().then(function(){c.state="running";for(var u=0;u<c._howls.length;u++)c._howls[u]._emit("resume")}),c._suspendTimer&&(clearTimeout(c._suspendTimer),c._suspendTimer=null)):c.state==="suspending"&&(c._resumeAfterSuspend=!0),c}};var t=new e,i=function(c){var u=this;if(!c.src||c.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}u.init(c)};i.prototype={init:function(c){var u=this;return t.ctx||f(),u._autoplay=c.autoplay||!1,u._format=typeof c.format!="string"?c.format:[c.format],u._html5=c.html5||!1,u._muted=c.mute||!1,u._loop=c.loop||!1,u._pool=c.pool||5,u._preload=typeof c.preload=="boolean"||c.preload==="metadata"?c.preload:!0,u._rate=c.rate||1,u._sprite=c.sprite||{},u._src=typeof c.src!="string"?c.src:[c.src],u._volume=c.volume!==void 0?c.volume:1,u._xhr={method:c.xhr&&c.xhr.method?c.xhr.method:"GET",headers:c.xhr&&c.xhr.headers?c.xhr.headers:null,withCredentials:c.xhr&&c.xhr.withCredentials?c.xhr.withCredentials:!1},u._duration=0,u._state="unloaded",u._sounds=[],u._endTimers={},u._queue=[],u._playLock=!1,u._onend=c.onend?[{fn:c.onend}]:[],u._onfade=c.onfade?[{fn:c.onfade}]:[],u._onload=c.onload?[{fn:c.onload}]:[],u._onloaderror=c.onloaderror?[{fn:c.onloaderror}]:[],u._onplayerror=c.onplayerror?[{fn:c.onplayerror}]:[],u._onpause=c.onpause?[{fn:c.onpause}]:[],u._onplay=c.onplay?[{fn:c.onplay}]:[],u._onstop=c.onstop?[{fn:c.onstop}]:[],u._onmute=c.onmute?[{fn:c.onmute}]:[],u._onvolume=c.onvolume?[{fn:c.onvolume}]:[],u._onrate=c.onrate?[{fn:c.onrate}]:[],u._onseek=c.onseek?[{fn:c.onseek}]:[],u._onunlock=c.onunlock?[{fn:c.onunlock}]:[],u._onresume=[],u._webAudio=t.usingWebAudio&&!u._html5,typeof t.ctx<"u"&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(u),u._autoplay&&u._queue.push({event:"play",action:function(){u.play()}}),u._preload&&u._preload!=="none"&&u.load(),u},load:function(){var c=this,u=null;if(t.noAudio){c._emit("loaderror",null,"No audio support.");return}typeof c._src=="string"&&(c._src=[c._src]);for(var p=0;p<c._src.length;p++){var m,_;if(c._format&&c._format[p])m=c._format[p];else{if(_=c._src[p],typeof _!="string"){c._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}m=/^data:audio\/([^;,]+);/i.exec(_),m||(m=/\.([^.]+)$/.exec(_.split("?",1)[0])),m&&(m=m[1].toLowerCase())}if(m||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),m&&t.codecs(m)){u=c._src[p];break}}if(!u){c._emit("loaderror",null,"No codec support for selected audio sources.");return}return c._src=u,c._state="loading",window.location.protocol==="https:"&&u.slice(0,5)==="http:"&&(c._html5=!0,c._webAudio=!1),new s(c),c._webAudio&&o(c),c},play:function(c,u){var p=this,m=null;if(typeof c=="number")m=c,c=null;else{if(typeof c=="string"&&p._state==="loaded"&&!p._sprite[c])return null;if(typeof c>"u"&&(c="__default",!p._playLock)){for(var _=0,g=0;g<p._sounds.length;g++)p._sounds[g]._paused&&!p._sounds[g]._ended&&(_++,m=p._sounds[g]._id);_===1?c=null:m=null}}var v=m?p._soundById(m):p._inactiveSound();if(!v)return null;if(m&&!c&&(c=v._sprite||"__default"),p._state!=="loaded"){v._sprite=c,v._ended=!1;var y=v._id;return p._queue.push({event:"play",action:function(){p.play(y)}}),y}if(m&&!v._paused)return u||p._loadQueue("play"),v._id;p._webAudio&&t._autoResume();var x=Math.max(0,v._seek>0?v._seek:p._sprite[c][0]/1e3),b=Math.max(0,(p._sprite[c][0]+p._sprite[c][1])/1e3-x),S=b*1e3/Math.abs(v._rate),A=p._sprite[c][0]/1e3,E=(p._sprite[c][0]+p._sprite[c][1])/1e3;v._sprite=c,v._ended=!1;var R=function(){v._paused=!1,v._seek=x,v._start=A,v._stop=E,v._loop=!!(v._loop||p._sprite[c][2])};if(x>=E){p._ended(v);return}var M=v._node;if(p._webAudio){var w=function(){p._playLock=!1,R(),p._refreshBuffer(v);var G=v._muted||p._muted?0:v._volume;M.gain.setValueAtTime(G,t.ctx.currentTime),v._playStart=t.ctx.currentTime,typeof M.bufferSource.start>"u"?v._loop?M.bufferSource.noteGrainOn(0,x,86400):M.bufferSource.noteGrainOn(0,x,b):v._loop?M.bufferSource.start(0,x,86400):M.bufferSource.start(0,x,b),S!==1/0&&(p._endTimers[v._id]=setTimeout(p._ended.bind(p,v),S)),u||setTimeout(function(){p._emit("play",v._id),p._loadQueue()},0)};t.state==="running"&&t.ctx.state!=="interrupted"?w():(p._playLock=!0,p.once("resume",w),p._clearTimer(v._id))}else{var L=function(){M.currentTime=x,M.muted=v._muted||p._muted||t._muted||M.muted,M.volume=v._volume*t.volume(),M.playbackRate=v._rate;try{var G=M.play();if(G&&typeof Promise<"u"&&(G instanceof Promise||typeof G.then=="function")?(p._playLock=!0,R(),G.then(function(){p._playLock=!1,M._unlocked=!0,u?p._loadQueue():p._emit("play",v._id)}).catch(function(){p._playLock=!1,p._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),v._ended=!0,v._paused=!0})):u||(p._playLock=!1,R(),p._emit("play",v._id)),M.playbackRate=v._rate,M.paused){p._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}c!=="__default"||v._loop?p._endTimers[v._id]=setTimeout(p._ended.bind(p,v),S):(p._endTimers[v._id]=function(){p._ended(v),M.removeEventListener("ended",p._endTimers[v._id],!1)},M.addEventListener("ended",p._endTimers[v._id],!1))}catch(W){p._emit("playerror",v._id,W)}};M.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(M.src=p._src,M.load());var N=window&&window.ejecta||!M.readyState&&t._navigator.isCocoonJS;if(M.readyState>=3||N)L();else{p._playLock=!0,p._state="loading";var B=function(){p._state="loaded",L(),M.removeEventListener(t._canPlayEvent,B,!1)};M.addEventListener(t._canPlayEvent,B,!1),p._clearTimer(v._id)}}return v._id},pause:function(c){var u=this;if(u._state!=="loaded"||u._playLock)return u._queue.push({event:"pause",action:function(){u.pause(c)}}),u;for(var p=u._getSoundIds(c),m=0;m<p.length;m++){u._clearTimer(p[m]);var _=u._soundById(p[m]);if(_&&!_._paused&&(_._seek=u.seek(p[m]),_._rateSeek=0,_._paused=!0,u._stopFade(p[m]),_._node))if(u._webAudio){if(!_._node.bufferSource)continue;typeof _._node.bufferSource.stop>"u"?_._node.bufferSource.noteOff(0):_._node.bufferSource.stop(0),u._cleanBuffer(_._node)}else(!isNaN(_._node.duration)||_._node.duration===1/0)&&_._node.pause();arguments[1]||u._emit("pause",_?_._id:null)}return u},stop:function(c,u){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"stop",action:function(){p.stop(c)}}),p;for(var m=p._getSoundIds(c),_=0;_<m.length;_++){p._clearTimer(m[_]);var g=p._soundById(m[_]);g&&(g._seek=g._start||0,g._rateSeek=0,g._paused=!0,g._ended=!0,p._stopFade(m[_]),g._node&&(p._webAudio?g._node.bufferSource&&(typeof g._node.bufferSource.stop>"u"?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),p._cleanBuffer(g._node)):(!isNaN(g._node.duration)||g._node.duration===1/0)&&(g._node.currentTime=g._start||0,g._node.pause(),g._node.duration===1/0&&p._clearSound(g._node))),u||p._emit("stop",g._id))}return p},mute:function(c,u){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"mute",action:function(){p.mute(c,u)}}),p;if(typeof u>"u")if(typeof c=="boolean")p._muted=c;else return p._muted;for(var m=p._getSoundIds(u),_=0;_<m.length;_++){var g=p._soundById(m[_]);g&&(g._muted=c,g._interval&&p._stopFade(g._id),p._webAudio&&g._node?g._node.gain.setValueAtTime(c?0:g._volume,t.ctx.currentTime):g._node&&(g._node.muted=t._muted?!0:c),p._emit("mute",g._id))}return p},volume:function(){var c=this,u=arguments,p,m;if(u.length===0)return c._volume;if(u.length===1||u.length===2&&typeof u[1]>"u"){var _=c._getSoundIds(),g=_.indexOf(u[0]);g>=0?m=parseInt(u[0],10):p=parseFloat(u[0])}else u.length>=2&&(p=parseFloat(u[0]),m=parseInt(u[1],10));var v;if(typeof p<"u"&&p>=0&&p<=1){if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"volume",action:function(){c.volume.apply(c,u)}}),c;typeof m>"u"&&(c._volume=p),m=c._getSoundIds(m);for(var y=0;y<m.length;y++)v=c._soundById(m[y]),v&&(v._volume=p,u[2]||c._stopFade(m[y]),c._webAudio&&v._node&&!v._muted?v._node.gain.setValueAtTime(p,t.ctx.currentTime):v._node&&!v._muted&&(v._node.volume=p*t.volume()),c._emit("volume",v._id))}else return v=m?c._soundById(m):c._sounds[0],v?v._volume:0;return c},fade:function(c,u,p,m){var _=this;if(_._state!=="loaded"||_._playLock)return _._queue.push({event:"fade",action:function(){_.fade(c,u,p,m)}}),_;c=Math.min(Math.max(0,parseFloat(c)),1),u=Math.min(Math.max(0,parseFloat(u)),1),p=parseFloat(p),_.volume(c,m);for(var g=_._getSoundIds(m),v=0;v<g.length;v++){var y=_._soundById(g[v]);if(y){if(m||_._stopFade(g[v]),_._webAudio&&!y._muted){var x=t.ctx.currentTime,b=x+p/1e3;y._volume=c,y._node.gain.setValueAtTime(c,x),y._node.gain.linearRampToValueAtTime(u,b)}_._startFadeInterval(y,c,u,p,g[v],typeof m>"u")}}return _},_startFadeInterval:function(c,u,p,m,_,g){var v=this,y=u,x=p-u,b=Math.abs(x/.01),S=Math.max(4,b>0?m/b:m),A=Date.now();c._fadeTo=p,c._interval=setInterval(function(){var E=(Date.now()-A)/m;A=Date.now(),y+=x*E,y=Math.round(y*100)/100,x<0?y=Math.max(p,y):y=Math.min(p,y),v._webAudio?c._volume=y:v.volume(y,c._id,!0),g&&(v._volume=y),(p<u&&y<=p||p>u&&y>=p)&&(clearInterval(c._interval),c._interval=null,c._fadeTo=null,v.volume(p,c._id),v._emit("fade",c._id))},S)},_stopFade:function(c){var u=this,p=u._soundById(c);return p&&p._interval&&(u._webAudio&&p._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(p._interval),p._interval=null,u.volume(p._fadeTo,c),p._fadeTo=null,u._emit("fade",c)),u},loop:function(){var c=this,u=arguments,p,m,_;if(u.length===0)return c._loop;if(u.length===1)if(typeof u[0]=="boolean")p=u[0],c._loop=p;else return _=c._soundById(parseInt(u[0],10)),_?_._loop:!1;else u.length===2&&(p=u[0],m=parseInt(u[1],10));for(var g=c._getSoundIds(m),v=0;v<g.length;v++)_=c._soundById(g[v]),_&&(_._loop=p,c._webAudio&&_._node&&_._node.bufferSource&&(_._node.bufferSource.loop=p,p&&(_._node.bufferSource.loopStart=_._start||0,_._node.bufferSource.loopEnd=_._stop,c.playing(g[v])&&(c.pause(g[v],!0),c.play(g[v],!0)))));return c},rate:function(){var c=this,u=arguments,p,m;if(u.length===0)m=c._sounds[0]._id;else if(u.length===1){var _=c._getSoundIds(),g=_.indexOf(u[0]);g>=0?m=parseInt(u[0],10):p=parseFloat(u[0])}else u.length===2&&(p=parseFloat(u[0]),m=parseInt(u[1],10));var v;if(typeof p=="number"){if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"rate",action:function(){c.rate.apply(c,u)}}),c;typeof m>"u"&&(c._rate=p),m=c._getSoundIds(m);for(var y=0;y<m.length;y++)if(v=c._soundById(m[y]),v){c.playing(m[y])&&(v._rateSeek=c.seek(m[y]),v._playStart=c._webAudio?t.ctx.currentTime:v._playStart),v._rate=p,c._webAudio&&v._node&&v._node.bufferSource?v._node.bufferSource.playbackRate.setValueAtTime(p,t.ctx.currentTime):v._node&&(v._node.playbackRate=p);var x=c.seek(m[y]),b=(c._sprite[v._sprite][0]+c._sprite[v._sprite][1])/1e3-x,S=b*1e3/Math.abs(v._rate);(c._endTimers[m[y]]||!v._paused)&&(c._clearTimer(m[y]),c._endTimers[m[y]]=setTimeout(c._ended.bind(c,v),S)),c._emit("rate",v._id)}}else return v=c._soundById(m),v?v._rate:c._rate;return c},seek:function(){var c=this,u=arguments,p,m;if(u.length===0)c._sounds.length&&(m=c._sounds[0]._id);else if(u.length===1){var _=c._getSoundIds(),g=_.indexOf(u[0]);g>=0?m=parseInt(u[0],10):c._sounds.length&&(m=c._sounds[0]._id,p=parseFloat(u[0]))}else u.length===2&&(p=parseFloat(u[0]),m=parseInt(u[1],10));if(typeof m>"u")return 0;if(typeof p=="number"&&(c._state!=="loaded"||c._playLock))return c._queue.push({event:"seek",action:function(){c.seek.apply(c,u)}}),c;var v=c._soundById(m);if(v)if(typeof p=="number"&&p>=0){var y=c.playing(m);y&&c.pause(m,!0),v._seek=p,v._ended=!1,c._clearTimer(m),!c._webAudio&&v._node&&!isNaN(v._node.duration)&&(v._node.currentTime=p);var x=function(){y&&c.play(m,!0),c._emit("seek",m)};if(y&&!c._webAudio){var b=function(){c._playLock?setTimeout(b,0):x()};setTimeout(b,0)}else x()}else if(c._webAudio){var S=c.playing(m)?t.ctx.currentTime-v._playStart:0,A=v._rateSeek?v._rateSeek-v._seek:0;return v._seek+(A+S*Math.abs(v._rate))}else return v._node.currentTime;return c},playing:function(c){var u=this;if(typeof c=="number"){var p=u._soundById(c);return p?!p._paused:!1}for(var m=0;m<u._sounds.length;m++)if(!u._sounds[m]._paused)return!0;return!1},duration:function(c){var u=this,p=u._duration,m=u._soundById(c);return m&&(p=u._sprite[m._sprite][1]/1e3),p},state:function(){return this._state},unload:function(){for(var c=this,u=c._sounds,p=0;p<u.length;p++)u[p]._paused||c.stop(u[p]._id),c._webAudio||(c._clearSound(u[p]._node),u[p]._node.removeEventListener("error",u[p]._errorFn,!1),u[p]._node.removeEventListener(t._canPlayEvent,u[p]._loadFn,!1),u[p]._node.removeEventListener("ended",u[p]._endFn,!1),t._releaseHtml5Audio(u[p]._node)),delete u[p]._node,c._clearTimer(u[p]._id);var m=t._howls.indexOf(c);m>=0&&t._howls.splice(m,1);var _=!0;for(p=0;p<t._howls.length;p++)if(t._howls[p]._src===c._src||c._src.indexOf(t._howls[p]._src)>=0){_=!1;break}return r&&_&&delete r[c._src],t.noAudio=!1,c._state="unloaded",c._sounds=[],c=null,null},on:function(c,u,p,m){var _=this,g=_["_on"+c];return typeof u=="function"&&g.push(m?{id:p,fn:u,once:m}:{id:p,fn:u}),_},off:function(c,u,p){var m=this,_=m["_on"+c],g=0;if(typeof u=="number"&&(p=u,u=null),u||p)for(g=0;g<_.length;g++){var v=p===_[g].id;if(u===_[g].fn&&v||!u&&v){_.splice(g,1);break}}else if(c)m["_on"+c]=[];else{var y=Object.keys(m);for(g=0;g<y.length;g++)y[g].indexOf("_on")===0&&Array.isArray(m[y[g]])&&(m[y[g]]=[])}return m},once:function(c,u,p){var m=this;return m.on(c,u,p,1),m},_emit:function(c,u,p){for(var m=this,_=m["_on"+c],g=_.length-1;g>=0;g--)(!_[g].id||_[g].id===u||c==="load")&&(setTimeout((function(v){v.call(this,u,p)}).bind(m,_[g].fn),0),_[g].once&&m.off(c,_[g].fn,_[g].id));return m._loadQueue(c),m},_loadQueue:function(c){var u=this;if(u._queue.length>0){var p=u._queue[0];p.event===c&&(u._queue.shift(),u._loadQueue()),c||p.action()}return u},_ended:function(c){var u=this,p=c._sprite;if(!u._webAudio&&c._node&&!c._node.paused&&!c._node.ended&&c._node.currentTime<c._stop)return setTimeout(u._ended.bind(u,c),100),u;var m=!!(c._loop||u._sprite[p][2]);if(u._emit("end",c._id),!u._webAudio&&m&&u.stop(c._id,!0).play(c._id),u._webAudio&&m){u._emit("play",c._id),c._seek=c._start||0,c._rateSeek=0,c._playStart=t.ctx.currentTime;var _=(c._stop-c._start)*1e3/Math.abs(c._rate);u._endTimers[c._id]=setTimeout(u._ended.bind(u,c),_)}return u._webAudio&&!m&&(c._paused=!0,c._ended=!0,c._seek=c._start||0,c._rateSeek=0,u._clearTimer(c._id),u._cleanBuffer(c._node),t._autoSuspend()),!u._webAudio&&!m&&u.stop(c._id,!0),u},_clearTimer:function(c){var u=this;if(u._endTimers[c]){if(typeof u._endTimers[c]!="function")clearTimeout(u._endTimers[c]);else{var p=u._soundById(c);p&&p._node&&p._node.removeEventListener("ended",u._endTimers[c],!1)}delete u._endTimers[c]}return u},_soundById:function(c){for(var u=this,p=0;p<u._sounds.length;p++)if(c===u._sounds[p]._id)return u._sounds[p];return null},_inactiveSound:function(){var c=this;c._drain();for(var u=0;u<c._sounds.length;u++)if(c._sounds[u]._ended)return c._sounds[u].reset();return new s(c)},_drain:function(){var c=this,u=c._pool,p=0,m=0;if(!(c._sounds.length<u)){for(m=0;m<c._sounds.length;m++)c._sounds[m]._ended&&p++;for(m=c._sounds.length-1;m>=0;m--){if(p<=u)return;c._sounds[m]._ended&&(c._webAudio&&c._sounds[m]._node&&c._sounds[m]._node.disconnect(0),c._sounds.splice(m,1),p--)}}},_getSoundIds:function(c){var u=this;if(typeof c>"u"){for(var p=[],m=0;m<u._sounds.length;m++)p.push(u._sounds[m]._id);return p}else return[c]},_refreshBuffer:function(c){var u=this;return c._node.bufferSource=t.ctx.createBufferSource(),c._node.bufferSource.buffer=r[u._src],c._panner?c._node.bufferSource.connect(c._panner):c._node.bufferSource.connect(c._node),c._node.bufferSource.loop=c._loop,c._loop&&(c._node.bufferSource.loopStart=c._start||0,c._node.bufferSource.loopEnd=c._stop||0),c._node.bufferSource.playbackRate.setValueAtTime(c._rate,t.ctx.currentTime),u},_cleanBuffer:function(c){var u=this,p=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(!c.bufferSource)return u;if(t._scratchBuffer&&c.bufferSource&&(c.bufferSource.onended=null,c.bufferSource.disconnect(0),p))try{c.bufferSource.buffer=t._scratchBuffer}catch{}return c.bufferSource=null,u},_clearSound:function(c){var u=/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent);u||(c.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var s=function(c){this._parent=c,this.init()};s.prototype={init:function(){var c=this,u=c._parent;return c._muted=u._muted,c._loop=u._loop,c._volume=u._volume,c._rate=u._rate,c._seek=0,c._paused=!0,c._ended=!0,c._sprite="__default",c._id=++t._counter,u._sounds.push(c),c.create(),c},create:function(){var c=this,u=c._parent,p=t._muted||c._muted||c._parent._muted?0:c._volume;return u._webAudio?(c._node=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),c._node.gain.setValueAtTime(p,t.ctx.currentTime),c._node.paused=!0,c._node.connect(t.masterGain)):t.noAudio||(c._node=t._obtainHtml5Audio(),c._errorFn=c._errorListener.bind(c),c._node.addEventListener("error",c._errorFn,!1),c._loadFn=c._loadListener.bind(c),c._node.addEventListener(t._canPlayEvent,c._loadFn,!1),c._endFn=c._endListener.bind(c),c._node.addEventListener("ended",c._endFn,!1),c._node.src=u._src,c._node.preload=u._preload===!0?"auto":u._preload,c._node.volume=p*t.volume(),c._node.load()),c},reset:function(){var c=this,u=c._parent;return c._muted=u._muted,c._loop=u._loop,c._volume=u._volume,c._rate=u._rate,c._seek=0,c._rateSeek=0,c._paused=!0,c._ended=!0,c._sprite="__default",c._id=++t._counter,c},_errorListener:function(){var c=this;c._parent._emit("loaderror",c._id,c._node.error?c._node.error.code:0),c._node.removeEventListener("error",c._errorFn,!1)},_loadListener:function(){var c=this,u=c._parent;u._duration=Math.ceil(c._node.duration*10)/10,Object.keys(u._sprite).length===0&&(u._sprite={__default:[0,u._duration*1e3]}),u._state!=="loaded"&&(u._state="loaded",u._emit("load"),u._loadQueue()),c._node.removeEventListener(t._canPlayEvent,c._loadFn,!1)},_endListener:function(){var c=this,u=c._parent;u._duration===1/0&&(u._duration=Math.ceil(c._node.duration*10)/10,u._sprite.__default[1]===1/0&&(u._sprite.__default[1]=u._duration*1e3),u._ended(c)),c._node.removeEventListener("ended",c._endFn,!1)}};var r={},o=function(c){var u=c._src;if(r[u]){c._duration=r[u].duration,d(c);return}if(/^data:[^;]+;base64,/.test(u)){for(var p=atob(u.split(",")[1]),m=new Uint8Array(p.length),_=0;_<p.length;++_)m[_]=p.charCodeAt(_);h(m.buffer,c)}else{var g=new XMLHttpRequest;g.open(c._xhr.method,u,!0),g.withCredentials=c._xhr.withCredentials,g.responseType="arraybuffer",c._xhr.headers&&Object.keys(c._xhr.headers).forEach(function(v){g.setRequestHeader(v,c._xhr.headers[v])}),g.onload=function(){var v=(g.status+"")[0];if(v!=="0"&&v!=="2"&&v!=="3"){c._emit("loaderror",null,"Failed loading audio file with status: "+g.status+".");return}h(g.response,c)},g.onerror=function(){c._webAudio&&(c._html5=!0,c._webAudio=!1,c._sounds=[],delete r[u],c.load())},l(g)}},l=function(c){try{c.send()}catch{c.onerror()}},h=function(c,u){var p=function(){u._emit("loaderror",null,"Decoding audio data failed.")},m=function(_){_&&u._sounds.length>0?(r[u._src]=_,d(u,_)):p()};typeof Promise<"u"&&t.ctx.decodeAudioData.length===1?t.ctx.decodeAudioData(c).then(m).catch(p):t.ctx.decodeAudioData(c,m,p)},d=function(c,u){u&&!c._duration&&(c._duration=u.duration),Object.keys(c._sprite).length===0&&(c._sprite={__default:[0,c._duration*1e3]}),c._state!=="loaded"&&(c._state="loaded",c._emit("load"),c._loadQueue())},f=function(){if(t.usingWebAudio){try{typeof AudioContext<"u"?t.ctx=new AudioContext:typeof webkitAudioContext<"u"?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch{t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var c=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),u=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),p=u?parseInt(u[1],10):null;if(c&&p&&p<9){var m=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!m&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};a.Howler=t,a.Howl=i,typeof bo<"u"?(bo.HowlerGlobal=e,bo.Howler=t,bo.Howl=i,bo.Sound=s):typeof window<"u"&&(window.HowlerGlobal=e,window.Howler=t,window.Howl=i,window.Sound=s)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var i=this;if(!i.ctx||!i.ctx.listener)return i;for(var s=i._howls.length-1;s>=0;s--)i._howls[s].stereo(t);return i},HowlerGlobal.prototype.pos=function(t,i,s){var r=this;if(!r.ctx||!r.ctx.listener)return r;if(i=typeof i!="number"?r._pos[1]:i,s=typeof s!="number"?r._pos[2]:s,typeof t=="number")r._pos=[t,i,s],typeof r.ctx.listener.positionX<"u"?(r.ctx.listener.positionX.setTargetAtTime(r._pos[0],Howler.ctx.currentTime,.1),r.ctx.listener.positionY.setTargetAtTime(r._pos[1],Howler.ctx.currentTime,.1),r.ctx.listener.positionZ.setTargetAtTime(r._pos[2],Howler.ctx.currentTime,.1)):r.ctx.listener.setPosition(r._pos[0],r._pos[1],r._pos[2]);else return r._pos;return r},HowlerGlobal.prototype.orientation=function(t,i,s,r,o,l){var h=this;if(!h.ctx||!h.ctx.listener)return h;var d=h._orientation;if(i=typeof i!="number"?d[1]:i,s=typeof s!="number"?d[2]:s,r=typeof r!="number"?d[3]:r,o=typeof o!="number"?d[4]:o,l=typeof l!="number"?d[5]:l,typeof t=="number")h._orientation=[t,i,s,r,o,l],typeof h.ctx.listener.forwardX<"u"?(h.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),h.ctx.listener.forwardY.setTargetAtTime(i,Howler.ctx.currentTime,.1),h.ctx.listener.forwardZ.setTargetAtTime(s,Howler.ctx.currentTime,.1),h.ctx.listener.upX.setTargetAtTime(r,Howler.ctx.currentTime,.1),h.ctx.listener.upY.setTargetAtTime(o,Howler.ctx.currentTime,.1),h.ctx.listener.upZ.setTargetAtTime(l,Howler.ctx.currentTime,.1)):h.ctx.listener.setOrientation(t,i,s,r,o,l);else return d;return h},Howl.prototype.init=function(t){return function(i){var s=this;return s._orientation=i.orientation||[1,0,0],s._stereo=i.stereo||null,s._pos=i.pos||null,s._pannerAttr={coneInnerAngle:typeof i.coneInnerAngle<"u"?i.coneInnerAngle:360,coneOuterAngle:typeof i.coneOuterAngle<"u"?i.coneOuterAngle:360,coneOuterGain:typeof i.coneOuterGain<"u"?i.coneOuterGain:0,distanceModel:typeof i.distanceModel<"u"?i.distanceModel:"inverse",maxDistance:typeof i.maxDistance<"u"?i.maxDistance:1e4,panningModel:typeof i.panningModel<"u"?i.panningModel:"HRTF",refDistance:typeof i.refDistance<"u"?i.refDistance:1,rolloffFactor:typeof i.rolloffFactor<"u"?i.rolloffFactor:1},s._onstereo=i.onstereo?[{fn:i.onstereo}]:[],s._onpos=i.onpos?[{fn:i.onpos}]:[],s._onorientation=i.onorientation?[{fn:i.onorientation}]:[],t.call(this,i)}}(Howl.prototype.init),Howl.prototype.stereo=function(t,i){var s=this;if(!s._webAudio)return s;if(s._state!=="loaded")return s._queue.push({event:"stereo",action:function(){s.stereo(t,i)}}),s;var r=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof i>"u")if(typeof t=="number")s._stereo=t,s._pos=[t,0,0];else return s._stereo;for(var o=s._getSoundIds(i),l=0;l<o.length;l++){var h=s._soundById(o[l]);if(h)if(typeof t=="number")h._stereo=t,h._pos=[t,0,0],h._node&&(h._pannerAttr.panningModel="equalpower",(!h._panner||!h._panner.pan)&&e(h,r),r==="spatial"?typeof h._panner.positionX<"u"?(h._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),h._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),h._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):h._panner.setPosition(t,0,0):h._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),s._emit("stereo",h._id);else return h._stereo}return s},Howl.prototype.pos=function(t,i,s,r){var o=this;if(!o._webAudio)return o;if(o._state!=="loaded")return o._queue.push({event:"pos",action:function(){o.pos(t,i,s,r)}}),o;if(i=typeof i!="number"?0:i,s=typeof s!="number"?-.5:s,typeof r>"u")if(typeof t=="number")o._pos=[t,i,s];else return o._pos;for(var l=o._getSoundIds(r),h=0;h<l.length;h++){var d=o._soundById(l[h]);if(d)if(typeof t=="number")d._pos=[t,i,s],d._node&&((!d._panner||d._panner.pan)&&e(d,"spatial"),typeof d._panner.positionX<"u"?(d._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),d._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),d._panner.positionZ.setValueAtTime(s,Howler.ctx.currentTime)):d._panner.setPosition(t,i,s)),o._emit("pos",d._id);else return d._pos}return o},Howl.prototype.orientation=function(t,i,s,r){var o=this;if(!o._webAudio)return o;if(o._state!=="loaded")return o._queue.push({event:"orientation",action:function(){o.orientation(t,i,s,r)}}),o;if(i=typeof i!="number"?o._orientation[1]:i,s=typeof s!="number"?o._orientation[2]:s,typeof r>"u")if(typeof t=="number")o._orientation=[t,i,s];else return o._orientation;for(var l=o._getSoundIds(r),h=0;h<l.length;h++){var d=o._soundById(l[h]);if(d)if(typeof t=="number")d._orientation=[t,i,s],d._node&&(d._panner||(d._pos||(d._pos=o._pos||[0,0,-.5]),e(d,"spatial")),typeof d._panner.orientationX<"u"?(d._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),d._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),d._panner.orientationZ.setValueAtTime(s,Howler.ctx.currentTime)):d._panner.setOrientation(t,i,s)),o._emit("orientation",d._id);else return d._orientation}return o},Howl.prototype.pannerAttr=function(){var t=this,i=arguments,s,r,o;if(!t._webAudio)return t;if(i.length===0)return t._pannerAttr;if(i.length===1)if(typeof i[0]=="object")s=i[0],typeof r>"u"&&(s.pannerAttr||(s.pannerAttr={coneInnerAngle:s.coneInnerAngle,coneOuterAngle:s.coneOuterAngle,coneOuterGain:s.coneOuterGain,distanceModel:s.distanceModel,maxDistance:s.maxDistance,refDistance:s.refDistance,rolloffFactor:s.rolloffFactor,panningModel:s.panningModel}),t._pannerAttr={coneInnerAngle:typeof s.pannerAttr.coneInnerAngle<"u"?s.pannerAttr.coneInnerAngle:t._coneInnerAngle,coneOuterAngle:typeof s.pannerAttr.coneOuterAngle<"u"?s.pannerAttr.coneOuterAngle:t._coneOuterAngle,coneOuterGain:typeof s.pannerAttr.coneOuterGain<"u"?s.pannerAttr.coneOuterGain:t._coneOuterGain,distanceModel:typeof s.pannerAttr.distanceModel<"u"?s.pannerAttr.distanceModel:t._distanceModel,maxDistance:typeof s.pannerAttr.maxDistance<"u"?s.pannerAttr.maxDistance:t._maxDistance,refDistance:typeof s.pannerAttr.refDistance<"u"?s.pannerAttr.refDistance:t._refDistance,rolloffFactor:typeof s.pannerAttr.rolloffFactor<"u"?s.pannerAttr.rolloffFactor:t._rolloffFactor,panningModel:typeof s.pannerAttr.panningModel<"u"?s.pannerAttr.panningModel:t._panningModel});else return o=t._soundById(parseInt(i[0],10)),o?o._pannerAttr:t._pannerAttr;else i.length===2&&(s=i[0],r=parseInt(i[1],10));for(var l=t._getSoundIds(r),h=0;h<l.length;h++)if(o=t._soundById(l[h]),o){var d=o._pannerAttr;d={coneInnerAngle:typeof s.coneInnerAngle<"u"?s.coneInnerAngle:d.coneInnerAngle,coneOuterAngle:typeof s.coneOuterAngle<"u"?s.coneOuterAngle:d.coneOuterAngle,coneOuterGain:typeof s.coneOuterGain<"u"?s.coneOuterGain:d.coneOuterGain,distanceModel:typeof s.distanceModel<"u"?s.distanceModel:d.distanceModel,maxDistance:typeof s.maxDistance<"u"?s.maxDistance:d.maxDistance,refDistance:typeof s.refDistance<"u"?s.refDistance:d.refDistance,rolloffFactor:typeof s.rolloffFactor<"u"?s.rolloffFactor:d.rolloffFactor,panningModel:typeof s.panningModel<"u"?s.panningModel:d.panningModel};var f=o._panner;f||(o._pos||(o._pos=t._pos||[0,0,-.5]),e(o,"spatial"),f=o._panner),f.coneInnerAngle=d.coneInnerAngle,f.coneOuterAngle=d.coneOuterAngle,f.coneOuterGain=d.coneOuterGain,f.distanceModel=d.distanceModel,f.maxDistance=d.maxDistance,f.refDistance=d.refDistance,f.rolloffFactor=d.rolloffFactor,f.panningModel=d.panningModel}return t},Sound.prototype.init=function(t){return function(){var i=this,s=i._parent;i._orientation=s._orientation,i._stereo=s._stereo,i._pos=s._pos,i._pannerAttr=s._pannerAttr,t.call(this),i._stereo?s.stereo(i._stereo):i._pos&&s.pos(i._pos[0],i._pos[1],i._pos[2],i._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var i=this,s=i._parent;return i._orientation=s._orientation,i._stereo=s._stereo,i._pos=s._pos,i._pannerAttr=s._pannerAttr,i._stereo?s.stereo(i._stereo):i._pos?s.pos(i._pos[0],i._pos[1],i._pos[2],i._id):i._panner&&(i._panner.disconnect(0),i._panner=void 0,s._refreshBuffer(i)),t.call(this)}}(Sound.prototype.reset);var e=function(t,i){i=i||"spatial",i==="spatial"?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,typeof t._panner.positionX<"u"?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),typeof t._panner.orientationX<"u"?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}})()})(fn);class CA{constructor(e){this.time=e.time,this.debug=e.debug,this.debug&&(this.debugFolder=this.debug.addFolder("sounds")),this.items=[],this.setSettings(),this.setMasterVolume(),this.setMute(),this.setEngine()}setSettings(){this.settings=[{name:"reveal",sounds:["./sounds/reveal/reveal-1.mp3"],minDelta:100,velocityMin:0,velocityMultiplier:1,volumeMin:1,volumeMax:1,rateMin:1,rateMax:1},{name:"brick",sounds:["./sounds/bricks/brick-1.mp3","./sounds/bricks/brick-2.mp3","./sounds/bricks/brick-4.mp3","./sounds/bricks/brick-6.mp3","./sounds/bricks/brick-7.mp3","./sounds/bricks/brick-8.mp3"],minDelta:100,velocityMin:1,velocityMultiplier:.75,volumeMin:.2,volumeMax:.85,rateMin:.5,rateMax:.75},{name:"bowlingPin",sounds:["./sounds/bowling/pin-1.mp3"],minDelta:0,velocityMin:1,velocityMultiplier:.5,volumeMin:.35,volumeMax:1,rateMin:.1,rateMax:.85},{name:"bowlingBall",sounds:["./sounds/bowling/pin-1.mp3","./sounds/bowling/pin-1.mp3","./sounds/bowling/pin-1.mp3"],minDelta:0,velocityMin:1,velocityMultiplier:.5,volumeMin:.35,volumeMax:1,rateMin:.1,rateMax:.2},{name:"carHit",sounds:["./sounds/car-hits/car-hit-1.mp3","./sounds/car-hits/car-hit-3.mp3","./sounds/car-hits/car-hit-4.mp3","./sounds/car-hits/car-hit-5.mp3"],minDelta:100,velocityMin:2,velocityMultiplier:1,volumeMin:.2,volumeMax:.6,rateMin:.35,rateMax:.55},{name:"woodHit",sounds:["./sounds/wood-hits/wood-hit-1.mp3"],minDelta:30,velocityMin:1,velocityMultiplier:1,volumeMin:.5,volumeMax:1,rateMin:.75,rateMax:1.5},{name:"screech",sounds:["./sounds/screeches/screech-1.mp3"],minDelta:1e3,velocityMin:0,velocityMultiplier:1,volumeMin:.75,volumeMax:1,rateMin:.9,rateMax:1.1},{name:"uiArea",sounds:["./sounds/ui/area-1.mp3"],minDelta:100,velocityMin:0,velocityMultiplier:1,volumeMin:.75,volumeMax:1,rateMin:.95,rateMax:1.05},{name:"carHorn1",sounds:["./sounds/car-horns/car-horn-1.mp3"],minDelta:0,velocityMin:0,velocityMultiplier:1,volumeMin:.95,volumeMax:1,rateMin:1,rateMax:1},{name:"carHorn2",sounds:["./sounds/car-horns/car-horn-2.mp3"],minDelta:0,velocityMin:0,velocityMultiplier:1,volumeMin:.95,volumeMax:1,rateMin:1,rateMax:1},{name:"horn",sounds:["./sounds/horns/horn-1.mp3","./sounds/horns/horn-2.mp3","./sounds/horns/horn-3.mp3"],minDelta:100,velocityMin:1,velocityMultiplier:.75,volumeMin:.5,volumeMax:1,rateMin:.75,rateMax:1},{name:"rocketLaunch",sounds:["./sounds/rocket/rocket_launch_sound.mp3"],minDelta:100,velocityMin:0,velocityMultiplier:1,volumeMin:1,volumeMax:1,rateMin:.8,rateMax:1}];for(const e of this.settings)this.add(e)}setMasterVolume(){this.masterVolume=.5,fn.Howler.volume(this.masterVolume),window.requestAnimationFrame(()=>{fn.Howler.volume(this.masterVolume)}),this.debug&&this.debugFolder.add(this,"masterVolume").step(.001).min(0).max(1).onChange(()=>{fn.Howler.volume(this.masterVolume)})}setMute(){this.muted=typeof this.debug<"u",fn.Howler.mute(this.muted),window.addEventListener("keydown",e=>{e.key==="m"&&(this.muted=!this.muted,fn.Howler.mute(this.muted))}),document.addEventListener("visibilitychange",()=>{document.hidden?fn.Howler.mute(!0):fn.Howler.mute(this.muted)}),this.debug&&this.debugFolder.add(this,"muted").listen().onChange(()=>{fn.Howler.mute(this.muted)})}setEngine(){if(this.engine={},this.engine.progress=0,this.engine.progressEasingUp=.3,this.engine.progressEasingDown=.15,this.engine.speed=0,this.engine.speedMultiplier=2.5,this.engine.acceleration=0,this.engine.accelerationMultiplier=.4,this.engine.rate={},this.engine.rate.min=.4,this.engine.rate.max=1.4,this.engine.volume={},this.engine.volume.min=.4,this.engine.volume.max=1,this.engine.volume.master=0,this.engine.sound=new fn.Howl({src:["./sounds/engines/1/low_off.mp3"],loop:!0}),this.engine.sound.play(),this.time.on("tick",()=>{let e=Math.abs(this.engine.speed)*this.engine.speedMultiplier+Math.max(this.engine.acceleration,0)*this.engine.accelerationMultiplier;e=Math.min(Math.max(e,0),1),this.engine.progress+=(e-this.engine.progress)*this.engine[e>this.engine.progress?"progressEasingUp":"progressEasingDown"];const t=this.engine.rate.max-this.engine.rate.min;this.engine.sound.rate(this.engine.rate.min+t*this.engine.progress);const i=this.engine.volume.max-this.engine.volume.min;this.engine.sound.volume((this.engine.volume.min+i*this.engine.progress)*this.engine.volume.master)}),this.debug){const e=this.debugFolder.addFolder("engine");e.open(),e.add(this.engine,"progressEasingUp").step(.001).min(0).max(1).name("progressEasingUp"),e.add(this.engine,"progressEasingDown").step(.001).min(0).max(1).name("progressEasingDown"),e.add(this.engine.rate,"min").step(.001).min(0).max(4).name("rateMin"),e.add(this.engine.rate,"max").step(.001).min(0).max(4).name("rateMax"),e.add(this.engine,"speedMultiplier").step(.01).min(0).max(5).name("speedMultiplier"),e.add(this.engine,"accelerationMultiplier").step(.01).min(0).max(100).name("accelerationMultiplier"),e.add(this.engine,"progress").step(.01).min(0).max(1).name("progress").listen()}}add(e){const t={name:e.name,minDelta:e.minDelta,velocityMin:e.velocityMin,velocityMultiplier:e.velocityMultiplier,volumeMin:e.volumeMin,volumeMax:e.volumeMax,rateMin:e.rateMin,rateMax:e.rateMax,lastTime:0,sounds:[]};for(const i of e.sounds){const s=new fn.Howl({src:[i]});t.sounds.push(s)}this.items.push(t)}play(e,t){const i=this.items.find(o=>o.name===e),s=Date.now(),r=typeof t>"u"?0:t;if(i&&s>i.lastTime+i.minDelta&&(i.velocityMin===0||r>i.velocityMin)){const o=i.sounds[Math.floor(Math.random()*i.sounds.length)];let l=Math.min(Math.max((r-i.velocityMin)*i.velocityMultiplier,i.volumeMin),i.volumeMax);l=Math.pow(l,2),o.volume(l);const h=i.rateMax-i.rateMin;o.rate(i.rateMin+Math.random()*h),o.play(),i.lastTime=s}}}class RA{constructor(e){this.config=e.config,this.time=e.time,this.resources=e.resources,this.objects=e.objects,this.areas=e.areas,this.walls=e.walls,this.tiles=e.tiles,this.debug=e.debug,this.scene=e.scene,this.x=e.x,this.y=e.y,this.container=new je,this.container.matrixAutoUpdate=!1,this.container.updateMatrix()}setFloor(){this.floor=new Ae(new pi(160,96),new Ne({color:8421504,transparent:!0,opacity:1,depthWrite:!1})),this.floor.frustumCulled=!1,this.floor.matrixAutoUpdate=!1,this.floor.updateMatrix(),this.container.add(this.floor)}setDikes(){this.dikes={},this.dikes.brickOptions={base:this.resources.items.brickBase.scene,collision:this.resources.items.brickCollision.scene,offset:new T(0,0,.1),rotation:new At(0,0,0),duplicated:!0,shadow:{sizeX:1.2,sizeY:1.8,offsetZ:-.15,alpha:.35},mass:0,soundName:"brick"},this.walls.add({object:this.dikes.brickOptions,shape:{type:"brick",equilibrateLastLine:!0,widthCount:109,heightCount:2,position:new T(this.x-96,this.y-0,0),offsetWidth:new T(0,1.05,0),offsetHeight:new T(0,0,.45),randomOffset:new T(0,0,0),randomRotation:new T(0,0,.2)}}),this.walls.add({object:this.dikes.brickOptions,shape:{type:"brick",equilibrateLastLine:!0,widthCount:109,heightCount:2,position:new T(this.x+96,this.y-0,0),offsetWidth:new T(0,1.05,0),offsetHeight:new T(0,0,.45),randomOffset:new T(0,0,0),randomRotation:new T(0,0,.2)}}),this.walls.add({object:{...this.dikes.brickOptions,rotation:new At(0,0,Math.PI*.5)},shape:{type:"brick",equilibrateLastLine:!0,widthCount:185,heightCount:2,position:new T(this.x-0,this.y+56,0),offsetWidth:new T(1.05,0,0),offsetHeight:new T(0,0,.45),randomOffset:new T(0,0,0),randomRotation:new T(0,0,.2)}}),this.walls.add({object:{...this.dikes.brickOptions,rotation:new At(0,0,Math.PI*.5)},shape:{type:"brick",equilibrateLastLine:!0,widthCount:185,heightCount:2,position:new T(this.x+0,this.y-56,0),offsetWidth:new T(1.05,0,0),offsetHeight:new T(0,0,.45),randomOffset:new T(0,0,0),randomRotation:new T(0,0,.2)}})}}let qf=20,$f=0,Zf=.03;const Nc=a=>a*(Math.PI/180);class PA{constructor(e){this.time=e.time,this.resources=e.resources,this.objects=e.objects,this.physics=e.physics,this.debug=e.debug,this.container=new je,this.container.matrixAutoUpdate=!1,this.setModel()}setModel(){var d;const e=(d=this.resources.items.Road)==null?void 0:d.scene;if(!e){console.error("Road model not found in resources");return}let t=[];e.children&&e.children.length>0?t=e.children:t=[e],new ft().setFromObject(e).getSize(new T);const s=new ie.Body({mass:0,position:new ie.Vec3(qf,$f,Zf),material:this.physics.materials.items.floor}),r=new ie.Box(new ie.Vec3(0,0,0));s.addShape(r),this.physics.world.addBody(s);const o=-90,l=180,h=180;this.model={},this.model.base=this.objects.add({base:{children:t},collision:{children:t},offset:new T(qf,$f,Zf),rotation:new At(Nc(o),Nc(l),Nc(h)),mass:0}),this.container.add(this.model.base.container)}}const IA=new T(29,-13,0);class LA{constructor({scene:e,resources:t,objects:i,physics:s,debug:r,rotateX:o=0,rotateY:l=0,rotateZ:h=0}){this.scene=e,this.resources=t,this.objects=i,this.physics=s,this.debug=r,this.rotateX=o,this.rotateY=l,this.rotateZ=h,this.container=new je,this.position=IA.clone(),this._buildModel(),this.scene.add(this.container)}_buildModel(){const e=this.resources.items.RoadSign,t=this.resources.items.Base;if(!e||!e.scene){console.error("RoadSign modeli bulunamadı");return}if(!t||!t.scene){console.error("Base modeli bulunamadı");return}const i=e.scene.clone(!0);i.traverse(c=>{if(c.isMesh){const u=c.material,p=u.clone();u.map&&(p.map=u.map),u.normalMap&&(p.normalMap=u.normalMap),u.roughnessMap&&(p.roughnessMap=u.roughnessMap),u.metalnessMap&&(p.metalnessMap=u.metalnessMap),p.needsUpdate=!0,c.material=p,c.castShadow=!0,c.receiveShadow=!0}});const s=t.scene.clone(!0);s.position.set(42.5,14,0),s.scale.set(0,0,0),i.position.copy(this.position),this.container.add(i),i.updateMatrixWorld(!0);var o=new ft().setFromObject(i).getSize(new T);const l=new ie.Vec3(o.x/12,o.y/8,2),h=new ie.Box(l),d=new ie.Body({mass:0,position:new ie.Vec3(this.position.x-2,this.position.y-1,this.position.z),material:this.physics.materials.items.floor}),f=new ie.Quaternion;if(f.setFromEuler(this.rotateX,this.rotateY,this.rotateZ,"XYZ"),d.quaternion.copy(f),d.addShape(h),this.physics.world.addBody(d),this.objects){const c=i.children.slice(),u=this.objects.add({base:{children:c},collision:{children:c},offset:this.position.clone(),mass:0});u.collision={body:d},u.container&&this.container.add(u.container)}}}class Kf{constructor({scene:e,resources:t,objects:i,physics:s,debug:r,rotateX:o=0,rotateY:l=0,rotateZ:h=0,position:d}){this.scene=e,this.resources=t,this.objects=i,this.physics=s,this.debug=r,this.rotateX=o,this.rotateY=l,this.rotateZ=h,this.container=new je,this.position=d}_buildModel(){const e=this.resources.items.TrafficLight,t=this.resources.items.Base;if(!e||!e.scene){console.error("RoadSign modeli bulunamadı");return}if(!t||!t.scene){console.error("Base modeli bulunamadı");return}const i=e.scene.clone(!0);i.traverse(f=>{if(f.isMesh){const c=f.material,u=c.clone();c.map&&(u.map=c.map),c.normalMap&&(u.normalMap=c.normalMap),c.roughnessMap&&(u.roughnessMap=c.roughnessMap),c.metalnessMap&&(u.metalnessMap=c.metalnessMap),u.needsUpdate=!0,f.material=u,f.castShadow=!0,f.receiveShadow=!0}});const s=t.scene.clone(!0);s.position.set(42.5,14,0),s.scale.set(0,0,0),i.scale.set(.13,.13,.13),i.rotation.set(this.rotateX,this.rotateY,this.rotateZ),i.position.copy(this.position),this.container.add(i),i.updateMatrixWorld(!0);var o=new ft().setFromObject(i).getSize(new T);const l=new ie.Vec3(o.x*1.5,o.y*1.5,o.z*10);new ie.Box(l);const h=new ie.Body({mass:0,position:new ie.Vec3(this.position.x,this.position.y,this.position.z),material:this.physics.materials.items.floor}),d=new ie.Quaternion;if(d.setFromEuler(this.rotateX,this.rotateY,this.rotateZ,"XYZ"),h.quaternion.copy(d),this.objects){const f=i.children.slice(),c=this.objects.add({base:{children:f},collision:{children:f},offset:this.position.clone(),mass:0});c.collision={body:h},c.container&&this.container.add(c.container)}}}const FA=new T(0,0,0);class BA{constructor({scene:e,resources:t,objects:i,physics:s,debug:r,rotateX:o=0,rotateY:l=0,rotateZ:h=0}){this.scene=e,this.resources=t,this.objects=i,this.physics=s,this.debug=r,this.rotateX=o,this.rotateY=l,this.rotateZ=h,this.container=new je,this.position=FA.clone(),this._buildModel(new T(-65.7,-16,0),1,.87,0,1,2),this._buildModel(new T(-56.9,-9.05,0),1,.87,0,1.3,1),this._buildModel(new T(-56.249,9.35,0),1,.87,0,1,1),this._buildModel(new T(-47.939,3.27,0),1,.87,0,1,1.7),this._buildModel(new T(-60,-27.4,0),1,.87,0,1.2,1),this._buildModel(new T(-56.04,-1.203,0),.55,0,0,1,1),this._buildModel(new T(-50.36,10.1,0),.55,0,0,1.6,1),this._buildModel(new T(-60.7,-17.65,0),.55,0,0,1,2),this._buildModel(new T(-57,6.34,0),.55,0,0,1,1.2),this._buildModel(new T(-52.65,.88,0),0,.55,1,1.2,1),this._buildModel(new T(-51.5,3.16,0),0,.55,1,1.2,1),this._buildModel(new T(-60.81,7.9,0),0,.55,1,1.2,1),this._buildModel(new T(-63.764,-4.15,0),0,.55,1,1.2,1),this._buildModel(new T(-53.32,-22.415,0),0,.55,1,1.2,1),this.scene.add(this.container)}_buildModel(e,t,i,s,r,o){const l=this.resources.items.Lego;if(!l||!l.scene){console.error("SectionStone bina modeli bulunamadı");return}const h=l.scene.clone(!0);h.traverse(_=>{if(_.isMesh){const g=_.material,v=g.clone();g.map&&(v.map=g.map),g.normalMap&&(v.normalMap=g.normalMap),g.roughnessMap&&(v.roughnessMap=g.roughnessMap),g.metalnessMap&&(v.metalnessMap=g.metalnessMap),v.needsUpdate=!0,_.material=v,_.castShadow=!0,_.receiveShadow=!0}}),h.position.copy(e),h.rotation.set(this.rotateX,this.rotateY,this.rotateZ),h.scale.set(r,o,.5),this.container.add(h),h.updateMatrixWorld(!0);var f=new ft().setFromObject(h).getSize(new T);const c=new ie.Vec3(f.x-.2,f.y-.2,f.z),u=new ie.Box(c),p=new ie.Body({mass:0,position:new ie.Vec3(e.x,e.y,e.z-.215),material:this.physics.materials.items.floor});h.children[0].material.color.r=t,h.children[0].material.color.g=i,h.children[0].material.color.b=s;const m=new ie.Quaternion;if(m.setFromEuler(this.rotateX,this.rotateY,this.rotateZ,"XYZ"),p.quaternion.copy(m),p.addShape(u),this.physics.world.addBody(p),this.objects){const _=h.children.slice(),g=this.objects.add({base:{children:_},collision:{children:_},offset:this.position.clone(),mass:0});g.collision={body:p},g.container&&this.container.add(g.container)}}}class aa extends Ln{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new UA(t)}),this.register(function(t){return new zA(t)}),this.register(function(t){return new $A(t)}),this.register(function(t){return new ZA(t)}),this.register(function(t){return new KA(t)}),this.register(function(t){return new HA(t)}),this.register(function(t){return new GA(t)}),this.register(function(t){return new WA(t)}),this.register(function(t){return new XA(t)}),this.register(function(t){return new OA(t)}),this.register(function(t){return new jA(t)}),this.register(function(t){return new VA(t)}),this.register(function(t){return new qA(t)}),this.register(function(t){return new YA(t)}),this.register(function(t){return new kA(t)}),this.register(function(t){return new QA(t)}),this.register(function(t){return new JA(t)})}load(e,t,i,s){const r=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const d=Hr.extractUrlBase(e);o=Hr.resolveURL(d,this.path)}else o=Hr.extractUrlBase(e);this.manager.itemStart(e);const l=function(d){s?s(d):console.error(d),r.manager.itemError(e),r.manager.itemEnd(e)},h=new Wo(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),h.setWithCredentials(this.withCredentials),h.load(e,function(d){try{r.parse(d,o,function(f){t(f),r.manager.itemEnd(e)},l)}catch(f){l(f)}},i,l)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let r;const o={},l={},h=new TextDecoder;if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(h.decode(new Uint8Array(e,0,4))===rg){try{o[bt.KHR_BINARY_GLTF]=new e1(e)}catch(c){s&&s(c);return}r=JSON.parse(o[bt.KHR_BINARY_GLTF].content)}else r=JSON.parse(h.decode(e));else r=e;if(r.asset===void 0||r.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const d=new f1(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});d.fileLoader.setRequestHeader(this.requestHeader);for(let f=0;f<this.pluginCallbacks.length;f++){const c=this.pluginCallbacks[f](d);c.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),l[c.name]=c,o[c.name]=!0}if(r.extensionsUsed)for(let f=0;f<r.extensionsUsed.length;++f){const c=r.extensionsUsed[f],u=r.extensionsRequired||[];switch(c){case bt.KHR_MATERIALS_UNLIT:o[c]=new NA;break;case bt.KHR_DRACO_MESH_COMPRESSION:o[c]=new t1(r,this.dracoLoader);break;case bt.KHR_TEXTURE_TRANSFORM:o[c]=new i1;break;case bt.KHR_MESH_QUANTIZATION:o[c]=new n1;break;default:u.indexOf(c)>=0&&l[c]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+c+'".')}}d.setExtensions(o),d.setPlugins(l),d.parse(i,s)}parseAsync(e,t){const i=this;return new Promise(function(s,r){i.parse(e,t,s,r)})}}function DA(){let a={};return{get:function(e){return a[e]},add:function(e,t){a[e]=t},remove:function(e){delete a[e]},removeAll:function(){a={}}}}const bt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class kA{constructor(e){this.parser=e,this.name=bt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,s=t.length;i<s;i++){const r=t[i];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let s=t.cache.get(i);if(s)return s;const r=t.json,h=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let d;const f=new Le(16777215);h.color!==void 0&&f.setRGB(h.color[0],h.color[1],h.color[2],bi);const c=h.range!==void 0?h.range:0;switch(h.type){case"directional":d=new ra(f),d.target.position.set(0,0,-1),d.add(d.target);break;case"point":d=new sh(f),d.distance=c;break;case"spot":d=new Zp(f),d.distance=c,h.spot=h.spot||{},h.spot.innerConeAngle=h.spot.innerConeAngle!==void 0?h.spot.innerConeAngle:0,h.spot.outerConeAngle=h.spot.outerConeAngle!==void 0?h.spot.outerConeAngle:Math.PI/4,d.angle=h.spot.outerConeAngle,d.penumbra=1-h.spot.innerConeAngle/h.spot.outerConeAngle,d.target.position.set(0,0,-1),d.add(d.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+h.type)}return d.position.set(0,0,0),d.decay=2,us(d,h),h.intensity!==void 0&&(d.intensity=h.intensity),d.name=t.createUniqueName(h.name||"light_"+e),s=Promise.resolve(d),t.cache.add(i,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,r=i.json.nodes[e],l=(r.extensions&&r.extensions[this.name]||{}).light;return l===void 0?null:this._loadLight(l).then(function(h){return i._getNodeRef(t.cache,l,h)})}}class NA{constructor(){this.name=bt.KHR_MATERIALS_UNLIT}getMaterialType(){return Ne}extendParams(e,t,i){const s=[];e.color=new Le(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],bi),e.opacity=o[3]}r.baseColorTexture!==void 0&&s.push(i.assignTexture(e,"map",r.baseColorTexture,ei))}return Promise.all(s)}}class OA{constructor(e){this.parser=e,this.name=bt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}class UA{constructor(e){this.parser=e,this.name=bt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Dn}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const l=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Oe(l,l)}return Promise.all(r)}}class zA{constructor(e){this.parser=e,this.name=bt.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Dn}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.dispersion=r.dispersion!==void 0?r.dispersion:0,Promise.resolve()}}class VA{constructor(e){this.parser=e,this.name=bt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Dn}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}}class HA{constructor(e){this.parser=e,this.name=bt.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Dn}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new Le(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=s.extensions[this.name];if(o.sheenColorFactor!==void 0){const l=o.sheenColorFactor;t.sheenColor.setRGB(l[0],l[1],l[2],bi)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,ei)),o.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}}class GA{constructor(e){this.parser=e,this.name=bt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Dn}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}}class WA{constructor(e){this.parser=e,this.name=bt.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Dn}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const l=o.attenuationColor||[1,1,1];return t.attenuationColor=new Le().setRGB(l[0],l[1],l[2],bi),Promise.all(r)}}class XA{constructor(e){this.parser=e,this.name=bt.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Dn}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class jA{constructor(e){this.parser=e,this.name=bt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Dn}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const l=o.specularColorFactor||[1,1,1];return t.specularColor=new Le().setRGB(l[0],l[1],l[2],bi),o.specularColorTexture!==void 0&&r.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,ei)),Promise.all(r)}}class YA{constructor(e){this.parser=e,this.name=bt.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Dn}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&r.push(i.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(r)}}class qA{constructor(e){this.parser=e,this.name=bt.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Dn}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(i.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}}class $A{constructor(e){this.parser=e,this.name=bt.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,s=i.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}}class ZA{constructor(e){this.parser=e,this.name=bt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],l=s.images[o.source];let h=i.textureLoader;if(l.uri){const d=i.options.manager.getHandler(l.uri);d!==null&&(h=d)}return this.detectSupport().then(function(d){if(d)return i.loadTextureImage(e,o.source,h);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class KA{constructor(e){this.parser=e,this.name=bt.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],l=s.images[o.source];let h=i.textureLoader;if(l.uri){const d=i.options.manager.getHandler(l.uri);d!==null&&(h=d)}return this.detectSupport().then(function(d){if(d)return i.loadTextureImage(e,o.source,h);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class QA{constructor(e){this.name=bt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(l){const h=s.byteOffset||0,d=s.byteLength||0,f=s.count,c=s.byteStride,u=new Uint8Array(l,h,d);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(f,c,u,s.mode,s.filter).then(function(p){return p.buffer}):o.ready.then(function(){const p=new ArrayBuffer(f*c);return o.decodeGltfBuffer(new Uint8Array(p),f,c,u,s.mode,s.filter),p})})}else return null}}class JA{constructor(e){this.name=bt.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=t.meshes[i.mesh];for(const d of s.primitives)if(d.mode!==sn.TRIANGLES&&d.mode!==sn.TRIANGLE_STRIP&&d.mode!==sn.TRIANGLE_FAN&&d.mode!==void 0)return null;const o=i.extensions[this.name].attributes,l=[],h={};for(const d in o)l.push(this.parser.getDependency("accessor",o[d]).then(f=>(h[d]=f,h[d])));return l.length<1?null:(l.push(this.parser.createNodeMesh(e)),Promise.all(l).then(d=>{const f=d.pop(),c=f.isGroup?f.children:[f],u=d[0].count,p=[];for(const m of c){const _=new Je,g=new T,v=new Tt,y=new T(1,1,1),x=new iw(m.geometry,m.material,u);for(let b=0;b<u;b++)h.TRANSLATION&&g.fromBufferAttribute(h.TRANSLATION,b),h.ROTATION&&v.fromBufferAttribute(h.ROTATION,b),h.SCALE&&y.fromBufferAttribute(h.SCALE,b),x.setMatrixAt(b,_.compose(g,v,y));for(const b in h)if(b==="_COLOR_0"){const S=h[b];x.instanceColor=new eh(S.array,S.itemSize,S.normalized)}else b!=="TRANSLATION"&&b!=="ROTATION"&&b!=="SCALE"&&m.geometry.setAttribute(b,h[b]);je.prototype.copy.call(x,m),this.parser.assignFinalMaterial(x),p.push(x)}return f.isGroup?(f.clear(),f.add(...p),f):p[0]}))}}const rg="glTF",Mo=12,Qf={JSON:1313821514,BIN:5130562};class e1{constructor(e){this.name=bt.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Mo),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==rg)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-Mo,r=new DataView(e,Mo);let o=0;for(;o<s;){const l=r.getUint32(o,!0);o+=4;const h=r.getUint32(o,!0);if(o+=4,h===Qf.JSON){const d=new Uint8Array(e,Mo+o,l);this.content=i.decode(d)}else if(h===Qf.BIN){const d=Mo+o;this.body=e.slice(d,d+l)}o+=l}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class t1{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=bt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,s=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,l={},h={},d={};for(const f in o){const c=Th[f]||f.toLowerCase();l[c]=o[f]}for(const f in e.attributes){const c=Th[f]||f.toLowerCase();if(o[f]!==void 0){const u=i.accessors[e.attributes[f]],p=jr[u.componentType];d[c]=p.name,h[c]=u.normalized===!0}}return t.getDependency("bufferView",r).then(function(f){return new Promise(function(c,u){s.decodeDracoFile(f,function(p){for(const m in p.attributes){const _=p.attributes[m],g=h[m];g!==void 0&&(_.normalized=g)}c(p)},l,d,bi,u)})})}}class i1{constructor(){this.name=bt.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class n1{constructor(){this.name=bt.KHR_MESH_QUANTIZATION}}class og extends sa{constructor(e,t,i,s){super(e,t,i,s)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let o=0;o!==s;o++)t[o]=i[r+o];return t}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,l=this.valueSize,h=l*2,d=l*3,f=s-t,c=(i-t)/f,u=c*c,p=u*c,m=e*d,_=m-d,g=-2*p+3*u,v=p-u,y=1-g,x=v-u+c;for(let b=0;b!==l;b++){const S=o[_+b+l],A=o[_+b+h]*f,E=o[m+b+l],R=o[m+b]*f;r[b]=y*S+x*A+g*E+v*R}return r}}const s1=new Tt;class r1 extends og{interpolate_(e,t,i,s){const r=super.interpolate_(e,t,i,s);return s1.fromArray(r).normalize().toArray(r),r}}const sn={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},jr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Jf={9728:li,9729:Nt,9984:pp,9985:Qa,9986:So,9987:Yn},ep={33071:Tn,33648:ll,10497:In},Oc={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Th={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ls={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},o1={CUBICSPLINE:void 0,LINEAR:Zr,STEP:Uo},Uc={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function a1(a){return a.DefaultMaterial===void 0&&(a.DefaultMaterial=new Ei({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Kn})),a.DefaultMaterial}function Os(a,e,t){for(const i in t.extensions)a[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function us(a,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(a.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function l1(a,e,t){let i=!1,s=!1,r=!1;for(let d=0,f=e.length;d<f;d++){const c=e[d];if(c.POSITION!==void 0&&(i=!0),c.NORMAL!==void 0&&(s=!0),c.COLOR_0!==void 0&&(r=!0),i&&s&&r)break}if(!i&&!s&&!r)return Promise.resolve(a);const o=[],l=[],h=[];for(let d=0,f=e.length;d<f;d++){const c=e[d];if(i){const u=c.POSITION!==void 0?t.getDependency("accessor",c.POSITION):a.attributes.position;o.push(u)}if(s){const u=c.NORMAL!==void 0?t.getDependency("accessor",c.NORMAL):a.attributes.normal;l.push(u)}if(r){const u=c.COLOR_0!==void 0?t.getDependency("accessor",c.COLOR_0):a.attributes.color;h.push(u)}}return Promise.all([Promise.all(o),Promise.all(l),Promise.all(h)]).then(function(d){const f=d[0],c=d[1],u=d[2];return i&&(a.morphAttributes.position=f),s&&(a.morphAttributes.normal=c),r&&(a.morphAttributes.color=u),a.morphTargetsRelative=!0,a})}function c1(a,e){if(a.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)a.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(a.morphTargetInfluences.length===t.length){a.morphTargetDictionary={};for(let i=0,s=t.length;i<s;i++)a.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function h1(a){let e;const t=a.extensions&&a.extensions[bt.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+zc(t.attributes):e=a.indices+":"+zc(a.attributes)+":"+a.mode,a.targets!==void 0)for(let i=0,s=a.targets.length;i<s;i++)e+=":"+zc(a.targets[i]);return e}function zc(a){let e="";const t=Object.keys(a).sort();for(let i=0,s=t.length;i<s;i++)e+=t[i]+":"+a[t[i]]+";";return e}function Ch(a){switch(a){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function u1(a){return a.search(/\.jpe?g($|\?)/i)>0||a.search(/^data\:image\/jpeg/)===0?"image/jpeg":a.search(/\.webp($|\?)/i)>0||a.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const d1=new Je;class f1{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new DA,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=!1,r=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,r=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||s&&r<98?this.textureLoader=new Wh(this.options.manager):this.textureLoader=new Uw(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Wo(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,s=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const l={scene:o[0][s.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:s.asset,parser:i,userData:{}};return Os(r,l,s),us(l,s),Promise.all(i._invokeAll(function(h){return h.afterRoot&&h.afterRoot(l)})).then(function(){for(const h of l.scenes)h.updateMatrixWorld();e(l)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let s=0,r=t.length;s<r;s++){const o=t[s].joints;for(let l=0,h=o.length;l<h;l++)e[o[l]].isBone=!0}for(let s=0,r=e.length;s<r;s++){const o=e[s];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const s=i.clone(),r=(o,l)=>{const h=this.associations.get(o);h!=null&&this.associations.set(l,h);for(const[d,f]of o.children.entries())r(f,l.children[d])};return r(i,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const s=e(t[i]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let s=0;s<t.length;s++){const r=e(t[s]);r&&i.push(r)}return i}getDependency(e,t){const i=e+":"+t;let s=this.cache.get(i);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(r){return r.loadNode&&r.loadNode(t)});break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(i,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(r,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[bt.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,o){i.load(Hr.resolveURL(t.uri,s.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const s=t.byteLength||0,r=t.byteOffset||0;return i.slice(r,r+s)})}loadAccessor(e){const t=this,i=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const o=Oc[s.type],l=jr[s.componentType],h=s.normalized===!0,d=new l(s.count*o);return Promise.resolve(new ci(d,o,h))}const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(o){const l=o[0],h=Oc[s.type],d=jr[s.componentType],f=d.BYTES_PER_ELEMENT,c=f*h,u=s.byteOffset||0,p=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,m=s.normalized===!0;let _,g;if(p&&p!==c){const v=Math.floor(u/p),y="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+v+":"+s.count;let x=t.cache.get(y);x||(_=new d(l,v*p,s.count*p/f),x=new Qb(_,p/f),t.cache.add(y,x)),g=new Uh(x,h,u%p/f,m)}else l===null?_=new d(s.count*h):_=new d(l,u,s.count*h),g=new ci(_,h,m);if(s.sparse!==void 0){const v=Oc.SCALAR,y=jr[s.sparse.indices.componentType],x=s.sparse.indices.byteOffset||0,b=s.sparse.values.byteOffset||0,S=new y(o[1],x,s.sparse.count*v),A=new d(o[2],b,s.sparse.count*h);l!==null&&(g=new ci(g.array.slice(),g.itemSize,g.normalized));for(let E=0,R=S.length;E<R;E++){const M=S[E];if(g.setX(M,A[E*h]),h>=2&&g.setY(M,A[E*h+1]),h>=3&&g.setZ(M,A[E*h+2]),h>=4&&g.setW(M,A[E*h+3]),h>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(e){const t=this.json,i=this.options,r=t.textures[e].source,o=t.images[r];let l=this.textureLoader;if(o.uri){const h=i.manager.getHandler(o.uri);h!==null&&(l=h)}return this.loadTextureImage(e,r,l)}loadTextureImage(e,t,i){const s=this,r=this.json,o=r.textures[e],l=r.images[t],h=(l.uri||l.bufferView)+":"+o.sampler;if(this.textureCache[h])return this.textureCache[h];const d=this.loadImageSource(t,i).then(function(f){f.flipY=!1,f.name=o.name||l.name||"",f.name===""&&typeof l.uri=="string"&&l.uri.startsWith("data:image/")===!1&&(f.name=l.uri);const u=(r.samplers||{})[o.sampler]||{};return f.magFilter=Jf[u.magFilter]||Nt,f.minFilter=Jf[u.minFilter]||Yn,f.wrapS=ep[u.wrapS]||In,f.wrapT=ep[u.wrapT]||In,s.associations.set(f,{textures:e}),f}).catch(function(){return null});return this.textureCache[h]=d,d}loadImageSource(e,t){const i=this,s=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(c=>c.clone());const o=s.images[e],l=self.URL||self.webkitURL;let h=o.uri||"",d=!1;if(o.bufferView!==void 0)h=i.getDependency("bufferView",o.bufferView).then(function(c){d=!0;const u=new Blob([c],{type:o.mimeType});return h=l.createObjectURL(u),h});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const f=Promise.resolve(h).then(function(c){return new Promise(function(u,p){let m=u;t.isImageBitmapLoader===!0&&(m=function(_){const g=new Ht(_);g.needsUpdate=!0,u(g)}),t.load(Hr.resolveURL(c,r.path),m,void 0,p)})}).then(function(c){return d===!0&&l.revokeObjectURL(h),c.userData.mimeType=o.mimeType||u1(o.uri),c}).catch(function(c){throw console.error("THREE.GLTFLoader: Couldn't load texture",h),c});return this.sourceCache[e]=f,f}assignTexture(e,t,i,s){const r=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),r.extensions[bt.KHR_TEXTURE_TRANSFORM]){const l=i.extensions!==void 0?i.extensions[bt.KHR_TEXTURE_TRANSFORM]:void 0;if(l){const h=r.associations.get(o);o=r.extensions[bt.KHR_TEXTURE_TRANSFORM].extendTexture(o,l),r.associations.set(o,h)}}return s!==void 0&&(o.colorSpace=s),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const s=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const l="PointsMaterial:"+i.uuid;let h=this.cache.get(l);h||(h=new Gp,Qi.prototype.copy.call(h,i),h.color.copy(i.color),h.map=i.map,h.sizeAttenuation=!1,this.cache.add(l,h)),i=h}else if(e.isLine){const l="LineBasicMaterial:"+i.uuid;let h=this.cache.get(l);h||(h=new tr,Qi.prototype.copy.call(h,i),h.color.copy(i.color),h.map=i.map,this.cache.add(l,h)),i=h}if(s||r||o){let l="ClonedMaterial:"+i.uuid+":";s&&(l+="derivative-tangents:"),r&&(l+="vertex-colors:"),o&&(l+="flat-shading:");let h=this.cache.get(l);h||(h=i.clone(),r&&(h.vertexColors=!0),o&&(h.flatShading=!0),s&&(h.normalScale&&(h.normalScale.y*=-1),h.clearcoatNormalScale&&(h.clearcoatNormalScale.y*=-1)),this.cache.add(l,h),this.associations.set(h,this.associations.get(i))),i=h}e.material=i}getMaterialType(){return Ei}loadMaterial(e){const t=this,i=this.json,s=this.extensions,r=i.materials[e];let o;const l={},h=r.extensions||{},d=[];if(h[bt.KHR_MATERIALS_UNLIT]){const c=s[bt.KHR_MATERIALS_UNLIT];o=c.getMaterialType(),d.push(c.extendParams(l,r,t))}else{const c=r.pbrMetallicRoughness||{};if(l.color=new Le(1,1,1),l.opacity=1,Array.isArray(c.baseColorFactor)){const u=c.baseColorFactor;l.color.setRGB(u[0],u[1],u[2],bi),l.opacity=u[3]}c.baseColorTexture!==void 0&&d.push(t.assignTexture(l,"map",c.baseColorTexture,ei)),l.metalness=c.metallicFactor!==void 0?c.metallicFactor:1,l.roughness=c.roughnessFactor!==void 0?c.roughnessFactor:1,c.metallicRoughnessTexture!==void 0&&(d.push(t.assignTexture(l,"metalnessMap",c.metallicRoughnessTexture)),d.push(t.assignTexture(l,"roughnessMap",c.metallicRoughnessTexture))),o=this._invokeOne(function(u){return u.getMaterialType&&u.getMaterialType(e)}),d.push(Promise.all(this._invokeAll(function(u){return u.extendMaterialParams&&u.extendMaterialParams(e,l)})))}r.doubleSided===!0&&(l.side=Ui);const f=r.alphaMode||Uc.OPAQUE;if(f===Uc.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,f===Uc.MASK&&(l.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==Ne&&(d.push(t.assignTexture(l,"normalMap",r.normalTexture)),l.normalScale=new Oe(1,1),r.normalTexture.scale!==void 0)){const c=r.normalTexture.scale;l.normalScale.set(c,c)}if(r.occlusionTexture!==void 0&&o!==Ne&&(d.push(t.assignTexture(l,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(l.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==Ne){const c=r.emissiveFactor;l.emissive=new Le().setRGB(c[0],c[1],c[2],bi)}return r.emissiveTexture!==void 0&&o!==Ne&&d.push(t.assignTexture(l,"emissiveMap",r.emissiveTexture,ei)),Promise.all(d).then(function(){const c=new o(l);return r.name&&(c.name=r.name),us(c,r),t.associations.set(c,{materials:e}),r.extensions&&Os(s,c,r),c})}createUniqueName(e){const t=Mt.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,s=this.primitiveCache;function r(l){return i[bt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(l,t).then(function(h){return tp(h,l,t)})}const o=[];for(let l=0,h=e.length;l<h;l++){const d=e[l],f=h1(d),c=s[f];if(c)o.push(c.promise);else{let u;d.extensions&&d.extensions[bt.KHR_DRACO_MESH_COMPRESSION]?u=r(d):u=tp(new Bt,d,t),s[f]={primitive:d,promise:u},o.push(u)}}return Promise.all(o)}loadMesh(e){const t=this,i=this.json,s=this.extensions,r=i.meshes[e],o=r.primitives,l=[];for(let h=0,d=o.length;h<d;h++){const f=o[h].material===void 0?a1(this.cache):this.getDependency("material",o[h].material);l.push(f)}return l.push(t.loadGeometries(o)),Promise.all(l).then(function(h){const d=h.slice(0,h.length-1),f=h[h.length-1],c=[];for(let p=0,m=f.length;p<m;p++){const _=f[p],g=o[p];let v;const y=d[p];if(g.mode===sn.TRIANGLES||g.mode===sn.TRIANGLE_STRIP||g.mode===sn.TRIANGLE_FAN||g.mode===void 0)v=r.isSkinnedMesh===!0?new Hp(_,y):new Ae(_,y),v.isSkinnedMesh===!0&&v.normalizeSkinWeights(),g.mode===sn.TRIANGLE_STRIP?v.geometry=Pf(v.geometry,Mp):g.mode===sn.TRIANGLE_FAN&&(v.geometry=Pf(v.geometry,Kc));else if(g.mode===sn.LINES)v=new Vh(_,y);else if(g.mode===sn.LINE_STRIP)v=new qi(_,y);else if(g.mode===sn.LINE_LOOP)v=new nw(_,y);else if(g.mode===sn.POINTS)v=new sw(_,y);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(v.geometry.morphAttributes).length>0&&c1(v,r),v.name=t.createUniqueName(r.name||"mesh_"+e),us(v,r),g.extensions&&Os(s,v,g),t.assignFinalMaterial(v),c.push(v)}for(let p=0,m=c.length;p<m;p++)t.associations.set(c[p],{meshes:e,primitives:p});if(c.length===1)return r.extensions&&Os(s,c[0],r),c[0];const u=new $n;r.extensions&&Os(s,u,r),t.associations.set(u,{meshes:e});for(let p=0,m=c.length;p<m;p++)u.add(c[p]);return u})}loadCamera(e){let t;const i=this.json.cameras[e],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new Pi(Ai.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(t=new ia(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),us(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let s=0,r=t.joints.length;s<r;s++)i.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){const r=s.pop(),o=s,l=[],h=[];for(let d=0,f=o.length;d<f;d++){const c=o[d];if(c){l.push(c);const u=new Je;r!==null&&u.fromArray(r.array,d*16),h.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[d])}return new Ll(l,h)})}loadAnimation(e){const t=this.json,i=this,s=t.animations[e],r=s.name?s.name:"animation_"+e,o=[],l=[],h=[],d=[],f=[];for(let c=0,u=s.channels.length;c<u;c++){const p=s.channels[c],m=s.samplers[p.sampler],_=p.target,g=_.node,v=s.parameters!==void 0?s.parameters[m.input]:m.input,y=s.parameters!==void 0?s.parameters[m.output]:m.output;_.node!==void 0&&(o.push(this.getDependency("node",g)),l.push(this.getDependency("accessor",v)),h.push(this.getDependency("accessor",y)),d.push(m),f.push(_))}return Promise.all([Promise.all(o),Promise.all(l),Promise.all(h),Promise.all(d),Promise.all(f)]).then(function(c){const u=c[0],p=c[1],m=c[2],_=c[3],g=c[4],v=[];for(let y=0,x=u.length;y<x;y++){const b=u[y],S=p[y],A=m[y],E=_[y],R=g[y];if(b===void 0)continue;b.updateMatrix&&b.updateMatrix();const M=i._createAnimationTracks(b,S,A,E,R);if(M)for(let w=0;w<M.length;w++)v.push(M[w])}return new _l(r,void 0,v)})}createNodeMesh(e){const t=this.json,i=this,s=t.nodes[e];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(r){const o=i._getNodeRef(i.meshCache,s.mesh,r);return s.weights!==void 0&&o.traverse(function(l){if(l.isMesh)for(let h=0,d=s.weights.length;h<d;h++)l.morphTargetInfluences[h]=s.weights[h]}),o})}loadNode(e){const t=this.json,i=this,s=t.nodes[e],r=i._loadNodeShallow(e),o=[],l=s.children||[];for(let d=0,f=l.length;d<f;d++)o.push(i.getDependency("node",l[d]));const h=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([r,Promise.all(o),h]).then(function(d){const f=d[0],c=d[1],u=d[2];u!==null&&f.traverse(function(p){p.isSkinnedMesh&&p.bind(u,d1)});for(let p=0,m=c.length;p<m;p++)f.add(c[p]);return f})}_loadNodeShallow(e){const t=this.json,i=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const r=t.nodes[e],o=r.name?s.createUniqueName(r.name):"",l=[],h=s._invokeOne(function(d){return d.createNodeMesh&&d.createNodeMesh(e)});return h&&l.push(h),r.camera!==void 0&&l.push(s.getDependency("camera",r.camera).then(function(d){return s._getNodeRef(s.cameraCache,r.camera,d)})),s._invokeAll(function(d){return d.createNodeAttachment&&d.createNodeAttachment(e)}).forEach(function(d){l.push(d)}),this.nodeCache[e]=Promise.all(l).then(function(d){let f;if(r.isBone===!0?f=new pl:d.length>1?f=new $n:d.length===1?f=d[0]:f=new je,f!==d[0])for(let c=0,u=d.length;c<u;c++)f.add(d[c]);if(r.name&&(f.userData.name=r.name,f.name=o),us(f,r),r.extensions&&Os(i,f,r),r.matrix!==void 0){const c=new Je;c.fromArray(r.matrix),f.applyMatrix4(c)}else r.translation!==void 0&&f.position.fromArray(r.translation),r.rotation!==void 0&&f.quaternion.fromArray(r.rotation),r.scale!==void 0&&f.scale.fromArray(r.scale);return s.associations.has(f)||s.associations.set(f,{}),s.associations.get(f).nodes=e,f}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],s=this,r=new $n;i.name&&(r.name=s.createUniqueName(i.name)),us(r,i),i.extensions&&Os(t,r,i);const o=i.nodes||[],l=[];for(let h=0,d=o.length;h<d;h++)l.push(s.getDependency("node",o[h]));return Promise.all(l).then(function(h){for(let f=0,c=h.length;f<c;f++)r.add(h[f]);const d=f=>{const c=new Map;for(const[u,p]of s.associations)(u instanceof Qi||u instanceof Ht)&&c.set(u,p);return f.traverse(u=>{const p=s.associations.get(u);p!=null&&c.set(u,p)}),c};return s.associations=d(r),r})}_createAnimationTracks(e,t,i,s,r){const o=[],l=e.name?e.name:e.uuid,h=[];ls[r.path]===ls.weights?e.traverse(function(u){u.morphTargetInfluences&&h.push(u.name?u.name:u.uuid)}):h.push(l);let d;switch(ls[r.path]){case ls.weights:d=Ks;break;case ls.rotation:d=Qn;break;case ls.position:case ls.scale:d=Qs;break;default:switch(i.itemSize){case 1:d=Ks;break;case 2:case 3:default:d=Qs;break}break}const f=s.interpolation!==void 0?o1[s.interpolation]:Zr,c=this._getArrayFromAccessor(i);for(let u=0,p=h.length;u<p;u++){const m=new d(h[u]+"."+ls[r.path],t.array,c,f);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),o.push(m)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=Ch(t.constructor),s=new Float32Array(t.length);for(let r=0,o=t.length;r<o;r++)s[r]=t[r]*i;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const s=this instanceof Qn?r1:og;return new s(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function p1(a,e,t){const i=e.attributes,s=new ft;if(i.POSITION!==void 0){const l=t.json.accessors[i.POSITION],h=l.min,d=l.max;if(h!==void 0&&d!==void 0){if(s.set(new T(h[0],h[1],h[2]),new T(d[0],d[1],d[2])),l.normalized){const f=Ch(jr[l.componentType]);s.min.multiplyScalar(f),s.max.multiplyScalar(f)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const l=new T,h=new T;for(let d=0,f=r.length;d<f;d++){const c=r[d];if(c.POSITION!==void 0){const u=t.json.accessors[c.POSITION],p=u.min,m=u.max;if(p!==void 0&&m!==void 0){if(h.setX(Math.max(Math.abs(p[0]),Math.abs(m[0]))),h.setY(Math.max(Math.abs(p[1]),Math.abs(m[1]))),h.setZ(Math.max(Math.abs(p[2]),Math.abs(m[2]))),u.normalized){const _=Ch(jr[u.componentType]);h.multiplyScalar(_)}l.max(h)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(l)}a.boundingBox=s;const o=new Bn;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,a.boundingSphere=o}function tp(a,e,t){const i=e.attributes,s=[];function r(o,l){return t.getDependency("accessor",o).then(function(h){a.setAttribute(l,h)})}for(const o in i){const l=Th[o]||o.toLowerCase();l in a.attributes||s.push(r(i[o],l))}if(e.indices!==void 0&&!a.index){const o=t.getDependency("accessor",e.indices).then(function(l){a.setIndex(l)});s.push(o)}return Rt.workingColorSpace!==bi&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Rt.workingColorSpace}" not supported.`),us(a,e),p1(a,e,t),Promise.all(s).then(function(){return e.targets!==void 0?l1(a,e.targets,t):a})}class m1{constructor(e){this.time=e.time,this.scene=e.scene,this.physics=e.physics,this.mixer=null,this.model=null,this.collisionBody=null,this.setModel(),this.time?this.time.on("tick",()=>{this.tick(this.time.delta*.001)}):console.warn("AlaaddinTepesi: time parametresi verilmedi, animasyonlar çalışmayacak.")}setModel(){if(!this.scene){console.warn("AlaaddinTepesi: scene parametresi verilmedi, model sahneye eklenmeyecek.");return}const e=new aa;e.load("./models/SectionAlaaddin/base.glb",t=>{if(this.model=t.scene,this.model.position.set(9.3,-52.5,1),this.model.scale.set(1,1,1),this.model.rotation.x=Math.PI/2,this.scene.add(this.model),!this.scene.__balikLightAdded){this.scene.add(new Dl(16777215,2));const i=new ra(16777215,2);i.position.set(5,10,7.5),this.scene.add(i),this.scene.__balikLightAdded=!0}this.model.traverse(i=>{i.isMesh&&(i.castShadow=!0,i.receiveShadow=!0,i.material||(i.material=new Ei({color:65280})),i.material&&i.material.type==="MeshBasicMaterial"&&(i.material=new Ei({color:i.material.color||16777215})),i.material.transparent=!1,i.material.opacity=1)}),t.animations&&t.animations.length>0?(this.mixer=new qh(this.model),t.animations.forEach((i,s)=>{this.mixer.clipAction(i).reset().play()})):console.warn("Hiç animasyon bulunamadı!")}),e.load("./models/Base/base.glb",t=>{const i=t.scene;if(i.position.set(9,-52,-.5),i.scale.set(3.8,3.8,1.5),this.scene.add(i),i.traverse(r=>{r.isMesh&&(r.castShadow=!0,r.receiveShadow=!0,r.material||(r.material=new Ei({color:255})),r.material&&r.material.type==="MeshBasicMaterial"&&(r.material=new Ei({color:r.material.color||16777215})),r.material.transparent=!1,r.material.opacity=1,r.material=r.material.clone(),r.material.color.r=.2,r.material.color.g=.6,r.material.color.b=0)}),this.physics){this.collisionBody=new ie.Body({mass:0,position:i.position,material:this.physics.materials.items.floor}),i.updateMatrixWorld(!0);var s=new ft().setFromObject(i).getSize(new T);const o=new ie.Vec3(s.x/1.97,s.y/1.97,2),l=new ie.Box(o),h=new ie.Body({mass:0,position:new ie.Vec3(i.position.x,i.position.y,1),material:this.physics.materials.items.floor}),d=new ie.Quaternion;d.setFromEuler(this.rotateX,this.rotateY,this.rotateZ,"XYZ"),h.quaternion.copy(d),console.log(l),h.addShape(l),this.collisionBody.addShape(l),this.physics.world.addBody(this.collisionBody)}})}tick(e){this.mixer&&this.mixer.update(e)}}class g1{constructor(e){this.time=e.time,this.scene=e.scene,this.physics=e.physics,this.mixer=null,this.model=null,this.collisionBody=null,this.setModel()}setModel(){if(!this.scene){console.warn("SectionAtmosphere: scene parametresi verilmedi, model sahneye eklenmeyecek.");return}new aa().load("./models/SectionAtmosphere/base.glb",t=>{if(this.model=t.scene,this.model.position.set(-20,-8,0),this.model.scale.set(1,1,1),this.model.rotation.x=-80.1,this.model.rotation.y=25,this.scene.add(this.model),this.physics&&(this.collisionBody=new ie.Body({mass:0,position:new ie.Vec3(-6,-28,1),material:this.physics.materials.items.floor}),new ie.Box(new ie.Vec3(5.2,5.2,5.2)),this.physics.world.addBody(this.collisionBody)),!this.scene.__balikLightAdded){this.scene.add(new Dl(16777215,2));const i=new ra(16777215,2);i.position.set(5,10,7.5),this.scene.add(i),this.scene.__balikLightAdded=!0}this.model.traverse(i=>{i.isMesh&&(i.castShadow=!0,i.receiveShadow=!0,i.material||(i.material=new Ei({color:65280})),i.material&&i.material.type==="MeshBasicMaterial"&&(i.material=new Ei({color:i.material.color||16777215})),i.material.transparent=!1,i.material.opacity=1)})})}tick(e){this.mixer&&this.mixer.update(e)}}const v1=new T(36.1,-18,3.5);class _1{constructor({scene:e,resources:t,objects:i,physics:s,debug:r,rotateX:o=0,rotateY:l=0,rotateZ:h=0}){this.scene=e,this.resources=t,this.objects=i,this.physics=s,this.debug=r,this.rotateX=o,this.rotateY=l,this.rotateZ=h,this.container=new je,this.position=v1.clone(),this._buildModel(),this.scene.add(this.container)}_buildModel(){const e=this.resources.items.Capsule,t=this.resources.items.Base;if(!e||!e.scene){console.error("Kapsül modeli bulunamadı");return}if(!t||!t.scene){console.error("Base modeli bulunamadı"),n;return}const i=e.scene.clone(!0);i.traverse(c=>{if(c.isMesh){const u=c.material,p=u.clone();u.map&&(p.map=u.map),u.normalMap&&(p.normalMap=u.normalMap),u.roughnessMap&&(p.roughnessMap=u.roughnessMap),u.metalnessMap&&(p.metalnessMap=u.metalnessMap),p.needsUpdate=!0,c.material=p,c.castShadow=!0,c.receiveShadow=!0,c.scale.set(1,1,1)}});const s=t.scene.clone(!0);s.position.set(37,-18,0),s.scale.set(1.5,1.5,1.5),this.container.add(s),i.position.copy(this.position),i.rotation.set(this.rotateX,this.rotateY,this.rotateZ),this.container.add(i),s.updateMatrixWorld(!0);var o=new ft().setFromObject(s).getSize(new T);const l=new ie.Vec3(o.x/2,o.y/1.9,o.z/1.9),h=new ie.Box(l),d=new ie.Body({mass:0,position:new ie.Vec3(this.position.x+1.5,this.position.y,this.position.z-3),material:this.physics.materials.items.floor});s.traverse(c=>{c.isMesh&&(c.material=c.material.clone(),c.material.color.r=.2,c.material.color.g=0,c.material.color.b=.6)});const f=new ie.Quaternion;if(f.setFromEuler(this.rotateX,this.rotateY,this.rotateZ,"XYZ"),d.quaternion.copy(f),d.addShape(h),this.physics.world.addBody(d),this.objects){const c=i.children.slice(),u=this.objects.add({base:{children:c},collision:{children:c},offset:this.position.clone(),mass:0});u.collision={body:d},u.container&&this.container.add(u.container)}}}const y1=new T(-65,4,2);class x1{constructor({scene:e,resources:t,objects:i,physics:s,debug:r,rotateX:o=0,rotateY:l=0,rotateZ:h=0}){this.scene=e,this.resources=t,this.objects=i,this.physics=s,this.debug=r,this.rotateX=o,this.rotateY=l,this.rotateZ=h,this.container=new je,this.position=y1.clone(),this._buildModel(),this.scene.add(this.container)}_buildModel(){const e=this.resources.items.Division,t=this.resources.items.Base;if(!e||!e.scene){console.error("Divizyon bina modeli bulunamadı");return}if(!t||!t.scene){console.error("Base modeli bulunamadı");return}const i=e.scene.clone(!0);i.traverse(c=>{if(c.isMesh){const u=c.material,p=u.clone();u.map&&(p.map=u.map),u.normalMap&&(p.normalMap=u.normalMap),u.roughnessMap&&(p.roughnessMap=u.roughnessMap),u.metalnessMap&&(p.metalnessMap=u.metalnessMap),p.needsUpdate=!0,c.material=p,c.castShadow=!0,c.receiveShadow=!0}});const s=t.scene.clone(!0);s.position.set(-65,4,0),s.scale.set(1.5,1.5,1.5),s.rotation.set(this.rotateX,this.rotateY,290.2),i.position.copy(this.position),i.rotation.set(this.rotateX,this.rotateY,290.2),this.container.add(s),this.container.add(i),this.container.add(s),s.updateMatrixWorld(!0);var o=new ft().setFromObject(s).getSize(new T);const l=new ie.Vec3(o.x/2.8,o.y/2.7,o.z/2),h=new ie.Box(l),d=new ie.Body({mass:0,position:s.position,material:this.physics.materials.items.floor}),f=new ie.Quaternion;if(f.setFromEuler(this.rotateX,this.rotateY,290,"XYZ"),d.quaternion.copy(f),d.addShape(h),this.physics.world.addBody(d),this.objects){const c=i.children.slice(),u=this.objects.add({base:{children:c},collision:{children:c},offset:this.position.clone(),mass:0});u.collision={body:d},u.container&&this.container.add(u.container)}}}const b1=new T(-54.8,28.4,1.1);class w1{constructor({scene:e,resources:t,objects:i,physics:s,debug:r,rotateX:o=0,rotateY:l=0,rotateZ:h=0,car:d,time:f,areas:c,passes:u,camera:p,zones:m}){this.scene=e,this.resources=t,this.objects=i,this.physics=s,this.debug=r,this.passes=u,this.camera=p,this.zones=m,this.areas=c,this.rotateX=o,this.rotateY=l,this.rotateZ=h,this.car=d,this.time=f,this.container=new je,this.position=b1.clone(),console.log(this.resources.items.UVDesert),this.greenScreenMesh=null,this.greenScreenImagePaths=["./uv/Desert.webp","./uv/Lake.webp","./uv/Iceland.webp"],this._buildModel(),this.scene.add(this.container),this._createPopup(),this.setZone()}_buildModel(){const e=this.resources.items.GreenScreen,t=this.resources.items.Base;if(!e||!e.scene){console.error("SectionGreenScreen bina modeli bulunamadı");return}if(!t||!t.scene){console.error("Base modeli bulunamadı");return}const i=e.scene.clone(!0);i.traverse(y=>{if(y.isMesh){const x=y.material,b=x.clone();x.map&&(b.map=x.map),x.normalMap&&(b.normalMap=x.normalMap),x.roughnessMap&&(b.roughnessMap=x.roughnessMap),x.metalnessMap&&(b.metalnessMap=x.metalnessMap),b.needsUpdate=!0,y.material=b,y.castShadow=!0,y.receiveShadow=!0}y instanceof Ae&&(y.name==="pureUc"||y.name==="Cube.002")&&(this.greenScreenMesh=y)}),i.position.copy(this.position),i.rotation.set(this.rotateX,this.rotateY,-.45),this.container.add(i);const s=t.scene.clone(!0);s.position.set(-54.65,30.2,0),s.scale.set(1.4,1.3,.5),s.rotation.set(this.rotateX,this.rotateY,290-.6),this.container.add(s),s.traverse(y=>{y.isMesh&&(y.material=y.material.clone(),y.material.color.r=2,y.material.color.g=0,y.material.color.b=0)});const r=t.scene.clone(!0);r.position.set(-54.65,30.2,0),r.scale.set(1.4,1.3,.5),r.rotation.set(this.rotateX,this.rotateY,201.23-.6),this.container.add(r),r.traverse(y=>{y.isMesh&&(y.material=y.material.clone(),y.material.color.r=2,y.material.color.g=0,y.material.color.b=0)}),s.updateMatrixWorld(!0),r.updateMatrixWorld(!0);var l=new ft().setFromObject(s).getSize(new T);const h=new ie.Vec3(l.x/2.8,l.y/2.8,1),d=new ie.Box(h),f=new ie.Body({mass:0,position:s.position,material:this.physics.materials.items.floor}),c=new ie.Quaternion;c.setFromEuler(s.rotation.x,s.rotation.y,s.rotation.z,"XYZ"),f.quaternion.copy(c),f.addShape(d),this.physics.world.addBody(f);var p=new ft().setFromObject(r).getSize(new T);const m=new ie.Vec3(p.x/2.7,p.y/2.7,1),_=new ie.Box(m),g=new ie.Body({mass:0,position:r.position,material:this.physics.materials.items.floor}),v=new ie.Quaternion;if(v.setFromEuler(r.rotation.x,r.rotation.y,r.rotation.z,"XYZ"),g.quaternion.copy(v),g.addShape(_),this.physics.world.addBody(g),this.objects){const y=i.children.slice(),x=this.objects.add({base:{children:y},collision:{children:y},offset:this.position.clone(),mass:0});x.collision={body:f},x.container&&this.container.add(x.container)}}_createPopup(){const e=document.createElement("div");e.id="greenscreen-popup",e.style.position="absolute",e.style.bottom="20px",e.style.left="50%",e.style.transform="translateX(-50%)",e.style.backgroundColor="rgba(26, 26, 26, 0.8)",e.style.padding="10px",e.style.borderRadius="5px",e.style.display="none",e.style.borderRadius="10px",e.style.zIndex="1000",this.greenScreenImagePaths.forEach((t,i)=>{const s=document.createElement("img");s.src=t,s.style.width="150px",s.style.margin="5px",s.style.cursor="pointer",s.style.borderRadius="10px",s.addEventListener("click",()=>{this.changeGreenscreenTexture(i),e.style.display="none"}),e.appendChild(s)}),document.body.appendChild(e),this.time.on("tick",()=>{this.car.position.distanceTo(this.position)<10?e.style.display="block":e.style.display="none"})}changeGreenscreenTexture(e){try{this.currentImageIndex=e;const t=this.greenScreenImagePaths[e],i=new Wh,s=new ft().setFromObject(this.greenScreenMesh),r=new T;s.getSize(r),i.load(t,o=>{o.colorSpace=ei,o.minFilter=Nt,o.magFilter=Nt,o.wrapS=In,o.wrapT=In,o.repeat.set(-1,1),o.offset.set(0,.5-o.repeat.y/2),o.rotation=Math.PI,o.center.set(.5,.5);const l=new Ei({map:o,side:Ui,color:16777215,emissive:16777215,emissiveIntensity:.05});this.greenScreenMesh.material=l,this.greenScreenMesh.material.needsUpdate=!0},void 0,o=>{console.error("Error loading texture:",o)}),this.areas.car.physics.car.chassis.body.position.copy(new ie.Vec3(-54.2,30.5,1)),this.physics.car.chassis.body.quaternion.copy(new ie.Quaternion(0,0,-Math.PI/3,1)),this.areas.car.physics.car.chassis.body.velocity.set(0,0,0),this.areas.car.physics.car.chassis.body.angularVelocity.set(0,0,0),this.areas.car.physics.car.chassis.body.wakeUp()}catch(t){console.error("Error changing greenscreen texture:",t)}}setZone(){const e=this.zones.add({position:{x:this.position.x+1,y:this.position.y+2},halfExtents:{x:2.6,y:2},data:{cameraAngle:"greenScreenCam"}});e.on("in",t=>{this.camera.angle.set(t.cameraAngle),Qe.to(this.passes.horizontalBlurPass.material.uniforms.uStrength.value,{x:0,duration:2}),Qe.to(this.passes.verticalBlurPass.material.uniforms.uStrength.value,{y:0,duration:2})}),e.on("out",()=>{this.camera.angle.set("default"),Qe.to(this.passes.horizontalBlurPass.material.uniforms.uStrength.value,{x:this.passes.horizontalBlurPass.strength,duration:2}),Qe.to(this.passes.verticalBlurPass.material.uniforms.uStrength.value,{y:this.passes.verticalBlurPass.strength,duration:2})})}}let Vc=55,M1=8,ip=5;class S1{constructor(e){this.time=e.time,this.resources=e.resources,this.objects=e.objects,this.physics=e.physics,this.debug=e.debug,this.scene=e.scene,this.sounds=e==null?void 0:e.sounds,this.areas=e==null?void 0:e.areas,this.materials=e==null?void 0:e.materials,this.container=new je,this.container.matrixAutoUpdate=!1,this.rocketLaunched=!1,this.x=Vc,this.y=M1,this.setModel(),this.areas&&this.setInteractionButton(),this.setupKeyboardControls()}setInteractionButton(){this.button={};const e=document.createElement("canvas");e.width=128,e.height=64,e.getContext("2d");const t=new Kd(e);t.magFilter=li,t.minFilter=Nt,this.button.area=this.areas.add({position:new Oe(Vc+4,ip),halfExtents:new Oe(2,2),hasKey:!0,testCar:!1,active:!0}),this.button.area.floorBorder.material.uniforms.uColor.value=new Le(16777215),this.button.area.floorBorder.material.uniforms.uAlpha.value=.8,this.button.container=new je,this.button.container.position.set(Vc+0,0,ip),this.container.add(this.button.container),this.button.areaLabel=new Ae(new pi(2,1),new Ne({transparent:!0,depthWrite:!1,map:t,opacity:.9})),this.button.areaLabel.position.set(0,0,-1),this.button.areaLabel.scale.set(1,1,1),this.button.areaLabel.rotation.x=-Math.PI*0,this.button.container.add(this.button.areaLabel),this.button.area.on("in",()=>{Qe.to(this.button.areaLabel.material,{opacity:1,duration:.3}),Qe.to(this.button.areaLabel.scale,{x:1.2,y:1.2,z:1.2,duration:.3})}),this.button.area.on("out",()=>{Qe.to(this.button.areaLabel.material,{opacity:.9,duration:.3}),Qe.to(this.button.areaLabel.scale,{x:1,y:1,z:1,duration:.3})}),this.button.area.on("interact",()=>{this.launchRocket()})}setupKeyboardControls(){window.addEventListener("keydown",e=>{(e.keyCode===13||e.key==="Enter")&&Math.abs(this.car.position.x-this.model.base.position.x)<2&&Math.abs(this.car.position.x-this.model.base.position.x)<2&&this.launchRocket()})}setModel(){this.model={},this.model.base=this.resources.items.Rocket.scene.clone(),this.model.base.scale.set(1,1,1),this.model.base.position.x=this.x,this.model.base.position.y=this.y,this.model.base.position.z=.6,this.model.base.rotation.x=0,this.model.base.rotation.y=0,this.model.base.rotation.z=0,this.model.base.traverse(e=>{e instanceof Ae&&(console.log("Roket mesh adı:",e.name),e.name.includes("shadeGray")?e.material=this.materials.items.gray:e.name.includes("shadeWhite")?e.material=this.materials.items.white:e.name.includes("shadeRed")?e.material=this.materials.items.red:e.material=this.materials.items.white)}),this.createFireEffect(),this.container.add(this.model.base)}createFireEffect(){this.fireParticles={count:200,particles:[],container:new je};const e=new vl(.25,.8,8),t=new vl(.15,.6,8),i=new na(.05,8,8),s=new Le(16777215),r=new Le(16774710),o=new Le(16729344),l=new Le(16752197),h=new Ne({color:s,transparent:!0,opacity:.9}),d=new Ne({color:r,transparent:!0,opacity:.8}),f=new Ne({color:o,transparent:!0,opacity:.6}),c=new Ne({color:l,transparent:!0,opacity:.7}),u=Math.floor(this.fireParticles.count*.2);for(let g=0;g<u;g++){const v={mesh:new Ae(e,h),speed:Math.random()*.15+.2,offset:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.1,scale:Math.random()*.3+.5,type:"core"};v.mesh.position.set(0,0,-.1),v.mesh.scale.set(v.scale,v.scale,v.scale),v.mesh.rotation.x=Math.PI,this.fireParticles.container.add(v.mesh),this.fireParticles.particles.push(v)}const p=Math.floor(this.fireParticles.count*.4);for(let g=0;g<p;g++){const v={mesh:new Ae(t,d),speed:Math.random()*.12+.15,offset:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.1,scale:Math.random()*.3+.4,type:"innerFlame"};v.mesh.position.set((Math.random()-.5)*.2,(Math.random()-.5)*.2,-.2-Math.random()*.2),v.mesh.scale.set(v.scale,v.scale*1.2,v.scale),v.mesh.rotation.x=Math.PI,this.fireParticles.container.add(v.mesh),this.fireParticles.particles.push(v)}const m=Math.floor(this.fireParticles.count*.3);for(let g=0;g<m;g++){const v={mesh:new Ae(t,f),speed:Math.random()*.1+.1,offset:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.15,scale:Math.random()*.2+.3,type:"outerFlame"};v.mesh.position.set((Math.random()-.5)*.3,(Math.random()-.5)*.3,-.3-Math.random()*.3),v.mesh.scale.set(v.scale,v.scale*1.5,v.scale),v.mesh.rotation.x=Math.PI,this.fireParticles.container.add(v.mesh),this.fireParticles.particles.push(v)}const _=Math.floor(this.fireParticles.count*.1);for(let g=0;g<_;g++){const v={mesh:new Ae(i,c),speed:Math.random()*.2+.15,offset:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.2,scale:Math.random()*.15+.05,type:"spark"};v.mesh.position.set((Math.random()-.5)*.4,(Math.random()-.5)*.4,-.3-Math.random()*.5),v.mesh.scale.set(v.scale,v.scale,v.scale),this.fireParticles.container.add(v.mesh),this.fireParticles.particles.push(v)}this.fireParticles.container.position.set(-.2,.7,.25),this.fireParticles.container.visible=!1,this.model.base.add(this.fireParticles.container),this.time.on("tick",()=>{this.rocketFired&&this.updateFireEffect()})}updateFireEffect(){for(const e of this.fireParticles.particles){switch(e.type){case"core":e.mesh.position.z-=e.speed*.8,e.mesh.position.x=Math.sin(this.time.elapsed*.01+e.offset)*.1,e.mesh.position.y=Math.cos(this.time.elapsed*.01+e.offset+Math.PI/2)*.1,e.mesh.rotation.z+=e.rotationSpeed;const t=.1*Math.sin(this.time.elapsed*.01+e.offset);e.mesh.scale.set(e.scale+t,e.scale*1.2+t,e.scale+t),e.mesh.position.z<-1.2&&(e.mesh.position.z=-.1);break;case"innerFlame":e.mesh.position.z-=e.speed,e.mesh.position.x+=(Math.random()-.5)*.02,e.mesh.position.y+=(Math.random()-.5)*.02,e.mesh.rotation.z+=e.rotationSpeed,e.mesh.scale.multiplyScalar(.99),(e.mesh.position.z<-1.8||e.mesh.scale.x<.2)&&(e.mesh.position.set((Math.random()-.5)*.3,(Math.random()-.5)*.3,-.2),e.mesh.scale.set(e.scale,e.scale*1.2,e.scale));break;case"outerFlame":e.mesh.position.z-=e.speed*.8,e.mesh.position.x+=(Math.random()-.5)*.04,e.mesh.position.y+=(Math.random()-.5)*.04,e.mesh.rotation.z+=e.rotationSpeed,e.mesh.rotation.y+=e.rotationSpeed*.5,e.mesh.scale.multiplyScalar(.985),(e.mesh.position.z<-2||e.mesh.scale.x<.1)&&(e.mesh.position.set((Math.random()-.5)*.5,(Math.random()-.5)*.5,-.3),e.mesh.scale.set(e.scale,e.scale*1.5,e.scale));break;case"spark":e.mesh.position.z-=e.speed*1.5,e.mesh.position.x+=(Math.random()-.5)*.08,e.mesh.position.y+=(Math.random()-.5)*.08,e.mesh.scale.multiplyScalar(.97),(e.mesh.position.z<-3||e.mesh.scale.x<.02)&&(e.mesh.position.set((Math.random()-.5)*.6,(Math.random()-.5)*.6,-.5),e.mesh.scale.set(e.scale,e.scale,e.scale));break}if(e.mesh.material.opacity){const t=Math.abs(e.mesh.position.z+.1);e.type==="core"?e.mesh.material.opacity=Math.max(.3,.9-t*.4):e.type==="innerFlame"?e.mesh.material.opacity=Math.max(.2,.8-t*.3):e.type==="outerFlame"?e.mesh.material.opacity=Math.max(.1,.6-t*.25):e.type==="spark"&&(e.mesh.material.opacity=Math.max(.1,.7-t*.2))}}}createLaunchButton(){this.launchButton={};const e=this.x,t=this.y-2;this.launchButton=this.createButton("Roketi Fırlat",e,t,"#FF4500","launchRocket"),this.launchButton.triggerArea.on("interact",()=>{this.launchRocket()}),this.launchButton.triggerArea.on("in",()=>{Qe.to(this.launchButton.label.mesh.position,{z:.2,duration:.3,ease:"back.out"}),Qe.to(this.launchButton.label.material,{opacity:1,duration:.3}),this.launchButton.enter&&this.launchButton.enter.mesh&&Qe.to(this.launchButton.enter.mesh.position,{z:.22,duration:.3,ease:"back.out"})}),this.launchButton.triggerArea.on("out",()=>{Qe.to(this.launchButton.label.mesh.position,{z:.12,duration:.3,ease:"back.in"}),Qe.to(this.launchButton.label.material,{opacity:.7,duration:.3}),this.launchButton.enter&&this.launchButton.enter.mesh&&Qe.to(this.launchButton.enter.mesh.position,{z:.13,duration:.3,ease:"back.in"})})}createButton(e,t,i,s,r){const o={};return o.position=new T(t,i,.01),o.container=new je,o.container.position.copy(o.position),this.container.add(o.container),o.label={},o.label.size=2.5,o.label.geometry=new pi(o.label.size,o.label.size/2.5,1,1),o.label.texture=this.createButtonTexture(e,s),o.label.material=new Ne({map:o.label.texture,transparent:!0,opacity:1,depthWrite:!1}),o.label.mesh=new Ae(o.label.geometry,o.label.material),o.label.mesh.rotation.x=-Math.PI*.5,o.label.mesh.position.z=.15,o.label.mesh.matrixAutoUpdate=!1,o.label.mesh.updateMatrix(),o.container.add(o.label.mesh),this.resources.items.areaKeyEnterTexture&&(o.enter={},o.enter.size=.8,o.enter.geometry=new pi(o.enter.size,o.enter.size,1,1),o.enter.texture=this.resources.items.areaKeyEnterTexture,o.enter.texture.magFilter=Nt,o.enter.texture.minFilter=Nt,o.enter.material=new Ne({map:o.enter.texture,transparent:!0,opacity:.9,depthWrite:!1}),o.enter.mesh=new Ae(o.enter.geometry,o.enter.material),o.enter.mesh.rotation.x=-Math.PI*.5,o.enter.mesh.position.x=o.label.size*.35,o.enter.mesh.position.z=.16,o.enter.mesh.matrixAutoUpdate=!1,o.enter.mesh.updateMatrix(),o.container.add(o.enter.mesh)),o.triggerArea=this.areas.add({position:new Oe(o.position.x,o.position.y),halfExtents:new Oe(1.5,1),hasKey:!0,testCar:!0,active:!0}),o.name=e,o.color=s,o.type=r,o}createButtonTexture(e,t){const i=document.createElement("canvas"),s=i.getContext("2d");i.width=600,i.height=240,s.fillStyle=t,s.beginPath(),s.moveTo(25,0),s.lineTo(i.width-25,0),s.quadraticCurveTo(i.width,0,i.width,25),s.lineTo(i.width,i.height-25),s.quadraticCurveTo(i.width,i.height,i.width-25,i.height),s.lineTo(25,i.height),s.quadraticCurveTo(0,i.height,0,i.height-25),s.lineTo(0,25),s.quadraticCurveTo(0,0,25,0),s.closePath(),s.fill(),s.strokeStyle="#ffffff",s.lineWidth=4,s.stroke();const r=50,o=i.width-r-20,l=(i.height-r)/2;s.fillStyle="#ffffff",s.fillRect(o,l,r*.8,r),s.fillRect(o+r*.6,l+r*.3,r*.4,r*.4),s.beginPath(),s.moveTo(o+r*.6,l+r*.5),s.lineTo(o+r*.8,l+r*.7),s.lineTo(o+r*.6,l+r*.9),s.closePath(),s.fill(),s.font="bold 28px Arial",s.textAlign="right",s.fillText("ENTER",o-10,l+r/2+10),s.font="bold 90px Arial",s.textAlign="left",s.textBaseline="middle",s.fillStyle="#ffffff",s.fillText(e,30,i.height/2),s.shadowColor="rgba(0, 0, 0, 0.3)",s.shadowBlur=10,s.shadowOffsetX=5,s.shadowOffsetY=5;const h=new Kd(i);return h.magFilter=Nt,h.minFilter=Nt,h}launchRocket(){if(!this.rocketLaunched){if(console.log("Roket fırlatılıyor!"),this.fireParticles.container.visible=!0,this.rocketFired=!0,this.sounds&&(console.log(this.sounds),this.sounds.play("rocketLaunch")),this.camera){let e=.1,t=0;const i=()=>{t<15?(this.camera.instance.position.x+=(Math.random()-.5)*e,this.camera.instance.position.y+=(Math.random()-.5)*e,t++,requestAnimationFrame(i)):Qe.to(this.camera.instance.position,{x:this.camera.instance.position.x-(Math.random()-.5)*e,y:this.camera.instance.position.y-(Math.random()-.5)*e,duration:.5})};i()}Qe.to(this.model.base.position,{z:.8,duration:1.2,ease:"power1.in",onComplete:()=>{if(this.sounds)this.sounds.play("horn");else if(this.resources.items.brickHitSound){const e=this.resources.items.brickHitSound.play();e&&(e.volume=1,e.rate=.7)}Qe.to(this.model.base.position,{z:20,duration:2.5,ease:"power2.in",onComplete:()=>{this.sounds&&this.sounds.play("brick",5),this.rocketLaunched=!0,setTimeout(()=>this.resetRocket(),4e3)}})}})}}resetRocket(){this.fireParticles.container.visible=!1,this.rocketFired=!1,Qe.to(this.model.base.position,{x:this.x,y:this.y,z:0,duration:.5}),this.rocketLaunched=!1,console.log("Roket sıfırlandı")}setCar(e){this.car=e}}const A1=new T(42.8,12.2,0);class E1{constructor({scene:e,resources:t,objects:i,physics:s,debug:r,rotateX:o=0,rotateY:l=0,rotateZ:h=0}){this.scene=e,this.resources=t,this.objects=i,this.physics=s,this.debug=r,this.rotateX=o,this.rotateY=l,this.rotateZ=h,this.container=new je,this.position=A1.clone(),this._buildModel(),this.scene.add(this.container)}_buildModel(){const e=this.resources.items.ScienceCenter,t=this.resources.items.Base;if(!e||!e.scene){console.error("ScienceCenter bina modeli bulunamadı");return}if(!t||!t.scene){console.error("Base modeli bulunamadı");return}const i=e.scene.clone(!0);i.traverse(c=>{if(c.isMesh){const u=c.material,p=u.clone();u.map&&(p.map=u.map),u.normalMap&&(p.normalMap=u.normalMap),u.roughnessMap&&(p.roughnessMap=u.roughnessMap),u.metalnessMap&&(p.metalnessMap=u.metalnessMap),p.needsUpdate=!0,c.material=p,c.castShadow=!0,c.receiveShadow=!0}});const s=t.scene.clone(!0);s.position.set(42.5,14,0),s.scale.set(3,2.1,2),this.container.add(s),i.position.copy(this.position),i.rotation.set(this.rotateX,this.rotateY,this.rotateZ),this.container.add(i),s.updateMatrixWorld(!0);var o=new ft().setFromObject(this.container).getSize(new T);const l=new ie.Vec3(o.x/1.97,o.y/1.97,o.z/2),h=new ie.Box(l),d=new ie.Body({mass:0,position:s.position,material:this.physics.materials.items.floor});s.traverse(c=>{c.isMesh&&(c.material=c.material.clone(),c.material.color.r=.2,c.material.color.g=0,c.material.color.b=.6)});const f=new ie.Quaternion;if(f.setFromEuler(this.rotateX,this.rotateY,this.rotateZ,"XYZ"),d.quaternion.copy(f),d.addShape(h),this.physics.world.addBody(d),this.objects){const c=i.children.slice(),u=this.objects.add({base:{children:c},collision:{children:c},offset:this.position.clone(),mass:0});u.collision={body:d},u.container&&this.container.add(u.container)}}}const T1=new T(57,-17,1.4);class C1{constructor({scene:e,resources:t,objects:i,physics:s,debug:r,rotateX:o=0,rotateY:l=0,rotateZ:h=0}){this.scene=e,this.resources=t,this.objects=i,this.physics=s,this.debug=r,this.rotateX=o,this.rotateY=l,this.rotateZ=h,this.container=new je,this.position=T1.clone(),this._buildModel(),this.scene.add(this.container)}_buildModel(){const e=this.resources.items.Butterfly,t=this.resources.items.Base;if(!e||!e.scene){console.error("SectionButterfly bina modeli bulunamadı");return}if(!t||!t.scene){console.error("Base modeli bulunamadı");return}const i=e.scene.clone(!0);i.traverse(c=>{if(c.isMesh){const u=c.material,p=u.clone();u.map&&(p.map=u.map),u.normalMap&&(p.normalMap=u.normalMap),u.roughnessMap&&(p.roughnessMap=u.roughnessMap),u.metalnessMap&&(p.metalnessMap=u.metalnessMap),p.needsUpdate=!0,c.material=p,c.castShadow=!0,c.receiveShadow=!0}});const s=t.scene.clone(!0);s.position.set(55,-17.5,0),s.scale.set(3,2.3,2),this.container.add(s),i.position.copy(this.position),i.rotation.set(this.rotateX,this.rotateY,Math.PI/2),this.container.add(i),s.updateMatrixWorld(!0);var o=new ft().setFromObject(this.container).getSize(new T);const l=new ie.Vec3(o.x/1.97,o.y/1.97,o.z/2),h=new ie.Box(l),d=new ie.Body({mass:0,position:s.position,material:this.physics.materials.items.floor});s.traverse(c=>{c.isMesh&&(c.material=c.material.clone(),c.material.color.r=.2,c.material.color.g=0,c.material.color.b=.6)});const f=new ie.Quaternion;if(f.setFromEuler(this.rotateX,this.rotateY,this.rotateZ,"XYZ"),d.quaternion.copy(f),d.addShape(h),this.physics.world.addBody(d),this.objects){const c=i.children.slice(),u=this.objects.add({base:{children:c},collision:{children:c},offset:this.position.clone(),mass:0});u.collision={body:d},u.container&&this.container.add(u.container)}}}const R1=new T(75,-10,1);class P1{constructor({scene:e,resources:t,objects:i,physics:s,debug:r,rotateX:o=0,rotateY:l=0,rotateZ:h=0}){this.scene=e,this.resources=t,this.objects=i,this.physics=s,this.debug=r,this.rotateX=o,this.rotateY=l,this.rotateZ=h,this.container=new je,this.position=R1.clone(),this._buildModel(),this.scene.add(this.container)}_buildModel(){const e=this.resources.items.SocialInovation,t=this.resources.items.Base;if(!e||!e.scene){console.error("SIA modeli bulunamadı");return}if(!t||!t.scene){console.error("Base modeli bulunamadı"),n;return}const i=e.scene.clone(!0);i.traverse(c=>{if(c.isMesh){const u=c.material,p=u.clone();u.map&&(p.map=u.map),u.normalMap&&(p.normalMap=u.normalMap),u.roughnessMap&&(p.roughnessMap=u.roughnessMap),u.metalnessMap&&(p.metalnessMap=u.metalnessMap),p.needsUpdate=!0,c.material=p,c.castShadow=!0,c.receiveShadow=!0,c.scale.set(1,1,1)}});const s=t.scene.clone(!0);s.position.set(75,-10,0),s.scale.set(1,1,1.5),this.container.add(s),i.position.copy(this.position),i.rotation.set(this.rotateX,this.rotateY,this.rotateZ),this.container.add(i),s.updateMatrixWorld(!0);var o=new ft().setFromObject(s).getSize(new T);const l=new ie.Vec3(o.x/2,o.y/1.9,o.z/1.9),h=new ie.Box(l),d=new ie.Body({mass:0,position:new ie.Vec3(this.position.x,this.position.y,this.position.z),material:this.physics.materials.items.floor}),f=new ie.Quaternion;if(f.setFromEuler(this.rotateX,this.rotateY,this.rotateZ,"XYZ"),d.quaternion.copy(f),d.addShape(h),this.physics.world.addBody(d),this.objects){const c=i.children.slice(),u=this.objects.add({base:{children:c},collision:{children:c},offset:this.position.clone(),mass:0});u.collision={body:d},u.container&&this.container.add(u.container)}}}const I1=new T(-56.8,15,2.2);class L1{constructor({scene:e,resources:t,objects:i,physics:s,debug:r,rotateX:o=0,rotateY:l=0,rotateZ:h=0}){this.scene=e,this.resources=t,this.objects=i,this.physics=s,this.debug=r,this.rotateX=o,this.rotateY=l,this.rotateZ=h,this.container=new je,this.position=I1.clone(),this._buildModel(),this.scene.add(this.container)}_buildModel(){const e=this.resources.items.SoundRoom,t=this.resources.items.Base;if(!e||!e.scene){console.error("SectionSoundRoom bina modeli bulunamadı");return}if(!t||!t.scene){console.error("Base modeli bulunamadı");return}const i=e.scene.clone(!0);i.traverse(y=>{if(y.isMesh){const x=y.material,b=x.clone();x.map&&(b.map=x.map),x.normalMap&&(b.normalMap=x.normalMap),x.roughnessMap&&(b.roughnessMap=x.roughnessMap),x.metalnessMap&&(b.metalnessMap=x.metalnessMap),b.needsUpdate=!0,y.material=b,y.castShadow=!0,y.receiveShadow=!0}}),i.position.copy(this.position),i.rotation.set(this.rotateX,this.rotateY,290.4),this.container.add(i);const s=t.scene.clone(!0);s.position.set(-58.3,15.5,0),s.scale.set(1.4,1.3,.5),s.rotation.set(this.rotateX,this.rotateY,290.4),this.container.add(s),s.traverse(y=>{y.isMesh&&(y.material=y.material.clone(),y.material.color.r=2,y.material.color.g=0,y.material.color.b=0)});const r=t.scene.clone(!0);r.position.set(-58.3,15.5,0),r.scale.set(1.4,1.3,.5),r.rotation.set(this.rotateX,this.rotateY,201.63),this.container.add(r),r.traverse(y=>{y.isMesh&&(y.material=y.material.clone(),y.material.color.r=2,y.material.color.g=0,y.material.color.b=0)}),s.updateMatrixWorld(!0),r.updateMatrixWorld(!0);var l=new ft().setFromObject(s).getSize(new T);const h=new ie.Vec3(l.x/2.4,l.y/2.4,2),d=new ie.Box(h),f=new ie.Body({mass:0,position:s.position,material:this.physics.materials.items.floor}),c=new ie.Quaternion;c.setFromEuler(s.rotation.x,s.rotation.y,s.rotation.z,"XYZ"),f.quaternion.copy(c),f.addShape(d),this.physics.world.addBody(f);var p=new ft().setFromObject(r).getSize(new T);const m=new ie.Vec3(p.x/2.7,p.y/2.7,2),_=new ie.Box(m),g=new ie.Body({mass:0,position:r.position,material:this.physics.materials.items.floor}),v=new ie.Quaternion;if(v.setFromEuler(r.rotation.x,r.rotation.y,r.rotation.z,"XYZ"),g.quaternion.copy(v),g.addShape(_),this.physics.world.addBody(g),this.objects){const y=i.children.slice(),x=this.objects.add({base:{children:y},collision:{children:y},offset:this.position.clone(),mass:0});x.collision={body:f},x.container&&this.container.add(x.container)}}}const F1=new T(42.5,-62,-1.6);class B1{constructor({scene:e,resources:t,objects:i,physics:s,debug:r,rotateX:o=0,rotateY:l=0,rotateZ:h=0}){this.scene=e,this.resources=t,this.objects=i,this.physics=s,this.debug=r,this.rotateX=o,this.rotateY=l,this.rotateZ=h,this.container=new je,this.position=F1.clone(),this._buildModel(),this.scene.add(this.container)}_buildModel(){const e=this.resources.items.Stadium,t=this.resources.items.Base;if(!e||!e.scene){console.error("Stadium bina modeli bulunamadı");return}if(!t||!t.scene){console.error("Base modeli bulunamadı");return}const i=e.scene.clone(!0);i.traverse(c=>{if(c.isMesh){const u=c.material,p=u.clone();u.map&&(p.map=u.map),u.normalMap&&(p.normalMap=u.normalMap),u.roughnessMap&&(p.roughnessMap=u.roughnessMap),u.metalnessMap&&(p.metalnessMap=u.metalnessMap),p.needsUpdate=!0,c.material=p,c.castShadow=!0,c.receiveShadow=!0}});const s=t.scene.clone(!0);s.position.set(42,-61.25,0),s.scale.set(2.6,3,1.5),s.rotation.set(this.rotateX,this.rotateY,this.rotateZ),this.container.add(s),i.position.copy(this.position),i.rotation.set(this.rotateX,this.rotateY,this.rotateZ),this.container.add(i),s.updateMatrixWorld(!0);var o=new ft().setFromObject(this.container).getSize(new T);const l=new ie.Vec3(o.x/3.4,o.y/1.8,o.z/2),h=new ie.Box(l),d=new ie.Body({mass:0,position:s.position,material:this.physics.materials.items.floor});s.traverse(c=>{c.isMesh&&(c.material=c.material.clone(),c.material.color.r=.2,c.material.color.g=.6,c.material.color.b=0)});const f=new ie.Quaternion;if(f.setFromEuler(this.rotateX,this.rotateY,this.rotateZ,"XYZ"),d.quaternion.copy(f),d.addShape(h),this.physics.world.addBody(d),this.objects){const c=i.children.slice(),u=this.objects.add({base:{children:c},collision:{children:c},offset:this.position.clone(),mass:0});u.collision={body:d},u.container&&this.container.add(u.container)}}}class D1{constructor(e){this.time=e.time,this.scene=e.scene,this.physics=e.physics,this.resources=e.resources,this.mixer=null,this.model=null,this.collisionBody=null,this.setModel(),this.time?this.time.on("tick",()=>{this.tick(this.time.delta*.001)}):console.warn("SectionYoungCard: time parametresi verilmedi, animasyonlar çalışmayacak.")}setModel(){if(!this.scene){console.warn("SectionYoungCard: scene parametresi verilmedi, model sahneye eklenmeyecek.");return}new aa().load("./models/SectionYoungCard/base.glb",t=>{this.model=t.scene,this.model.position.set(42.5,-38,1.7),this.model.scale.set(1,1,1),this.model.rotation.set(Math.PI,Math.PI,0);const s=this.resources.items.Base.scene.clone(!0);s.position.set(42.5,-38,0),s.scale.set(1.5,1,1.5),s.rotation.set(Math.PI,Math.PI,Math.PI/2),s.updateMatrixWorld(!0);var o=new ft().setFromObject(s).getSize(new T);const l=new ie.Vec3(o.x/3,o.y/1.35,o.z/2),h=new ie.Box(l),d=new ie.Body({mass:0,position:s.position,material:this.physics.materials.items.floor});s.traverse(c=>{c.isMesh&&(c.material=c.material.clone(),c.material.color.r=.2,c.material.color.g=0,c.material.color.b=.6)});const f=new ie.Quaternion;if(f.setFromEuler(Math.PI,Math.PI,0),d.quaternion.copy(f),d.addShape(h),this.physics.world.addBody(d),this.scene.add(s),this.scene.add(this.model),!this.scene.__balikLightAdded){this.scene.add(new Dl(16777215,2));const c=new ra(16777215,2);c.position.set(5,10,7.5),this.scene.add(c),this.scene.__balikLightAdded=!0}this.model.traverse(c=>{c.isMesh&&(c.castShadow=!0,c.receiveShadow=!0,c.material||(c.material=new Ei({color:65280})),c.material&&c.material.type==="MeshBasicMaterial"&&(c.material=new Ei({color:c.material.color||16777215})),c.material.transparent=!1,c.material.opacity=1)}),t.animations&&t.animations.length>0&&(this.mixer=new qh(this.model),t.animations.forEach((c,u)=>{this.mixer.clipAction(c).reset().play()}))})}tick(e){this.mixer&&this.mixer.update(e)}}const k1=new T(58,-37.7,.45);class N1{constructor({scene:e,resources:t,objects:i,physics:s,debug:r,rotateX:o=0,rotateY:l=0,rotateZ:h=0}){this.scene=e,this.resources=t,this.objects=i,this.physics=s,this.debug=r,this.rotateX=o,this.rotateY=l,this.rotateZ=h,this.container=new je,this.position=k1.clone(),this._buildModel(),this.scene.add(this.container)}_buildModel(){const e=this.resources.items.YoungCenter,t=this.resources.items.Base;if(!e||!e.scene){console.error("YoungCenter bina modeli bulunamadı");return}if(!t||!t.scene){console.error("Base modeli bulunamadı");return}const i=e.scene.clone(!0);i.traverse(c=>{if(c.isMesh){const u=c.material,p=u.clone();u.map&&(p.map=u.map),u.normalMap&&(p.normalMap=u.normalMap),u.roughnessMap&&(p.roughnessMap=u.roughnessMap),u.metalnessMap&&(p.metalnessMap=u.metalnessMap),p.needsUpdate=!0,c.material=p,c.castShadow=!0,c.receiveShadow=!0}});const s=t.scene.clone(!0);s.position.set(57,-38,0),s.scale.set(1.5,1.5,1.5),this.container.add(s),i.position.copy(this.position),i.rotation.set(-Math.PI/1,0,0),this.container.add(i),s.updateMatrixWorld(!0);var o=new ft().setFromObject(this.container).getSize(new T);const l=new ie.Vec3(o.x/1.99,o.y/1.96,o.z/2),h=new ie.Box(l),d=new ie.Body({mass:0,position:s.position,material:this.physics.materials.items.floor});s.traverse(c=>{c.isMesh&&(c.material=c.material.clone(),c.material.color.r=.2,c.material.color.g=0,c.material.color.b=.6)});const f=new ie.Quaternion;if(f.setFromEuler(this.rotateX,this.rotateY,this.rotateZ,"XYZ"),d.quaternion.copy(f),d.addShape(h),this.physics.world.addBody(d),this.objects){const c=i.children.slice(),u=this.objects.add({base:{children:c},collision:{children:c},offset:this.position.clone(),mass:0});u.collision={body:d},u.container&&this.container.add(u.container)}}}class O1{constructor(e){this.time=e.time,this.scene=e.scene,this.physics=e.physics,this.mixer=null,this.model=null,this.collisionBody=null,this.setModel(),this.time?this.time.on("tick",()=>{this.tick(this.time.delta*.001)}):console.warn("SectionJapanesePark: time parametresi verilmedi, animasyonlar çalışmayacak.")}setModel(){if(!this.scene){console.warn("SectionJapanesePark: scene parametresi verilmedi, model sahneye eklenmeyecek.");return}const e=new aa;e.load("./models/SectionJapanesePark/base.glb",t=>{this.model=t.scene,this.model.position.set(13,-28,1.5),this.model.scale.set(1,1,1),this.model.rotation.x=-80.1,this.model.rotation.y=-55,this.scene.add(this.model),this.model.traverse(i=>{i.isMesh&&(i.castShadow=!0,i.receiveShadow=!0,i.material||(i.material=new Ei({color:65280})),i.material&&i.material.type==="MeshBasicMaterial"&&(i.material=new Ei({color:i.material.color||16777215})),i.material.transparent=!1,i.material.opacity=1)})}),e.load("./models/Base/base.glb",t=>{const i=t.scene;if(i.position.set(11.5,-27.5,-.5),i.scale.set(3.4,2.6,1.5),this.scene.add(i),i.traverse(r=>{r.isMesh&&(r.castShadow=!0,r.receiveShadow=!0,r.material||(r.material=new Ei({color:255})),r.material&&r.material.type==="MeshBasicMaterial"&&(r.material=new Ei({color:r.material.color||16777215})),r.material.transparent=!1,r.material.opacity=1,r.material=r.material.clone(),r.material.color.r=.2,r.material.color.g=.6,r.material.color.b=0)}),this.physics){this.collisionBody=new ie.Body({mass:0,position:i.position,material:this.physics.materials.items.floor}),i.updateMatrixWorld(!0);var s=new ft().setFromObject(i).getSize(new T);const o=new ie.Vec3(s.x/1.97,s.y/1.97,2),l=new ie.Box(o),h=new ie.Body({mass:0,position:new ie.Vec3(i.position.x,i.position.y,1),material:this.physics.materials.items.floor}),d=new ie.Quaternion;d.setFromEuler(this.rotateX,this.rotateY,this.rotateZ,"XYZ"),h.quaternion.copy(d),console.log(l),h.addShape(l),this.collisionBody.addShape(l),this.physics.world.addBody(this.collisionBody)}})}tick(e){this.mixer&&this.mixer.update(e)}}const U1=new T(-70,-8.75,3.2);class z1{constructor({scene:e,resources:t,objects:i,physics:s,debug:r,rotateX:o=0,rotateY:l=0,rotateZ:h=0}){this.scene=e,this.resources=t,this.objects=i,this.physics=s,this.debug=r,this.rotateX=o,this.rotateY=l,this.rotateZ=h,this.container=new je,this.position=U1.clone(),this._buildModel(),this.scene.add(this.container)}_buildModel(){const e=this.resources.items.RenderRoom,t=this.resources.items.Base;if(!e||!e.scene){console.error("SectionRenderRoom bina modeli bulunamadı");return}if(!t||!t.scene){console.error("Base modeli bulunamadı");return}const i=e.scene.clone(!0);i.traverse(x=>{if(x.isMesh){const b=x.material,S=b.clone();b.map&&(S.map=b.map),b.normalMap&&(S.normalMap=b.normalMap),b.roughnessMap&&(S.roughnessMap=b.roughnessMap),b.metalnessMap&&(S.metalnessMap=b.metalnessMap),S.needsUpdate=!0,x.material=S,x.castShadow=!0,x.receiveShadow=!0}}),this.position.y-=.5,this.position.x-=.55;const s=new je;i.position.set(0,0,0),i.scale.set(1.1,1.1,1.1),s.add(i),s.position.set(-70,-9.2,3.2),s.rotation.z=Math.PI/2,this.container.add(s);const r=t.scene.clone(!0);r.position.set(-70,-9.2,0),r.scale.set(1.5,1.5,.5),this.container.add(r),r.traverse(x=>{x.isMesh&&(x.material=x.material.clone(),x.material.color.r=2,x.material.color.g=0,x.material.color.b=0)});const o=t.scene.clone(!0);o.position.set(-70,-9.2,0),o.scale.set(1.5,1.5,.5),o.rotation.set(this.rotateX,this.rotateY,289.8),this.container.add(o),o.traverse(x=>{x.isMesh&&(x.material=x.material.clone(),x.material.color.r=2,x.material.color.g=0,x.material.color.b=0)}),r.updateMatrixWorld(!0),o.updateMatrixWorld(!0);var h=new ft().setFromObject(r).getSize(new T);const d=new ie.Vec3(h.x/2,h.y/2,2),f=new ie.Box(d),c=new ie.Body({mass:0,position:r.position,material:this.physics.materials.items.floor}),u=new ie.Quaternion;u.setFromEuler(r.rotation.x,r.rotation.y,r.rotation.z,"XYZ"),c.quaternion.copy(u),c.addShape(f),this.physics.world.addBody(c);var m=new ft().setFromObject(o).getSize(new T);const _=new ie.Vec3(m.x/2.7,m.y/2.7,2),g=new ie.Box(_),v=new ie.Body({mass:0,position:o.position,material:this.physics.materials.items.floor}),y=new ie.Quaternion;if(y.setFromEuler(o.rotation.x,o.rotation.y,o.rotation.z,"XYZ"),v.quaternion.copy(y),v.addShape(g),this.physics.world.addBody(v),this.objects){const x=i.children.slice(),b=this.objects.add({base:{children:x},collision:{children:x},offset:this.position.clone(),mass:0});b.collision={body:c},b.container&&this.container.add(b.container)}}}const V1=new T(-33,20,1);class H1{constructor({scene:e,resources:t,objects:i,physics:s,debug:r,rotateX:o=0,rotateY:l=0,rotateZ:h=0}){this.scene=e,this.resources=t,this.objects=i,this.physics=s,this.debug=r,this.rotateX=o,this.rotateY=l,this.rotateZ=h,this.container=new je,this.position=V1.clone(),this._buildModel(),this.scene.add(this.container)}_buildModel(){const e=this.resources.items.Concert,t=this.resources.items.Base;if(!e||!e.scene){console.error("SectionConcert bina modeli bulunamadı");return}if(!t||!t.scene){console.error("Base modeli bulunamadı");return}const i=e.scene.clone(!0);i.traverse(u=>{if(u.isMesh){const p=u.material,m=p.clone();p.map&&(m.map=p.map),p.normalMap&&(m.normalMap=p.normalMap),p.roughnessMap&&(m.roughnessMap=p.roughnessMap),p.metalnessMap&&(m.metalnessMap=p.metalnessMap),m.needsUpdate=!0,u.material=m,u.castShadow=!0,u.receiveShadow=!0}});const s=t.scene.clone(!0);s.position.set(this.position),s.scale.set(1,1,1);const r=this.position;i.position.copy(r),i.rotation.set(this.rotateX,this.rotateY,81.4),this.container.add(i),s.updateMatrixWorld(!0);var l=new ft().setFromObject(i).getSize(new T);const h=new ie.Vec3(l.x/1.9,3,l.z*1.5),d=new ie.Box(h),f=new ie.Body({mass:0,position:new ie.Vec3(this.position.x-1.25,this.position.y,this.position.z),material:this.physics.materials.items.floor}),c=new ie.Quaternion;if(c.setFromEuler(Math.PI/2,this.rotateY,this.rotateZ,"XYZ"),f.quaternion.copy(c),f.addShape(d),this.objects){const u=i.children.slice(),p=this.objects.add({base:{children:u},collision:{children:u},mass:0,offset:this.position});p.collision={body:f},p.container&&this.container.add(p.container)}}}const G1=new T(0,0,0);class W1{constructor({scene:e,resources:t,objects:i,physics:s,debug:r,areas:o,rotateX:l=0,rotateY:h=0,rotateZ:d=0,camera:f=0,time:c=0,car:u=null}){this.scene=e,this.resources=t,this.objects=i,this.physics=s,this.debug=r,this.areas=o,this.camera=f,this.rotateX=l,this.rotateY=h,this.rotateZ=d,this.time=c,this.car=u,this.container=new je,this.position=G1.clone(),this.billboards=[{position:{x:3,y:-8,z:0},name:"Billboard1",link:"https://gokonya.com/en/catalhoyuk"},{position:{x:14,y:-8,z:0},name:"Billboard2",link:"https://kbbgenclikmeclisi.com/hosgeldin"},{position:{x:23,y:-7,z:0},name:"Billboard3",link:"https://www.genckultur.com/"},{position:{x:32,y:-1.5,z:0},name:"Billboard4",link:"https://gokonya.com/tr/karatay-medresesi"},{position:{x:43,y:0,z:0},name:"Billboard5",link:"https://gokonya.com/en/mevlana"},{position:{x:53,y:1,z:0},name:"Billboard6",link:"https://gokonya.com/en/sille-2"}],this.billboards.forEach(p=>{this._buildModel(p.position,p.name),this.createButton(p.position,p.link)}),this.scene.add(this.container)}_buildModel(e,t){const i=this.resources.items[t],s=this.resources.items.Base;if(!i||!i.scene){console.error("SectionBillboard bina modeli bulunamadı");return}if(!s||!s.scene){console.error("Base modeli bulunamadı");return}const r=i.scene.clone(!0);r.traverse(m=>{if(m.isMesh){const _=m.material,g=_.clone();_.map&&(g.map=_.map),_.normalMap&&(g.normalMap=_.normalMap),_.roughnessMap&&(g.roughnessMap=_.roughnessMap),_.metalnessMap&&(g.metalnessMap=_.metalnessMap),g.needsUpdate=!0,m.material=g,m.castShadow=!0,m.receiveShadow=!0}});const o=s.scene.clone(!0);o.position.set(0+e.x,0+e.y,0+e.z),o.scale.set(1,1,1);const l=new T(e.x,e.y,e.z);r.position.copy(l),r.rotation.set(this.rotateX,this.rotateY,this.rotateZ+-Math.PI/2),this.container.add(r),o.updateMatrixWorld(!0);var d=new ft().setFromObject(r).getSize(new T);const f=new ie.Vec3(d.x/3,d.y/3,d.z),c=new ie.Box(f),u=new ie.Body({mass:0,position:r.position,material:this.physics.materials.items.floor}),p=new ie.Quaternion;if(p.setFromEuler(this.rotateX,this.rotateY,this.rotateZ+-Math.PI/2,"XYZ"),u.quaternion.copy(p),u.addShape(c),this.physics.world.addBody(u),this.objects){const m=r.children.slice(),_=this.objects.add({base:{children:m},collision:{children:m},offset:new T(e.x,e.y,e.z),mass:0});_.collision={body:u},_.container&&this.container.add(_.container)}}createButton(e,t){this.button={},this.button.position=new T(e.x,e.y-4,e+.25),this.button.container=new je,this.button.container.position.copy(this.button.position),this.container.add(this.button.container),this.button.label={},this.button.label.size=2,this.button.label.geometry=new pi(this.button.label.size,this.button.label.size/2.5,1,1),this.button.label.canvas=document.createElement("canvas"),this.button.label.canvas.width=512,this.button.label.canvas.height=360,this.button.label.context=this.button.label.canvas.getContext("2d"),this.button.label.texture=new Ht(this.button.label.canvas),this.button.label.texture.magFilter=Nt,this.button.label.texture.minFilter=Nt,this.button.label.texture.needsUpdate=!0,this.button.label.material=new Ne({map:this.button.label.texture,transparent:!0,opacity:1,depthWrite:!1}),this.button.label.mesh=new Ae(this.button.label.geometry,this.button.label.material),this.button.label.mesh.position.z=.15,this.button.label.mesh.matrixAutoUpdate=!1,this.button.label.mesh.updateMatrix(),this.button.container.add(this.button.label.mesh),this.button.triggerArea=this.areas.add({position:new Oe(this.button.position.x,this.button.position.y),halfExtents:new Oe(2,1.5),hasKey:!0,testCar:!0,active:!0,car:this.car,billboardLink:t,isBillboard:!0,areaSize:3})}}const X1=new T(-66.5,-25,1.7);class j1{constructor({scene:e,resources:t,objects:i,physics:s,debug:r,rotateX:o=0,rotateY:l=0,rotateZ:h=0}){this.scene=e,this.resources=t,this.objects=i,this.physics=s,this.debug=r,this.rotateX=o,this.rotateY=l,this.rotateZ=h,this.container=new je,this.position=X1.clone(),this._buildModel(),this.scene.add(this.container)}_buildModel(){const e=this.resources.items.CoWork,t=this.resources.items.Base;if(!e||!e.scene){console.error("CoWork modeli bulunamadı");return}if(!t||!t.scene){console.error("Base modeli bulunamadı"),n;return}const i=e.scene.clone(!0);i.traverse(y=>{if(y.isMesh){const x=y.material,b=x.clone();x.map&&(b.map=x.map),x.normalMap&&(b.normalMap=x.normalMap),x.roughnessMap&&(b.roughnessMap=x.roughnessMap),x.metalnessMap&&(b.metalnessMap=x.metalnessMap),b.needsUpdate=!0,y.material=b,y.castShadow=!0,y.receiveShadow=!0,y.scale.set(1,1,1)}});const s=t.scene.clone(!0);s.position.set(-67,-25,0),s.scale.set(1.5,1.5,.5),s.rotation.set(this.rotateX,this.rotateY,0),this.container.add(s),s.traverse(y=>{y.isMesh&&(y.material=y.material.clone(),y.material.color.r=2,y.material.color.g=0,y.material.color.b=0)});const r=t.scene.clone(!0);r.position.set(-67,-25,0),r.scale.set(1.5,1.5,.5),r.rotation.set(this.rotateX,this.rotateY,289.8),this.container.add(r),r.traverse(y=>{y.isMesh&&(y.material=y.material.clone(),y.material.color.r=2,y.material.color.g=0,y.material.color.b=0)}),i.position.copy(this.position),i.rotation.set(this.rotateX,this.rotateY,this.rotateZ),this.container.add(i),s.updateMatrixWorld(!0),r.updateMatrixWorld(!0);var l=new ft().setFromObject(s).getSize(new T);const h=new ie.Vec3(l.x/2,l.y/2,2),d=new ie.Box(h),f=new ie.Body({mass:0,position:s.position,material:this.physics.materials.items.floor}),c=new ie.Quaternion;c.setFromEuler(s.rotation.x,s.rotation.y,s.rotation.z,"XYZ"),f.quaternion.copy(c),f.addShape(d),this.physics.world.addBody(f);var p=new ft().setFromObject(r).getSize(new T);const m=new ie.Vec3(p.x/2.95,p.y/2.95,2),_=new ie.Box(m),g=new ie.Body({mass:0,position:r.position,material:this.physics.materials.items.floor}),v=new ie.Quaternion;if(v.setFromEuler(r.rotation.x,r.rotation.y,r.rotation.z,"XYZ"),g.quaternion.copy(v),g.addShape(_),this.physics.world.addBody(g),this.objects){const y=i.children.slice(),x=this.objects.add({base:{children:y},collision:{children:y},offset:this.position.clone(),mass:0});x.collision={body:f},x.container&&this.container.add(x.container)}}}class Y1{constructor({scene:e,resources:t,physics:i,debug:s,time:r}){this.scene=e,this.resources=t,this.physics=i,this.debug=s,this.time=r,this.container=new je,this.container.name="Tram",this.tramSpeed=.2,this.tramPosition=0,this.railRadius=15,this._createTram(),this.time.on("tick",()=>this._update()),this.scene.add(this.container)}_createTram(){try{this.resources.items.tramBase&&this.resources.items.tramBase.scene?(console.log("Tram modeli yüklendi"),this.tram=this.resources.items.tramBase.scene.clone(),this.tram.traverse(e=>{if(e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0,e.material)){const t=e.material.clone();t.needsUpdate=!0,e.material=t}}),this.tram.scale.set(.5,.5,.5),this.container.add(this.tram),this._updateTramPosition()):console.error("Tram modeli bulunamadı!")}catch(e){console.error("Tram oluşturma hatası:",e)}}_updateTramPosition(){const e=this.tramPosition*Math.PI*2,t=Math.cos(e)*this.railRadius,i=Math.sin(e)*this.railRadius;this.tram.position.set(t,0,i),this.tram.rotation.set(0,0,0)}_update(){this.tramPosition+=this.tramSpeed*.001,this.tramPosition>=1&&(this.tramPosition=0),this._updateTramPosition()}toggleMovement(){return this.tramSpeed=this.tramSpeed===0?.2:0,this.tramSpeed>0?"Tram hareket ediyor":"Tram durdu"}addInteractionArea(){this.physics&&this.physics.areas&&(this.interactionArea=this.physics.areas.add({position:new Oe(this.container.position.x,this.container.position.z),halfExtents:new Oe(this.railRadius+5,this.railRadius+5),debug:this.debug}),this.interactionArea.on("interact",()=>{const e=this.toggleMovement();console.log(e)}))}}class q1{constructor({scene:e,resources:t,objects:i,rotateX:s=0,rotateY:r=0,rotateZ:o=0,position:l=null,materials:h=null,areas:d=null,time:f=null,physics:c}){this.scene=e,this.resources=t,this.objects=i,this.materials=h,this.areas=d,this.time=f,this.physics=c,this.rotateX=s,this.rotateY=r,this.rotateZ=o,this.position=l||new T(-60,-37,0),this.timeScale=1,this.container=new je,this.container.matrixAutoUpdate=!1,this.container.updateMatrix(),this.scene.add(this.container),this._buildModel(),this._buildPlatform()}_buildModel(){const e=this.resources.items.Newton;if(!e||!e.scene){console.error("Newton Salıncağı modeli bulunamadı");return}const t=e.scene.clone(!0);t.scale.set(1,1,1),t.traverse(d=>{if(d.isMesh){const f=d.material,c=f.clone();f.map&&(c.map=f.map),f.normalMap&&(c.normalMap=f.normalMap),f.roughnessMap&&(c.roughnessMap=f.roughnessMap),f.metalnessMap&&(c.metalnessMap=f.metalnessMap),c.needsUpdate=!0,d.material=c,d.castShadow=!0,d.receiveShadow=!0}}),t.position.copy(this.position),t.rotation.set(this.rotateX,this.rotateY,this.rotateZ),this.container.add(t),t.updateMatrixWorld(!0);const s=new ft().setFromObject(t).getSize(new T),r=new ie.Vec3(s.x/2.175,s.y,3.6),o=new ie.Box(r),l=new ie.Body({mass:0,position:new ie.Vec3(this.position.x+.75,this.position.y-1.5,this.position.z),material:this.physics.materials.items.floor}),h=new ie.Quaternion;h.setFromEuler(this.rotateX,this.rotateY,this.rotateZ,"XYZ"),l.quaternion.copy(h),l.addShape(o),this.physics.world.addBody(l),this.model=t,e.animations&&e.animations.length>0&&(this.mixer=new qh(t),e.animations.forEach(d=>{const f=this.mixer.clipAction(d);f.setEffectiveTimeScale(this.timeScale),f.play()}),this.time&&this.time.on("tick",()=>{this.mixer&&this.mixer.update(this.time.delta*.001*this.timeScale)})),console.log("Newton Salıncağı eklendi, konum:",this.position)}setAnimationSpeed(e){this.timeScale=e,this.mixer&&this.mixer._actions.forEach(t=>{t.setEffectiveTimeScale(this.timeScale)})}_buildPlatform(){this.model.updateMatrixWorld(!0);const t=new ft().setFromObject(this.model).getSize(new T),i=t.x-1,s=t.z-1,r=.5,o=new Ut(i,r,s),l=new Ei({color:8421504,roughness:.5,metalness:.2});this.platform=new Ae(o,l),this.platform.position.set(this.position.x+.4,this.position.y-t.y/2-r/2+2.5,this.position.z),this.platform.rotation.set(this.rotateX,this.rotateY,this.rotateZ),this.platform.castShadow=!0,this.platform.receiveShadow=!0;const h=new ow(o),d=new tr({color:6710886,linewidth:1}),f=new Vh(h,d);this.platform.add(f),this.container.add(this.platform)}}const $1=new T(0,0,0);class Z1{constructor({scene:e,resources:t,objects:i,physics:s,debug:r,rotateX:o=0,rotateY:l=0,rotateZ:h=0}){this.scene=e,this.resources=t,this.objects=i,this.physics=s,this.debug=r,this.rotateX=o,this.rotateY=l,this.rotateZ=h,this.container=new je,this.position=$1.clone(),this._buildModel(new T(-69.98,-15.74,0)),this._buildModel(new T(-64.8,-17.03,0)),this._buildModel(new T(-63.43,-19.59,0)),this._buildModel(new T(-66.846,-17.896,0)),this._buildModel(new T(-67.08,-15.288,0)),this._buildModel(new T(-65.508,-4.0425,0)),this._buildModel(new T(-69.13,-2.448,0)),this._buildModel(new T(-71.75,.918,0)),this._buildModel(new T(-67.572,-.534,0)),this._buildModel(new T(-59.376,6.63637,0)),this._buildModel(new T(-62.935,10.116,0)),this._buildModel(new T(-57.8,7.8,0)),this._buildModel(new T(-60.676,10.3376,0)),this._buildModel(new T(-52.63,21.52,0)),this._buildModel(new T(-55.93,23.54,0)),this._buildModel(new T(-59.34,22.31,0)),this._buildModel(new T(-52.42,17.11,0)),this._buildModel(new T(-57.35,21.5,0)),this._buildModel(new T(-54.22,19.53,0)),this._buildModel(new T(-58.7,24.92,0)),this.scene.add(this.container)}_buildModel(e){const t=this.resources.items.tilesABase;if(!t||!t.scene){console.error("SectionStone bina modeli bulunamadı");return}const i=t.scene.clone(!0);i.traverse(f=>{if(f.isMesh){const c=f.material,u=c.clone();c.map&&(u.map=c.map),c.normalMap&&(u.normalMap=c.normalMap),c.roughnessMap&&(u.roughnessMap=c.roughnessMap),c.metalnessMap&&(u.metalnessMap=c.metalnessMap),u.needsUpdate=!0,f.material=u,f.castShadow=!0,f.receiveShadow=!0}}),i.position.copy(e),i.rotation.set(this.rotateX,this.rotateY,this.rotateZ),this.container.add(i),i.updateMatrixWorld(!0);var r=new ft().setFromObject(i).getSize(new T);const o=new ie.Vec3(r.x-.2,r.y-.2,r.z),l=new ie.Box(o),h=new ie.Body({mass:0,position:new ie.Vec3(e.x,e.y,e.z-.025),material:this.physics.materials.items.floor});i.children[0].material.color.b=0,i.children[0].material.color.g=0,i.children[0].material.color.r=1;const d=new ie.Quaternion;if(d.setFromEuler(this.rotateX,this.rotateY,this.rotateZ,"XYZ"),h.quaternion.copy(d),h.addShape(l),this.physics.world.addBody(h),this.objects){const f=i.children.slice(),c=this.objects.add({base:{children:f},collision:{children:f},offset:this.position.clone(),mass:0});c.collision={body:h},c.container&&this.container.add(c.container)}}}const K1=new T(-27,-25,0);class Q1{constructor({scene:e,resources:t,objects:i,physics:s,debug:r,rotateX:o=0,rotateY:l=0,rotateZ:h=0,areas:d=null,car:f=null}){this.scene=e,this.resources=t,this.objects=i,this.physics=s,this.debug=r,this.areas=d,this.car=f,this.rotateX=o,this.rotateY=l,this.rotateZ=h,this.container=new je,this.position=K1.clone(),this.debug&&this.setupDebug(),this._buildModel(),this._createBaseModel(),this._createInteractionArea(),this.scene.add(this.container)}setupDebug(){this.debugFolder=this.debug.addFolder("Kademe"),this.debugFolder.add(this.position,"x").step(1).min(-100).max(100).name("positionX").onChange(()=>this.updatePosition()),this.debugFolder.add(this.position,"y").step(1).min(-100).max(100).name("positionY").onChange(()=>this.updatePosition()),this.debugFolder.add(this.position,"z").step(1).min(-100).max(100).name("positionZ").onChange(()=>this.updatePosition()),this.scale={value:1},this.debugFolder.add(this.scale,"value").step(.1).min(.1).max(5).name("scale").onChange(()=>this.updateScale()),this.rotation={x:this.rotateX,y:this.rotateY,z:this.rotateZ},this.debugFolder.add(this.rotation,"x").step(.1).min(-Math.PI).max(Math.PI).name("rotationX").onChange(()=>this.updateRotation()),this.debugFolder.add(this.rotation,"y").step(.1).min(-Math.PI).max(Math.PI).name("rotationY").onChange(()=>this.updateRotation()),this.debugFolder.add(this.rotation,"z").step(.1).min(-Math.PI).max(Math.PI).name("rotationZ").onChange(()=>this.updateRotation())}updatePosition(){this.model&&(this.model.position.copy(this.position),this.baseModel&&this.baseModel.position.copy(this.position),this.interactionArea&&(this.interactionArea.container.position.x=this.position.x,this.interactionArea.container.position.y=this.position.y),this.body&&this.body.position.copy(new ie.Vec3(this.position.x,this.position.y,this.position.z)))}updateScale(){this.model&&(this.model.scale.set(this.scale.value,this.scale.value,this.scale.value),this.baseModel&&this.baseModel.scale.set(this.scale.value,this.scale.value,this.scale.value))}updateRotation(){if(this.model&&(this.model.rotation.set(this.rotation.x,this.rotation.y,this.rotation.z),this.baseModel&&this.baseModel.rotation.set(this.rotation.x,this.rotation.y,this.rotation.z),this.body)){const e=new ie.Quaternion;e.setFromEuler(this.rotation.x,this.rotation.y,this.rotation.z,"XYZ"),this.body.quaternion.copy(e)}}_createBaseModel(){let e=8,t=8,i=.5;if(this.model){const l=new ft().setFromObject(this.model).getSize(new T);e=l.x+1,t=l.y+1,i=.5}const s=new Ut(e,t,i),r=new Ne({color:65280,transparent:!0,opacity:0,wireframe:!1});if(this.baseModel=new Ae(s,r),this.baseModel.position.copy(this.position),this.model){const l=new ft().setFromObject(this.model).getSize(new T);this.baseModel.position.z=this.position.z-l.z*.25}this.baseModel.rotation.set(this.rotateX,this.rotateY,this.rotateZ),this.container.add(this.baseModel),console.log("Base model oluşturuldu ve boyutlandırıldı")}_createInteractionArea(){if(!this.areas){console.warn("Areas sınıfı tanımlanmamış, etkileşim alanı oluşturulamadı");return}console.log("Areas sınıfı mevcut, etkileşim alanı oluşturuluyor...");try{let e=15,t=15;if(this.model){const s=new ft().setFromObject(this.model).getSize(new T);e=s.x*2+10,t=s.y*2+10}this.interactionArea=this.areas.add({position:new Oe(this.position.x,this.position.y),halfExtents:new Oe(e/2,t/2),testCar:!0,active:!0,hasKey:!0,car:this.car,isBuilding:!0,areaSize:Math.max(e,t)/2,name:"Kademe",description:"Kademe, öğrencilere akademik başarılarının yanı sıra kişisel ve profesyonel gelişimlerine odaklanarak onları iş dünyasının taleplerine uygun şekilde hazırlıyor."}),this.interactionArea&&this.interactionArea.on("in",()=>{console.log("Araç Kademe alanına girdi, popup açılıyor..."),setTimeout(()=>{this.interactionArea.interact(!0,!0)},500)}),console.log("Kademe etkileşim alanı başarıyla oluşturuldu, boyutlar:",`Genişlik: ${e}, Yükseklik: ${t}`)}catch(e){console.error("Etkileşim alanı oluşturulurken hata:",e)}}_buildModel(){const e=this.resources.items.Kademe;if(!e||!e.scene){console.error("Kademe modeli bulunamadı");return}const t=e.scene.clone(!0);this.model=t,t.traverse(_=>{if(_.isMesh){const g=_.material,v=g.clone();g.map&&(v.map=g.map),g.normalMap&&(v.normalMap=g.normalMap),g.roughnessMap&&(v.roughnessMap=g.roughnessMap),g.metalnessMap&&(v.metalnessMap=g.metalnessMap),v.needsUpdate=!0,_.material=v,_.castShadow=!0,_.receiveShadow=!0}}),t.scale.set(1,1,1),t.position.copy(this.position),t.rotation.set(this.rotateX,this.rotateY,this.rotateZ),this.container.add(t),t.updateMatrixWorld(!0);const i=new ft().setFromObject(t),s=i.getSize(new T);i.getCenter(new T);const r=.85,o=s.z/4,l=new ie.Vec3(s.x*r/2,s.y*r/2,s.z*r/2),h=new ie.Box(l),d=new ie.Body({mass:0,position:new ie.Vec3(this.position.x,this.position.y,this.position.z+o),material:this.physics.materials.items.floor,collisionFilterGroup:1,collisionFilterMask:1});this.body=d;const f=new ie.Quaternion;f.setFromEuler(this.rotateX,this.rotateY,this.rotateZ,"XYZ"),d.quaternion.copy(f),d.addShape(h);const c=Math.min(s.x,s.y)*.15,u=s.z*.7,p=new ie.Box(new ie.Vec3(c,c,u/2));if([new ie.Vec3(-s.x/2*r*.95,-s.y/2*r*.95,0),new ie.Vec3(s.x/2*r*.95,-s.y/2*r*.95,0),new ie.Vec3(-s.x/2*r*.95,s.y/2*r*.95,0),new ie.Vec3(s.x/2*r*.95,s.y/2*r*.95,0)].forEach(_=>{d.addShape(p,_)}),this.physics.world.addBody(d),this.objects){const _=t.children.slice(),g=this.objects.add({base:{children:_},collision:{children:_},offset:this.position.clone(),mass:0});g.collision={body:d},g.container&&this.container.add(g.container)}console.log("Kademe modeli başarıyla yerleştirildi, pozisyon:",this.position)}}const J1=new T(-40,15,0);class eE{constructor({scene:e,resources:t,objects:i,physics:s,debug:r,rotateX:o=0,rotateY:l=0,rotateZ:h=0}){this.scene=e,this.resources=t,this.objects=i,this.physics=s,this.debug=r,this.rotateX=o,this.rotateY=l,this.rotateZ=h,this.container=new je,this.position=J1.clone(),this._buildModel(),this.scene.add(this.container)}_buildModel(){const e=this.resources.items.BasketballCourt,t=this.resources.items.Base;if(!e||!e.scene){console.error("SectionBasketballCourt bina modeli bulunamadı");return}if(!t||!t.scene){console.error("Base modeli bulunamadı");return}const i=e.scene.clone(!0);i.traverse(u=>{if(u.isMesh){const p=u.material,m=p.clone();p.map&&(m.map=p.map),p.normalMap&&(m.normalMap=p.normalMap),p.roughnessMap&&(m.roughnessMap=p.roughnessMap),p.metalnessMap&&(m.metalnessMap=p.metalnessMap),m.needsUpdate=!0,u.material=m,u.castShadow=!0,u.receiveShadow=!0}});const s=t.scene.clone(!0);s.position.set(this.position),s.scale.set(1,1,1);const r=this.position;i.position.copy(r),i.rotation.set(Math.PI/2,Math.PI/5,this.rotateZ),this.container.add(i),s.updateMatrixWorld(!0);var l=new ft().setFromObject(i).getSize(new T);const h=new ie.Vec3(l.x/1.9,3,l.z*1.5),d=new ie.Box(h),f=new ie.Body({mass:0,position:new ie.Vec3(this.position.x-1.25,this.position.y,this.position.z),material:this.physics.materials.items.floor}),c=new ie.Quaternion;if(c.setFromEuler(Math.PI/2,this.rotateY,this.rotateZ,"XYZ"),f.quaternion.copy(c),f.addShape(d),this.objects){const u=i.children.slice(),p=this.objects.add({base:{children:u},collision:{children:u},mass:0,offset:this.position});p.collision={body:f},p.container&&this.container.add(p.container)}}}const tE=new T(-40,15,1);class iE{constructor({scene:e,resources:t,objects:i,physics:s,debug:r,rotateX:o=0,rotateY:l=0,rotateZ:h=0}){this.scene=e,this.resources=t,this.objects=i,this.physics=s,this.debug=r,this.rotateX=o,this.rotateY=l,this.rotateZ=h,this.container=new je,this.position=tE.clone(),this._buildModel(),this.scene.add(this.container)}_buildModel(){}}class nE{constructor(e){this.config=e.config,this.debug=e.debug,this.resources=e.resources,this.time=e.time,this.sizes=e.sizes,this.camera=e.camera,this.scene=e.scene,this.renderer=e.renderer,this.passes=e.passes,this.debug&&(this.debugFolder=this.debug.addFolder("world"),this.debugFolder.open()),this.container=new je,this.container.matrixAutoUpdate=!1,this.setSounds(),this.setControls(),this.setFloor(),this.setAreas(),this.setStartingScreen(),this.options={config:this.config,time:this.time,resources:this.resources,camera:this.camera,passes:this.passes,objects:this.objects,areas:this.areas,zones:this.zones,walls:this.walls,tiles:this.tiles,debug:this.debugFolder}}start(){window.setTimeout(()=>{this.camera.pan.enable()},2e3),this.sections={},this.buildings={},this.setReveal(),this.setMaterials(),this.setShadows(),this.setPhysics(),this.setZones(),this.setObjects(),this.setWalls(),this.setGround(),this.setRoadSign(),this.setTrafficLight(),this.setLego(),this.setAlaaddin(),this.setAtmosphere(),this.setCapsule(),this.setDivision(),this.setRenderRoom(),this.setConcert(),this.setBasketballCourt(),this.setButterfly(),this.setNewton(),this.setStone(),this.setCoWork(),this.setJapanesePark(),this.setRocket(),this.setScienceCenter(),this.setSocialInovation(),this.setSoundRoom(),this.setStadium(),this.setYoungCard(),this.setYoungCenter(),this.setKademe(),this.setSoccer(),this.createBuildingAreas(),this.setCar(),this.setGreenScreen(),this.setBillboard(),this.areas.car=this.car,this.areas.setCar(this.car),this.sectionRocket.setCar(this.car),window.setTimeout(()=>{const e=document.getElementById("loadingScreen");e.style.opacity="0",e.addEventListener("transitionend",()=>{e.style.display="none"})},3200)}setReveal(){this.reveal={},this.reveal.matcapsProgress=0,this.reveal.floorShadowsProgress=0,this.reveal.previousMatcapsProgress=null,this.reveal.previousFloorShadowsProgress=null,this.reveal.go=()=>{Qe.fromTo(this.reveal,{matcapsProgress:0},{matcapsProgress:1,duration:3}),Qe.fromTo(this.reveal,{floorShadowsProgress:0},{floorShadowsProgress:1,duration:3,delay:.5}),Qe.fromTo(this.shadows,{alpha:0},{alpha:.5,duration:3,delay:.5}),this.sections.intro&&(Qe.fromTo(this.sections.intro.instructions.arrows.label.material,{opacity:0},{opacity:1,duration:.3,delay:.5}),this.sections.intro.otherInstructions&&Qe.fromTo(this.sections.intro.otherInstructions.label.material,{opacity:0},{opacity:1,duration:.3,delay:.75})),this.physics.car.chassis.body.sleep(),this.physics.car.chassis.body.position.set(19.913,-12.908,1),window.setTimeout(()=>{this.physics.car.chassis.body.wakeUp()},300),Qe.fromTo(this.sounds.engine.volume,{master:0},{master:.7,duration:.5,delay:.3,ease:"power2.in"}),window.setTimeout(()=>{this.sounds.play("reveal")},400),this.controls.touch&&window.setTimeout(()=>{this.controls.touch.reveal()},400)},this.time.on("tick",()=>{if(this.reveal.matcapsProgress!==this.reveal.previousMatcapsProgress){for(const e in this.materials.shades.items){const t=this.materials.shades.items[e];t.uniforms.uRevealProgress.value=this.reveal.matcapsProgress}this.reveal.previousMatcapsProgress=this.reveal.matcapsProgress}if(this.reveal.floorShadowsProgress!==this.reveal.previousFloorShadowsProgress){for(const e of this.objects.floorShadows)e.material.uniforms.uAlpha.value=this.reveal.floorShadowsProgress;this.reveal.previousFloorShadowsProgress=this.reveal.floorShadowsProgress}}),this.debug&&(this.debugFolder.add(this.reveal,"matcapsProgress").step(1e-4).min(0).max(1).name("matcapsProgress"),this.debugFolder.add(this.reveal,"floorShadowsProgress").step(1e-4).min(0).max(1).name("floorShadowsProgress"),this.debugFolder.add(this.reveal,"go").name("reveal"))}setStartingScreen(){this.startingScreen={},this.startingScreen.area=this.areas.add({position:new Oe(0,0),halfExtents:new Oe(2.35,1.5),hasKey:!1,testCar:!1,active:!1}),this.startingScreen.loadingLabel={},this.startingScreen.loadingLabel.geometry=new pi(2.5,2.5/4),this.startingScreen.loadingLabel.image=new Image,this.startingScreen.loadingLabel.image.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAABABAMAAAAHc7SNAAAAMFBMVEUAAAD///9ra2ucnJzR0dH09PQmJiaNjY24uLjp6end3d1CQkLFxcVYWFiqqqp9fX3nQ5qrAAAEVUlEQVRo3u3YT08TQRQA8JEtW6CATGnDdvljaTwYE2IBI/HGRrwSetGTsZh4MPFQYiQe229gE++WePFY9Oqh1cRzieEDYIgXLxjPJu5M33vbZQszW+fgoS+B7ewO836znRl2lg1jGMP4P2Okw0yFvaKsklr3I99Tvl3iPPelGbQhKqxB4eN6N/7gVcsvbEAz1F4RLn67zzl/v6/oLvejGBQ9LsNphio4UFjmEAsVJuOK/zkDtc6w+gyTcZ3LyP6IAzjBDA+pj6LkEgAjW4kANsMAC6vmOvqAMU5RgVOTskQACicCmCcA9AXjkT5gj1MswqlxWcoTgKJ6HuAQAD5guNoAu8QpMnBul1ONMGD2PCBbRgDAKYq6AEtmXvtdj3S6GhRyW1t1DvkAgM0ggG7mu1t3xWFHFzAqv3wYCi0mY1UCGgiQPU+1oWIY8LoXcAA3qeYfr+kClvHW14PJ5OfCAgHYNAoDAORBQIrDvHjqH5c0ANTbORzBacbAQgUC2IAKAzI9gCSHlWEMLmgBPJxMvyARpIICALDm4nkAbwIA71EZx5UOgO48JnLoOhQIAN9sOgKoBoAE5r0aB8ARcNhtFzrg0VQmwCp8CAMeAADGc44S5GMBsF1aCEU2LcAcAPDCvwFytBDehCaUgJxRAKeF8BNUUQJ43iiAUlqwFKoBrTCAHjiagwEgU0YM5IYWYD4KoIgPwIXQwUbVgCXzgLpIBJNeDciWTQNskVsq1ADX/6kYBdCTjse5owbMiX+IpgGWOCPSuWpA2vN/TAMm5QTYg5IC4FdbMA0YF5Nb5s2rAaLyhzBgektGZWDArrgqi0U1QHxf38OABDwUDgTAjGfyPlTVgJT/67FBACbqyGYaaoBctQwD2vI4DecVAPkgZRhQlxPQks2rAePGAbZsRlaa1QBYEQBUHRCAmaXD0QDYxgFWdye05R9cDQCrmQYkeBA6gGXTgNEeQF4DMG4S4MLjOUZRA5A0CcjADgmjqgGwSwSg9wK1GIBS74KTgTxv/EHoiaVQsTOS5RoCJuiZyosB8EIrHpyowFiYofO0i4wCjhCQwL0hq2sCaFNM22S4JXloLk0AuLDTBzCBAAt3xykeA7CHe/mDbgdTvQ9GswSAwdbqA0giYASHjQUJnhQKhQ6z/d8rDA4hAG2Dsk042ejubHMM2nV6AMf93pCkaRjhh0WsWuz+6aasl2FwiAImReEts1/CSaFfwFouAJxC4RW+I4oCThBQE1X2WbKkBFDkqYDtJ0SHaYKq3pJJwCECjjiFPoC1w+2P0gumurgeBjT6AhIIGKOelGIAngWlFnRnMZjMIYBb7gtIIsAuYU+8GICpEhYyZVgIZ2g9rYYAX1lfAKvjnxzjnWrHALDn9K1h2k2aoI1ewGd2AWAVAVMHcKdW4wDYje739pNufJXhkJohgLu9zy4CHCKAJYUge4ddCojGyPrp9kaHmYjUi9N7+2wYwxjGZfEXMKxGE0GkkfIAAAAASUVORK5CYII=",this.startingScreen.loadingLabel.texture=new Ht(this.startingScreen.loadingLabel.image),this.startingScreen.loadingLabel.texture.magFilter=li,this.startingScreen.loadingLabel.texture.minFilter=Nt,this.startingScreen.loadingLabel.texture.needsUpdate=!0,this.startingScreen.loadingLabel.material=new Ne({transparent:!0,depthWrite:!1,color:16777215,alphaMap:this.startingScreen.loadingLabel.texture}),this.startingScreen.loadingLabel.mesh=new Ae(this.startingScreen.loadingLabel.geometry,this.startingScreen.loadingLabel.material),this.startingScreen.loadingLabel.mesh.matrixAutoUpdate=!1,this.container.add(this.startingScreen.loadingLabel.mesh),this.startingScreen.startLabel={},this.startingScreen.startLabel.geometry=new pi(2.5,2.5/4),this.startingScreen.startLabel.image=new Image,this.startingScreen.startLabel.image.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAABABAMAAAAHc7SNAAAAMFBMVEUAAAD///+cnJxra2vR0dHd3d0mJib09PRYWFjp6em4uLhCQkKqqqqNjY19fX3FxcV3XeRgAAADsklEQVRo3u3YsU9TQRwH8KNgLSDQg9ZCAak1IdE4PKPu1NTEsSzOMDl3I3GpcXAxBhLjXFxNjJgQJ2ON0Rnj4uAAEyv8B/L7tV++5/VN+CM69Ldwfa+534d7d793VzeIQQzi/49c4v5lPF/1vvhFm++rjIpcyErrmrSCuz+cxng1iL/If8drPJD2Lc/Iy4VhaZWlFd4tLPfuMc6e/5LvRilJA2SkVSQA8c0OsI0uNtIAU9rsB8y1rAAZjyimAUa1mQDAeGwF+MA+9lIA69qs9AMKVoDP8vhf35A+NiMAc7YJKFSrX7tcI8BW9+k/O/kz6zSunjSnncMHiQYBcmdXrh3xCVbc2WO8N/YZZI0AxxwMArKivmwAwFKSPmV0UwBbCpj5E+C+yzUbQAaJVwUSA9SFjwFgHQ0jAMrBWgzAPCtHgFFbQAlpEwKC2zWUQgJGbAH+naSdu/fTxQAthPL5/ADD6OCpQwCAsb6LsbEGcBluOAYBmG2fkMIawHVWXEsDIGUGpZCAIRsAS93DPgDbhUmUQgKe2NUB90hfhK0YwEJYHkYpJGDbqBKiB86CGLAlzd6/S8CEvh8sACiBvrSXCshKblWEgNy2vkAMAHwGfjECcJHOu5qUQgDm6vXulshZAXJNL9GJAeg+LxeKPQBj1gzgdlnuCWAhbOi7LwaU9u0A2VWPpUgAC+GR5k0iwBtnB3Bj3qMaRYB17X0IOQhYcjYA7guxxyIAGfd1HNqchPfly7aACQUshAA2W1r5G1yG415YpgB3qIIkAHBH2D075QnQ10fHDsCl+CoGSKpiN8kMAVqIN00BsitnVgKyPIBMB4ADKU92AA5BKQIgszjKBGBLagpwB5xZBGS6pbcuizQAXMA6NAK86OCQ3okAI55BQPe7VoDxXzU/iwPASgS4GAASAiYxWgYAzvAa1loA2AkAFQIU2zEELCJtDDgIAG0CFLvp7LblC2kAtF6eTEJJ2CBAr88bAXKY4WkASbzXmwt5AvTvohHA4WSUBmj2Jt+IThQChrAOLQC13vPFMAOAQwuyTAeAKVQto3OBDOdESh2YxNZPbpYBQNbEAoBfod7e1i1BiwB0voSZWgwAOWgtAGPhD18E8ASIiRIAXNPwXJBtcqMbAFAIr5weIJMAcIx1aAAIqk0lAuyompyFwBMHAsAZlj/lgw0rsy2AkhbsgK4Q+70CUBjxeFXsUb0G1HJDJC9rketZRcCWCJwHM8DgJm7b7ch+XizXm25QQxiEOcXvwGCWOhbCZC0qAAAAABJRU5ErkJggg==",this.startingScreen.startLabel.texture=new Ht(this.startingScreen.startLabel.image),this.startingScreen.startLabel.texture.magFilter=li,this.startingScreen.startLabel.texture.minFilter=Nt,this.startingScreen.startLabel.texture.needsUpdate=!0,this.startingScreen.startLabel.material=new Ne({transparent:!0,depthWrite:!1,color:16777215,alphaMap:this.startingScreen.startLabel.texture}),this.startingScreen.startLabel.material.opacity=0,this.startingScreen.startLabel.mesh=new Ae(this.startingScreen.startLabel.geometry,this.startingScreen.startLabel.material),this.startingScreen.startLabel.mesh.matrixAutoUpdate=!1,this.container.add(this.startingScreen.startLabel.mesh),this.resources.on("progress",e=>{this.startingScreen.area.floorBorder.material.uniforms.uAlpha.value=1,this.startingScreen.area.floorBorder.material.uniforms.uLoadProgress.value=e}),this.resources.on("ready",()=>{window.requestAnimationFrame(()=>{this.startingScreen.area.activate(),Qe.to(this.startingScreen.area.floorBorder.material.uniforms.uAlpha,{value:.3,duration:.3}),Qe.to(this.startingScreen.loadingLabel.material,{opacity:0,duration:.3}),Qe.to(this.startingScreen.startLabel.material,{opacity:1,duration:.3,delay:.3})}),this.start(),this.startingScreen.area.deactivate(),Qe.to(this.startingScreen.area.floorBorder.material.uniforms.uProgress,{value:0,duration:.3,delay:.4}),Qe.to(this.startingScreen.startLabel.material,{opacity:0,duration:.3,delay:.4}),window.setTimeout(()=>{this.reveal.go()},600)})}setSounds(){this.sounds=new CA({debug:this.debugFolder,time:this.time})}setAxes(){this.axis=new eM,this.container.add(this.axis)}setControls(){this.controls=new TA({config:this.config,sizes:this.sizes,time:this.time,camera:this.camera,sounds:this.sounds})}setMaterials(){this.materials=new PM({resources:this.resources,debug:this.debugFolder})}setFloor(){this.floor=new BM({debug:this.debugFolder}),this.container.add(this.floor.container)}setShadows(){this.shadows=new XM({time:this.time,debug:this.debugFolder,renderer:this.renderer,camera:this.camera}),this.container.add(this.shadows.container)}setPhysics(){this.physics=new qM({config:this.config,debug:this.debug,scene:this.scene,time:this.time,sizes:this.sizes,controls:this.controls,sounds:this.sounds}),this.container.add(this.physics.models.container)}setZones(){this.zones=new ZM({time:this.time,physics:this.physics,debug:this.debugFolder}),this.container.add(this.zones.container)}setAreas(){this.areas=new MA({config:this.config,resources:this.resources,debug:this.debug,renderer:this.renderer,camera:this.camera,car:this.car,sounds:this.sounds,time:this.time}),this.container.add(this.areas.container)}setTiles(){this.tiles=new Tiles({resources:this.resources,objects:this.objects,debug:this.debug})}setWalls(){this.walls=new SA({resources:this.resources,objects:this.objects})}setObjects(){this.objects=new QM({time:this.time,resources:this.resources,materials:this.materials,physics:this.physics,shadows:this.shadows,sounds:this.sounds,debug:this.debugFolder}),this.container.add(this.objects.container)}setCar(){this.car=new JM({time:this.time,resources:this.resources,objects:this.objects,physics:this.physics,shadows:this.shadows,materials:this.materials,controls:this.controls,sounds:this.sounds,renderer:this.renderer,camera:this.camera,debug:this.debugFolder,config:this.config,scene:this.scene,soundRoom:this.sectionSoundRoom}),this.container.add(this.car.container)}setGround(){this.sections.ground=new RA({...this.options,x:0,y:0,time:this.time,resources:this.resources,objects:this.objects,physics:this.physics,debug:this.debugFolder,walls:this.walls,config:this.config,scene:this.scene}),this.container.add(this.sections.ground.container)}setRoad(){this.road=new PA({time:this.time,resources:this.resources,objects:this.objects,physics:this.physics,debug:this.debugFolder,scene:this.scene}),this.container.add(this.road.container)}setRoadSign(){this.sectionRoadSign=new LA({scene:this.scene,resources:this.resources,physics:this.physics,debug:this.debugFolder,rotateX:0,rotateY:0,rotateZ:Math.PI/180})}setTrafficLight(){this.sectionTrafficLight=new Kf({scene:this.scene,resources:this.resources,objects:this.objects,physics:this.physics,debug:this.debugFolder,rotateX:0,rotateY:0,rotateZ:0,position:new T(16,-14,-.2)}),this.sectionTrafficLight2=new Kf({scene:this.scene,resources:this.resources,objects:this.objects,physics:this.physics,debug:this.debugFolder,rotateX:0,rotateY:0,rotateZ:Math.PI/2,position:new T(30,-31.9,-.2)})}setScienceCenter(){this.sectionScienceCenter=new E1({scene:this.scene,resources:this.resources,physics:this.physics,debug:this.debugFolder,rotateX:0,rotateY:0,rotateZ:Math.PI/180})}setGreenScreen(){this.sectionGreenScreen=new w1({time:this.time,scene:this.scene,resources:this.resources,physics:this.physics,debug:this.debugFolder,rotateX:0,rotateY:0,rotateZ:Math.PI/4,car:this.car,areas:this.areas,zones:this.zones,camera:this.camera,passes:this.passes})}setRenderRoom(){this.sectionRenderRoom=new z1({scene:this.scene,resources:this.resources,physics:this.physics,debug:this.debugFolder,rotateX:0,rotateY:0,rotateZ:Math.PI/2})}setConcert(){this.concert=new H1({time:this.time,resources:this.resources,objects:this.objects,physics:this.physics,debug:this.debugFolder,scene:this.scene})}setBasketball(){}setJapanesePark(){this.sectionJapanesePark=new O1({time:this.time,resources:this.resources,objects:this.objects,physics:this.physics,debug:this.debugFolder,scene:this.scene})}setCapsule(){this.sectionCapsule=new _1({scene:this.scene,resources:this.resources,physics:this.physics,debug:this.debugFolder,rotateX:0,rotateY:0,rotateZ:0})}setButterfly(){this.sectionButterfly=new C1({scene:this.scene,resources:this.resources,physics:this.physics,debug:this.debugFolder,rotateX:0,rotateY:0,rotateZ:0})}setYoungCard(){this.sectionYoungCard=new D1({time:this.time,resources:this.resources,objects:this.objects,physics:this.physics,debug:this.debugFolder,scene:this.scene,rotateX:Math.PI,rotateY:Math.PI,rotateZ:-Math.PI/2})}setRocket(){this.sectionRocket=new S1({time:this.time,resources:this.resources,objects:this.objects,physics:this.physics,debug:this.debugFolder,scene:this.scene,areas:this.areas,sounds:this.sounds,materials:this.materials}),this.container.add(this.sectionRocket.container)}setNewton(){this.sectionNewton=new q1({scene:this.scene,resources:this.resources,objects:this.objects,physics:this.physics,debug:this.debugFolder,areas:this.areas,materials:this.materials,time:this.time,rotateX:Math.PI/2,rotateY:Math.PI/8,rotateZ:0})}setStone(){this.sectionStone=new Z1({scene:this.scene,resources:this.resources,physics:this.physics,debug:this.debugFolder,rotateX:0,rotateY:0,rotateZ:0})}setSocialInovation(){this.sectionSocialInovation=new P1({scene:this.scene,resources:this.resources,physics:this.physics,debug:this.debugFolder,rotateX:Math.PI/2,rotateY:Math.PI,rotateZ:0}),this.container.add(this.sectionSocialInovation.container)}setSoundRoom(){this.sectionSoundRoom=new L1({scene:this.scene,resources:this.resources,physics:this.physics,debug:this.debugFolder,rotateX:0,rotateY:0,rotateZ:Math.PI/2}),this.container.name="SoundRoom"}setYoungCenter(){this.sectio=new N1({scene:this.scene,resources:this.resources,physics:this.physics,debug:this.debugFolder,rotateX:0,rotateY:0,rotateZ:Math.PI/2})}setAlaaddin(){this.sectionAlaaddin=new m1({scene:this.scene,time:this.time,physics:this.physics,resources:this.resources,objects:this.objects})}setTram(){try{console.log("Tram sistemi oluşturuluyor..."),this.sectionTram=new Y1({scene:this.scene,resources:this.resources,physics:this.physics,debug:this.debugFolder,time:this.time});const e=new T(13,-45,-1);this.sectionTram.container.position.copy(e),this.sectionTram.railRadius=12,console.log("Tram Alaaddin çevresine yerleştirildi"),this.sectionTram.addInteractionArea()}catch(e){console.error("Tram oluşturma hatası:",e)}}adjustTram(e,t){this.sectionTram&&(e!==void 0&&(this.sectionTram.container.position.y=-45+e),t!==void 0&&(this.sectionTram.railRadius=t),console.log(`Tram ayarlandı: Yükseklik=${this.sectionTram.container.position.y}, Yarıçap=${this.sectionTram.railRadius}`))}setAtmosphere(){this.sectionAtmosphere=new g1({time:this.time,resources:this.resources,objects:this.objects,physics:this.physics,debug:this.debugFolder,scene:this.scene})}setDivision(){this.division=new x1({scene:this.scene,resources:this.resources,physics:this.physics,debug:this.debugFolder,rotateX:0,rotateY:0,rotateZ:Math.PI/2})}setStadium(){this.stadium=new B1({scene:this.scene,resources:this.resources,physics:this.physics,debug:this.debugFolder,rotateX:0,rotateY:0,rotateZ:Math.PI/2})}setBillboard(){this.sectionBillboard=new W1({scene:this.scene,resources:this.resources,physics:this.physics,debug:this.debugFolder,areas:this.areas,rotateX:0,rotateY:0,rotateZ:Math.PI/2,camera:this.camera,time:this.time,car:this.car}),this.container.name="Billboard"}setCoWork(){this.sectionCoWork=new j1({scene:this.scene,resources:this.resources,physics:this.physics,debug:this.debugFolder,rotateX:0,rotateY:0,rotateZ:Math.PI/2})}setGameMechanic(){console.log("Futbol sahası devre dışı bırakıldı - setGameMechanic() yorum satırına alındı")}setLego(){this.sectionLego=new BA({scene:this.scene,resources:this.resources,physics:this.physics,debug:this.debugFolder,rotateX:0,rotateY:0,rotateZ:0})}setSoccer(){this.sectionSoccer=new iE({scene:this.scene,resources:this.resources,physics:this.physics,debug:this.debugFolder,rotateX:0,rotateY:0,rotateZ:0})}setKademe(){this.sectionKademe=new Q1({scene:this.scene,resources:this.resources,objects:this.objects,physics:this.physics,debug:this.debugFolder,rotateX:0,rotateY:Math.PI/6,rotateZ:0,areas:this.areas,car:this.car})}setBasketballCourt(){this.sectionBasketballCourt=new eE({scene:this.scene,resources:this.resources,physics:this.physics,debug:this.debugFolder,rotateX:0,rotateY:0,rotateZ:0})}createBuildingAreas(){const e=[{id:"atmosphere",name:"Atmosfer Bosna Gençlik Merkezi",position:{x:-10,y:-9},size:{x:5,y:5},link:"https://www.konya.bel.tr/hizmet-binalari-ve-sosyal-tesisler/atmosfer-bosna-genclik-merkezi",description:"Konya Büyükşehir Belediyesi tarafından hayata geçirilen bu merkez, gençlere sosyal, kültürel ve akademik destek sunan çok yönlü bir yaşam alanıdır."},{id:"capsule",name:"Kapsül Teknoloji Platformu",position:{x:37,y:-18},size:{x:7,y:7},link:"https://www.kapsul.org.tr",description:"Konya Büyükşehir Belediyesi bünyesinde faaliyet gösteren Kapsül, gençleri teknoloji üretimine teşvik ederek Türkiye'nin milli teknoloji hamlesine katkı sağlar."},{id:"division",name:"Divizyon",position:{x:-65,y:4},size:{x:8,y:8},link:"https://www.divizyon.org/",description:"Konya Büyükşehir Belediyesi tarafından kurulan Divizyon, yazılım ve dijital sanatlar alanında kolektif üretimi destekleyen açık inovasyon platformudur.",rotation:Math.PI/90*290},{id:"scienceCenter",name:"Konya Bilim Merkezi",position:{x:42,y:14},size:{x:12,y:9},link:"https://www.konyabilimmerkezi.com",description:"Konya Büyükşehir Belediyesi tarafından kurulan Türkiye'nin TÜBİTAK destekli ilk bilim merkezi, bilimi toplumun her kesimine sevdirmeyi ve bilimsel farkındalığı artırmayı amaçlamaktadır."},{id:"youngCard",name:"Genç Kültür Kart",position:{x:42,y:-40},size:{x:7,y:7},link:"https://genckulturkart.konya.bel.tr/",description:"Konya Büyükşehir Belediyesi tarafından hayata geçirilen bu program, üniversite öğrencilerinin sosyal, kültürel ve sportif etkinliklere aktif katılımını teşvik eder."},{id:"youngCenter",name:"Çalışan Gençlik",position:{x:57,y:-38},size:{x:6,y:6},link:"https://www.calisangenclik.com",description:"Konya Büyükşehir Belediyesi tarafından hayata geçirilen merkez, gençlerin ahilik kültürünü benimseyerek iş ve yaşam alanlarında gelişimini desteklemeyi amaçlar."}];this.lastBuilding=null,e.forEach(t=>{if(this.areas){const i=this.areas.add({position:new Oe(t.position.x,t.position.y),halfExtents:new Oe(t.size.x,t.size.y),testCar:!0,active:!0,hasKey:!0,car:this.car,isBuilding:!0,areaSize:t.size.x,name:t.name,link:t.link,description:t.description});t.id==="division"&&i.container&&(i.container.rotation.z=t.rotation)}})}}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var rn=Uint8Array,Nr=Uint16Array,sE=Int32Array,ag=new rn([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),lg=new rn([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),rE=new rn([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),cg=function(a,e){for(var t=new Nr(31),i=0;i<31;++i)t[i]=e+=1<<a[i-1];for(var s=new sE(t[30]),i=1;i<30;++i)for(var r=t[i];r<t[i+1];++r)s[r]=r-t[i]<<5|i;return{b:t,r:s}},hg=cg(ag,2),ug=hg.b,oE=hg.r;ug[28]=258,oE[258]=28;var aE=cg(lg,0),lE=aE.b,Rh=new Nr(32768);for(var Xt=0;Xt<32768;++Xt){var cs=(Xt&43690)>>1|(Xt&21845)<<1;cs=(cs&52428)>>2|(cs&13107)<<2,cs=(cs&61680)>>4|(cs&3855)<<4,Rh[Xt]=((cs&65280)>>8|(cs&255)<<8)>>1}var No=function(a,e,t){for(var i=a.length,s=0,r=new Nr(e);s<i;++s)a[s]&&++r[a[s]-1];var o=new Nr(e);for(s=1;s<e;++s)o[s]=o[s-1]+r[s-1]<<1;var l;if(t){l=new Nr(1<<e);var h=15-e;for(s=0;s<i;++s)if(a[s])for(var d=s<<4|a[s],f=e-a[s],c=o[a[s]-1]++<<f,u=c|(1<<f)-1;c<=u;++c)l[Rh[c]>>h]=d}else for(l=new Nr(i),s=0;s<i;++s)a[s]&&(l[s]=Rh[o[a[s]-1]++]>>15-a[s]);return l},la=new rn(288);for(var Xt=0;Xt<144;++Xt)la[Xt]=8;for(var Xt=144;Xt<256;++Xt)la[Xt]=9;for(var Xt=256;Xt<280;++Xt)la[Xt]=7;for(var Xt=280;Xt<288;++Xt)la[Xt]=8;var dg=new rn(32);for(var Xt=0;Xt<32;++Xt)dg[Xt]=5;var cE=No(la,9,1),hE=No(dg,5,1),Hc=function(a){for(var e=a[0],t=1;t<a.length;++t)a[t]>e&&(e=a[t]);return e},dn=function(a,e,t){var i=e/8|0;return(a[i]|a[i+1]<<8)>>(e&7)&t},Gc=function(a,e){var t=e/8|0;return(a[t]|a[t+1]<<8|a[t+2]<<16)>>(e&7)},uE=function(a){return(a+7)/8|0},dE=function(a,e,t){return(t==null||t>a.length)&&(t=a.length),new rn(a.subarray(e,t))},fE=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],pn=function(a,e,t){var i=new Error(e||fE[a]);if(i.code=a,Error.captureStackTrace&&Error.captureStackTrace(i,pn),!t)throw i;return i},pE=function(a,e,t,i){var s=a.length,r=0;if(!s||e.f&&!e.l)return t||new rn(0);var o=!t,l=o||e.i!=2,h=e.i;o&&(t=new rn(s*3));var d=function(pe){var xe=t.length;if(pe>xe){var Ee=new rn(Math.max(xe*2,pe));Ee.set(t),t=Ee}},f=e.f||0,c=e.p||0,u=e.b||0,p=e.l,m=e.d,_=e.m,g=e.n,v=s*8;do{if(!p){f=dn(a,c,1);var y=dn(a,c+1,3);if(c+=3,y)if(y==1)p=cE,m=hE,_=9,g=5;else if(y==2){var A=dn(a,c,31)+257,E=dn(a,c+10,15)+4,R=A+dn(a,c+5,31)+1;c+=14;for(var M=new rn(R),w=new rn(19),L=0;L<E;++L)w[rE[L]]=dn(a,c+L*3,7);c+=E*3;for(var N=Hc(w),B=(1<<N)-1,G=No(w,N,1),L=0;L<R;){var W=G[dn(a,c,B)];c+=W&15;var x=W>>4;if(x<16)M[L++]=x;else{var ee=0,z=0;for(x==16?(z=3+dn(a,c,3),c+=2,ee=M[L-1]):x==17?(z=3+dn(a,c,7),c+=3):x==18&&(z=11+dn(a,c,127),c+=7);z--;)M[L++]=ee}}var k=M.subarray(0,A),q=M.subarray(A);_=Hc(k),g=Hc(q),p=No(k,_,1),m=No(q,g,1)}else pn(1);else{var x=uE(c)+4,b=a[x-4]|a[x-3]<<8,S=x+b;if(S>s){h&&pn(0);break}l&&d(u+b),t.set(a.subarray(x,S),u),e.b=u+=b,e.p=c=S*8,e.f=f;continue}if(c>v){h&&pn(0);break}}l&&d(u+131072);for(var $=(1<<_)-1,H=(1<<g)-1,Q=c;;Q=c){var ee=p[Gc(a,c)&$],X=ee>>4;if(c+=ee&15,c>v){h&&pn(0);break}if(ee||pn(2),X<256)t[u++]=X;else if(X==256){Q=c,p=null;break}else{var F=X-254;if(X>264){var L=X-257,D=ag[L];F=dn(a,c,(1<<D)-1)+ug[L],c+=D}var j=m[Gc(a,c)&H],te=j>>4;j||pn(3),c+=j&15;var q=lE[te];if(te>3){var D=lg[te];q+=Gc(a,c)&(1<<D)-1,c+=D}if(c>v){h&&pn(0);break}l&&d(u+131072);var ae=u+F;if(u<q){var K=r-q,O=Math.min(q,ae);for(K+u<0&&pn(3);u<O;++u)t[u]=i[K+u]}for(;u<ae;++u)t[u]=t[u-q]}}e.l=p,e.p=Q,e.b=u,e.f=f,p&&(f=1,e.m=_,e.d=m,e.n=g)}while(!f);return u!=t.length&&o?dE(t,0,u):t.subarray(0,u)},mE=new rn(0),gE=function(a,e){return((a[0]&15)!=8||a[0]>>4>7||(a[0]<<8|a[1])%31)&&pn(6,"invalid zlib data"),(a[1]>>5&1)==+!e&&pn(6,"invalid zlib data: "+(a[1]&32?"need":"unexpected")+" dictionary"),(a[1]>>3&4)+2};function vE(a,e){return pE(a.subarray(gE(a,e),-4),{i:2},e,e)}var _E=typeof TextDecoder<"u"&&new TextDecoder,yE=0;try{_E.decode(mE,{stream:!0}),yE=1}catch{}function fg(a,e,t){const i=t.length-a-1;if(e>=t[i])return i-1;if(e<=t[a])return a;let s=a,r=i,o=Math.floor((s+r)/2);for(;e<t[o]||e>=t[o+1];)e<t[o]?r=o:s=o,o=Math.floor((s+r)/2);return o}function xE(a,e,t,i){const s=[],r=[],o=[];s[0]=1;for(let l=1;l<=t;++l){r[l]=e-i[a+1-l],o[l]=i[a+l]-e;let h=0;for(let d=0;d<l;++d){const f=o[d+1],c=r[l-d],u=s[d]/(f+c);s[d]=h+f*u,h=c*u}s[l]=h}return s}function bE(a,e,t,i){const s=fg(a,i,e),r=xE(s,i,a,e),o=new Ct(0,0,0,0);for(let l=0;l<=a;++l){const h=t[s-a+l],d=r[l],f=h.w*d;o.x+=h.x*f,o.y+=h.y*f,o.z+=h.z*f,o.w+=h.w*d}return o}function wE(a,e,t,i,s){const r=[];for(let c=0;c<=t;++c)r[c]=0;const o=[];for(let c=0;c<=i;++c)o[c]=r.slice(0);const l=[];for(let c=0;c<=t;++c)l[c]=r.slice(0);l[0][0]=1;const h=r.slice(0),d=r.slice(0);for(let c=1;c<=t;++c){h[c]=e-s[a+1-c],d[c]=s[a+c]-e;let u=0;for(let p=0;p<c;++p){const m=d[p+1],_=h[c-p];l[c][p]=m+_;const g=l[p][c-1]/l[c][p];l[p][c]=u+m*g,u=_*g}l[c][c]=u}for(let c=0;c<=t;++c)o[0][c]=l[c][t];for(let c=0;c<=t;++c){let u=0,p=1;const m=[];for(let _=0;_<=t;++_)m[_]=r.slice(0);m[0][0]=1;for(let _=1;_<=i;++_){let g=0;const v=c-_,y=t-_;c>=_&&(m[p][0]=m[u][0]/l[y+1][v],g=m[p][0]*l[v][y]);const x=v>=-1?1:-v,b=c-1<=y?_-1:t-c;for(let A=x;A<=b;++A)m[p][A]=(m[u][A]-m[u][A-1])/l[y+1][v+A],g+=m[p][A]*l[v+A][y];c<=y&&(m[p][_]=-m[u][_-1]/l[y+1][c],g+=m[p][_]*l[c][y]),o[_][c]=g;const S=u;u=p,p=S}}let f=t;for(let c=1;c<=i;++c){for(let u=0;u<=t;++u)o[c][u]*=f;f*=t-c}return o}function ME(a,e,t,i,s){const r=s<a?s:a,o=[],l=fg(a,i,e),h=wE(l,i,a,r,e),d=[];for(let f=0;f<t.length;++f){const c=t[f].clone(),u=c.w;c.x*=u,c.y*=u,c.z*=u,d[f]=c}for(let f=0;f<=r;++f){const c=d[l-a].clone().multiplyScalar(h[f][0]);for(let u=1;u<=a;++u)c.add(d[l-a+u].clone().multiplyScalar(h[f][u]));o[f]=c}for(let f=r+1;f<=s+1;++f)o[f]=new Ct(0,0,0);return o}function SE(a,e){let t=1;for(let s=2;s<=a;++s)t*=s;let i=1;for(let s=2;s<=e;++s)i*=s;for(let s=2;s<=a-e;++s)i*=s;return t/i}function AE(a){const e=a.length,t=[],i=[];for(let r=0;r<e;++r){const o=a[r];t[r]=new T(o.x,o.y,o.z),i[r]=o.w}const s=[];for(let r=0;r<e;++r){const o=t[r].clone();for(let l=1;l<=r;++l)o.sub(s[r-l].clone().multiplyScalar(SE(r,l)*i[l]));s[r]=o.divideScalar(i[0])}return s}function EE(a,e,t,i,s){const r=ME(a,e,t,i,s);return AE(r)}class TE extends rw{constructor(e,t,i,s,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=s||0,this.endKnot=r||this.knots.length-1;for(let o=0;o<i.length;++o){const l=i[o];this.controlPoints[o]=new Ct(l.x,l.y,l.z,l.w)}}getPoint(e,t=new T){const i=t,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=bE(this.degree,this.knots,this.controlPoints,s);return r.w!==1&&r.divideScalar(r.w),i.set(r.x,r.y,r.z)}getTangent(e,t=new T){const i=t,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=EE(this.degree,this.knots,this.controlPoints,s,1);return i.copy(r[1]).normalize(),i}}let _t,ni,Ni;class CE extends Ln{constructor(e){super(e)}load(e,t,i,s){const r=this,o=r.path===""?Hr.extractUrlBase(e):r.path,l=new Wo(this.manager);l.setPath(r.path),l.setResponseType("arraybuffer"),l.setRequestHeader(r.requestHeader),l.setWithCredentials(r.withCredentials),l.load(e,function(h){try{t(r.parse(h,o))}catch(d){s?s(d):console.error(d),r.manager.itemError(e)}},i,s)}parse(e,t){if(BE(e))_t=new FE().parse(e);else{const s=vg(e);if(!DE(s))throw new Error("THREE.FBXLoader: Unknown format.");if(sp(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+sp(s));_t=new LE().parse(s)}const i=new Wh(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new RE(i,this.manager).parse(_t)}}class RE{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){ni=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),i=this.parseMaterials(t),s=this.parseDeformers(),r=new PE().parse(s);return this.parseScene(s,r,i),Ni}parseConnections(){const e=new Map;return"Connections"in _t&&_t.Connections.connections.forEach(function(i){const s=i[0],r=i[1],o=i[2];e.has(s)||e.set(s,{parents:[],children:[]});const l={ID:r,relationship:o};e.get(s).parents.push(l),e.has(r)||e.set(r,{parents:[],children:[]});const h={ID:s,relationship:o};e.get(r).children.push(h)}),e}parseImages(){const e={},t={};if("Video"in _t.Objects){const i=_t.Objects.Video;for(const s in i){const r=i[s],o=parseInt(s);if(e[o]=r.RelativeFilename||r.Filename,"Content"in r){const l=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,h=typeof r.Content=="string"&&r.Content!=="";if(l||h){const d=this.parseImage(i[s]);t[r.RelativeFilename||r.Filename]=d}}}}for(const i in e){const s=e[i];t[s]!==void 0?e[i]=t[s]:e[i]=e[i].split("\\").pop()}return e}parseImage(e){const t=e.Content,i=e.RelativeFilename||e.Filename,s=i.slice(i.lastIndexOf(".")+1).toLowerCase();let r;switch(s){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",i),r="image/tga";break;default:console.warn('FBXLoader: Image type "'+s+'" is not supported.');return}if(typeof t=="string")return"data:"+r+";base64,"+t;{const o=new Uint8Array(t);return window.URL.createObjectURL(new Blob([o],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in _t.Objects){const i=_t.Objects.Texture;for(const s in i){const r=this.parseTexture(i[s],e);t.set(parseInt(s),r)}}return t}parseTexture(e,t){const i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;const s=e.WrapModeU,r=e.WrapModeV,o=s!==void 0?s.value:0,l=r!==void 0?r.value:0;if(i.wrapS=o===0?In:Tn,i.wrapT=l===0?In:Tn,"Scaling"in e){const h=e.Scaling.value;i.repeat.x=h[0],i.repeat.y=h[1]}if("Translation"in e){const h=e.Translation.value;i.offset.x=h[0],i.offset.y=h[1]}return i}loadTexture(e,t){let i;const s=this.textureLoader.path,r=ni.get(e.id).children;r!==void 0&&r.length>0&&t[r[0].ID]!==void 0&&(i=t[r[0].ID],(i.indexOf("blob:")===0||i.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let o;const l=e.FileName.slice(-3).toLowerCase();if(l==="tga"){const h=this.manager.getHandler(".tga");h===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new Ht):(h.setPath(this.textureLoader.path),o=h.load(i))}else if(l==="dds"){const h=this.manager.getHandler(".dds");h===null?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",e.RelativeFilename),o=new Ht):(h.setPath(this.textureLoader.path),o=h.load(i))}else l==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new Ht):o=this.textureLoader.load(i);return this.textureLoader.setPath(s),o}parseMaterials(e){const t=new Map;if("Material"in _t.Objects){const i=_t.Objects.Material;for(const s in i){const r=this.parseMaterial(i[s],e);r!==null&&t.set(parseInt(s),r)}}return t}parseMaterial(e,t){const i=e.id,s=e.attrName;let r=e.ShadingModel;if(typeof r=="object"&&(r=r.value),!ni.has(i))return null;const o=this.parseParameters(e,t,i);let l;switch(r.toLowerCase()){case"phong":l=new bc;break;case"lambert":l=new Sw;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),l=new bc;break}return l.setValues(o),l.name=s,l}parseParameters(e,t,i){const s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=new Le().fromArray(e.Diffuse.value).convertSRGBToLinear():e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(s.color=new Le().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=new Le().fromArray(e.Emissive.value).convertSRGBToLinear():e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(s.emissive=new Le().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(s.opacity=parseFloat(e.Opacity.value)),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=new Le().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(s.specular=new Le().fromArray(e.SpecularColor.value).convertSRGBToLinear());const r=this;return ni.get(i).children.forEach(function(o){const l=o.relationship;switch(l){case"Bump":s.bumpMap=r.getTexture(t,o.ID);break;case"Maya|TEX_ao_map":s.aoMap=r.getTexture(t,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=r.getTexture(t,o.ID),s.map!==void 0&&(s.map.colorSpace=ei);break;case"DisplacementColor":s.displacementMap=r.getTexture(t,o.ID);break;case"EmissiveColor":s.emissiveMap=r.getTexture(t,o.ID),s.emissiveMap!==void 0&&(s.emissiveMap.colorSpace=ei);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=r.getTexture(t,o.ID);break;case"ReflectionColor":s.envMap=r.getTexture(t,o.ID),s.envMap!==void 0&&(s.envMap.mapping=al,s.envMap.colorSpace=ei);break;case"SpecularColor":s.specularMap=r.getTexture(t,o.ID),s.specularMap!==void 0&&(s.specularMap.colorSpace=ei);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=r.getTexture(t,o.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",l);break}}),s}getTexture(e,t){return"LayeredTexture"in _t.Objects&&t in _t.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=ni.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in _t.Objects){const i=_t.Objects.Deformer;for(const s in i){const r=i[s],o=ni.get(parseInt(s));if(r.attrType==="Skin"){const l=this.parseSkeleton(o,i);l.ID=s,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=o.parents[0].ID,e[s]=l}else if(r.attrType==="BlendShape"){const l={id:s};l.rawTargets=this.parseMorphTargets(o,i),l.id=s,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[s]=l}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const i=[];return e.children.forEach(function(s){const r=t[s.ID];if(r.attrType!=="Cluster")return;const o={ID:s.ID,indices:[],weights:[],transformLink:new Je().fromArray(r.TransformLink.a)};"Indexes"in r&&(o.indices=r.Indexes.a,o.weights=r.Weights.a),i.push(o)}),{rawBones:i,bones:[]}}parseMorphTargets(e,t){const i=[];for(let s=0;s<e.children.length;s++){const r=e.children[s],o=t[r.ID],l={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;l.geoID=ni.get(parseInt(r.ID)).children.filter(function(h){return h.relationship===void 0})[0].ID,i.push(l)}return i}parseScene(e,t,i){Ni=new $n;const s=this.parseModels(e.skeletons,t,i),r=_t.Objects.Model,o=this;s.forEach(function(h){const d=r[h.ID];o.setLookAtProperties(h,d),ni.get(h.ID).parents.forEach(function(c){const u=s.get(c.ID);u!==void 0&&u.add(h)}),h.parent===null&&Ni.add(h)}),this.bindSkeleton(e.skeletons,t,s),this.addGlobalSceneSettings(),Ni.traverse(function(h){if(h.userData.transformData){h.parent&&(h.userData.transformData.parentMatrix=h.parent.matrix,h.userData.transformData.parentMatrixWorld=h.parent.matrixWorld);const d=mg(h.userData.transformData);h.applyMatrix4(d),h.updateWorldMatrix()}});const l=new IE().parse();Ni.children.length===1&&Ni.children[0].isGroup&&(Ni.children[0].animations=l,Ni=Ni.children[0]),Ni.animations=l}parseModels(e,t,i){const s=new Map,r=_t.Objects.Model;for(const o in r){const l=parseInt(o),h=r[o],d=ni.get(l);let f=this.buildSkeleton(d,e,l,h.attrName);if(!f){switch(h.attrType){case"Camera":f=this.createCamera(d);break;case"Light":f=this.createLight(d);break;case"Mesh":f=this.createMesh(d,t,i);break;case"NurbsCurve":f=this.createCurve(d,t);break;case"LimbNode":case"Root":f=new pl;break;case"Null":default:f=new $n;break}f.name=h.attrName?Mt.sanitizeNodeName(h.attrName):"",f.userData.originalName=h.attrName,f.ID=l}this.getTransformData(f,h),s.set(l,f)}return s}buildSkeleton(e,t,i,s){let r=null;return e.parents.forEach(function(o){for(const l in t){const h=t[l];h.rawBones.forEach(function(d,f){if(d.ID===o.ID){const c=r;r=new pl,r.matrixWorld.copy(d.transformLink),r.name=s?Mt.sanitizeNodeName(s):"",r.userData.originalName=s,r.ID=i,h.bones[f]=r,c!==null&&r.add(c)}})}}),r}createCamera(e){let t,i;if(e.children.forEach(function(s){const r=_t.Objects.NodeAttribute[s.ID];r!==void 0&&(i=r)}),i===void 0)t=new je;else{let s=0;i.CameraProjectionType!==void 0&&i.CameraProjectionType.value===1&&(s=1);let r=1;i.NearPlane!==void 0&&(r=i.NearPlane.value/1e3);let o=1e3;i.FarPlane!==void 0&&(o=i.FarPlane.value/1e3);let l=window.innerWidth,h=window.innerHeight;i.AspectWidth!==void 0&&i.AspectHeight!==void 0&&(l=i.AspectWidth.value,h=i.AspectHeight.value);const d=l/h;let f=45;i.FieldOfView!==void 0&&(f=i.FieldOfView.value);const c=i.FocalLength?i.FocalLength.value:null;switch(s){case 0:t=new Pi(f,d,r,o),c!==null&&t.setFocalLength(c);break;case 1:t=new ia(-l/2,l/2,h/2,-h/2,r,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),t=new je;break}}return t}createLight(e){let t,i;if(e.children.forEach(function(s){const r=_t.Objects.NodeAttribute[s.ID];r!==void 0&&(i=r)}),i===void 0)t=new je;else{let s;i.LightType===void 0?s=0:s=i.LightType.value;let r=16777215;i.Color!==void 0&&(r=new Le().fromArray(i.Color.value).convertSRGBToLinear());let o=i.Intensity===void 0?1:i.Intensity.value/100;i.CastLightOnObject!==void 0&&i.CastLightOnObject.value===0&&(o=0);let l=0;i.FarAttenuationEnd!==void 0&&(i.EnableFarAttenuation!==void 0&&i.EnableFarAttenuation.value===0?l=0:l=i.FarAttenuationEnd.value);const h=1;switch(s){case 0:t=new sh(r,o,l,h);break;case 1:t=new ra(r,o);break;case 2:let d=Math.PI/3;i.InnerAngle!==void 0&&(d=Ai.degToRad(i.InnerAngle.value));let f=0;i.OuterAngle!==void 0&&(f=Ai.degToRad(i.OuterAngle.value),f=Math.max(f,1)),t=new Zp(r,o,l,d,f,h);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),t=new sh(r,o);break}i.CastShadows!==void 0&&i.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,i){let s,r=null,o=null;const l=[];return e.children.forEach(function(h){t.has(h.ID)&&(r=t.get(h.ID)),i.has(h.ID)&&l.push(i.get(h.ID))}),l.length>1?o=l:l.length>0?o=l[0]:(o=new bc({name:Ln.DEFAULT_MATERIAL_NAME,color:13421772}),l.push(o)),"color"in r.attributes&&l.forEach(function(h){h.vertexColors=!0}),r.FBX_Deformer?(s=new Hp(r,o),s.normalizeSkinWeights()):s=new Ae(r,o),s}createCurve(e,t){const i=e.children.reduce(function(r,o){return t.has(o.ID)&&(r=t.get(o.ID)),r},null),s=new tr({name:Ln.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new qi(i,s)}getTransformData(e,t){const i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?i.eulerOrder=gg(t.RotationOrder.value):i.eulerOrder="ZYX","Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i}setLookAtProperties(e,t){"LookAtProperty"in t&&ni.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const r=_t.Objects.Model[s.ID];if("Lcl_Translation"in r){const o=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),Ni.add(e.target)):e.lookAt(new T().fromArray(o))}}})}bindSkeleton(e,t,i){const s=this.parsePoseNodes();for(const r in e){const o=e[r];ni.get(parseInt(o.ID)).parents.forEach(function(h){if(t.has(h.ID)){const d=h.ID;ni.get(d).parents.forEach(function(c){i.has(c.ID)&&i.get(c.ID).bind(new Ll(o.bones),s[c.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in _t.Objects){const t=_t.Objects.Pose;for(const i in t)if(t[i].attrType==="BindPose"&&t[i].NbPoseNodes>0){const s=t[i].PoseNode;Array.isArray(s)?s.forEach(function(r){e[r.Node]=new Je().fromArray(r.Matrix.a)}):e[s.Node]=new Je().fromArray(s.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in _t){if("AmbientColor"in _t.GlobalSettings){const e=_t.GlobalSettings.AmbientColor.value,t=e[0],i=e[1],s=e[2];if(t!==0||i!==0||s!==0){const r=new Le(t,i,s).convertSRGBToLinear();Ni.add(new Dl(r,1))}}"UnitScaleFactor"in _t.GlobalSettings&&(Ni.userData.unitScaleFactor=_t.GlobalSettings.UnitScaleFactor.value)}}}class PE{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in _t.Objects){const i=_t.Objects.Geometry;for(const s in i){const r=ni.get(parseInt(s)),o=this.parseGeometry(r,i[s],e);t.set(parseInt(s),o)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,i){const s=i.skeletons,r=[],o=e.parents.map(function(c){return _t.Objects.Model[c.ID]});if(o.length===0)return;const l=e.children.reduce(function(c,u){return s[u.ID]!==void 0&&(c=s[u.ID]),c},null);e.children.forEach(function(c){i.morphTargets[c.ID]!==void 0&&r.push(i.morphTargets[c.ID])});const h=o[0],d={};"RotationOrder"in h&&(d.eulerOrder=gg(h.RotationOrder.value)),"InheritType"in h&&(d.inheritType=parseInt(h.InheritType.value)),"GeometricTranslation"in h&&(d.translation=h.GeometricTranslation.value),"GeometricRotation"in h&&(d.rotation=h.GeometricRotation.value),"GeometricScaling"in h&&(d.scale=h.GeometricScaling.value);const f=mg(d);return this.genGeometry(t,l,r,f)}genGeometry(e,t,i,s){const r=new Bt;e.attrName&&(r.name=e.attrName);const o=this.parseGeoNode(e,t),l=this.genBuffers(o),h=new yt(l.vertex,3);if(h.applyMatrix4(s),r.setAttribute("position",h),l.colors.length>0&&r.setAttribute("color",new yt(l.colors,3)),t&&(r.setAttribute("skinIndex",new kh(l.weightsIndices,4)),r.setAttribute("skinWeight",new yt(l.vertexWeights,4)),r.FBX_Deformer=t),l.normal.length>0){const d=new pt().getNormalMatrix(s),f=new yt(l.normal,3);f.applyNormalMatrix(d),r.setAttribute("normal",f)}if(l.uvs.forEach(function(d,f){const c=f===0?"uv":`uv${f}`;r.setAttribute(c,new yt(l.uvs[f],2))}),o.material&&o.material.mappingType!=="AllSame"){let d=l.materialIndex[0],f=0;if(l.materialIndex.forEach(function(c,u){c!==d&&(r.addGroup(f,u-f,d),d=c,f=u)}),r.groups.length>0){const c=r.groups[r.groups.length-1],u=c.start+c.count;u!==l.materialIndex.length&&r.addGroup(u,l.materialIndex.length-u,d)}r.groups.length===0&&r.addGroup(0,l.materialIndex.length,l.materialIndex[0])}return this.addMorphTargets(r,e,i,s),r}parseGeoNode(e,t){const i={};if(i.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],i.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];let s=0;for(;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&i.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return i.weightTable={},t!==null&&(i.skeleton=t,t.rawBones.forEach(function(s,r){s.indices.forEach(function(o,l){i.weightTable[o]===void 0&&(i.weightTable[o]=[]),i.weightTable[o].push({id:r,weight:s.weights[l]})})})),i}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let i=0,s=0,r=!1,o=[],l=[],h=[],d=[],f=[],c=[];const u=this;return e.vertexIndices.forEach(function(p,m){let _,g=!1;p<0&&(p=p^-1,g=!0);let v=[],y=[];if(o.push(p*3,p*3+1,p*3+2),e.color){const x=Za(m,i,p,e.color);h.push(x[0],x[1],x[2])}if(e.skeleton){if(e.weightTable[p]!==void 0&&e.weightTable[p].forEach(function(x){y.push(x.weight),v.push(x.id)}),y.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const x=[0,0,0,0],b=[0,0,0,0];y.forEach(function(S,A){let E=S,R=v[A];b.forEach(function(M,w,L){if(E>M){L[w]=E,E=M;const N=x[w];x[w]=R,R=N}})}),v=x,y=b}for(;y.length<4;)y.push(0),v.push(0);for(let x=0;x<4;++x)f.push(y[x]),c.push(v[x])}if(e.normal){const x=Za(m,i,p,e.normal);l.push(x[0],x[1],x[2])}e.material&&e.material.mappingType!=="AllSame"&&(_=Za(m,i,p,e.material)[0],_<0&&(u.negativeMaterialIndices=!0,_=0)),e.uv&&e.uv.forEach(function(x,b){const S=Za(m,i,p,x);d[b]===void 0&&(d[b]=[]),d[b].push(S[0]),d[b].push(S[1])}),s++,g&&(u.genFace(t,e,o,_,l,h,d,f,c,s),i++,s=0,o=[],l=[],h=[],d=[],f=[],c=[])}),t}getNormalNewell(e){const t=new T(0,0,0);for(let i=0;i<e.length;i++){const s=e[i],r=e[(i+1)%e.length];t.x+=(s.y-r.y)*(s.z+r.z),t.y+=(s.z-r.z)*(s.x+r.x),t.z+=(s.x-r.x)*(s.y+r.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){const t=this.getNormalNewell(e),s=(Math.abs(t.z)>.5?new T(0,1,0):new T(0,0,1)).cross(t).normalize(),r=t.clone().cross(s).normalize();return{normal:t,tangent:s,bitangent:r}}flattenVertex(e,t,i){return new Oe(e.dot(t),e.dot(i))}genFace(e,t,i,s,r,o,l,h,d,f){let c;if(f>3){const u=[];for(let g=0;g<i.length;g+=3)u.push(new T(t.vertexPositions[i[g]],t.vertexPositions[i[g+1]],t.vertexPositions[i[g+2]]));const{tangent:p,bitangent:m}=this.getNormalTangentAndBitangent(u),_=[];for(const g of u)_.push(this.flattenVertex(g,p,m));c=Gh.triangulateShape(_,[])}else c=[[0,1,2]];for(const[u,p,m]of c)e.vertex.push(t.vertexPositions[i[u*3]]),e.vertex.push(t.vertexPositions[i[u*3+1]]),e.vertex.push(t.vertexPositions[i[u*3+2]]),e.vertex.push(t.vertexPositions[i[p*3]]),e.vertex.push(t.vertexPositions[i[p*3+1]]),e.vertex.push(t.vertexPositions[i[p*3+2]]),e.vertex.push(t.vertexPositions[i[m*3]]),e.vertex.push(t.vertexPositions[i[m*3+1]]),e.vertex.push(t.vertexPositions[i[m*3+2]]),t.skeleton&&(e.vertexWeights.push(h[u*4]),e.vertexWeights.push(h[u*4+1]),e.vertexWeights.push(h[u*4+2]),e.vertexWeights.push(h[u*4+3]),e.vertexWeights.push(h[p*4]),e.vertexWeights.push(h[p*4+1]),e.vertexWeights.push(h[p*4+2]),e.vertexWeights.push(h[p*4+3]),e.vertexWeights.push(h[m*4]),e.vertexWeights.push(h[m*4+1]),e.vertexWeights.push(h[m*4+2]),e.vertexWeights.push(h[m*4+3]),e.weightsIndices.push(d[u*4]),e.weightsIndices.push(d[u*4+1]),e.weightsIndices.push(d[u*4+2]),e.weightsIndices.push(d[u*4+3]),e.weightsIndices.push(d[p*4]),e.weightsIndices.push(d[p*4+1]),e.weightsIndices.push(d[p*4+2]),e.weightsIndices.push(d[p*4+3]),e.weightsIndices.push(d[m*4]),e.weightsIndices.push(d[m*4+1]),e.weightsIndices.push(d[m*4+2]),e.weightsIndices.push(d[m*4+3])),t.color&&(e.colors.push(o[u*3]),e.colors.push(o[u*3+1]),e.colors.push(o[u*3+2]),e.colors.push(o[p*3]),e.colors.push(o[p*3+1]),e.colors.push(o[p*3+2]),e.colors.push(o[m*3]),e.colors.push(o[m*3+1]),e.colors.push(o[m*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),t.normal&&(e.normal.push(r[u*3]),e.normal.push(r[u*3+1]),e.normal.push(r[u*3+2]),e.normal.push(r[p*3]),e.normal.push(r[p*3+1]),e.normal.push(r[p*3+2]),e.normal.push(r[m*3]),e.normal.push(r[m*3+1]),e.normal.push(r[m*3+2])),t.uv&&t.uv.forEach(function(_,g){e.uvs[g]===void 0&&(e.uvs[g]=[]),e.uvs[g].push(l[g][u*2]),e.uvs[g].push(l[g][u*2+1]),e.uvs[g].push(l[g][p*2]),e.uvs[g].push(l[g][p*2+1]),e.uvs[g].push(l[g][m*2]),e.uvs[g].push(l[g][m*2+1])})}addMorphTargets(e,t,i,s){if(i.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;i.forEach(function(o){o.rawTargets.forEach(function(l){const h=_t.Objects.Geometry[l.geoID];h!==void 0&&r.genMorphGeometry(e,t,h,s,l.name)})})}genMorphGeometry(e,t,i,s,r){const o=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],l=i.Vertices!==void 0?i.Vertices.a:[],h=i.Indexes!==void 0?i.Indexes.a:[],d=e.attributes.position.count*3,f=new Float32Array(d);for(let m=0;m<h.length;m++){const _=h[m]*3;f[_]=l[m*3],f[_+1]=l[m*3+1],f[_+2]=l[m*3+2]}const c={vertexIndices:o,vertexPositions:f},u=this.genBuffers(c),p=new yt(u.vertex,3);p.name=r||i.attrName,p.applyMatrix4(s),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.Normals.a;let r=[];return i==="IndexToDirect"&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:r,mappingType:t,referenceType:i}}parseUVs(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.UV.a;let r=[];return i==="IndexToDirect"&&(r=e.UVIndex.a),{dataSize:2,buffer:s,indices:r,mappingType:t,referenceType:i}}parseVertexColors(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.Colors.a;let r=[];i==="IndexToDirect"&&(r=e.ColorIndex.a);for(let o=0,l=new Le;o<s.length;o+=4)l.fromArray(s,o).convertSRGBToLinear().toArray(s,o);return{dataSize:4,buffer:s,indices:r,mappingType:t,referenceType:i}}parseMaterialIndices(e){const t=e.MappingInformationType,i=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};const s=e.Materials.a,r=[];for(let o=0;o<s.length;++o)r.push(o);return{dataSize:1,buffer:s,indices:r,mappingType:t,referenceType:i}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Bt;const i=t-1,s=e.KnotVector.a,r=[],o=e.Points.a;for(let c=0,u=o.length;c<u;c+=4)r.push(new Ct().fromArray(o,c));let l,h;if(e.Form==="Closed")r.push(r[0]);else if(e.Form==="Periodic"){l=i,h=s.length-1-l;for(let c=0;c<i;++c)r.push(r[c])}const f=new TE(i,s,r,l,h).getPoints(r.length*12);return new Bt().setFromPoints(f)}}class IE{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const i in t){const s=t[i],r=this.addClip(s);e.push(r)}return e}parseClips(){if(_t.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=_t.Objects.AnimationCurveNode,t=new Map;for(const i in e){const s=e[i];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){const r={id:s.id,attr:s.attrName,curves:{}};t.set(r.id,r)}}return t}parseAnimationCurves(e){const t=_t.Objects.AnimationCurve;for(const i in t){const s={id:t[i].id,times:t[i].KeyTime.a.map(kE),values:t[i].KeyValueFloat.a},r=ni.get(s.id);if(r!==void 0){const o=r.parents[0].ID,l=r.parents[0].relationship;l.match(/X/)?e.get(o).curves.x=s:l.match(/Y/)?e.get(o).curves.y=s:l.match(/Z/)?e.get(o).curves.z=s:l.match(/DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=s)}}}parseAnimationLayers(e){const t=_t.Objects.AnimationLayer,i=new Map;for(const s in t){const r=[],o=ni.get(parseInt(s));o!==void 0&&(o.children.forEach(function(h,d){if(e.has(h.ID)){const f=e.get(h.ID);if(f.curves.x!==void 0||f.curves.y!==void 0||f.curves.z!==void 0){if(r[d]===void 0){const c=ni.get(h.ID).parents.filter(function(u){return u.relationship!==void 0})[0].ID;if(c!==void 0){const u=_t.Objects.Model[c.toString()];if(u===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",h);return}const p={modelName:u.attrName?Mt.sanitizeNodeName(u.attrName):"",ID:u.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Ni.traverse(function(m){m.ID===u.id&&(p.transform=m.matrix,m.userData.transformData&&(p.eulerOrder=m.userData.transformData.eulerOrder))}),p.transform||(p.transform=new Je),"PreRotation"in u&&(p.preRotation=u.PreRotation.value),"PostRotation"in u&&(p.postRotation=u.PostRotation.value),r[d]=p}}r[d]&&(r[d][f.attr]=f)}else if(f.curves.morph!==void 0){if(r[d]===void 0){const c=ni.get(h.ID).parents.filter(function(v){return v.relationship!==void 0})[0].ID,u=ni.get(c).parents[0].ID,p=ni.get(u).parents[0].ID,m=ni.get(p).parents[0].ID,_=_t.Objects.Model[m],g={modelName:_.attrName?Mt.sanitizeNodeName(_.attrName):"",morphName:_t.Objects.Deformer[c].attrName};r[d]=g}r[d][f.attr]=f}}}),i.set(parseInt(s),r))}return i}parseAnimStacks(e){const t=_t.Objects.AnimationStack,i={};for(const s in t){const r=ni.get(parseInt(s)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(r[0].ID);i[s]={name:t[s].attrName,layer:o}}return i}addClip(e){let t=[];const i=this;return e.layer.forEach(function(s){t=t.concat(i.generateTracks(s))}),new _l(e.name,-1,t)}generateTracks(e){const t=[];let i=new T,s=new T;if(e.transform&&e.transform.decompose(i,new Tt,s),i=i.toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");r!==void 0&&t.push(r)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const r=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);r!==void 0&&t.push(r)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");r!==void 0&&t.push(r)}if(e.DeformPercent!==void 0){const r=this.generateMorphTrack(e);r!==void 0&&t.push(r)}return t}generateVectorTrack(e,t,i,s){const r=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(r,t,i);return new Qs(e+"."+s,r,o)}generateRotationTrack(e,t,i,s,r){let o,l;if(t.x!==void 0&&t.y!==void 0&&t.z!==void 0){const c=this.interpolateRotations(t.x,t.y,t.z,r);o=c[0],l=c[1]}i!==void 0&&(i=i.map(Ai.degToRad),i.push(r),i=new At().fromArray(i),i=new Tt().setFromEuler(i)),s!==void 0&&(s=s.map(Ai.degToRad),s.push(r),s=new At().fromArray(s),s=new Tt().setFromEuler(s).invert());const h=new Tt,d=new At,f=[];if(!l||!o)return new Qn(e+".quaternion",[0],[0]);for(let c=0;c<l.length;c+=3)d.set(l[c],l[c+1],l[c+2],r),h.setFromEuler(d),i!==void 0&&h.premultiply(i),s!==void 0&&h.multiply(s),c>2&&new Tt().fromArray(f,(c-3)/3*4).dot(h)<0&&h.set(-h.x,-h.y,-h.z,-h.w),h.toArray(f,c/3*4);return new Qn(e+".quaternion",o,f)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,i=t.values.map(function(r){return r/100}),s=Ni.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Ks(e.modelName+".morphTargetInfluences["+s+"]",t.times,i)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(i,s){return i-s}),t.length>1){let i=1,s=t[0];for(let r=1;r<t.length;r++){const o=t[r];o!==s&&(t[i]=o,s=o,i++)}t=t.slice(0,i)}return t}getKeyframeTrackValues(e,t,i){const s=i,r=[];let o=-1,l=-1,h=-1;return e.forEach(function(d){if(t.x&&(o=t.x.times.indexOf(d)),t.y&&(l=t.y.times.indexOf(d)),t.z&&(h=t.z.times.indexOf(d)),o!==-1){const f=t.x.values[o];r.push(f),s[0]=f}else r.push(s[0]);if(l!==-1){const f=t.y.values[l];r.push(f),s[1]=f}else r.push(s[1]);if(h!==-1){const f=t.z.values[h];r.push(f),s[2]=f}else r.push(s[2])}),r}interpolateRotations(e,t,i,s){const r=[],o=[];r.push(e.times[0]),o.push(Ai.degToRad(e.values[0])),o.push(Ai.degToRad(t.values[0])),o.push(Ai.degToRad(i.values[0]));for(let l=1;l<e.values.length;l++){const h=[e.values[l-1],t.values[l-1],i.values[l-1]];if(isNaN(h[0])||isNaN(h[1])||isNaN(h[2]))continue;const d=h.map(Ai.degToRad),f=[e.values[l],t.values[l],i.values[l]];if(isNaN(f[0])||isNaN(f[1])||isNaN(f[2]))continue;const c=f.map(Ai.degToRad),u=[f[0]-h[0],f[1]-h[1],f[2]-h[2]],p=[Math.abs(u[0]),Math.abs(u[1]),Math.abs(u[2])];if(p[0]>=180||p[1]>=180||p[2]>=180){const _=Math.max(...p)/180,g=new At(...d,s),v=new At(...c,s),y=new Tt().setFromEuler(g),x=new Tt().setFromEuler(v);y.dot(x)&&x.set(-x.x,-x.y,-x.z,-x.w);const b=e.times[l-1],S=e.times[l]-b,A=new Tt,E=new At;for(let R=0;R<1;R+=1/_)A.copy(y.clone().slerp(x.clone(),R)),r.push(b+R*S),E.setFromQuaternion(A,s),o.push(E.x),o.push(E.y),o.push(E.z)}else r.push(e.times[l]),o.push(Ai.degToRad(e.values[l])),o.push(Ai.degToRad(t.values[l])),o.push(Ai.degToRad(i.values[l]))}return[r,o]}}class LE{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new pg,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,i=e.split(/[\r\n]+/);return i.forEach(function(s,r){const o=s.match(/^[\s\t]*;/),l=s.match(/^[\s\t]*$/);if(o||l)return;const h=s.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),d=s.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),f=s.match("^\\t{"+(t.currentIndent-1)+"}}");h?t.parseNodeBegin(s,h):d?t.parseNodeProperty(s,d,i[++r]):f?t.popStack():s.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(e,t){const i=t[1].trim().replace(/^"/,"").replace(/"$/,""),s=t[2].split(",").map(function(h){return h.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:i},o=this.parseNodeAttr(s),l=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(i,r):i in l?(i==="PoseNode"?l.PoseNode.push(r):l[i].id!==void 0&&(l[i]={},l[i][l[i].id]=l[i]),o.id!==""&&(l[i][o.id]=r)):typeof o.id=="number"?(l[i]={},l[i][o.id]=r):i!=="Properties70"&&(i==="PoseNode"?l[i]=[r]:l[i]=r),typeof o.id=="number"&&(r.id=o.id),o.name!==""&&(r.attrName=o.name),o.type!==""&&(r.attrType=o.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let i="",s="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:t,name:i,type:s}}parseNodeProperty(e,t,i){let s=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&r===","&&(r=i.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(e,s,r);return}if(s==="C"){const h=r.split(",").slice(1),d=parseInt(h[0]),f=parseInt(h[1]);let c=r.split(",").slice(3);c=c.map(function(u){return u.trim().replace(/^"/,"")}),s="connections",r=[d,f],OE(r,c),o[s]===void 0&&(o[s]=[])}s==="Node"&&(o.id=r),s in o&&Array.isArray(o[s])?o[s].push(r):s!=="a"?o[s]=r:o.a=r,this.setCurrentProp(o,s),s==="a"&&r.slice(-1)!==","&&(o.a=Xc(r))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=Xc(t.a))}parseNodeSpecialProperty(e,t,i){const s=i.split('",').map(function(f){return f.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=s[0],o=s[1],l=s[2],h=s[3];let d=s[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":d=parseFloat(d);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":d=Xc(d);break}this.getPrevNode()[r]={type:o,type2:l,flag:h,value:d},this.setCurrentProp(this.getPrevNode(),r)}}class FE{parse(e){const t=new np(e);t.skip(23);const i=t.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);const s=new pg;for(;!this.endOfContent(t);){const r=this.parseNode(t,i);r!==null&&s.add(r.name,r)}return s}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const i={},s=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),l=e.getString(o);if(s===0)return null;const h=[];for(let u=0;u<r;u++)h.push(this.parseProperty(e));const d=h.length>0?h[0]:"",f=h.length>1?h[1]:"",c=h.length>2?h[2]:"";for(i.singleProperty=r===1&&e.getOffset()===s;s>e.getOffset();){const u=this.parseNode(e,t);u!==null&&this.parseSubNode(l,i,u)}return i.propertyList=h,typeof d=="number"&&(i.id=d),f!==""&&(i.attrName=f),c!==""&&(i.attrType=c),l!==""&&(i.name=l),i}parseSubNode(e,t,i){if(i.singleProperty===!0){const s=i.propertyList[0];Array.isArray(s)?(t[i.name]=i,i.a=s):t[i.name]=s}else if(e==="Connections"&&i.name==="C"){const s=[];i.propertyList.forEach(function(r,o){o!==0&&s.push(r)}),t.connections===void 0&&(t.connections=[]),t.connections.push(s)}else if(i.name==="Properties70")Object.keys(i).forEach(function(r){t[r]=i[r]});else if(e==="Properties70"&&i.name==="P"){let s=i.propertyList[0],r=i.propertyList[1];const o=i.propertyList[2],l=i.propertyList[3];let h;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),r==="Color"||r==="ColorRGB"||r==="Vector"||r==="Vector3D"||r.indexOf("Lcl_")===0?h=[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:h=i.propertyList[4],t[s]={type:r,type2:o,flag:l,value:h}}else t[i.name]===void 0?typeof i.id=="number"?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:i.name==="PoseNode"?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):t[i.name][i.id]===void 0&&(t[i.name][i.id]=i)}parseProperty(e){const t=e.getString(1);let i;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return i=e.getUint32(),e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=e.getUint32(),r=e.getUint32(),o=e.getUint32();if(r===0)switch(t){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}const l=vE(new Uint8Array(e.getArrayBuffer(o))),h=new np(l.buffer);switch(t){case"b":case"c":return h.getBooleanArray(s);case"d":return h.getFloat64Array(s);case"f":return h.getFloat32Array(s);case"i":return h.getInt32Array(s);case"l":return h.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class np{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let i=0;i<e;i++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let i=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const s=i.indexOf(0);return s>=0&&(i=new Uint8Array(this.dv.buffer,t,s)),this._textDecoder.decode(i)}}class pg{add(e,t){this[e]=t}}function BE(a){const e="Kaydara FBX Binary  \0";return a.byteLength>=e.length&&e===vg(a,0,e.length)}function DE(a){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function i(s){const r=a[s-1];return a=a.slice(t+s),t++,r}for(let s=0;s<e.length;++s)if(i(1)===e[s])return!1;return!0}function sp(a){const e=/FBXVersion: (\d+)/,t=a.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function kE(a){return a/46186158e3}const NE=[];function Za(a,e,t,i){let s;switch(i.mappingType){case"ByPolygonVertex":s=a;break;case"ByPolygon":s=e;break;case"ByVertice":s=t;break;case"AllSame":s=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}i.referenceType==="IndexToDirect"&&(s=i.indices[s]);const r=s*i.dataSize,o=r+i.dataSize;return UE(NE,i.buffer,r,o)}const Wc=new At,Er=new T;function mg(a){const e=new Je,t=new Je,i=new Je,s=new Je,r=new Je,o=new Je,l=new Je,h=new Je,d=new Je,f=new Je,c=new Je,u=new Je,p=a.inheritType?a.inheritType:0;if(a.translation&&e.setPosition(Er.fromArray(a.translation)),a.preRotation){const w=a.preRotation.map(Ai.degToRad);w.push(a.eulerOrder||At.DEFAULT_ORDER),t.makeRotationFromEuler(Wc.fromArray(w))}if(a.rotation){const w=a.rotation.map(Ai.degToRad);w.push(a.eulerOrder||At.DEFAULT_ORDER),i.makeRotationFromEuler(Wc.fromArray(w))}if(a.postRotation){const w=a.postRotation.map(Ai.degToRad);w.push(a.eulerOrder||At.DEFAULT_ORDER),s.makeRotationFromEuler(Wc.fromArray(w)),s.invert()}a.scale&&r.scale(Er.fromArray(a.scale)),a.scalingOffset&&l.setPosition(Er.fromArray(a.scalingOffset)),a.scalingPivot&&o.setPosition(Er.fromArray(a.scalingPivot)),a.rotationOffset&&h.setPosition(Er.fromArray(a.rotationOffset)),a.rotationPivot&&d.setPosition(Er.fromArray(a.rotationPivot)),a.parentMatrixWorld&&(c.copy(a.parentMatrix),f.copy(a.parentMatrixWorld));const m=t.clone().multiply(i).multiply(s),_=new Je;_.extractRotation(f);const g=new Je;g.copyPosition(f);const v=g.clone().invert().multiply(f),y=_.clone().invert().multiply(v),x=r,b=new Je;if(p===0)b.copy(_).multiply(m).multiply(y).multiply(x);else if(p===1)b.copy(_).multiply(y).multiply(m).multiply(x);else{const L=new Je().scale(new T().setFromMatrixScale(c)).clone().invert(),N=y.clone().multiply(L);b.copy(_).multiply(m).multiply(N).multiply(x)}const S=d.clone().invert(),A=o.clone().invert();let E=e.clone().multiply(h).multiply(d).multiply(t).multiply(i).multiply(s).multiply(S).multiply(l).multiply(o).multiply(r).multiply(A);const R=new Je().copyPosition(E),M=f.clone().multiply(R);return u.copyPosition(M),E=u.clone().multiply(b),E.premultiply(f.invert()),E}function gg(a){a=a||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return a===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[a]}function Xc(a){return a.split(",").map(function(t){return parseFloat(t)})}function vg(a,e,t){return e===void 0&&(e=0),t===void 0&&(t=a.byteLength),new TextDecoder().decode(new Uint8Array(a,e,t))}function OE(a,e){for(let t=0,i=a.length,s=e.length;t<s;t++,i++)a[i]=e[t]}function UE(a,e,t,i){for(let s=t,r=0;s<i;s++,r++)a[r]=e[s];return a}const jc=new WeakMap;class rp extends Ln{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,s){const r=new Wo(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,o=>{this.parse(o,t,s)},i,s)}parse(e,t,i=()=>{}){this.decodeDracoFile(e,t,null,null,ei).catch(i)}decodeDracoFile(e,t,i,s,r=bi,o=()=>{}){const l={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:r};return this.decodeGeometry(e,l).then(t).catch(o)}decodeGeometry(e,t){const i=JSON.stringify(t);if(jc.has(e)){const h=jc.get(e);if(h.key===i)return h.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const r=this.workerNextTaskID++,o=e.byteLength,l=this._getWorker(r,o).then(h=>(s=h,new Promise((d,f)=>{s._callbacks[r]={resolve:d,reject:f},s.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(h=>this._createGeometry(h.geometry));return l.catch(()=>!0).then(()=>{s&&r&&this._releaseTask(s,r)}),jc.set(e,{key:i,promise:l}),l}_createGeometry(e){const t=new Bt;e.index&&t.setIndex(new ci(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const s=e.attributes[i],r=s.name,o=s.array,l=s.itemSize,h=new ci(o,l);r==="color"&&(this._assignVertexColorSpace(h,s.vertexColorSpace),h.normalized=!(o instanceof Float32Array)),t.setAttribute(r,h)}return t}_assignVertexColorSpace(e,t){if(t!==ei)return;const i=new Le;for(let s=0,r=e.count;s<r;s++)i.fromBufferAttribute(e,s).convertSRGBToLinear(),e.setXYZ(s,i.r,i.g,i.b)}_loadLibrary(e,t){const i=new Wo(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((s,r)=>{i.load(e,s,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const s=i[0];e||(this.decoderConfig.wasmBinary=i[1]);const r=zE.toString(),o=["/* draco decoder */",s,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(r){const o=r.data;switch(o.type){case"decode":s._callbacks[o.id].resolve(o);break;case"error":s._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,r){return s._taskLoad>r._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function zE(){let a,e;onmessage=function(o){const l=o.data;switch(l.type){case"init":a=l.decoderConfig,e=new Promise(function(f){a.onModuleLoaded=function(c){f({draco:c})},DracoDecoderModule(a)});break;case"decode":const h=l.buffer,d=l.taskConfig;e.then(f=>{const c=f.draco,u=new c.Decoder;try{const p=t(c,u,new Int8Array(h),d),m=p.attributes.map(_=>_.array.buffer);p.index&&m.push(p.index.array.buffer),self.postMessage({type:"decode",id:l.id,geometry:p},m)}catch(p){console.error(p),self.postMessage({type:"error",id:l.id,error:p.message})}finally{c.destroy(u)}});break}};function t(o,l,h,d){const f=d.attributeIDs,c=d.attributeTypes;let u,p;const m=l.GetEncodedGeometryType(h);if(m===o.TRIANGULAR_MESH)u=new o.Mesh,p=l.DecodeArrayToMesh(h,h.byteLength,u);else if(m===o.POINT_CLOUD)u=new o.PointCloud,p=l.DecodeArrayToPointCloud(h,h.byteLength,u);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||u.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const _={index:null,attributes:[]};for(const g in f){const v=self[c[g]];let y,x;if(d.useUniqueIDs)x=f[g],y=l.GetAttributeByUniqueId(u,x);else{if(x=l.GetAttributeId(u,o[f[g]]),x===-1)continue;y=l.GetAttribute(u,x)}const b=s(o,l,u,g,v,y);g==="color"&&(b.vertexColorSpace=d.vertexColorSpace),_.attributes.push(b)}return m===o.TRIANGULAR_MESH&&(_.index=i(o,l,u)),o.destroy(u),_}function i(o,l,h){const f=h.num_faces()*3,c=f*4,u=o._malloc(c);l.GetTrianglesUInt32Array(h,c,u);const p=new Uint32Array(o.HEAPF32.buffer,u,f).slice();return o._free(u),{array:p,itemSize:1}}function s(o,l,h,d,f,c){const u=c.num_components(),m=h.num_points()*u,_=m*f.BYTES_PER_ELEMENT,g=r(o,f),v=o._malloc(_);l.GetAttributeDataArrayForAllPoints(h,c,g,_,v);const y=new f(o.HEAPF32.buffer,v,m).slice();return o._free(v),{name:d,array:y,itemSize:u}}function r(o,l){switch(l){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}let VE=class extends nr{constructor(){super(),this.setLoaders(),this.toLoad=0,this.loaded=0,this.items={}}setLoaders(){this.loaders={},this.loadersArray=[],this.loadersArray.push({extensions:["jpg","png","webp"],action:t=>{const i=new Image;i.addEventListener("load",()=>{this.fileLoadEnd(t,i)}),i.addEventListener("error",()=>{this.fileLoadEnd(t,i)}),i.src=t.source}}),this.loaders.dracoLoader=new rp,this.loaders.dracoLoader.setDecoderPath("./draco/"),this.loadersArray.push({extensions:["drc"],action:t=>{this.loaders.dracoLoader.load(t.source,i=>{this.fileLoadEnd(t,i),rp.releaseDecoderModule()})}}),this.loaders.gltfLoader=new aa,this.loaders.gltfLoader.setDRACOLoader(this.loaders.dracoLoader),this.loadersArray.push({extensions:["glb","gltf"],action:t=>{this.loaders.gltfLoader.load(t.source,i=>{this.fileLoadEnd(t,i)},i=>{},i=>{console.error(`${t.name} modeli yüklenirken hata:`,i),this.fileLoadEnd(t,null)})}});const e=new CE;this.loadersArray.push({extensions:["fbx"],action:t=>{e.load(t.source,i=>{this.fileLoadEnd(t,i)})}})}load(e=[]){if(this.toLoad=e.length,this.toLoad===0){console.log("[Loader] Yüklenecek kaynak yok, işlem bitiriliyor"),setTimeout(()=>{this.trigger("end")},1);return}for(const t of e){const i=t.source.match(/\.([a-z]+)$/);if(typeof i[1]<"u"){const s=i[1],r=this.loadersArray.find(o=>o.extensions.find(l=>l===s));r?r.action(t):console.warn(`Cannot found loader for ${t}`)}else console.warn(`Cannot found extension of ${t}`)}}fileLoadEnd(e,t){this.loaded++,this.items[e.name]=t,this.trigger("fileEnd",[e,t]),this.loaded===this.toLoad&&this.trigger("end")}};class HE extends nr{constructor(){super(),this.loader=new VE,this.items={},this.loader.load([{name:"matcapBeige",source:"./models/matcaps/beige.png",type:"texture"},{name:"matcapBlack",source:"./models/matcaps/black.png",type:"texture"},{name:"matcapOrange",source:"./models/matcaps/orange.png",type:"texture"},{name:"matcapRed",source:"./models/matcaps/red.png",type:"texture"},{name:"matcapWhite",source:"./models/matcaps/white.png",type:"texture"},{name:"matcapGreen",source:"./models/matcaps/green.png",type:"texture"},{name:"matcapBrown",source:"./models/matcaps/brown.png",type:"texture"},{name:"matcapGray",source:"./models/matcaps/gray.png",type:"texture"},{name:"matcapEmeraldGreen",source:"./models/matcaps/emeraldGreen.png",type:"texture"},{name:"matcapPurple",source:"./models/matcaps/purple.png",type:"texture"},{name:"matcapBlue",source:"./models/matcaps/blue.png",type:"texture"},{name:"matcapYellow",source:"./models/matcaps/yellow.png",type:"texture"},{name:"matcapMetal",source:"./models/matcaps/metal.png",type:"texture"},{name:"rocketBase",source:"./models/rocket/RoketModeli.glb"},{name:"introStaticBase",source:"./models/intro/static/base.glb"},{name:"introStaticCollision",source:"./models/intro/static/collision.glb"},{name:"introStaticFloorShadow",source:"./models/intro/static/floorShadow.png",type:"texture"},{name:"introInstructionsLabels",source:"./models/intro/instructions/labels.glb"},{name:"introInstructionsArrows",source:"./models/intro/instructions/arrows.png",type:"texture"},{name:"introInstructionsControls",source:"./models/intro/instructions/controls.png",type:"texture"},{name:"introInstructionsOther",source:"./models/intro/instructions/other.png",type:"texture"},{name:"introArrowKeyBase",source:"./models/intro/arrowKey/base.glb"},{name:"introArrowKeyCollision",source:"./models/intro/arrowKey/collision.glb"},{name:"introCreativeBase",source:"./models/intro/creative/base.glb"},{name:"introCreativeCollision",source:"./models/intro/creative/collision.glb"},{name:"introDevBase",source:"./models/intro/dev/base.glb"},{name:"introDevCollision",source:"./models/intro/dev/collision.glb"},{name:"crossroadsStaticBase",source:"./models/crossroads/static/base.glb"},{name:"crossroadsStaticCollision",source:"./models/crossroads/static/collision.glb"},{name:"crossroadsStaticFloorShadow",source:"./models/crossroads/static/floorShadow.png",type:"texture"},{name:"carDefaultChassis",source:"./models/car/togg/toggmodel.glb"},{name:"carDefaultWheel",source:"./models/car/default/wheel.glb"},{name:"carDefaultBackLightsBrake",source:"./models/car/default/backLightsBrake.glb"},{name:"carDefaultBackLightsReverse",source:"./models/car/default/backLightsReverse.glb"},{name:"carDefaultAntena",source:"./models/car/default/antena.glb"},{name:"carCyberTruckChassis",source:"./models/car/cyberTruck/chassis.glb"},{name:"carCyberTruckWheel",source:"./models/car/cyberTruck/wheel.glb"},{name:"carCyberTruckBackLightsBrake",source:"./models/car/cyberTruck/backLightsBrake.glb"},{name:"carCyberTruckBackLightsReverse",source:"./models/car/cyberTruck/backLightsReverse.glb"},{name:"carCyberTruckAntena",source:"./models/car/cyberTruck/antena.glb"},{name:"playgroundStaticBase",source:"./models/playground/static/base.glb"},{name:"playgroundStaticCollision",source:"./models/playground/static/collision.glb"},{name:"playgroundStaticFloorShadow",source:"./models/playground/static/floorShadow.png",type:"texture"},{name:"brickBase",source:"./models/balya/balya.glb"},{name:"brickCollision",source:"./models/brick/collision.glb"},{name:"hornBase",source:"./models/horn/base.glb"},{name:"hornCollision",source:"./models/horn/collision.glb"},{name:"webbyTrophyBase",source:"./models/webbyTrophy/base.glb"},{name:"webbyTrophyCollision",source:"./models/webbyTrophy/collision.glb"},{name:"areaKeyEnter",source:"./models/area/keyEnter.png",type:"texture"},{name:"areaEnter",source:"./models/area/enter.png",type:"texture"},{name:"areaOpen",source:"./models/area/open.png",type:"texture"},{name:"areaReset",source:"./models/area/reset.png",type:"texture"},{name:"areaQuestionMark",source:"./models/area/questionMark.png",type:"texture"},{name:"tilesABase",source:"./models/tiles/a/base.glb"},{name:"tilesACollision",source:"./models/tiles/a/collision.glb"},{name:"tilesBBase",source:"./models/tiles/b/base.glb"},{name:"tilesBCollision",source:"./models/tiles/b/collision.glb"},{name:"tilesCBase",source:"./models/tiles/c/base.glb"},{name:"tilesCCollision",source:"./models/tiles/c/collision.glb"},{name:"tilesDBase",source:"./models/tiles/d/base.glb"},{name:"tilesDCollision",source:"./models/tiles/d/collision.glb"},{name:"tilesEBase",source:"./models/tiles/e/base.glb"},{name:"tilesECollision",source:"./models/tiles/e/collision.glb"},{name:"Road",source:"./models/Road/base.glb"},{name:"Base",source:"./models/Base/base.glb"},{name:"ScienceCenter",source:"./models/SectionScienceCenter/base.glb"},{name:"GreenScreen",source:"./models/SectionGreenScreen/base.glb"},{name:"RenderRoom",source:"./models/SectionRenderRoom/base.glb"},{name:"JapanesePark",source:"./models/SectionJapanesePark/base.glb"},{name:"Capsule",source:"./models/SectionCapsule/base.glb"},{name:"YoungCard",source:"./models/SectionYoungCard/base.glb"},{name:"Rocket",source:"./models/SectionRocket/base.glb"},{name:"RoadSign",source:"./models/SectionRoadSign/base.glb"},{name:"TrafficLight",source:"./models/SectionTrafficLight/base.glb"},{name:"Lego",source:"./models/SectionLego/base.glb"},{name:"SoundRoom",source:"./models/SectionSoundRoom/base.glb"},{name:"YoungCenter",source:"./models/SectionYoungCenter/base.glb"},{name:"Newton",source:"./models/SectionNewton/base.glb"},{name:"Division",source:"./models/SectionDivision/base.glb"},{name:"Alaaddin",source:"./models/SectionAlaaddin/base.glb"},{name:"Atmosphere",source:"./models/SectionAtmosphere/base.glb"},{name:"Stadium",source:"./models/SectionStadium/base.glb"},{name:"Butterfly",source:"./models/SectionButterfly/base.glb"},{name:"CoWork",source:"./models/SectionCoWork/base.glb"},{name:"Basketball",source:"./models/SectionBasketball/base.glb"},{name:"Board",source:"./models/SectionBillboard/base.glb"},{name:"Billboard1",source:"./models/SectionBillboard/base1.glb"},{name:"Billboard2",source:"./models/SectionBillboard/base2.glb"},{name:"Billboard3",source:"./models/SectionBillboard/base3.glb"},{name:"Billboard4",source:"./models/SectionBillboard/base4.glb"},{name:"Billboard5",source:"./models/SectionBillboard/base5.glb"},{name:"Billboard6",source:"./models/SectionBillboard/base6.glb"},{name:"Kademe",source:"./models/SectionKademe/base.glb"},{name:"BasketballCourt",source:"./models/SectionBasketballCourt/base.glb"},{name:"Concert",source:"./models/SectionConcert/base.glb"},{name:"Soccer",source:"./models/SectionSoccer/base.glb"},{name:"UVLake",source:"./uv/Lake.webp",type:"texture"},{name:"UVIceland",source:"./uv/Iceland.webp",type:"texture"},{name:"UVDesert",source:"./uv/Desert.webp",type:"texture"}]),this.loader.on("fileEnd",(e,t)=>{if(this.items[e.name]=t,e.type==="texture"){const i=new Ht(t);i.needsUpdate=!0,this.items[`${e.name}Texture`]=i}this.trigger("progress",[this.loader.loaded/this.loader.toLoad])}),this.loader.on("end",()=>{this.trigger("ready")})}}const op={type:"change"},Yc={type:"start"},ap={type:"end"},Ka=new so,lp=new hs,GE=Math.cos(70*Ai.DEG2RAD);class WE extends As{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new T,this.cursor=new T,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:rr.ROTATE,MIDDLE:rr.DOLLY,RIGHT:rr.PAN},this.touches={ONE:or.ROTATE,TWO:or.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(C){C.addEventListener("keydown",tt),this._domElementKeyEvents=C},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",tt),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(op),i.update(),r=s.NONE},this.update=function(){const C=new T,ne=new Tt().setFromUnitVectors(e.up,new T(0,1,0)),oe=ne.clone().invert(),be=new T,Re=new Tt,ot=new T,ht=2*Math.PI;return function(Gt=null){const gt=i.object.position;C.copy(gt).sub(i.target),C.applyQuaternion(ne),l.setFromVector3(C),i.autoRotate&&r===s.NONE&&N(w(Gt)),i.enableDamping?(l.theta+=h.theta*i.dampingFactor,l.phi+=h.phi*i.dampingFactor):(l.theta+=h.theta,l.phi+=h.phi);let vt=i.minAzimuthAngle,le=i.maxAzimuthAngle;isFinite(vt)&&isFinite(le)&&(vt<-Math.PI?vt+=ht:vt>Math.PI&&(vt-=ht),le<-Math.PI?le+=ht:le>Math.PI&&(le-=ht),vt<=le?l.theta=Math.max(vt,Math.min(le,l.theta)):l.theta=l.theta>(vt+le)/2?Math.max(vt,l.theta):Math.min(le,l.theta)),l.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,l.phi)),l.makeSafe(),i.enableDamping===!0?i.target.addScaledVector(f,i.dampingFactor):i.target.add(f),i.target.sub(i.cursor),i.target.clampLength(i.minTargetRadius,i.maxTargetRadius),i.target.add(i.cursor);let ge=!1;if(i.zoomToCursor&&A||i.object.isOrthographicCamera)l.radius=$(l.radius);else{const ye=l.radius;l.radius=$(l.radius*d),ge=ye!=l.radius}if(C.setFromSpherical(l),C.applyQuaternion(oe),gt.copy(i.target).add(C),i.object.lookAt(i.target),i.enableDamping===!0?(h.theta*=1-i.dampingFactor,h.phi*=1-i.dampingFactor,f.multiplyScalar(1-i.dampingFactor)):(h.set(0,0,0),f.set(0,0,0)),i.zoomToCursor&&A){let ye=null;if(i.object.isPerspectiveCamera){const we=C.length();ye=$(we*d);const nt=we-ye;i.object.position.addScaledVector(b,nt),i.object.updateMatrixWorld(),ge=!!nt}else if(i.object.isOrthographicCamera){const we=new T(S.x,S.y,0);we.unproject(i.object);const nt=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/d)),i.object.updateProjectionMatrix(),ge=nt!==i.object.zoom;const Ue=new T(S.x,S.y,0);Ue.unproject(i.object),i.object.position.sub(Ue).add(we),i.object.updateMatrixWorld(),ye=C.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;ye!==null&&(this.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(ye).add(i.object.position):(Ka.origin.copy(i.object.position),Ka.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(Ka.direction))<GE?e.lookAt(i.target):(lp.setFromNormalAndCoplanarPoint(i.object.up,i.target),Ka.intersectPlane(lp,i.target))))}else if(i.object.isOrthographicCamera){const ye=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/d)),ye!==i.object.zoom&&(i.object.updateProjectionMatrix(),ge=!0)}return d=1,A=!1,ge||be.distanceToSquared(i.object.position)>o||8*(1-Re.dot(i.object.quaternion))>o||ot.distanceToSquared(i.target)>o?(i.dispatchEvent(op),be.copy(i.object.position),Re.copy(i.object.quaternion),ot.copy(i.target),!0):!1}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",ut),i.domElement.removeEventListener("pointerdown",U),i.domElement.removeEventListener("pointercancel",re),i.domElement.removeEventListener("wheel",_e),i.domElement.removeEventListener("pointermove",P),i.domElement.removeEventListener("pointerup",re),i.domElement.getRootNode().removeEventListener("keydown",Ce,{capture:!0}),i._domElementKeyEvents!==null&&(i._domElementKeyEvents.removeEventListener("keydown",tt),i._domElementKeyEvents=null)};const i=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=s.NONE;const o=1e-6,l=new cf,h=new cf;let d=1;const f=new T,c=new Oe,u=new Oe,p=new Oe,m=new Oe,_=new Oe,g=new Oe,v=new Oe,y=new Oe,x=new Oe,b=new T,S=new Oe;let A=!1;const E=[],R={};let M=!1;function w(C){return C!==null?2*Math.PI/60*i.autoRotateSpeed*C:2*Math.PI/60/60*i.autoRotateSpeed}function L(C){const ne=Math.abs(C*.01);return Math.pow(.95,i.zoomSpeed*ne)}function N(C){h.theta-=C}function B(C){h.phi-=C}const G=function(){const C=new T;return function(oe,be){C.setFromMatrixColumn(be,0),C.multiplyScalar(-oe),f.add(C)}}(),W=function(){const C=new T;return function(oe,be){i.screenSpacePanning===!0?C.setFromMatrixColumn(be,1):(C.setFromMatrixColumn(be,0),C.crossVectors(i.object.up,C)),C.multiplyScalar(oe),f.add(C)}}(),ee=function(){const C=new T;return function(oe,be){const Re=i.domElement;if(i.object.isPerspectiveCamera){const ot=i.object.position;C.copy(ot).sub(i.target);let ht=C.length();ht*=Math.tan(i.object.fov/2*Math.PI/180),G(2*oe*ht/Re.clientHeight,i.object.matrix),W(2*be*ht/Re.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(G(oe*(i.object.right-i.object.left)/i.object.zoom/Re.clientWidth,i.object.matrix),W(be*(i.object.top-i.object.bottom)/i.object.zoom/Re.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function z(C){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?d/=C:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function k(C){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?d*=C:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function q(C,ne){if(!i.zoomToCursor)return;A=!0;const oe=i.domElement.getBoundingClientRect(),be=C-oe.left,Re=ne-oe.top,ot=oe.width,ht=oe.height;S.x=be/ot*2-1,S.y=-(Re/ht)*2+1,b.set(S.x,S.y,1).unproject(i.object).sub(i.object.position).normalize()}function $(C){return Math.max(i.minDistance,Math.min(i.maxDistance,C))}function H(C){c.set(C.clientX,C.clientY)}function Q(C){q(C.clientX,C.clientX),v.set(C.clientX,C.clientY)}function X(C){m.set(C.clientX,C.clientY)}function F(C){u.set(C.clientX,C.clientY),p.subVectors(u,c).multiplyScalar(i.rotateSpeed);const ne=i.domElement;N(2*Math.PI*p.x/ne.clientHeight),B(2*Math.PI*p.y/ne.clientHeight),c.copy(u),i.update()}function D(C){y.set(C.clientX,C.clientY),x.subVectors(y,v),x.y>0?z(L(x.y)):x.y<0&&k(L(x.y)),v.copy(y),i.update()}function j(C){_.set(C.clientX,C.clientY),g.subVectors(_,m).multiplyScalar(i.panSpeed),ee(g.x,g.y),m.copy(_),i.update()}function te(C){q(C.clientX,C.clientY),C.deltaY<0?k(L(C.deltaY)):C.deltaY>0&&z(L(C.deltaY)),i.update()}function ae(C){let ne=!1;switch(C.code){case i.keys.UP:C.ctrlKey||C.metaKey||C.shiftKey?B(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):ee(0,i.keyPanSpeed),ne=!0;break;case i.keys.BOTTOM:C.ctrlKey||C.metaKey||C.shiftKey?B(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):ee(0,-i.keyPanSpeed),ne=!0;break;case i.keys.LEFT:C.ctrlKey||C.metaKey||C.shiftKey?N(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):ee(i.keyPanSpeed,0),ne=!0;break;case i.keys.RIGHT:C.ctrlKey||C.metaKey||C.shiftKey?N(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):ee(-i.keyPanSpeed,0),ne=!0;break}ne&&(C.preventDefault(),i.update())}function K(C){if(E.length===1)c.set(C.pageX,C.pageY);else{const ne=xt(C),oe=.5*(C.pageX+ne.x),be=.5*(C.pageY+ne.y);c.set(oe,be)}}function O(C){if(E.length===1)m.set(C.pageX,C.pageY);else{const ne=xt(C),oe=.5*(C.pageX+ne.x),be=.5*(C.pageY+ne.y);m.set(oe,be)}}function pe(C){const ne=xt(C),oe=C.pageX-ne.x,be=C.pageY-ne.y,Re=Math.sqrt(oe*oe+be*be);v.set(0,Re)}function xe(C){i.enableZoom&&pe(C),i.enablePan&&O(C)}function Ee(C){i.enableZoom&&pe(C),i.enableRotate&&K(C)}function ve(C){if(E.length==1)u.set(C.pageX,C.pageY);else{const oe=xt(C),be=.5*(C.pageX+oe.x),Re=.5*(C.pageY+oe.y);u.set(be,Re)}p.subVectors(u,c).multiplyScalar(i.rotateSpeed);const ne=i.domElement;N(2*Math.PI*p.x/ne.clientHeight),B(2*Math.PI*p.y/ne.clientHeight),c.copy(u)}function he(C){if(E.length===1)_.set(C.pageX,C.pageY);else{const ne=xt(C),oe=.5*(C.pageX+ne.x),be=.5*(C.pageY+ne.y);_.set(oe,be)}g.subVectors(_,m).multiplyScalar(i.panSpeed),ee(g.x,g.y),m.copy(_)}function fe(C){const ne=xt(C),oe=C.pageX-ne.x,be=C.pageY-ne.y,Re=Math.sqrt(oe*oe+be*be);y.set(0,Re),x.set(0,Math.pow(y.y/v.y,i.zoomSpeed)),z(x.y),v.copy(y);const ot=(C.pageX+ne.x)*.5,ht=(C.pageY+ne.y)*.5;q(ot,ht)}function qe(C){i.enableZoom&&fe(C),i.enablePan&&he(C)}function Ye(C){i.enableZoom&&fe(C),i.enableRotate&&ve(C)}function U(C){i.enabled!==!1&&(E.length===0&&(i.domElement.setPointerCapture(C.pointerId),i.domElement.addEventListener("pointermove",P),i.domElement.addEventListener("pointerup",re)),!st(C)&&(it(C),C.pointerType==="touch"?Pe(C):de(C)))}function P(C){i.enabled!==!1&&(C.pointerType==="touch"?et(C):me(C))}function re(C){switch(We(C),E.length){case 0:i.domElement.releasePointerCapture(C.pointerId),i.domElement.removeEventListener("pointermove",P),i.domElement.removeEventListener("pointerup",re),i.dispatchEvent(ap),r=s.NONE;break;case 1:const ne=E[0],oe=R[ne];Pe({pointerId:ne,pageX:oe.x,pageY:oe.y});break}}function de(C){let ne;switch(C.button){case 0:ne=i.mouseButtons.LEFT;break;case 1:ne=i.mouseButtons.MIDDLE;break;case 2:ne=i.mouseButtons.RIGHT;break;default:ne=-1}switch(ne){case rr.DOLLY:if(i.enableZoom===!1)return;Q(C),r=s.DOLLY;break;case rr.ROTATE:if(C.ctrlKey||C.metaKey||C.shiftKey){if(i.enablePan===!1)return;X(C),r=s.PAN}else{if(i.enableRotate===!1)return;H(C),r=s.ROTATE}break;case rr.PAN:if(C.ctrlKey||C.metaKey||C.shiftKey){if(i.enableRotate===!1)return;H(C),r=s.ROTATE}else{if(i.enablePan===!1)return;X(C),r=s.PAN}break;default:r=s.NONE}r!==s.NONE&&i.dispatchEvent(Yc)}function me(C){switch(r){case s.ROTATE:if(i.enableRotate===!1)return;F(C);break;case s.DOLLY:if(i.enableZoom===!1)return;D(C);break;case s.PAN:if(i.enablePan===!1)return;j(C);break}}function _e(C){i.enabled===!1||i.enableZoom===!1||r!==s.NONE||(C.preventDefault(),i.dispatchEvent(Yc),te(De(C)),i.dispatchEvent(ap))}function De(C){const ne=C.deltaMode,oe={clientX:C.clientX,clientY:C.clientY,deltaY:C.deltaY};switch(ne){case 1:oe.deltaY*=16;break;case 2:oe.deltaY*=100;break}return C.ctrlKey&&!M&&(oe.deltaY*=10),oe}function Ce(C){C.key==="Control"&&(M=!0,i.domElement.getRootNode().addEventListener("keyup",Me,{passive:!0,capture:!0}))}function Me(C){C.key==="Control"&&(M=!1,i.domElement.getRootNode().removeEventListener("keyup",Me,{passive:!0,capture:!0}))}function tt(C){i.enabled===!1||i.enablePan===!1||ae(C)}function Pe(C){switch(ct(C),E.length){case 1:switch(i.touches.ONE){case or.ROTATE:if(i.enableRotate===!1)return;K(C),r=s.TOUCH_ROTATE;break;case or.PAN:if(i.enablePan===!1)return;O(C),r=s.TOUCH_PAN;break;default:r=s.NONE}break;case 2:switch(i.touches.TWO){case or.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;xe(C),r=s.TOUCH_DOLLY_PAN;break;case or.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;Ee(C),r=s.TOUCH_DOLLY_ROTATE;break;default:r=s.NONE}break;default:r=s.NONE}r!==s.NONE&&i.dispatchEvent(Yc)}function et(C){switch(ct(C),r){case s.TOUCH_ROTATE:if(i.enableRotate===!1)return;ve(C),i.update();break;case s.TOUCH_PAN:if(i.enablePan===!1)return;he(C),i.update();break;case s.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;qe(C),i.update();break;case s.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;Ye(C),i.update();break;default:r=s.NONE}}function ut(C){i.enabled!==!1&&C.preventDefault()}function it(C){E.push(C.pointerId)}function We(C){delete R[C.pointerId];for(let ne=0;ne<E.length;ne++)if(E[ne]==C.pointerId){E.splice(ne,1);return}}function st(C){for(let ne=0;ne<E.length;ne++)if(E[ne]==C.pointerId)return!0;return!1}function ct(C){let ne=R[C.pointerId];ne===void 0&&(ne=new Oe,R[C.pointerId]=ne),ne.set(C.pageX,C.pageY)}function xt(C){const ne=C.pointerId===E[0]?E[1]:E[0];return R[ne]}i.domElement.addEventListener("contextmenu",ut),i.domElement.addEventListener("pointerdown",U),i.domElement.addEventListener("pointercancel",re),i.domElement.addEventListener("wheel",_e,{passive:!1}),i.domElement.getRootNode().addEventListener("keydown",Ce,{passive:!0,capture:!0}),this.update()}}class XE{constructor(e){this.time=e.time,this.sizes=e.sizes,this.renderer=e.renderer,this.debug=e.debug,this.config=e.config,this.container=new je,this.container.matrixAutoUpdate=!1,this.target=new T(0,0,0),this.targetEased=new T(0,0,0),this.easing=.15,this.debug&&(this.debugFolder=this.debug.addFolder("camera")),this.setAngle(),this.setInstance(),this.setZoom(),this.setPan(),this.setOrbitControls(),this.setCarMovementTracking(),this.setThirdPersonMode()}setAngle(){this.angle={},this.angle.items={default:new T(1.135,-1.45,1.15),projects:new T(.38,-1.4,1.63),greenScreenCam:new T(.5,-2,.7)},this.angle.value=new T,this.angle.value.copy(this.angle.items.default),this.angle.set=e=>{const t=this.angle.items[e];typeof t<"u"&&(e=="greenScreenCam"?(this.zoom.targetValue=.5,this.pan.targetValue={x:-.8,y:3},this.pan.disable(),this.pan.preventReset=!0):(this.zoom.targetValue=1,this.pan.targetValue={x:0,y:0},this.pan.enabled=!0,this.pan.preventReset=!1),Qe.to(this.angle.value,{...t,duration:2,ease:"power1.inOut"}))},this.debug&&(this.debugFolder.add(this,"easing").step(1e-4).min(0).max(1).name("easing"),this.debugFolder.add(this.angle.value,"x").step(.001).min(-2).max(2).name("invertDirectionX").listen(),this.debugFolder.add(this.angle.value,"y").step(.001).min(-2).max(2).name("invertDirectionY").listen(),this.debugFolder.add(this.angle.value,"z").step(.001).min(-2).max(2).name("invertDirectionZ").listen())}setInstance(){this.instance=new Pi(40,this.sizes.viewport.width/this.sizes.viewport.height,1,80),this.instance.up.set(0,0,1),this.instance.position.copy(this.angle.value),this.instance.lookAt(new T),this.container.add(this.instance),this.sizes.on("resize",()=>{this.instance.aspect=this.sizes.viewport.width/this.sizes.viewport.height,this.instance.updateProjectionMatrix()}),this.time.on("tick",()=>{this.orbitControls.enabled||(this.targetEased.x+=(this.target.x-this.targetEased.x)*this.easing,this.targetEased.y+=(this.target.y-this.targetEased.y)*this.easing,this.targetEased.z+=(this.target.z-this.targetEased.z)*this.easing,this.instance.position.copy(this.targetEased).add(this.angle.value.clone().normalize().multiplyScalar(this.zoom.distance)),this.instance.lookAt(this.targetEased),this.instance.position.x+=this.pan.value.x,this.instance.position.y+=this.pan.value.y)})}setZoom(){this.zoom={},this.zoom.easing=.1,this.zoom.minDistance=1,this.zoom.amplitude=15,this.zoom.value=1,this.zoom.targetValue=this.zoom.value,this.zoom.distance=this.zoom.minDistance+this.zoom.amplitude*this.zoom.value,document.addEventListener("mousewheel",e=>{this.zoom.targetValue+=e.deltaY*.001,this.zoom.targetValue=Math.min(Math.max(this.zoom.targetValue,0),1)},{passive:!0}),this.zoom.touch={},this.zoom.touch.startDistance=0,this.zoom.touch.startValue=0,this.renderer.domElement.addEventListener("touchstart",e=>{e.touches.length===2&&(this.zoom.touch.startDistance=Math.hypot(e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientX-e.touches[1].clientX),this.zoom.touch.startValue=this.zoom.targetValue)}),this.renderer.domElement.addEventListener("touchmove",e=>{if(e.touches.length===2){e.preventDefault();const i=Math.hypot(e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientX-e.touches[1].clientX)/this.zoom.touch.startDistance;this.zoom.targetValue=this.zoom.touch.startValue-(i-1),this.zoom.targetValue=Math.min(Math.max(this.zoom.targetValue,0),1)}}),this.time.on("tick",()=>{this.zoom.value+=(this.zoom.targetValue-this.zoom.value)*this.zoom.easing,this.zoom.distance=this.zoom.minDistance+this.zoom.amplitude*this.zoom.value})}setPan(){this.pan={},this.pan.enabled=!1,this.pan.active=!1,this.pan.preventReset=!1,this.pan.easing=.1,this.pan.start={},this.pan.start.x=0,this.pan.start.y=0,this.pan.value={},this.pan.value.x=0,this.pan.value.y=0,this.pan.targetValue={},this.pan.targetValue.x=this.pan.value.x,this.pan.targetValue.y=this.pan.value.y,this.pan.raycaster=new $h,this.pan.mouse=new Oe,this.pan.needsUpdate=!1,this.pan.hitMesh=new Ae(new pi(500,500,1,1),new Ne({color:16711680,wireframe:!0,visible:!1})),this.container.add(this.pan.hitMesh),this.pan.reset=()=>{this.pan.preventReset||(this.pan.targetValue.x=0,this.pan.targetValue.y=0)},this.pan.enable=()=>{this.pan.enabled=!0,this.renderer.domElement.classList.add("has-cursor-grab")},this.pan.disable=()=>{this.pan.enabled=!1,this.renderer.domElement.classList.remove("has-cursor-grab")},this.pan.down=(e,t)=>{if(!this.pan.enabled)return;this.renderer.domElement.classList.add("has-cursor-grabbing"),this.pan.active=!0,this.pan.mouse.x=e/this.sizes.viewport.width*2-1,this.pan.mouse.y=-(t/this.sizes.viewport.height)*2+1,this.pan.raycaster.setFromCamera(this.pan.mouse,this.instance);const i=this.pan.raycaster.intersectObjects([this.pan.hitMesh]);i.length&&(this.pan.start.x=i[0].point.x,this.pan.start.y=i[0].point.y)},this.pan.move=(e,t)=>{this.pan.enabled&&this.pan.active&&(this.pan.mouse.x=e/this.sizes.viewport.width*2-1,this.pan.mouse.y=-(t/this.sizes.viewport.height)*2+1,this.pan.needsUpdate=!0)},this.pan.up=()=>{this.pan.active=!1,this.renderer.domElement.classList.remove("has-cursor-grabbing")},window.addEventListener("mousedown",e=>{this.pan.down(e.clientX,e.clientY)}),window.addEventListener("mousemove",e=>{this.pan.move(e.clientX,e.clientY)}),window.addEventListener("mouseup",()=>{this.pan.up()}),this.renderer.domElement.addEventListener("touchstart",e=>{e.touches.length===1&&this.pan.down(e.touches[0].clientX,e.touches[0].clientY)}),this.renderer.domElement.addEventListener("touchmove",e=>{e.touches.length===1&&this.pan.move(e.touches[0].clientX,e.touches[0].clientY)}),this.renderer.domElement.addEventListener("touchend",()=>{this.pan.up()}),this.time.on("tick",()=>{if(this.pan.active&&this.pan.needsUpdate){this.pan.raycaster.setFromCamera(this.pan.mouse,this.instance);const e=this.pan.raycaster.intersectObjects([this.pan.hitMesh]);e.length&&(this.pan.targetValue.x=-(e[0].point.x-this.pan.start.x),this.pan.targetValue.y=-(e[0].point.y-this.pan.start.y)),this.pan.needsUpdate=!1}this.pan.value.x+=(this.pan.targetValue.x-this.pan.value.x)*this.pan.easing,this.pan.value.y+=(this.pan.targetValue.y-this.pan.value.y)*this.pan.easing})}setOrbitControls(){this.orbitControls=new WE(this.instance,this.renderer.domElement),this.orbitControls.enabled=!1,this.orbitControls.enableKeys=!1,this.orbitControls.zoomSpeed=.5,this.debug&&this.debugFolder.add(this.orbitControls,"enabled").name("orbitControlsEnabled")}setCarMovementTracking(){this.carMovement={speed:new T,localSpeed:new T,acceleration:new T,localAcceleration:new T,position:new T,lastLogTime:0}}setCarReference(e){this.car=e,console.log("Araba referansı kameraya eklendi")}setThirdPersonMode(){if(this.thirdPerson={enabled:!1,offset:new T(-8,0,3),lookAtOffset:new T(0,0,2),smoothFactor:.001,transitionDuration:1},window.addEventListener("keydown",e=>{(e.key==="o"||e.key==="O")&&(this.thirdPerson.enabled=!this.thirdPerson.enabled,this.thirdPerson.enabled?(console.log("Üçüncü şahıs kamera modu aktif"),this.orbitControls.enabled=!1,this.pan.disable()):(console.log("Normal kamera moduna dönüldü"),this.target.set(0,0,0)))}),this.time.on("tick",()=>{if(this.thirdPerson.enabled&&window.application&&window.application.world&&window.application.world.car){const e=window.application.world.car;if(e.chassis&&e.chassis.object){const t=e.chassis.object.position,i=e.chassis.object.rotation,s=this.thirdPerson.offset.clone();s.applyAxisAngle(new T(0,0,1),i.z);const r=t.clone().add(s),o=this.thirdPerson.lookAtOffset.clone();o.applyAxisAngle(new T(0,0,1),i.z);const l=t.clone().add(o);this.target.copy(l),this.targetEased.copy(this.target),this.instance.position.copy(r),this.instance.lookAt(this.target)}}}),this.debug&&this.debugFolder){const e=this.debugFolder.addFolder("thirdPersonCamera");e.add(this.thirdPerson,"enabled").name("Aktif").listen(),e.add(this.thirdPerson.offset,"x").min(-10).max(10).step(.1).name("Offset X"),e.add(this.thirdPerson.offset,"y").min(-10).max(10).step(.1).name("Offset Y"),e.add(this.thirdPerson.offset,"z").min(-10).max(10).step(.1).name("Offset Z"),e.add(this.thirdPerson.lookAtOffset,"x").min(-10).max(10).step(.1).name("LookAt X"),e.add(this.thirdPerson.lookAtOffset,"y").min(-10).max(10).step(.1).name("LookAt Y"),e.add(this.thirdPerson.lookAtOffset,"z").min(-10).max(10).step(.1).name("LookAt Z"),e.add(this.thirdPerson,"smoothFactor").min(.01).max(1).step(.01).name("Yumuşaklık")}}}class jE{constructor(e){if(this.config=e.config,this.time=e.time,this.world=e.world,this.$container=document.querySelector(".js-threejs-journey"),!this.$container){console.warn("ThreejsJourney container bulunamadı, komponent devre dışı bırakılıyor.");return}this.$messages=[...this.$container.querySelectorAll(".js-message")],this.$yes=this.$container.querySelector(".js-yes"),this.$no=this.$container.querySelector(".js-no"),this.step=0,this.maxStep=this.$messages.length-1,this.seenCount=window.localStorage.getItem("threejsJourneySeenCount")||0,this.seenCount=parseInt(this.seenCount),this.shown=!1,this.traveledDistance=0,this.minTraveledDistance=(this.config.debug?5:75)*(this.seenCount+1),this.prevent=!!window.localStorage.getItem("threejsJourneyPrevent"),this.config.debug&&this.start(),!this.prevent&&(this.setYesNo(),this.setLog(),this.time.on("tick",()=>{this.world.physics&&(this.traveledDistance+=this.world.physics.car.forwardSpeed,!this.config.touch&&!this.shown&&this.traveledDistance>this.minTraveledDistance&&this.start())}))}setYesNo(){this.$container&&(this.$yes.addEventListener("click",()=>{Qe.delayedCall(2,()=>{this.hide()}),window.localStorage.setItem("threejsJourneyPrevent",1)}),this.$no.addEventListener("click",()=>{this.next(),Qe.delayedCall(5,()=>{this.hide()})}),this.$yes.addEventListener("mouseenter",()=>{this.$container.classList.remove("is-hover-none"),this.$container.classList.remove("is-hover-no"),this.$container.classList.add("is-hover-yes")}),this.$no.addEventListener("mouseenter",()=>{this.$container.classList.remove("is-hover-none"),this.$container.classList.add("is-hover-no"),this.$container.classList.remove("is-hover-yes")}),this.$yes.addEventListener("mouseleave",()=>{this.$container.classList.add("is-hover-none"),this.$container.classList.remove("is-hover-no"),this.$container.classList.remove("is-hover-yes")}),this.$no.addEventListener("mouseleave",()=>{this.$container.classList.add("is-hover-none"),this.$container.classList.remove("is-hover-no"),this.$container.classList.remove("is-hover-yes")}))}setLog(){console.log("%cWhat are you doing here?! you sneaky developer...","color: #32ffce"),console.log("%cDo you want to learn how this portfolio has been made?","color: #32ffce"),console.log("%cCheckout Three.js Journey 👉 https://threejs-journey.com?c=p2","color: #32ffce"),console.log("%c— Bruno","color: #777777")}hide(){if(this.$container){for(const e of this.$messages)e.classList.remove("is-visible");Qe.delayedCall(.5,()=>{this.$container.classList.remove("is-active")})}}start(){this.$container&&(this.$container.classList.add("is-active"),window.requestAnimationFrame(()=>{this.next(),Qe.delayedCall(4,()=>{this.next()}),Qe.delayedCall(7,()=>{this.next()})}),this.shown=!0,window.localStorage.setItem("threejsJourneySeenCount",this.seenCount+1))}updateMessages(){if(!this.$container||!this.$messages||!this.$messages.length)return;let e=0;for(const i of this.$messages)e<this.step&&i.classList.add("is-visible"),e++;this.$messages.reverse();let t=0;e=this.maxStep;for(const i of this.$messages){const s=i.offsetHeight;e<this.step?(i.style.transform=`translateY(${-t}px)`,t+=s+20):i.style.transform=`translateY(${s}px)`,e--}this.$messages.reverse()}next(){this.step>this.maxStep||(this.step++,this.updateMessages())}}const YE={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Ul{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const qE=new ia(-1,1,1,-1,0,1);class $E extends Bt{constructor(){super(),this.setAttribute("position",new yt([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new yt([0,2,0,0,2,0],2))}}const ZE=new $E;class KE{constructor(e){this._mesh=new Ae(ZE,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,qE)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class rl extends Ul{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof fi?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=Lp.clone(e.uniforms),this.material=new fi({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new KE(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class cp extends Ul{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const s=e.getContext(),r=e.state;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0);let o,l;this.inverse?(o=0,l=1):(o=1,l=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),r.buffers.stencil.setFunc(s.ALWAYS,o,4294967295),r.buffers.stencil.setClear(l),r.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.color.setMask(!0),r.buffers.depth.setMask(!0),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(s.EQUAL,1,4294967295),r.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),r.buffers.stencil.setLocked(!0)}}class QE extends Ul{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class JE{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const i=e.getSize(new Oe);this._width=i.width,this._height=i.height,t=new bs(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Jo}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new rl(YE),this.copyPass.material.blending=Zn,this.clock=new zw}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let s=0,r=this.passes.length;s<r;s++){const o=this.passes[s];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),o.needsSwap){if(i){const l=this.renderer.getContext(),h=this.renderer.state.buffers.stencil;h.setFunc(l.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),h.setFunc(l.EQUAL,1,4294967295)}this.swapBuffers()}cp!==void 0&&(o instanceof cp?i=!0:o instanceof QE&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new Oe);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(i,s),this.renderTarget2.setSize(i,s);for(let r=0;r<this.passes.length;r++)this.passes[r].setSize(i,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class eT extends Ul{constructor(e,t,i=null,s=null,r=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=s,this.clearAlpha=r,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Le}render(e,t,i){const s=e.autoClear;e.autoClear=!1;let r,o;this.overrideMaterial!==null&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor)),this.clearAlpha!==null&&(r=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(r),this.overrideMaterial!==null&&(this.scene.overrideMaterial=o),e.autoClear=s}}var tT=`#define M_PI 3.1415926535897932384626433832795

uniform sampler2D tDiffuse;
uniform vec2 uResolution;
uniform vec2 uStrength;

varying vec2 vUv;

vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main()
{
    vec4 diffuseColor = texture2D(tDiffuse, vUv);
    vec4 blurColor = blur9(tDiffuse, vUv, uResolution, uStrength);
    float blurStrength = 1.0 - sin(vUv.y * M_PI);
    gl_FragColor = mix(diffuseColor, blurColor, blurStrength);
}`,iT=`varying vec2 vUv;

void main()
{
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`;const hp={uniforms:{tDiffuse:{type:"t",value:null},uResolution:{type:"v2",value:null},uStrength:{type:"v2",value:null}},vertexShader:iT,fragmentShader:tT};var nT=`uniform sampler2D tDiffuse;
uniform vec2 uPosition;
uniform float uRadius;
uniform vec3 uColor;
uniform float uAlpha;

varying vec2 vUv;

void main()
{
    vec4 diffuseColor = texture2D(tDiffuse, vUv);

    float glowStrength = distance(vUv, uPosition) / uRadius;
    glowStrength = 1.0 - glowStrength;
    glowStrength *= uAlpha;
    glowStrength = clamp(glowStrength, 0.0, 1.0);
    vec3 color = mix(diffuseColor.rgb, uColor, glowStrength);

    gl_FragColor = vec4(color, 1.0);
}`,sT=`varying vec2 vUv;

void main()
{
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`;const rT={uniforms:{tDiffuse:{type:"t",value:null},uPosition:{type:"v2",value:null},uRadius:{type:"f",value:null},uColor:{type:"v3",value:null},uAlpha:{type:"f",value:null}},vertexShader:sT,fragmentShader:nT};class oT{constructor(e){this.$canvas=e.$canvas,this.time=new SM,this.sizes=new MM,this.resources=new HE,this.setConfig(),this.setDebug(),this.setRenderer(),this.setCamera(),this.setPasses(),this.setWorld(),this.setTitle(),this.setThreejsJourney()}setConfig(){this.config={},this.config.debug=window.location.hash==="#debug",this.config.cyberTruck=window.location.hash==="#cybertruck",this.config.touch=!1,window.addEventListener("touchstart",()=>{this.config.touch=!0,this.world.controls.setTouch(),this.passes.horizontalBlurPass.strength=1,this.passes.horizontalBlurPass.material.uniforms.uStrength.value=new Oe(this.passes.horizontalBlurPass.strength,0),this.passes.verticalBlurPass.strength=1,this.passes.verticalBlurPass.material.uniforms.uStrength.value=new Oe(0,this.passes.verticalBlurPass.strength)},{once:!0})}setDebug(){this.config.debug&&(this.debug=new wM({width:420}))}setRenderer(){this.scene=new Kb,this.renderer=new Zb({canvas:this.$canvas,alpha:!0,powerPreference:"high-performance"}),this.renderer.setClearColor(0,1),this.renderer.setPixelRatio(2),this.renderer.setSize(this.sizes.viewport.width,this.sizes.viewport.height),this.renderer.autoClear=!1,this.sizes.on("resize",()=>{this.renderer.setSize(this.sizes.viewport.width,this.sizes.viewport.height)})}setCamera(){this.camera=new XE({time:this.time,sizes:this.sizes,renderer:this.renderer,debug:this.debug,config:this.config}),this.scene.add(this.camera.container),this.time.on("tick",()=>{this.world&&this.world.car&&(this.camera.target.x=this.world.car.chassis.object.position.x,this.camera.target.y=this.world.car.chassis.object.position.y,this.camera.carX=this.world.car.chassis.object.position.x,this.camera.carY=this.world.car.chassis.object.position.y)})}setPasses(){if(this.passes={},this.debug&&(this.passes.debugFolder=this.debug.addFolder("postprocess")),this.passes.composer=new JE(this.renderer),this.passes.renderPass=new eT(this.scene,this.camera.instance),this.passes.horizontalBlurPass=new rl(hp),this.passes.horizontalBlurPass.strength=this.config.touch?0:1,this.passes.horizontalBlurPass.material.uniforms.uResolution.value=new Oe(this.sizes.viewport.width,this.sizes.viewport.height),this.passes.horizontalBlurPass.material.uniforms.uStrength.value=new Oe(this.passes.horizontalBlurPass.strength,0),this.passes.verticalBlurPass=new rl(hp),this.passes.verticalBlurPass.strength=this.config.touch?0:1,this.passes.verticalBlurPass.material.uniforms.uResolution.value=new Oe(this.sizes.viewport.width,this.sizes.viewport.height),this.passes.verticalBlurPass.material.uniforms.uStrength.value=new Oe(0,this.passes.verticalBlurPass.strength),this.debug){const e=this.passes.debugFolder.addFolder("blur");e.open(),e.add(this.passes.horizontalBlurPass.material.uniforms.uStrength.value,"x").step(.001).min(0).max(10),e.add(this.passes.verticalBlurPass.material.uniforms.uStrength.value,"y").step(.001).min(0).max(10)}if(this.passes.glowsPass=new rl(rT),this.passes.glowsPass.color="#ffcfe0",this.passes.glowsPass.material.uniforms.uPosition.value=new Oe(0,.25),this.passes.glowsPass.material.uniforms.uRadius.value=.7,this.passes.glowsPass.material.uniforms.uColor.value=new Le(this.passes.glowsPass.color),this.passes.glowsPass.material.uniforms.uColor.value.convertLinearToSRGB(),this.passes.glowsPass.material.uniforms.uAlpha.value=.55,this.debug){const e=this.passes.debugFolder.addFolder("glows");e.open(),e.add(this.passes.glowsPass.material.uniforms.uPosition.value,"x").step(.001).min(-1).max(2).name("positionX"),e.add(this.passes.glowsPass.material.uniforms.uPosition.value,"y").step(.001).min(-1).max(2).name("positionY"),e.add(this.passes.glowsPass.material.uniforms.uRadius,"value").step(.001).min(0).max(2).name("radius"),e.addColor(this.passes.glowsPass,"color").name("color").onChange(()=>{this.passes.glowsPass.material.uniforms.uColor.value=new Le(this.passes.glowsPass.color)}),e.add(this.passes.glowsPass.material.uniforms.uAlpha,"value").step(.001).min(0).max(1).name("alpha")}this.passes.composer.addPass(this.passes.renderPass),this.passes.composer.addPass(this.passes.horizontalBlurPass),this.passes.composer.addPass(this.passes.verticalBlurPass),this.passes.composer.addPass(this.passes.glowsPass),this.time.on("tick",()=>{this.passes.horizontalBlurPass.enabled=this.passes.horizontalBlurPass.material.uniforms.uStrength.value.x>0,this.passes.verticalBlurPass.enabled=this.passes.verticalBlurPass.material.uniforms.uStrength.value.y>0,this.passes.composer.render()}),this.sizes.on("resize",()=>{this.renderer.setSize(this.sizes.viewport.width,this.sizes.viewport.height),this.passes.composer.setSize(this.sizes.viewport.width,this.sizes.viewport.height),this.passes.horizontalBlurPass.material.uniforms.uResolution.value.x=this.sizes.viewport.width,this.passes.horizontalBlurPass.material.uniforms.uResolution.value.y=this.sizes.viewport.height,this.passes.verticalBlurPass.material.uniforms.uResolution.value.x=this.sizes.viewport.width,this.passes.verticalBlurPass.material.uniforms.uResolution.value.y=this.sizes.viewport.height})}setWorld(){this.world=new nE({config:this.config,debug:this.debug,resources:this.resources,time:this.time,sizes:this.sizes,camera:this.camera,scene:this.scene,renderer:this.renderer,passes:this.passes}),this.scene.add(this.world.container)}setTitle(){this.title={},this.title.frequency=300,this.title.width=20,this.title.position=0,this.title.$element=document.querySelector("title"),this.title.absolutePosition=Math.round(this.title.width*.25),this.time.on("tick",()=>{this.world.physics&&(this.title.absolutePosition+=this.world.physics.car.forwardSpeed,this.title.absolutePosition<0&&(this.title.absolutePosition=0))}),window.setInterval(()=>{this.title.position=Math.round(this.title.absolutePosition%this.title.width),document.title=`${"_".repeat(this.title.width-this.title.position)}🚗${"_".repeat(this.title.position)}`},this.title.frequency)}setThreejsJourney(){try{this.threejsJourney=new jE({config:this.config,time:this.time,world:this.world})}catch(e){console.warn("ThreejsJourney aktifleştirilemedi:",e)}}destructor(){this.time.off("tick"),this.sizes.off("resize"),this.camera.orbitControls.dispose(),this.renderer.dispose(),this.debug.destroy()}}window.application=new oT({$canvas:document.querySelector(".js-canvas"),useComposer:!0});class aT{constructor(){if(this.fps=0,this.frames=0,this.lastTime=performance.now(),this.frameID=null,this.canvas=document.getElementById("fpsCanvas"),this.fpsText=document.getElementById("fpsCounter"),!this.canvas||!this.fpsText){console.error("FPS canvas veya metin öğesi bulunamadı!");return}this.ctx=this.canvas.getContext("2d"),this.canvas.width=100,this.canvas.height=50,this.fpsValues=Array(100).fill(0),this.update=this.update.bind(this),this.frameID=requestAnimationFrame(this.update)}update(e){if(!this.canvas||!this.ctx||!this.fpsText)return;const t=e-this.lastTime;this.frames++,t>=1e3&&(this.fps=Math.round(this.frames*1e3/t),this.lastTime=e,this.frames=0,this.fpsText.textContent=`FPS: ${this.fps}`,this.fpsValues.shift(),this.fpsValues.push(this.fps>0?this.fps:0),this.drawGraph()),this.frameID=requestAnimationFrame(this.update)}drawGraph(){const e=this.ctx,t=this.canvas.width,i=this.canvas.height;e.clearRect(0,0,t,i),e.fillStyle="rgba(0, 0, 0, 0.2)",e.fillRect(0,0,t,i),e.strokeStyle="#4CAF50",e.lineWidth=2,e.beginPath();const s=this.fpsValues.length,r=120;for(let o=0;o<s;o++){const l=o/s*t,h=i-this.fpsValues[o]/r*i;o===0?e.moveTo(l,h):e.lineTo(l,h)}e.stroke()}destroy(){this.frameID!==null&&cancelAnimationFrame(this.frameID)}}const up=new aT;window.addEventListener("beforeunload",()=>{up&&up.destroy()});class lT{constructor(){this.trianglesElement=document.getElementById("perf-triangles"),this.callsElement=document.getElementById("perf-calls"),this.geometriesElement=document.getElementById("perf-geometries"),this.texturesElement=document.getElementById("perf-textures"),(!this.trianglesElement||!this.callsElement||!this.geometriesElement||!this.texturesElement)&&console.warn("Bazı performans gösterge elementleri bulunamadı!"),this.createModelLoadPanel(),this.isActive=!0,this.updateInterval=1e3,this.lastUpdate=performance.now(),this.models=new Map,this.jsFiles=new Map,this.totalModelSize=0,this.totalJsSize=0,this.debugMode=!0,this.checkForAppAndInit(),this.monkeyPatchLoaders()}debug(...e){this.debugMode}createModelLoadPanel(){try{const e=document.querySelector(".perf-panel");if(!e){console.warn("Performans paneli bulunamadı!");return}const t=document.createElement("div");t.className="model-load-section",t.innerHTML=`
          <h4>Model ve Dosya Yükleri</h4>
          <div id="model-count">Modeller: 0</div>
          <div id="model-size">Toplam Model Boyutu: 0 MB</div>
          <div id="js-count">JS Dosyaları: 0</div>
          <div id="js-size">Toplam JS Boyutu: 0 MB</div>
          <div class="details-toggle">Detaylar <span>▼</span></div>
          <div class="model-details" style="display:none">
            <h5>Model Detayları</h5>
            <ul id="model-list"></ul>
            <h5>JS Dosya Detayları</h5>
            <ul id="js-list"></ul>
          </div>
        `,e.appendChild(t);const i=t.querySelector(".details-toggle"),s=t.querySelector(".model-details");this._detailsToggleHandler=()=>{const r=s.style.display!=="none";s.style.display=r?"none":"block",i.querySelector("span").textContent=r?"▼":"▲"},i.addEventListener("click",this._detailsToggleHandler),this.modelCountElement=document.getElementById("model-count"),this.modelSizeElement=document.getElementById("model-size"),this.jsCountElement=document.getElementById("js-count"),this.jsSizeElement=document.getElementById("js-size"),this.modelListElement=document.getElementById("model-list"),this.jsListElement=document.getElementById("js-list"),this.debug("Model yükü paneli oluşturuldu")}catch(e){console.error("Model yükü paneli oluşturulurken hata:",e)}}checkForAppAndInit(){try{window.application&&window.application.renderer&&window.application.renderer.instance?this.init():setTimeout(()=>this.checkForAppAndInit(),500)}catch(e){console.error("Application kontrolü sırasında hata:",e),setTimeout(()=>this.checkForAppAndInit(),1e3)}}init(){try{this.renderer=window.application.renderer.instance,window.THREE&&this.debug(`Three.js sürümü: ${window.THREE.REVISION}`),this.update(),window.application.world&&window.application.world.models?this.checkExistingModels():this.debug("Dünya veya modeller bulunamadı")}catch(e){console.error("Performans monitörü başlatılırken hata:",e)}}checkExistingModels(){var e;try{const t=(e=window.application.world)==null?void 0:e.models;if(!t){this.debug("Mevcut modeller bulunamadı");return}this.debug(`${Object.keys(t).length} mevcut model bulundu`),Object.keys(t).forEach(i=>{const s=t[i];s&&this.analyzeModel(i,s)}),this.updateModelStats()}catch(t){console.error("Mevcut modeller kontrol edilirken hata:",t)}}monkeyPatchLoaders(){try{window.THREE&&window.THREE.GLTFLoader?this.patchGlobalGLTFLoader():window.application&&window.application.loaders&&window.application.loaders.gltfLoader?this.patchApplicationGLTFLoader():setTimeout(()=>this.monkeyPatchLoaders(),1e3),this.patchFetchAPI()}catch(e){console.error("Loaderlar patching yapılırken hata:",e)}}patchGlobalGLTFLoader(){try{this.debug("Global THREE.GLTFLoader patching yapılıyor");const e=window.THREE.GLTFLoader.prototype.load;window.THREE.GLTFLoader.prototype.load=(t,i,s,r)=>{const o=performance.now();this.debug(`Model yükleniyor: ${t}`),this.getFileSize(t).then(h=>{const d=t.split("/").pop();this.models.set(d,{url:t,size:h,triangles:0,materials:0,textures:0,loadTime:0})});const l=h=>{const d=performance.now()-o,f=t.split("/").pop();this.debug(`Model yüklendi: ${f} (${d.toFixed(0)} ms)`),this.analyzeGLTF(f,h,d),i&&i(h)};return e.call(this,t,l,s,r)},this.debug("Global THREE.GLTFLoader patching tamamlandı")}catch(e){console.error("GLTFLoader patching yapılırken hata:",e)}}patchApplicationGLTFLoader(){try{this.debug("Application GLTFLoader patching yapılıyor");const e=window.application.loaders.gltfLoader,t=e.load;e.load=(i,s,r,o)=>{const l=performance.now();this.debug(`Model yükleniyor: ${i}`),this.getFileSize(i).then(d=>{const f=i.split("/").pop();this.models.set(f,{url:i,size:d,triangles:0,materials:0,textures:0,loadTime:0})});const h=d=>{const f=performance.now()-l,c=i.split("/").pop();this.debug(`Model yüklendi: ${c} (${f.toFixed(0)} ms)`),this.analyzeGLTF(c,d,f),s&&s(d)};return t.call(e,i,h,r,o)},this.debug("Application GLTFLoader patching tamamlandı")}catch(e){console.error("Application GLTFLoader patching yapılırken hata:",e)}}patchFetchAPI(){try{const e=window.fetch;window.fetch=async(t,i)=>{const s=t instanceof Request?t.url:t;if(typeof s=="string"&&(s.endsWith(".js")||s.endsWith(".glb")||s.endsWith(".gltf"))){const r=performance.now();let o;try{o=await e(t,i)}catch(h){throw console.error(`Fetch hatası (${s}):`,h),h}const l=performance.now()-r;if(s.endsWith(".js"))try{const h=o.clone(),d=parseInt(h.headers.get("content-length")||"0"),f=s.split("/").pop();this.jsFiles.set(f,{url:s,size:d,loadTime:l}),this.totalJsSize+=d,this.debug(`JS dosyası yüklendi: ${f} (${this.formatBytes(d)}, ${l.toFixed(0)} ms)`),this.updateJsStats()}catch(h){console.error(`JS dosyası işlenirken hata (${s}):`,h)}return o}return e(t,i)}}catch(e){console.error("Fetch API patching yapılırken hata:",e)}}async getFileSize(e){try{this.debug(`Dosya boyutu alınıyor: ${e}`);const t=await fetch(e,{method:"HEAD"});if(!t.ok)return this.debug(`Dosya boyutu alınamadı: ${e} - Durum kodu: ${t.status}`),0;const i=parseInt(t.headers.get("content-length")||"0");return this.debug(`Dosya boyutu: ${e} - ${this.formatBytes(i)}`),i}catch(t){return console.warn(`Dosya boyutu alınamadı: ${e}`,t),0}}analyzeGLTF(e,t,i){try{const s=this.models.get(e);if(!s){this.debug(`Model bulunamadı: ${e}`);return}let r=0;const o=new Set,l=new Set;t.scene.traverse(h=>{h.isMesh&&h.geometry&&(h.geometry.index?r+=h.geometry.index.count/3:h.geometry.attributes.position&&(r+=h.geometry.attributes.position.count/3),h.material&&(Array.isArray(h.material)?h.material.forEach(d=>o.add(d)):o.add(h.material)))}),o.forEach(h=>{Object.values(h).forEach(d=>{d&&d.isTexture&&l.add(d)})}),s.triangles=r,s.materials=o.size,s.textures=l.size,s.loadTime=i,this.totalModelSize+=s.size,this.debug(`Model analiz edildi: ${e} - ${r.toLocaleString()} üçgen, ${o.size} materyal, ${l.size} doku`),this.updateModelStats()}catch(s){console.error(`Model analiz edilirken hata: ${e}`,s)}}analyzeModel(e,t){try{this.debug(`Mevcut model analiz ediliyor: ${e}`);let i=0,s=0;const r=new Set,o=new Set;t.traverse&&t.traverse(l=>{l.isMesh&&l.geometry&&(l.geometry.index?i+=l.geometry.index.count/3:l.geometry.attributes.position&&(i+=l.geometry.attributes.position.count/3),s+=this.estimateGeometrySize(l.geometry),l.material&&(Array.isArray(l.material)?l.material.forEach(h=>r.add(h)):r.add(l.material)))}),r.forEach(l=>{Object.values(l).forEach(h=>{h&&h.isTexture&&(o.add(h),s+=this.estimateTextureSize(h))})}),this.debug(`Model analizi tamamlandı: ${e} - ${i.toLocaleString()} üçgen, ${r.size} materyal, ${o.size} doku, yaklaşık ${this.formatBytes(s)}`),this.models.set(e,{size:s,triangles:i,materials:r.size,textures:o.size,loadTime:0}),this.totalModelSize+=s}catch(i){console.error(`Model analizi sırasında hata: ${e}`,i)}}estimateGeometrySize(e){try{let t=0;const i=12,s=12,r=8,o=e.attributes.position?e.attributes.position.count:0;return e.attributes.position&&(t+=o*i),e.attributes.normal&&(t+=o*s),e.attributes.uv&&(t+=o*r),e.index&&(t+=e.index.count*2),t}catch(t){return console.error("Geometri boyutu hesaplanırken hata:",t),0}}estimateTextureSize(e){try{if(!e.image)return 0;const{width:t,height:i}=e.image;return t*i*4}catch(t){return console.error("Doku boyutu hesaplanırken hata:",t),0}}formatBytes(e,t=2){if(e===0)return"0 Bytes";const i=1024,s=t<0?0:t,r=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(i));return parseFloat((e/Math.pow(i,o)).toFixed(s))+" "+r[o]}updateModelStats(){try{if(!this.modelCountElement||!this.modelSizeElement||!this.modelListElement){this.debug("Model istatistikleri için UI elementleri bulunamadı");return}this.modelCountElement.textContent=`Modeller: ${this.models.size}`,this.modelSizeElement.textContent=`Toplam Model Boyutu: ${this.formatBytes(this.totalModelSize)}`,this.modelListElement.innerHTML="",this.models.forEach((e,t)=>{const i=document.createElement("li");i.innerHTML=`
            <strong>${t}</strong>
            <div>Boyut: ${this.formatBytes(e.size)}</div>
            <div>Üçgenler: ${e.triangles.toLocaleString()}</div>
            <div>Materyaller: ${e.materials}</div>
            <div>Dokular: ${e.textures}</div>
            ${e.loadTime?`<div>Yükleme: ${e.loadTime.toFixed(0)} ms</div>`:""}
          `,this.modelListElement.appendChild(i)})}catch(e){console.error("Model istatistikleri güncellenirken hata:",e)}}updateJsStats(){try{if(!this.jsCountElement||!this.jsSizeElement||!this.jsListElement){this.debug("JS istatistikleri için UI elementleri bulunamadı");return}this.jsCountElement.textContent=`JS Dosyaları: ${this.jsFiles.size}`,this.jsSizeElement.textContent=`Toplam JS Boyutu: ${this.formatBytes(this.totalJsSize)}`,this.jsListElement.innerHTML="",this.jsFiles.forEach((e,t)=>{const i=document.createElement("li");i.innerHTML=`
            <strong>${t}</strong>
            <div>Boyut: ${this.formatBytes(e.size)}</div>
            <div>Yükleme: ${e.loadTime.toFixed(0)} ms</div>
          `,this.jsListElement.appendChild(i)})}catch(e){console.error("JS istatistikleri güncellenirken hata:",e)}}update(){if(!this.isActive)return;const e=performance.now();e-this.lastUpdate>=this.updateInterval&&(this.lastUpdate=e,this.updateStats()),requestAnimationFrame(()=>this.update())}updateStats(){try{if(!this.renderer||!this.renderer.info)return;const e=this.renderer.info,t=e.render;t&&(this.trianglesElement&&(this.trianglesElement.textContent=`Üçgenler: ${t.triangles.toLocaleString()}`),this.callsElement&&(this.callsElement.textContent=`Çizimler: ${t.calls}`));const i=e.memory;i&&(this.geometriesElement&&(this.geometriesElement.textContent=`Geometri: ${i.geometries}`),this.texturesElement&&(this.texturesElement.textContent=`Dokular: ${i.textures}`))}catch(e){console.error("İstatistikler güncellenirken hata:",e)}}stop(){this.isActive=!1;try{const e=document.querySelector(".details-toggle");e&&this._detailsToggleHandler&&e.removeEventListener("click",this._detailsToggleHandler)}catch(e){console.error("Temizlik sırasında hata:",e)}this.debug("Performans monitörü durduruldu")}}const Ph=new lT;window.addEventListener("beforeunload",()=>{Ph&&Ph.stop()});window.perfMonitor=Ph;
//# sourceMappingURL=index-C2H1wjp0.js.map
